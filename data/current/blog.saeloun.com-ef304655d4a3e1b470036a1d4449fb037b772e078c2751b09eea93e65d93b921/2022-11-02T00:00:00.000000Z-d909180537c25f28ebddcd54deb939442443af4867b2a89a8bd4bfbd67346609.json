{
  "title":"Rails raises exception when config.active_storage.service is not explicitly set",
  "date":"2022-11-02T00:00:00.000000Z",
  "author":null,
  "id":"https://blog.saeloun.com/2022/11/02/exception-active-record-config.html",
  "link":"https://blog.saeloun.com/2022/11/02/exception-active-record-config.html",
  "content":"<p>ActiveStorage makes it easy for developers to upload files to cloud services like Amazon S3, Google Cloud Storage, \nand more. \nIt also provides a local disk service for development \nand testing. \nRails reads the config value <code class=\"highlighter-rouge\">config.active_storage.service</code> \nto determine which service to use. \nIf this value is not set, \nRails will raise an exception.</p>\n\n<p>However, when the <code class=\"highlighter-rouge\">config.active_storage.service</code> is not set, \nthe application raises a vague error causing unnecessary time lost to debugging.</p>\n\n<h3 id=\"before\">Before</h3>\n<p>This value is set in the environment file via the <code class=\"highlighter-rouge\">rails active_storage:install</code> command. \nHowever, in some cases it can be removed or commented out.</p>\n\n<p>Letâ€™s use a simple example to demonstrate this. \nWe have a <code class=\"highlighter-rouge\">User</code> model with an <code class=\"highlighter-rouge\">avatar</code> attachment.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-ruby\">  <span class=\"k\">class</span> <span class=\"nc\">User</span> <span class=\"o\">&lt;</span> <span class=\"no\">ApplicationRecord</span>\n    <span class=\"n\">has_one_attached</span> <span class=\"ss\">:avatar</span>\n  <span class=\"k\">end</span></code></pre></figure>\n\n<p>When we try to upload an avatar, we get the following error:</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-ruby\">  <span class=\"sr\">/Users/s</span><span class=\"n\">waathi</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"nf\">rbenv</span><span class=\"o\">/</span><span class=\"n\">versions</span><span class=\"o\">/</span><span class=\"mf\">3.1</span><span class=\"o\">.</span><span class=\"mi\">2</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">ruby</span><span class=\"o\">/</span><span class=\"n\">gems</span><span class=\"o\">/</span><span class=\"mf\">3.1</span><span class=\"o\">.</span><span class=\"mi\">0</span><span class=\"o\">/</span><span class=\"n\">gems</span><span class=\"o\">/</span><span class=\"n\">activestorage</span><span class=\"o\">-</span><span class=\"mf\">7.0</span><span class=\"o\">.</span><span class=\"mi\">4</span><span class=\"o\">/</span><span class=\"n\">app</span><span class=\"o\">/</span><span class=\"n\">models</span><span class=\"o\">/</span><span class=\"n\">active_storage</span><span class=\"o\">/</span><span class=\"n\">blob</span><span class=\"p\">.</span><span class=\"nf\">rb</span><span class=\"p\">:</span><span class=\"mi\">90</span><span class=\"ss\">:in</span> <span class=\"sb\">`build_after_unfurling': missing keyword: :filename (ArgumentError)   </span></code></pre></figure>\n\n<p>This is a cryptic error that does not give us any indication of what the problem is. \nIt takes significant effort to figure out that the <code class=\"highlighter-rouge\">config.active_storage.service</code> is not set.</p>\n\n<h3 id=\"after\">After</h3>\n<p>Thanks to <a href=\"https://github.com/rails/rails/pull/44372\">this PR</a> \nActiveStorage gives much more descriptive errors when the <code class=\"highlighter-rouge\">config.active_storage.service</code> is not set.</p>\n\n<figure class=\"highlight\"><pre><code class=\"language-ruby\">  <span class=\"sr\">/Users/s</span><span class=\"n\">waathi</span><span class=\"o\">/</span><span class=\"p\">.</span><span class=\"nf\">rbenv</span><span class=\"o\">/</span><span class=\"n\">versions</span><span class=\"o\">/</span><span class=\"mf\">3.1</span><span class=\"o\">.</span><span class=\"mi\">2</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">ruby</span><span class=\"o\">/</span><span class=\"n\">gems</span><span class=\"o\">/</span><span class=\"mf\">3.1</span><span class=\"o\">.</span><span class=\"mi\">0</span><span class=\"o\">/</span><span class=\"n\">bundler</span><span class=\"o\">/</span><span class=\"n\">gems</span><span class=\"o\">/</span><span class=\"n\">rails</span><span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"n\">d849dfbe8f0</span><span class=\"o\">/</span><span class=\"n\">activestorage</span><span class=\"o\">/</span><span class=\"n\">lib</span><span class=\"o\">/</span><span class=\"n\">active_storage</span><span class=\"o\">/</span><span class=\"n\">attached</span><span class=\"o\">/</span><span class=\"n\">model</span><span class=\"p\">.</span><span class=\"nf\">rb</span><span class=\"p\">:</span><span class=\"mi\">226</span><span class=\"ss\">:in</span> <span class=\"sb\">`validate_global_service_configuration': Missing Active Storage service name. Specify Active Storage service name for config.active_storage.service in config/environments/development.rb (RuntimeError)</span></code></pre></figure>\n\n"
}