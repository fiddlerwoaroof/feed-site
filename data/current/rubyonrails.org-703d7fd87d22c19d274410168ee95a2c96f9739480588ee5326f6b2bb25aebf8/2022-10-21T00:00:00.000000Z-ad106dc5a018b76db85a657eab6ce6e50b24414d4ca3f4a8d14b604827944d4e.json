{
  "title":"An Active Record improvement, performance gains and a bugfix!",
  "date":"2022-10-21T00:00:00.000000Z",
  "author":"siaw23",
  "id":"https://rubyonrails.org/2022/10/21/this-week-in-rails-activerecord-querymethods-reselect-now-accepts-a-hash-performance-gains-and-a-fix-for-ciphertext_for-5254976c",
  "link":"https://rubyonrails.org/2022/10/21/this-week-in-rails-activerecord-querymethods-reselect-now-accepts-a-hash-performance-gains-and-a-fix-for-ciphertext_for-5254976c",
  "content":"<p>Guten Tag! <a href=\"https://twitter.com/siaw23\">Emmanuel</a> here again, with some updates from Rails.</p>\n\n<p><a href=\"https://github.com/rails/rails/pull/46197\">Don’t trigger after_commit :destroy callback again on destroy if record previously was destroyed</a>\nThe <em>after_commit :destroy</em> callback would always run even if a record was destroyed previously. This PR fixes that. Essentially, we don’t want to call <em>after_commit :destroy</em> on unpersisted records.</p>\n\n<p><a href=\"https://github.com/rails/rails/pull/46299\">Allow ErrorReporter to handle several error classes</a>\nErrorReporter now allows you to handle several error classes in one go. You can now handle multiple error classes like so:</p>\n\n<p><em>Rails.error.handle(ArgumentError, TypeError) do\n  # Do some work\nend</em> <a href=\"https://github.com/rails/rails/pull/46284\">Fix ciphertext_for for yet-to-be-encrypted values</a>\n<em>ciphertext_for</em> should return the encrypted value of an attribute that’s encrypted even when the record has not been persisted, before this commit, this wasn’t what we were getting, instead, for an unpersisted record, <em>ciphertext_for</em> returned the plain text value of the attribute. This PR fixes that.</p>\n\n<p><a href=\"https://github.com/rails/rails/pull/46231\">Avoid unnecessary serialize calls after save</a>\nWe’ve got some performance gains with this one: This commit memoizes <em>value_for_database</em> so that <em>serialize</em> is not called a 2nd time after save. Because <em>value</em> is the single source of truth and can change in place, the memoization carefully checks for when <em>value</em> differs from the memoized <em>@value_for_database</em>. Verbatim from the commit message. \uD83D\uDE0E</p>\n\n<p><a href=\"https://github.com/rails/rails/pull/46253\">Allow ActiveRecord::QueryMethods#reselect to accept a hash</a>\nThis PR allows <em>ActiveRecord::QueryMethods#reselect</em> to receive hash values, similar to <a href=\"https://github.com/rails/rails/pull/45612\">this PR</a> that allowed <em>ActiveRecord::QueryMethods#select</em> to accept hashes.</p>\n\n<p><a href=\"https://contributors.rubyonrails.org/contributors/in-time-window/20221014-20221021\">21 contributors improved</a> Rails in the past week. We’ll bring you more updates next week!</p>\n\n<p>Take care.</p>\n\n<p><i><a href=\"https://world.hey.com/this.week.in.rails\">Subscribe</a> to get these updates mailed to you.</i></p>"
}