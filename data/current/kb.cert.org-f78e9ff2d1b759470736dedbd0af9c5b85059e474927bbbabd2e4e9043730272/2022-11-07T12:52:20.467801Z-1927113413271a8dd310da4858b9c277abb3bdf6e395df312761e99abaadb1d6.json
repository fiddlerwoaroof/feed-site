{
  "title":"VU#855201: L2 network security controls can be bypassed using VLAN 0 stacking and/or 802.3 headers",
  "date":"2022-11-07T12:52:20.467801Z",
  "author":null,
  "id":"https://kb.cert.org/vuls/id/855201",
  "link":"https://kb.cert.org/vuls/id/855201",
  "content":"\n\n<div class=\"row\" id=\"content\">\n  <div class=\"large-9 medium-9 columns\">\n    <div class=\"blog-post\">\n      <div class=\"row\">\n        <div class=\"large-12 columns\">\n\t  \n\t  <h3 id=\"overview\">Overview</h3>\n<p>Layer-2 (L2) network security controls provided by various devices, such as switches, routers, and operating systems, can be bypassed by stacking Ethernet protocol headers. An attacker can send crafted packets through vulnerable devices to cause Denial-of-service (DoS) or to perform a man-in-the-middle (MitM) attack against a target network.</p>\n<h3 id=\"description\">Description</h3>\n<p>This vulnerability exists within Ethernet encapsulation protocols that allow for stacking of Virtual Local Area Network (VLAN) headers.  Network standards such as  <a href=\"https://standards.ieee.org/standard/802_1Q-1998.html\">IEEE 802.1Q-1998</a> and <a href=\"https://standards.ieee.org/standard/802_3-2018.html\">IEEE 802.3</a> define a system of tagging Ethernet frames that help isolate networks to provide virtual networking capability.  IEEE standard <a href=\"https://standards.ieee.org/standard/802_1ad-2005.html\">802.1ad</a>, also known as QinQ, allows for the stacking of these VLAN tags, extending the VLAN capability into multiple network segments. This widely adopted Ethernet feature is also referred to as &quot;provider bridging&quot; and &quot;stacked VLANs&quot;.  In order to properly isolate and protect these virtual networks, many network devices and operating systems provide an L2 network filtering capability.   It is important to note that in modern computing environments , such as Cloud based virtualization and virtual networking, the L2 network capability is extended beyond the local area networks.  This can lead to exposure of this vulnerabilities in unintended ways to the larger Internet.</p>\n<p>The identified vulnerabilities allow an attacker to bypass the security controls by stacking encapsulating headers. This is done by stacking a combination of one or more VLAN 0 (priority tag) headers and <a href=\"https://standards.ieee.org/standard/802_2-1985.html\">802.2</a> LLC/SNAP headers.  An attacker can send these crafted network packets and exploit vulnerable devices by bypassing their inspection and filtering capabilities.   Some examples of bypassed L2 inspections include, but are not limited to, <a href=\"https://blogs.nwkings.com/what-is-dai-dynamic-arp-inspection/\">Dynamic ARP inspection</a>, <a href=\"https://datatracker.ietf.org/doc/rfc4861/\">IPv6 Neighbor Discovery</a> (ND) protection, and <a href=\"https://datatracker.ietf.org/doc/html/rfc6105\">IPv6 RA Guard</a>. </p>\n<p><strong>CVE-2021-27853</strong>\nLayer 2 network filtering capabilities such as IPv6 RA guard or ARP inspection can be bypassed using combinations of VLAN 0 headers and LLC/SNAP headers.</p>\n<p><strong>CVE-2021-27854</strong>\nLayer 2 network filtering capabilities such as IPv6 RA guard can be bypassed using combinations of VLAN 0 headers, LLC/SNAP headers in Ethernet to Wifi frame translation and the reverse Wifi to Ethernet.</p>\n<p><strong>CVE-2021-27861</strong>\nLayer 2 network filtering capabilities such as IPv6 RA guard can be bypassed using LLC/SNAP headers with invalid length (and optionally VLAN0 headers).</p>\n<p><strong>CVE-2021-27862</strong>\nLayer 2 network filtering capabilities such as IPv6 RA guard can be bypassed using LLC/SNAP headers with invalid length and Ethernet to Wifi frame conversion (and optionally VLAN0 headers).</p>\n<h3 id=\"impact\">Impact</h3>\n<p>An attacker can bypass security controls and deceive a locally connected target host to route traffic to arbitrary destinations.  Victim devices experience either a DoS (blackholing traffic) or MitM (observing the unencrypted traffic and maybe breaking encryption). </p>\n<h3 id=\"solution\">Solution</h3>\n<h4 id=\"apply-updates\">Apply Updates</h4>\n<p>Install vendor-provided patches and updates to ensure malicious content is blocked or rejected by the security controls (such as RA Guard), thereby blocking router advertisements or other network configuration related advertisements that originate on host ports.</p>\n<h4 id=\"inspect-and-block-router-advertisements\">Inspect and Block Router Advertisements</h4>\n<p>Utilize the interface security controls on your router or managed switch to perform DHCP snooping, IPv6 RA guard, IP source guard, and ARP/ND inspection. It is also recommended to only allow needed protocol on access ports (ARP/ICMP/IPv4/IPv6), some applications may have additional needs so be prepared to modify the allow list as needed. </p>\n<h3 id=\"acknowledgements\">Acknowledgements</h3>\n<p>Thanks to Etienne Champetier for reporting this vulnerability. </p>\n<p>This document was written by Timur Snoke.</p>\n\t  \n\t</div>\n      </div>\n      <div class=\"row\">\n\t<div class=\"large-12 columns\">\n\t  <h3> Vendor Information </h3>\n\t  \n\t  <div id=\"vendorinfo\">\n\t    One or more vendors are listed for this advisory. Please reference the full report for more information.\n\t  </div>\n\t  \n\t</div>\n      </div>\n      <br>\n      \n      \n      <div class=\"row\">\n\t<div class=\"large-12 columns\">\n\t  <h3> References </h3>\n\t  <ul>\n\t    \n\t    \n\t    \n            <li><a href=\"https://blog.champtar.fr/VLAN0/\" class=\"vulreflink safereflink\" rel=\"noopener\">https://blog.champtar.fr/VLAN0/</a></li>\n            \n          \n\t    \n            <li><a href=\"https://blog.champtar.fr/VLAN0_LLC_SNAP/\" class=\"vulreflink safereflink\" rel=\"noopener\">https://blog.champtar.fr/VLAN0_LLC_SNAP/</a></li>\n            \n          \n\t    \n            <li><a href=\"https://lore.kernel.org/netdev/CAOdf3grDKBkYmt54ZAzG1zZ6zz1JXeoHSv67_Fc9-nRiY662mQ@mail.gmail.com/\" class=\"vulreflink safereflink\" rel=\"noopener\">https://lore.kernel.org/netdev/CAOdf3grDKBkYmt54ZAzG1zZ6zz1JXeoHSv67_Fc9-nRiY662mQ@mail.gmail.com/</a></li>\n            \n          \n\t    \n            <li><a href=\"https://bugs.launchpad.net/neutron/+bug/1884341\" class=\"vulreflink safereflink\" rel=\"noopener\">https://bugs.launchpad.net/neutron/+bug/1884341</a></li>\n            \n          \n\t    \n            <li><a href=\"https://standards.ieee.org/standard/802_1Q-1998.html\" class=\"vulreflink safereflink\" rel=\"noopener\">https://standards.ieee.org/standard/802_1Q-1998.html</a></li>\n            \n          \n\t    \n            <li><a href=\"https://standards.ieee.org/standard/802_2-1985.html\" class=\"vulreflink safereflink\" rel=\"noopener\">https://standards.ieee.org/standard/802_2-1985.html</a></li>\n            \n          \n\t    \n            <li><a href=\"https://standards.ieee.org/standard/802_3-2018.html\" class=\"vulreflink safereflink\" rel=\"noopener\">https://standards.ieee.org/standard/802_3-2018.html</a></li>\n            \n          \n\t    \n            <li><a href=\"https://standards.ieee.org/standard/802_1ad-2005.html\" class=\"vulreflink safereflink\" rel=\"noopener\">https://standards.ieee.org/standard/802_1ad-2005.html</a></li>\n            \n          \n\t    \n            <li><a href=\"https://blogs.nwkings.com/what-is-dai-dynamic-arp-inspection/\" class=\"vulreflink safereflink\" rel=\"noopener\">https://blogs.nwkings.com/what-is-dai-dynamic-arp-inspection/</a></li>\n            \n          \n\t    \n            <li><a href=\"https://datatracker.ietf.org/doc/rfc4861/\" class=\"vulreflink safereflink\" rel=\"noopener\">https://datatracker.ietf.org/doc/rfc4861/</a></li>\n            \n          \n\t    \n            <li><a href=\"https://datatracker.ietf.org/doc/html/rfc6105\" class=\"vulreflink safereflink\" rel=\"noopener\">https://datatracker.ietf.org/doc/html/rfc6105</a></li>\n            \n          \n\t    \n            <li><a href=\"https://www.ieee802.org/1/files/public/docs2022/q-rev-seaman-priority-in-tags-0122-v0.pdf \" class=\"vulreflink safereflink\" rel=\"noopener\">https://www.ieee802.org/1/files/public/docs2022/q-rev-seaman-priority-in-tags-0122-v0.pdf </a></li>\n            \n          \n\t    \n            <li><a href=\"https://www.ieee802.org/1/files/public/docs2022/q-rev-seaman-vlan-tag-encoding-ppt-0122-v0.pdf\" class=\"vulreflink safereflink\" rel=\"noopener\">https://www.ieee802.org/1/files/public/docs2022/q-rev-seaman-vlan-tag-encoding-ppt-0122-v0.pdf</a></li>\n            \n          \n\t  \n\t  </ul>\n\t</div>\n      </div>\n      \n      <h3>Other Information</h3>\n        <div class=\"vulcontent\">\n          <table class=\"unstriped\">\n            <tbody>\n\t      \n              <tr>\n                <td width=\"200\"><b>CVE IDs:</b></td>\n\t\t<td>\n\t\t\n\t\t\n                <a href=\"http://web.nvd.nist.gov/view/vuln/detail?vulnId=2021-27861\">CVE-2021-27861  </a>\n\t\t\n                \n\t\t\n                <a href=\"http://web.nvd.nist.gov/view/vuln/detail?vulnId=2021-27862\">CVE-2021-27862  </a>\n\t\t\n                \n\t\t\n                <a href=\"http://web.nvd.nist.gov/view/vuln/detail?vulnId=2021-27854\">CVE-2021-27854  </a>\n\t\t\n                \n\t\t\n                <a href=\"http://web.nvd.nist.gov/view/vuln/detail?vulnId=2021-27853\">CVE-2021-27853  </a>\n\t\t\n                \n\t\t</td>\n\t      </tr>\n\t      \n\t      <tr>\n\t\t<td>\n\t\t  <b>Date Public:</b>\n\t\t</td>\n                <td>2022-09-27</td>\n              </tr>\n              <tr>\n                <td><b>Date First Published:</b></td>\n                <td id=\"datefirstpublished\">2022-09-27</td>\n              </tr>\n              <tr>\n                <td><b>Date Last Updated: </b></td>\n                <td>2022-11-07 12:52 UTC</td>\n              </tr>\n              <tr>\n                <td><b>Document Revision: </b></td>\n                <td>7 </td>\n              </tr>\n            </tbody>\n          </table>\n\t</div>\n    </div>\n  </div>\n  <div class=\"large-3 medium-3 columns\">\n  <div class=\"sticky\">\n    <div class=\"sidebar-links\">\n      <ul class=\"menu vertical\">\n\t<li><a href=\"https://vuls.cert.org/confluence/display/VIN/Vulnerability+Note+Help\" rel=\"noopener\">About vulnerability notes</a></li>\n\t<li><a href=\"mailto:cert@cert.org?Subject=VU%23855201 Feedback\">Contact us about this vulnerability</a></li>\n\t<li><a href=\"https://vuls.cert.org/confluence/display/VIN/Case+Handling#CaseHandling-Givingavendorstatusandstatement\">Provide a vendor statement</a></li>\n      </ul>\n    </div>\n  </div>\n</div>\n\n</div>\n\n\n\n"
}