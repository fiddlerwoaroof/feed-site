{
  "title":"VU#915563: Microsoft Exchange vulnerable to server-side request forgery and remote code execution.",
  "date":"2022-11-10T01:59:24.894200Z",
  "author":null,
  "id":"https://kb.cert.org/vuls/id/915563",
  "link":"https://kb.cert.org/vuls/id/915563",
  "content":"\n\n<div class=\"row\" id=\"content\">\n  <div class=\"large-9 medium-9 columns\">\n    <div class=\"blog-post\">\n      <div class=\"row\">\n        <div class=\"large-12 columns\">\n\t  \n\t  <h3 id=\"overview\">Overview</h3>\n<p>Microsoft Exchange Server 2019, Exchange Server 2016 and Exchange Server 2013 are vulnerable to a server-side request forgery (SSRF) attack and remote code execution.  An authenticated attacker can use the combination of these two vulnerabilities to elevate privileges and execute arbitrary code on the target Exchange server. </p>\n<h3 id=\"description\">Description</h3>\n<p>Microsoft Exchange Server's <a href=\"https://learn.microsoft.com/en-us/exchange/architecture/client-access/autodiscover?view=exchserver-2019\"> Autodiscover service</a> is a web service widely available to any Microsoft Exchange Web Services (EWS) client.  Since Microsoft Exchange version 2016, the Autodiscover service has become an integral part of the Microsoft Exchange system, and it is no longer independently provided by a Client Access server.  The Autodiscover service and a number of other privileged mailbox services are hosted on the default Internet Information Services server running on the Mailbox server.  </p>\n<p>Cybersecurity company GTSC <a href=\"https://www.gteltsc.vn/blog/warning-new-attack-campaign-utilized-a-new-0day-rce-vulnerability-on-microsoft-exchange-server-12715.html\">observed an abuse of the Autodiscover service in August of 2022</a> using a crafted URL SSRF attack, similar to the earlier <a href=\"https://techcommunity.microsoft.com/t5/exchange-team-blog/proxyshell-vulnerabilities-and-your-exchange-server/ba-p/2684705\">ProxyShell</a> vulnerability reported in August 2021.  The observed attack appears to have implemented <a href=\"https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-41040\">CVE-2022-41040</a> to gain privileged access and <a href=\"https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-41082\">CVE-2022-41082</a> to perform remote code execution via PowerShell.  Microsoft Security Research Center has <a href=\"https://msrc-blog.microsoft.com/2022/09/29/customer-guidance-for-reported-zero-day-vulnerabilities-in-microsoft-exchange-server/\">acknowledged the vulnerability and provided guidance for mitigation</a>.  The guidance highlights that Microsoft Exchange Online customers will be provided with detection and mitigation defenses automatically from Microsoft's managed Infrastructure, informing them of any attempts to exploit these vulnerabilities. </p>\n<h3 id=\"impact\">Impact</h3>\n<p>An authenticated remote attacker can perform SSRF attacks to escalate privileges and execute arbtirary PowerShell code on vulnerable Microsoft Exchange servers.  As the attack is targeted against Microsoft Exchange Mailbox server, the attacker can potentially gain access to other resources via lateral movement into Exchange and Active Directory environments.</p>\n<h3 id=\"solution\">Solution</h3>\n<h4 id=\"workaround-guidance\">Workaround guidance</h4>\n<p>Microsoft has provided guidance in their <a href=\"https://msrc-blog.microsoft.com/2022/09/29/customer-guidance-for-reported-zero-day-vulnerabilities-in-microsoft-exchange-server/\">recent blog post</a> to address the issue. Note that Microsoft has updated their guidance for the Option 3 Step 6 with the URL filter to be <em>.*autodiscover\\.json.*Powershell.*</em> (excluding the <em>@</em> symbol)  instead of the earlier <em>.*autodiscover\\.json.*\\@.*Powershell.*</em>. The recommended block pattern is a regular expression suggested by  <a href=\"https://twitter.com/testanull\">Jang</a> to prevent known variants of the #ProxyNotShell attacks.   Microsoft further updated their advisory on October 8th suggesting <strong>Condition Input</strong> should be changed from {URL} to {UrlDecode:{REQUEST_URI}} to ensure all encoded variations are evaluated before being blocked.</p>\n<h4 id=\"apply-update-when-available\">Apply update when available</h4>\n<p>As of October 3, 2022, there is no patch available to mitigate this issue. It is recommended that Microsoft Exchange administrators stay on alert for any advisory or patch released by Microsoft.  Note the latest security updates from Microsoft on <a href=\"https://techcommunity.microsoft.com/t5/exchange-team-blog/released-october-2022-exchange-server-security-updates/ba-p/3646263\">October 11th</a> <strong>do not</strong> address the vulnerabilities highlighted here. Even with the workaround in place, many on-premise Microsoft Exchange instances remain at risk until Microsoft provides a patch and the patch has been applied.</p>\n<p>On November 8th 2022, Microsoft has provided fixes as part of their Patch Tuesday rollout, see updated Microsoft's guidance at <a href=\"https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-41082\">CVE-2022-41082</a> and <a href=\"https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-41040\">CVE-2022-41040</a>.  </p>\n<h4 id=\"third-party-web-application-protection\">Third-party web application protection</h4>\n<p>Exchange Administrators who use third-party Web Application Firewall (WAF) products can implement the recommended URL filters and blocks as part of their WAF policy.</p>\n<h4 id=\"other-mitigations\">Other mitigations</h4>\n<p>Exchange Administrators can limit the outgoing connection from the Exchange Mailbox server using specific allowed list on an outgoing proxy to limit suspicious web requests.</p>\n<p>This document was written by Vijay Sarvepalli.</p>\n\t  \n\t</div>\n      </div>\n      <div class=\"row\">\n\t<div class=\"large-12 columns\">\n\t  <h3> Vendor Information </h3>\n\t  \n\t  <div id=\"vendorinfo\">\n\t    One or more vendors are listed for this advisory. Please reference the full report for more information.\n\t  </div>\n\t  \n\t</div>\n      </div>\n      <br>\n      \n      \n      <div class=\"row\">\n\t<div class=\"large-12 columns\">\n\t  <h3> References </h3>\n\t  <ul>\n\t    \n\t    \n\t    \n            <li><a href=\"https://msrc-blog.microsoft.com/2022/09/29/customer-guidance-for-reported-zero-day-vulnerabilities-in-microsoft-exchange-server/\" class=\"vulreflink safereflink\" rel=\"noopener\">https://msrc-blog.microsoft.com/2022/09/29/customer-guidance-for-reported-zero-day-vulnerabilities-in-microsoft-exchange-server/</a></li>\n            \n          \n\t    \n            <li><a href=\"https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-41040\" class=\"vulreflink safereflink\" rel=\"noopener\">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-41040</a></li>\n            \n          \n\t    \n            <li><a href=\"https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-41082\" class=\"vulreflink safereflink\" rel=\"noopener\">https://msrc.microsoft.com/update-guide/vulnerability/CVE-2022-41082</a></li>\n            \n          \n\t    \n            <li><a href=\"https://www.microsoft.com/security/blog/2022/09/30/analyzing-attacks-using-the-exchange-vulnerabilities-cve-2022-41040-and-cve-2022-41082/\" class=\"vulreflink safereflink\" rel=\"noopener\">https://www.microsoft.com/security/blog/2022/09/30/analyzing-attacks-using-the-exchange-vulnerabilities-cve-2022-41040-and-cve-2022-41082/</a></li>\n            \n          \n\t    \n            <li><a href=\"https://doublepulsar.com/proxynotshell-the-story-of-the-claimed-zero-day-in-microsoft-exchange-5c63d963a9e9\" class=\"vulreflink safereflink\" rel=\"noopener\">https://doublepulsar.com/proxynotshell-the-story-of-the-claimed-zero-day-in-microsoft-exchange-5c63d963a9e9</a></li>\n            \n          \n\t    \n            <li><a href=\"https://rw.md/2022/11/09/ProxyNotRelay.html\" class=\"vulreflink safereflink\" rel=\"noopener\">https://rw.md/2022/11/09/ProxyNotRelay.html</a></li>\n            \n          \n\t  \n\t  </ul>\n\t</div>\n      </div>\n      \n      <h3>Other Information</h3>\n        <div class=\"vulcontent\">\n          <table class=\"unstriped\">\n            <tbody>\n\t      \n              <tr>\n                <td width=\"200\"><b>CVE IDs:</b></td>\n\t\t<td>\n\t\t\n\t\t\n                <a href=\"http://web.nvd.nist.gov/view/vuln/detail?vulnId=2022-41082\">CVE-2022-41082  </a>\n\t\t\n                \n\t\t\n                <a href=\"http://web.nvd.nist.gov/view/vuln/detail?vulnId=2022-41040\">CVE-2022-41040  </a>\n\t\t\n                \n\t\t</td>\n\t      </tr>\n\t      \n\t      <tr>\n\t\t<td>\n\t\t  <b>Date Public:</b>\n\t\t</td>\n                <td>2022-10-03</td>\n              </tr>\n              <tr>\n                <td><b>Date First Published:</b></td>\n                <td id=\"datefirstpublished\">2022-10-03</td>\n              </tr>\n              <tr>\n                <td><b>Date Last Updated: </b></td>\n                <td>2022-11-10 01:59 UTC</td>\n              </tr>\n              <tr>\n                <td><b>Document Revision: </b></td>\n                <td>9 </td>\n              </tr>\n            </tbody>\n          </table>\n\t</div>\n    </div>\n  </div>\n  <div class=\"large-3 medium-3 columns\">\n  <div class=\"sticky\">\n    <div class=\"sidebar-links\">\n      <ul class=\"menu vertical\">\n\t<li><a href=\"https://vuls.cert.org/confluence/display/VIN/Vulnerability+Note+Help\" rel=\"noopener\">About vulnerability notes</a></li>\n\t<li><a href=\"mailto:cert@cert.org?Subject=VU%23915563 Feedback\">Contact us about this vulnerability</a></li>\n\t<li><a href=\"https://vuls.cert.org/confluence/display/VIN/Case+Handling#CaseHandling-Givingavendorstatusandstatement\">Provide a vendor statement</a></li>\n      </ul>\n    </div>\n  </div>\n</div>\n\n</div>\n\n\n\n"
}