<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Hint Blog Feed]]></title><description><![CDATA[We grow your business through practical software solutions. We're all about people, simplicity, and integrity.]]></description><link>https://hint.io</link><generator>GatsbyJS</generator><lastBuildDate>Thu, 09 Jun 2022 21:19:38 GMT</lastBuildDate><item><title><![CDATA[Is your team struggling to ship code?]]></title><description><![CDATA[At first, it was easy. The future was bright. But the codebase grew, and so did the team. Instead of shipping features, they're fixing…]]></description><link>https://hint.io/helps-you-ship-code</link><guid isPermaLink="false">https://hint.io/helps-you-ship-code</guid><content:encoded>&lt;p&gt;At first, it was easy. The future was bright. But the codebase grew, and so did the team. Instead of shipping features, they&amp;#x27;re fixing regressions, and now the business team is wondering, &amp;quot;what happened?&amp;quot;.&lt;/p&gt;&lt;p&gt;Sound familiar? It&amp;#x27;s a typical story. Before you can scale your Rails application any further, you have some housekeeping to do. The problem is that finding the time is nearly impossible at this stage. We can help.&lt;/p&gt;&lt;h2&gt;Onboarding new developers taking forever?&lt;/h2&gt;&lt;p&gt;Every new-hire can ship code on their first day on the job. We&amp;#x27;ll automate everything we can and document the rest.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Create a fine-tuned development environment with Docker that is fast on macOS and Windows too.&lt;/li&gt;&lt;li&gt;Utilize all the power of VS Code by running it inside Docker with the remote-containers extension.&lt;/li&gt;&lt;li&gt;Implement a Software Development Life Cycle (SDLC) that fits your team.&lt;/li&gt;&lt;li&gt;Automate the setup process and provide command-line-tooling to stay productive, going forward.&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;Can&amp;#x27;t scale in production? Heroku prices killing you?&lt;/h2&gt;&lt;p&gt;We&amp;#x27;ll build modern infrastructure with Docker &amp;amp; Kubernetes, teaching your team the ins &amp;amp; outs as we go. Our strategy is to keep things as simple as possible while empowering your engineers to operate the infrastructure themselves before our work is done.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Deploy your Rails applications with Docker &amp;amp; Kubernetes.&lt;/li&gt;&lt;li&gt;Create reproducible infrastructure using CDK &amp;amp; Terraform.&lt;/li&gt;&lt;li&gt;Utilize canary deployments to minimize risk and experiment with new features.&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;Slow or intermittently failing CI killing productivity?&lt;/h2&gt;&lt;p&gt;Our team of expert consultants will help you determine root-causes and develop short-term &amp;amp; long-term solutions.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Modernize your CI with parallel workflows on GitHub Actions.&lt;/li&gt;&lt;li&gt;Finally get to the bottom of those &amp;#x27;flakey&amp;#x27; tests that eat up developer time &amp;amp; focus.&lt;/li&gt;&lt;li&gt;No test suite? No problem. We&amp;#x27;ll get your team started with current best practices.&lt;/li&gt;&lt;/ul&gt;&lt;blockquote&gt;&lt;p&gt;These testing improvements have already increased the efficiency of developers working on the code.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Scott C, Concord software architect&lt;/li&gt;&lt;/ul&gt;&lt;/blockquote&gt;&lt;h2&gt;Application dependencies outdated?&lt;/h2&gt;&lt;p&gt;Upgrades often take a back seat to bug fixes or new features. Unfortunately, putting off maintenance creates technical debt, which can bankrupt your app in the long-run.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Upgrade Ruby, Rails, and other application dependencies.&lt;/li&gt;&lt;li&gt;Upgrade or migrate development/test dependencies (phantomjs -&amp;gt; headless chrome anyone?).&lt;/li&gt;&lt;li&gt;Safely migrate from protected attributes -&amp;gt; strong parameters.&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;We&amp;#x27;re Hint, and we&amp;#x27;ll help your team ship code.&lt;/h2&gt;&lt;p&gt;Our mission is to transform how software is made by building a better, more sustainable development process for everyone. Interested? We&amp;#x27;d love to talk.&lt;/p&gt;&lt;div style=&quot;margin-top:1.5rem&quot;&gt;&lt;div class=&quot;container-0-1-1 container-0-1-11&quot;&gt;&lt;div class=&quot;innerContainer-0-1-2 innerContainer-0-1-12&quot;&gt;&lt;div class=&quot;row no-gutters&quot;&gt;&lt;div class=&quot;col-md-10 false angleContainer-0-1-3&quot;&gt;&lt;div class=&quot;angle-0-1-4&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;div class=&quot;col-11 col-lg-3 false left-0-1-6 left-0-1-13&quot;&gt;&lt;img src=&quot;data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTAzcHgiIGhlaWdodD0iODFweCIgdmlld0JveD0iMCAwIDEwMyA4MSIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4KICAgIDwhLS0gR2VuZXJhdG9yOiBTa2V0Y2ggNTEuMyAoNTc1NDQpIC0gaHR0cDovL3d3dy5ib2hlbWlhbmNvZGluZy5jb20vc2tldGNoIC0tPgogICAgPHRpdGxlPkZpbGwgMTwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxkZWZzPjwvZGVmcz4KICAgIDxnIGlkPSJXZWJzaXRlLVVJIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iY29udGFjdF8xMDcwIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMTM4LjAwMDAwMCwgLTQwNS4wMDAwMDApIiBmaWxsPSIjRkZGRkZGIj4KICAgICAgICAgICAgPGcgaWQ9IkNvbnRhY3QtRmllbGQtR3JvdXAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDY3LjAwMDAwMCwgMzQxLjAwMDAwMCkiPgogICAgICAgICAgICAgICAgPGcgaWQ9IlJlZC1CYWNrc2hhcGUiPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMzkuNjU5MjE1LDY0LjUgTDEzOS42NTkyMTUsNjkuMjc5NTI4NCBMMTY4LjUwNzI1Myw2OS4yNzk1Mjg0IEwxNjguNTA3MjUzLDk3LjgwNzMzODQgTDE3My4yODc5NzYsOTcuODA3MzM4NCBMMTczLjI4Nzk3Niw2NC41IEwxMzkuNjU5MjE1LDY0LjUgWiBNMTE3LjkwOTk3MSw2OS4yNzk1Mjg0IEwxMzMuODUyMDg4LDY5LjI3OTUyODQgTDEzMy44NTIwODgsNjQuNSBMMTE3LjkwOTk3MSw2NC41IEwxMTcuOTA5OTcxLDY5LjI3OTUyODQgWiBNMTA2LjQyNTk1OSw2OS4yNzk1Mjg0IEwxMTMuNDg4OTA3LDY5LjI3OTUyODQgTDExMy40ODg5MDcsNjQuNSBMMTA2LjQyNTk1OSw2NC41IEwxMDYuNDI1OTU5LDY5LjI3OTUyODQgWiBNODIuMzA3MjYzNyw3NS4xMzQ0NTA3IEw4Mi4zMDcyNjM3LDEzMy4yOTI5NDcgTDE0NC4wNzY2OTQsMTMzLjI5Mjk0NyBMMTQ0LjA3NjY5NCwxMzkuNDI4NjY2IEw3Ni40OTY1NTIxLDEzOS40Mjg2NjYgTDc2LjQ5NjU1MjEsOTEuOTcxNTM0MyBMNzEuNzE3MDIzNyw5MS45NzE1MzQzIEw3MS43MTcwMjM3LDE0NC4yMDcgTDE0OC44NTc0MTcsMTQ0LjIwNyBMMTQ4Ljg1NzQxNywxMzMuMjkyOTQ3IEwxNjIuNzgyNTczLDEzMy4yOTI5NDcgTDE2Mi43ODI1NzMsMTMwLjkwMzE4MyBMMTYyLjc4MjU3Myw3NS4xMzQ0NTA3IEw4Mi4zMDcyNjM3LDc1LjEzNDQ1MDcgWiBNOTAuMzgzNDcxOCw3OS45MTM5NzkgTDE1NC43MDYzNjUsNzkuOTEzOTc5IEwxMjIuNTQ0OTE4LDEwOS43OTU1OTEgTDkwLjM4MzQ3MTgsNzkuOTEzOTc5IFogTTEzNi45Nzc4OTksMTAyLjkwOTQ4NSBMMTU4LjAwMzA0NSw4My4zNzU1NTI1IEwxNTguMDAzMDQ1LDEyNS42NjM2MjUgTDEzNi45Nzc4OTksMTAyLjkwOTQ4NSBaIE04Ny4wODc5ODcsODMuMzc1NTUyNSBMMTA3LjY4MTc4LDEwMi41MTAzOTQgTDg3LjA4Nzk4NywxMjQuNzk0OTQ1IEw4Ny4wODc5ODcsODMuMzc1NTUyNSBaIE0xMTEuMTgxNTksMTA1Ljc2Mjg2MyBMMTIyLjU0NDkxOCwxMTYuMzE5NjQ3IEwxMzMuNDc1NywxMDYuMTYzMTQ5IEwxNTQuMTI4MDQyLDEyOC41MTM0MTkgTDkwLjE2MDAyODksMTI4LjUxMzQxOSBMMTExLjE4MTU5LDEwNS43NjI4NjMgWiBNMTY4LjUwNzI1MywxMTAuMTI1Mzc4IEwxNzMuMjg3OTc2LDExMC4xMjUzNzggTDE3My4yODc5NzYsMTAzLjA2MjQzIEwxNjguNTA3MjUzLDEwMy4wNjI0MyBMMTY4LjUwNzI1MywxMTAuMTI1Mzc4IFoiIGlkPSJGaWxsLTEiPjwvcGF0aD4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+&quot; class=&quot;mailIcon-0-1-5&quot; alt=&quot;&quot;/&gt;&lt;/div&gt;&lt;div class=&quot;col-11 offset-1 offset-lg-0 col-lg-7 right-0-1-7&quot;&gt;&lt;h2&gt;Let&amp;#x27;s talk about your next project&lt;/h2&gt;&lt;form&gt;&lt;div class=&quot;inputContainer-0-1-8&quot;&gt;&lt;label for=&quot;name&quot;&gt;name&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot; value=&quot;&quot; required=&quot;&quot;/&gt;&lt;/div&gt;&lt;div class=&quot;inputContainer-0-1-8&quot;&gt;&lt;label for=&quot;email&quot;&gt;email&lt;/label&gt;&lt;input type=&quot;text&quot; id=&quot;email&quot; name=&quot;email&quot; value=&quot;&quot; required=&quot;&quot;/&gt;&lt;/div&gt;&lt;div class=&quot;inputContainer-0-1-8&quot;&gt;&lt;label for=&quot;description&quot;&gt;Description&lt;/label&gt;&lt;textarea id=&quot;description&quot; name=&quot;description&quot; required=&quot;&quot;&gt;&lt;/textarea&gt;&lt;/div&gt;&lt;button type=&quot;submit&quot; class=&quot;submitButton-0-1-9 &quot;&gt;Send&lt;/button&gt;&lt;div&gt;&lt;/div&gt;&lt;/form&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Case Study: Angi]]></title><description><![CDATA[Executive Summary Founded in 1995, Angi (formerly Angie’s List) connects individuals looking for home improvement, repair and household…]]></description><link>https://hint.io/blog/angi-case-study</link><guid isPermaLink="false">https://hint.io/blog/angi-case-study</guid><dc:creator><![CDATA[benWood]]></dc:creator><pubDate>Tue, 31 May 2022 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;Executive Summary&lt;/h2&gt;&lt;p&gt;Founded in 1995, Angi (formerly Angie’s List) connects individuals looking for home improvement, repair and household services with home service professionals. At the center of the Angi Services business is a Ruby on Rails-based web application internally known as &amp;quot;Handybook&amp;quot;. Angi engaged Hint&amp;#x27;s services to upgrade Handybook from Rails 4.1 and Ruby 2.3 to the latest versions of Ruby and Rails.&lt;/p&gt;&lt;h2&gt;Challenges&lt;/h2&gt;&lt;p&gt;Angi is experiencing accelerated growth. Keeping application dependencies up-to-date is always important, but it&amp;#x27;s absolutely essential in today&amp;#x27;s developer market. Attracting and retaining top talent is difficult already; add an outdated stack into the mix, and it&amp;#x27;s nearly impossible. Security &amp;amp; compliance risks can be mitigated by patching old dependencies, but there is no shortcut to improving developer happiness. With this in mind, Angi chose Hint as its partner to establish a process by which major dependency upgrades can be performed safely &amp;amp; continuously.&lt;/p&gt;&lt;h2&gt;How we helped&lt;/h2&gt;&lt;p&gt;Angi&amp;#x27;s services are in high demand, and Handybook is an essential application. Featuring deep integration with third-party services and 40+ microservices, Handybook has a lot of moving parts. Aggressive caching, database sharding, and horizontal scaling are all important factors allowing the application to meet demand.&lt;/p&gt;&lt;h3&gt;Upgrade Manifesto&lt;/h3&gt;&lt;p&gt;Before starting on the upgrade, we set forth the following upgrade manifesto.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Minimize WIP&lt;/strong&gt;. Upgrading Rails in a large, very active codebase is a risky business. Falling behind is easy, and if you&amp;#x27;re not careful, you may find yourself in merge hell. Practically speaking, this means no long-running branches. Instead, all changes must be PR&amp;#x27;d to the main branch and be merged swiftly.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Incremental everything&lt;/strong&gt;. No task is too small to deserve asking the question, &amp;quot;how can we break this up?&amp;quot;. We minimize WIP and reduce business risk by taking many small, incremental steps. Put in practice, this means changes for compatibility are made in the smallest possible units, and when deploying changes into production, we perform a canary deployment, starting at 1% traffic and ramping up slowly.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Use data to drive decision making&lt;/strong&gt;. Sometimes it isn’t possible to determine the correct solution for a given challenge by static analysis, even with excellent git history. In these situations, it&amp;#x27;s tempting to guess. But don’t do it; it&amp;#x27;s a trap! Instead, use dynamic analysis (often in production). Gather more information, and make decisions based on fact, not conjecture.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Over-communicate&lt;/strong&gt;. We&amp;#x27;ll be making significant sweeping changes (incrementally) to the entire codebase. If something goes wrong and the symptom is outside our purview, we want to know about it. By continuously communicating project status, every member of the organization becomes a secret agent, reporting helpful information, resulting in a smoother upgrade.&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Process&lt;/h3&gt;&lt;h4&gt;Dual Boot&lt;/h4&gt;&lt;p&gt;In the spirit of &amp;quot;minimizing WIP&amp;quot; and &amp;quot;incremental everything&amp;quot;, we need a way for all compatibility changes to flow to the main branch. The solution is to dual-boot the application with two different sets of dependencies co-existing on the main branch together. Dual-booting a Rails application is a well-trodden path at this point, and to make the process easier, we took advantage of Shopify&amp;#x27;s excellent bootboot gem.&lt;/p&gt;&lt;p&gt;With bootboot installed, you can insert a condition like the following into your Gemfile:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;DEPENDENCIES_NEXT&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  gem &lt;span class=&quot;token string&quot;&gt;&amp;quot;rails&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;~&amp;gt; 6.1.0&amp;quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
  gem &lt;span class=&quot;token string&quot;&gt;&amp;quot;rails&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;~&amp;gt; 6.0.0&amp;quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In each stage of the upgrade (Rails 4.1 -&amp;gt; 4.2, 4.2 -&amp;gt; 5.0, and so on), we begin with bundling the new/next set of dependencies in a Gemfile_next.lock. In each step, some dependencies can be upgraded alongside the current/non-next set of dependencies (i.e. Gemfile.lock). These dependencies are upgraded in advance and removed from the Gemfile_next.lock equation.&lt;/p&gt;&lt;h4&gt;Changes for compatibility&lt;/h4&gt;&lt;p&gt;Once the main branch has a Gemfile_next.lock with the target dependencies, our focus turns to compatibility. The goal here is to obtain green CI results when the suite is run against both sets of dependencies. Note that only upgrade-related branches run the test suite against the &amp;quot;next&amp;quot; dependencies at this stage.&lt;/p&gt;&lt;p&gt;Each compatibility change targets the main branch. Ideally, our changes are compatible with both the current and next set of dependencies &amp;quot;out of the box.&amp;quot; When changes are incompatible, we consider making them compatible by backporting functionality from the new dependencies. If the backport path is not feasible, we add a condition. Here’s an example where sprockets changed the API for registering an engine:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; dependencies_next&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;
  &lt;span class=&quot;token constant&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;application&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;assets&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;configure &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;env&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
    env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;register_engine &lt;span class=&quot;token string&quot;&gt;&amp;#x27;.es6&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BabelTranspile&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
  &lt;span class=&quot;token constant&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;application&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;assets&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;register_engine &lt;span class=&quot;token string&quot;&gt;&amp;#x27;.es6&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BabelTranspile&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This stage is where the bulk of the upgrade work takes place. Many small PR&amp;#x27;s bring compatibility with the new/next set of dependencies until, eventually, we have a green build on CI with the suite running under both sets of dependencies.&lt;/p&gt;&lt;h4&gt;Green CI, require compatibility on all branches&lt;/h4&gt;&lt;p&gt;Once the test suite is green when run under both sets of dependencies, it&amp;#x27;s time to &amp;quot;lock it in&amp;quot;. At this phase, we enable dual-boot CI on all branches. This mandates all developers write code in a way that is compatible with both sets of dependencies. Changes are not approved to be merged to the main branch unless they are compatible with both sets of dependencies.&lt;/p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:73.61963190184049%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9UlEQVQ4y5WTS2/TQBRG+7cJbVSlFStoKh4r/gNVs0AC1EQJZQHivUVCAlGn1LFnPO+H4w/dCWnrpASwdDSZ2PfkuzfjLQD4/vUb7uz30d29j9vbB+h07iVude6m/d7+o0Sv9wC9vYfY6R5ie6ePbrePw4PHUNqQBk3TYIs+5Oc5xi9eYXjyBoPBSxwfj3F0NMJgMMHzZ68xGr3H6elnjMcfMZl8wnD4Ln13MvqAJ0/fwjnfFjrv4axEdBWcN4jRomkimnlACBabri9FJFNbqJRClk2RZRnO0jq92p9lEEKiqkRCCJESEcEHoA6Yz+dtodYajDGUSiEXDiFE1HVEjAucc1d4D38NEq8JjTHgnKGSCpUQ0MZCGgfrXKv4T9wonM0KVLxK7UtlILSFtQ51XW+EOlgTUiskoxnFEBC8h9Yq/VAIIRXRSmloXWVNSMNlusIPPkUhSxSagWkBxnmSUhIqtNZeipfcKKQbQguUhoPrCsIpMMkwK2bpX6UCKlwmXk263rL3MNqgjoskMURoTUekSpKUJvhWwo1Cn2amWw9LyVGWBaSQcNalOVrzH8LVdgrNkfMCpWDQzkB7A230P7bsXDoulwMPHlN5gYz9xDm7QC4L5KoEN1Uax1/PIYlISDNaoq35jYYyC4w1rWcICtNce5d/AYdgdTm5zsbAAAAAAElFTkSuQmCC&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;handybook-ci&quot; title=&quot;handybook-ci&quot; src=&quot;/static/f1a84349e923f3e7bdd830fe1c1582f8/a6d36/handybook-ci.png&quot; srcSet=&quot;/static/f1a84349e923f3e7bdd830fe1c1582f8/222b7/handybook-ci.png 163w,/static/f1a84349e923f3e7bdd830fe1c1582f8/ff46a/handybook-ci.png 325w,/static/f1a84349e923f3e7bdd830fe1c1582f8/a6d36/handybook-ci.png 650w,/static/f1a84349e923f3e7bdd830fe1c1582f8/e548f/handybook-ci.png 975w,/static/f1a84349e923f3e7bdd830fe1c1582f8/3c492/handybook-ci.png 1300w,/static/f1a84349e923f3e7bdd830fe1c1582f8/821da/handybook-ci.png 2200w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;h4&gt;Smoke test in a production-like environment&lt;/h4&gt;&lt;p&gt;The final stage is QA. Angi uses Kubernetes namespaces to spin up production-like environments for testing purposes. Testing typically starts with a sanity check/smoke test by upgrade engineers. After that, a QA specialist puts the upgraded application through its paces.&lt;/p&gt;&lt;p&gt;When a bug is discovered in this phase, it is fixed on the testing branch and re-deployed for further testing. This cycle repeats until no known issues remain.&lt;/p&gt;&lt;h4&gt;Canary Deployment&lt;/h4&gt;&lt;p&gt;Once all the testing &amp;amp; QA boxes are checked, it&amp;#x27;s time to deploy, but not all at once. In the spirit of &amp;quot;incremental everything&amp;quot;, we begin rolling out the upgraded application alongside the current version. At Angi, we accomplish this with weighted DNS in AWS Route53. We send 1% of production traffic to Kubernetes pods running the upgraded application, then monitor and see what happens. If everything checks out, we increase to 5% and continue in small steps to 100%. If an issue is discovered, we dial traffic back (0% to upgraded instances), fix the problem, and start back at 1%. This phase takes time, but it&amp;#x27;s invaluable.&lt;/p&gt;&lt;p&gt;We utilized a Kibana dashboard to monitor the rollout. In the picture below, you can see roughly 1% of web traffic is targeting handybook-next, while all sidekiq jobs are still being processed by non-next pods.&lt;/p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:56.44171779141104%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACEElEQVQoz22Ta08TQRSG+eeaqFE0+lGRhmpbih8AgWC5GBPhA0Kii9Bta7rbbUuXFmjB3W4v270+ZqY0WHSTd98z55x5MpfMDIDT7ZIvFlEKKscFlaKuodVr6PUaDdPkvNmkrGkoxVOU4olUqVqmfGZQbzRoNEy6jiNQzERxJIOSfcbr8hoL+icW9BxvtHVy5hFhOK57UUDS2GSuskbC2GC+ssFCdRM76Mt6HMdSMxExhPD9qsjj0yQv1IyUiJdrX8bNUYw96PGqsMTTfIrnaobZfJqXhSw3o67sCcLwFihWGAtgiQc/EzxT01IPTxJ8qH5mTATHHUjQo9MkT9UUT/LvmFXTXI/saaD4iQmtfof9i2P2zxX2TIW9lkLJrjH5/CDg8Eplr6nw1fzBfvOYw7aKG45kPZwA5fl4PpZlc2NbtK+vuex0GLguo8DH8QZSPW+IFwYMvRH94VC6GI98nyAI74AxMXEYo12eka5ska3usGhss2jskDG2yVZ3yRqT3Fgilza25JFcOjdEQUQYRRMgMlG+qJPSc2Qq2xIsPHXrYvx3LPy9nmPJ2MXx+9NblisMYn5dVJnTVkjoH3mrr075/H9yojdpbGB5zn0gRGGIYV6xfFBm9VBn5Zv+j9/PLR9orB9V6Ln+LTC6uxRBH7oeluVj/b6TbQW020NarR6djotlBVN10e/74wsREi/lD5OhEzzrS0ecAAAAAElFTkSuQmCC&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;handybook-dashboard&quot; title=&quot;handybook-dashboard&quot; src=&quot;/static/8b6aac4eb9fb736cc1ff434239121422/a6d36/handybook-dashboard.png&quot; srcSet=&quot;/static/8b6aac4eb9fb736cc1ff434239121422/222b7/handybook-dashboard.png 163w,/static/8b6aac4eb9fb736cc1ff434239121422/ff46a/handybook-dashboard.png 325w,/static/8b6aac4eb9fb736cc1ff434239121422/a6d36/handybook-dashboard.png 650w,/static/8b6aac4eb9fb736cc1ff434239121422/e548f/handybook-dashboard.png 975w,/static/8b6aac4eb9fb736cc1ff434239121422/3c492/handybook-dashboard.png 1300w,/static/8b6aac4eb9fb736cc1ff434239121422/859b0/handybook-dashboard.png 5098w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;h4&gt;Bake at 100%, strip and repeat&lt;/h4&gt;&lt;p&gt;Some issues may not be immediately apparent. Once 100% of production traffic is being routed to the upgraded application, it&amp;#x27;s time to let it bake. After a day or two of watching graphs &amp;amp; logs, we commit to the upgrade.&lt;/p&gt;&lt;p&gt;Committing to the upgrade means copying the contents of Gemfile_next.lock over to Gemfile.lock, freeing up Gemfile_next.lock for the next upgrade step. We also must remove all compatibility backports and dependencies_next? conditions.&lt;/p&gt;&lt;p&gt;At this stage, the application has successfully been upgraded to the target dependencies, and we can move on to the next upgrade step!&lt;/p&gt;&lt;h3&gt;Challenges&lt;/h3&gt;&lt;p&gt;By following the predefined upgrade manifesto &amp;amp; process, we avoided many common pitfalls. However, it&amp;#x27;s worth calling out some unique challenges that we encountered.&lt;/p&gt;&lt;h4&gt;Strong Parameters migration&lt;/h4&gt;&lt;p&gt;Strong parameters is a mass-assignment security feature first introduced in Rails 4.0 as a replacement for protected attributes. When we began the upgrade process, Handybook was running Rails 4.1 and had only partially embraced Strong Parameters. Once we reached Rails 4.2, finishing the migration to Strong Parameters was necessary before upgrading to Rails 5.0 where protected attributes are no longer supported.&lt;/p&gt;&lt;p&gt;Performing this migration is never easy, and doing so in Handybook was no exception. Therefore, we developed a process (and tools) that allow us to perform the migration systematically, without guessing. At a high level, the process goes like this:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Install logging that shows us where unpermitted mass-assignment is being performed.&lt;/li&gt;&lt;li&gt;Install moderate_parameters, a gem we developed that shows us what parameters will be filtered out by strong parameters, without actually filtering any parameters out.&lt;/li&gt;&lt;li&gt;Use the test environment to resolve all unpermitted mass-assignment &amp;amp; moderate parameter logs.
Take unpermitted mass-assignment &amp;amp; moderate parameter logging into production and resolve remaining issues until the logs are empty or until they contain only known/explicitly ignored entities (parameters that should * not be permitted).&lt;/li&gt;&lt;li&gt;Swap calls to moderate parameters for the strong parameters at which time actual filtering occurs.&lt;/li&gt;&lt;li&gt;Finally, remove the protected_attributes gem and related code, and the application is running with Strong Parameters!&lt;/li&gt;&lt;/ul&gt;&lt;h4&gt;Complex Ruby objects in persistent data stores&lt;/h4&gt;&lt;p&gt;Storing complex Ruby objects in persistent data stores is a mistake that often bites us during upgrades. The problem is, it&amp;#x27;s hard to know when it&amp;#x27;ll bite, and it often goes undetected in test suites &amp;amp; QA testing. For the problem to occur, objects must be serialized into persistent storage by the application running one set of dependencies, then read by the application running another set of dependencies. When it &amp;quot;bites,&amp;quot; the application fails to deserialize the object, often because of a constant removed or renamed.&lt;/p&gt;&lt;p&gt;For example, if you attempt to serialize an ActiveRecord object in Rails 4.2, and deserialize it in Rails 5.0, you will get an ArgumentError like the following:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;ArgumentError&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; undefined &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;ConnectionAdapters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;AbstractMysqlAdapter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;MysqlDateTime&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We ran into several of these scenarios while upgrading Handybook. In each case, the solution was to rework the code such that complex objects are not put in persistent data stores. Instead, serialization is performed upfront, and only simple data types are put in persistent storage. When the data is deserialized, we rehydrate those complex Ruby objects, and the code path continues as it did before.&lt;/p&gt;&lt;h4&gt;Octopus -&amp;gt; Rails 6.1 multi-database features &amp;amp; Octoball&lt;/h4&gt;&lt;p&gt;Another significant migration was caused by changes in Active Record at Rails 6.1 to enable new multi-database features. Specifically, Handybook was using a gem called Octopus to make some database queries using read-replicas, and unfortunately, the gem is not supported beyond Rails 6.0. Adding support for Rails 6.1 to Octopus wasn&amp;#x27;t feasible because of fundamental assumptions made in its approach, which changed in Rails 6.1.&lt;/p&gt;&lt;p&gt;The good news is that Rails 6.1 introduced multi-database features that make much of what a gem like Octopus did obsolete. We were able to migrate Handybook to a gem named Octoball, which is a relatively thin layer on top of Rails 6.1 multi-database implementation offering an Octopus-like API.&lt;/p&gt;&lt;p&gt;Getting rid of the Octopus gem was a massive win for the Handybook application as it was the source of many edge-case bugs and unexpected behavior. A bonus was that Octoball usage could also be tested in CI.&lt;/p&gt;&lt;h2&gt;Results&lt;/h2&gt;&lt;p&gt;We partnered with Angi in their effort to improve developer experience &amp;amp; productivity by investing in the platform. Upgrading a large/busy Rails application is tedious work and it&amp;#x27;s easy to introduce new tech debt that compounds making future upgrades even more difficult. By following a well-defined process backed by the upgrade manifesto, we achieved an overall reduction in technical debt, leading to a number of positive outcomes.&lt;/p&gt;&lt;p&gt;Perhaps the best way to highlight the results is by sharing some inspirational quotes from a few of our favorite people at Angi:&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Angi developers are happy, leading to increased productivity&lt;/strong&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&amp;quot;I think I speak for every long-tenured Angi person when I say... WOW!&amp;quot;&lt;/p&gt;&lt;p&gt;- David Olsen &lt;br/&gt;&lt;small&gt;   Director, Infrastructure Engineering&lt;/small&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;strong&gt;With an up-to-date stack, it&amp;#x27;s easier to attract top engineering talent&lt;/strong&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&amp;quot;Handybook is pretty heckin modern if you ask me.&amp;quot;&lt;/p&gt;&lt;p&gt;- Thomas Johnell &lt;br/&gt;&lt;small&gt;   VP, Engineering&lt;/small&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;&lt;strong&gt;Angi customer data is safer than ever (and security &amp;amp; compliance can sleep at night)&lt;/strong&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&amp;quot;I for one like software that is not EOL and still receives security updates. Nice work!&amp;quot;&lt;/p&gt;&lt;p&gt;- Chris Sansone &lt;br/&gt;&lt;small&gt;   Director of Information Security and Risk&lt;/small&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;h2&gt;How can we help you?&lt;/h2&gt;&lt;p&gt;Interested in finding out how partnering with Hint could help your company achieve similar results? We&amp;#x27;d love to talk! &lt;a href=&quot;/contact&quot;&gt;Contact us&lt;/a&gt; to get started.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Test Like You Fly - What was your Intent?]]></title><description><![CDATA[In our previous installment in the TLYF series we took "time" to cover the important topic of Time and Timing. Next up, we're going to get…]]></description><link>https://hint.io/blog/test-like-you-fly-5</link><guid isPermaLink="false">https://hint.io/blog/test-like-you-fly-5</guid><dc:creator><![CDATA[timChambers]]></dc:creator><pubDate>Thu, 30 Sep 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In our previous installment in the TLYF series we took &amp;quot;time&amp;quot; to cover the important topic of Time and Timing. Next up, we&amp;#x27;re going to get into what we call &lt;strong&gt;Intentional Code.&lt;/strong&gt;&lt;/p&gt;&lt;h2&gt;What Was Your intent?&lt;/h2&gt;&lt;p&gt;As crafters of code we spend our days (and sometimes nights) writing code. Code that does stuff. And the purpose we have when we generate code is to express our intent to the computer(s) that will execute the code. We do that through language. And how we express that, the assertions we make (explicit and implicit), are our way of communicating with the computer.&lt;/p&gt;&lt;p&gt;But wait ... is the computer our only audience?&lt;/p&gt;&lt;p&gt;Absolutely not. In fact perhaps our most important audience is our fellow developers. They will read our code. They likely will review our code. They will try to understand the INTENT of our code. So the more we communicate intent as we write code, the more chance that they, and the computer, and our future selves a few months from now, will understand precisely what was expected of that code - the input, the processing rules, the data, and subsequently the nature of the outcome. How do we best accomplish this?&lt;/p&gt;&lt;p&gt;We must write &lt;em&gt;intentional code&lt;/em&gt;.&lt;/p&gt;&lt;h2&gt;What makes code exude intent? Why?&lt;/h2&gt;&lt;p&gt;As I do much of my development today in Ruby, let&amp;#x27;s use that language as the lens for this. You can certainly find similar traits in almost every computer language - both functional and object-oriented - that provide equivalent capabilities. As we craft our code to meet requirements we must constantly ask ourselves &amp;quot;what could go wrong?&amp;quot;. It is the answer to that simple question that informs us as to how to express intent - both what should happen and what should never happen.&lt;/p&gt;&lt;p&gt;Failure to accomplish implicit intent occurs most often at interfaces. Whether it is making an API request, using a framework method, or addressing a local OSS package bundled into your application, those &amp;quot;conversations&amp;quot; are fraught with uncertainty. Should I be checking for sending the right query parameters, or do I expect the callee to have that responsibility? Is the interface exchanging just simple primitive data, e.g. numeric values or strings, or is there sufficiently rich metadata to determine the class of the data sent and received for me to ensure that units of measure are compatible, or missing data is discovered?&lt;/p&gt;&lt;p&gt;As we TLYF across longer Total Operations Chain Timeframes, we have broader intentions to verify. Satisfying a customer of an e-commerce application involves the integral activities of accepting orders, managing payment, handling shipping and confirming satisfaction. It is hundreds of details with dozens of interfaces where a gap could occur. First time activities include establishing customer profiles, capturing that first payment and ensuring initial e-mail was delivered.&lt;/p&gt;&lt;h3&gt;Code is the reason we have code&lt;/h3&gt;&lt;p&gt;Confused? You shouldn&amp;#x27;t be. Each line of code, each variable, each method, each class, each function - every single character - is in place for a reason. If not then it can be eliminated without impact on the outcome of the mission. Our intent then, is to craft the minimum amount of code that is necessary to fulfill the objective. How do we recognize when we have unnecessary code? Through testing. Ideally an automated style of testing referred to as &amp;quot;mutation testing&amp;quot;. Mutation testing (for example &lt;a href=&quot;https://github.com/mbj/mutant&quot;&gt;mutant&lt;/a&gt;) simply runs our tests, then mutates our code in small but powerful ways, replacing or removing code, and then rerunning the tests. If the tests still pass - especially after removal of code - than one of two inferences can be drawn. One, that code is unnecessary to the overall objective. It is removable. Or two, the tests confirming the need for that code are insufficient to confirm that code. In the latter case the tests (or possibly the strictness of the code) need to be enhanced.&lt;/p&gt;&lt;h3&gt;Ensure Immutability when handling Data&lt;/h3&gt;&lt;p&gt;Stateless code - or code that at least encapsulates the state as locally as possible for as short a period as possible - is easier to reason about and ensure correctness. Code that has no &amp;quot;side-effects&amp;quot; is code we can predict.&lt;/p&gt;&lt;p&gt;Ensuring data that should not change during execution does not change is ideal (&lt;a href=&quot;https://github.com/dkubb/adamantium&quot;&gt;Adamantium&lt;/a&gt;)&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Use CONSTANTS whenever possible for static content of all types - freeze all constants as deeply as possible to ensure inadvertent alteration is surfaced&lt;/li&gt;&lt;li&gt;Freeze results as often as possible to prevent inadvertent alteration when passing upstream (&lt;a href=&quot;https://github.com/dkubb/ice_nine&quot;&gt;IceNine&lt;/a&gt;)&lt;/li&gt;&lt;li&gt;Never alter input parameters - duplicate input if needed to sanitize. This prevents hidden side-effects in OOP where state is mysteriously altered&lt;/li&gt;&lt;li&gt;All database requests that are intended purely for read-only - no update - processing should be made through readonly channels or declared explicitly&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Surface errors (yours and others) as you write your code&lt;/h3&gt;&lt;p&gt;We all have a favorite IDE or editor that focuses our thoughts as we write. And depending upon whether your language is statically or dynamically typed, compiled or interpreted, you always have the choice to convey through your code syntactic correctness.&lt;/p&gt;&lt;p&gt;Use getter access (&lt;code&gt;abc&lt;/code&gt;) rather than instance variable access (&lt;code&gt;@abc&lt;/code&gt;) to ensure compile-time fails&lt;/p&gt;&lt;ul&gt;&lt;li&gt;A mistyped instance variable is always just nil and becomes invisible&lt;/li&gt;&lt;li&gt;Private &lt;code&gt;attr_reader&lt;/code&gt;&amp;#x27;s provide simple mechanisms for getter method generation&lt;/li&gt;&lt;li&gt;Use &lt;a href=&quot;https://github.com/mbj/concord&quot;&gt;Concord&lt;/a&gt; gem to generate methods for initialization parameters&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Don&amp;#x27;t just expect - DEMAND - a particular outcome using the strongest assertive methods possible&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Use &lt;code&gt;fetch(:key)&lt;/code&gt; for &lt;code&gt;Hash&lt;/code&gt; access rather than &lt;code&gt;[:key]&lt;/code&gt; to communicate intent of key presence&lt;/li&gt;&lt;li&gt;When in Rails use bang methods like &lt;code&gt;first!&lt;/code&gt;, &lt;code&gt;last!&lt;/code&gt;, &lt;code&gt;find_by!&lt;/code&gt; where content presence/existence is required&lt;ul&gt;&lt;li&gt;In specs this makes failure clear vs. typical &lt;code&gt;NoMethodError&lt;/code&gt; on &lt;code&gt;NilClass&lt;/code&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Prove that your intent is met&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Ensure files transmitted/stored in the cloud are received/persisted&lt;/li&gt;&lt;li&gt;Test that results are in fact immutable&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;What does writing intentional code buy us?&lt;/h2&gt;&lt;p&gt;Excellent question. It allows us to more clearly reason about the code. Thus...&lt;/p&gt;&lt;ul&gt;&lt;li&gt;The code communicates more precisely and deeply what we expect in production AND while testing&lt;/li&gt;&lt;li&gt;The system(s) executing code has the ability to detect more unexpected conditions&lt;/li&gt;&lt;li&gt;We discover earlier in the development cycle where our expectations are violated&lt;/li&gt;&lt;li&gt;Our assertions become codified and operate in the production environment&lt;/li&gt;&lt;li&gt;Our intentions become visible for others to review, affirm and abide by now and in the future&lt;/li&gt;&lt;li&gt;And when our intent is violated the location is often far more localized and concise around the issue than when the violation is discovered far away in a prior or future method/module&lt;/li&gt;&lt;li&gt;As requirements change we can clearly see what intents need to be altered or relaxed to accommodate the inevitable&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Write with intent.&lt;/p&gt;&lt;p&gt;Next up in our TLYF Series → Logging and Failure Modes.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Deploy Infrastructure With CDKTF]]></title><description><![CDATA[CDK or Cloud Development Kit came out of AWS in 2018 as a way to write Infrastructure as Code in software languages used day-to-day by…]]></description><link>https://hint.io/blog/deploy-infrastructure-cdktf</link><guid isPermaLink="false">https://hint.io/blog/deploy-infrastructure-cdktf</guid><dc:creator><![CDATA[nateVick]]></dc:creator><pubDate>Sat, 21 Aug 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;CDK or Cloud Development Kit came out of AWS in 2018 as a way to write Infrastructure as Code in software languages used day-to-day by developers (JavaScript/TypeScript, Python, Java, C#, and soon Go). Since its release, a community has built up around it, and new flavors have arrived. AWS CDK, CDKTF, and CDK8s are all based on the same core, but compile to different formats. AWS CDK compiles to CloudFormation, while CDKTF compiles to Terraform compatible JSON, and CDK8s compiles to Kubernetes config.&lt;/p&gt;&lt;p&gt;In this post, we will walk through how to use CDKTF with DigitalOcean&amp;#x27;s Terraform provider. A Terraform provider is a &amp;quot;plugin&amp;quot; for Terraform to interact with remote systems. In this case, the provider is created and maintained by DigitalOcean. We will share a few examples of creating a Digital Ocean Project, a VPC, a Postgres Database, and a Droplet.&lt;/p&gt;&lt;h2&gt;Prereqs and Install&lt;/h2&gt;&lt;p&gt;To use cdktf you will need the following packages installed:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Terraform ≥ 0.12&lt;/li&gt;&lt;li&gt;Node.js ≥ 12.16&lt;/li&gt;&lt;li&gt;Yarn ≥ 1.21&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;To install cdktf, we will use &lt;code&gt;npm install&lt;/code&gt;&lt;/p&gt;&lt;p&gt;&lt;code&gt;$ npm install --global cdktf-cli&lt;/code&gt;&lt;/p&gt;&lt;p&gt;You will also need to &lt;a href=&quot;https://docs.digitalocean.com/reference/api/create-personal-access-token/&quot;&gt;create a personal access token&lt;/a&gt; on Digital Ocean if you would like to deploy this config.&lt;/p&gt;&lt;h2&gt;Create and Initialize the example project&lt;/h2&gt;&lt;p&gt;First let&amp;#x27;s make a directory and change into it.&lt;/p&gt;&lt;p&gt;&lt;code&gt;$ mkdir cdk-do-example &amp;amp;&amp;amp; cd cdk-do-example&lt;/code&gt;&lt;/p&gt;&lt;p&gt;Initialize the project with the &lt;code&gt;init&lt;/code&gt; command. In general, I use the &lt;code&gt;--local&lt;/code&gt; flag, so all state is stored locally.&lt;/p&gt;&lt;p&gt;&lt;code&gt;$ cdktf init --template=typescript --local&lt;/code&gt;&lt;/p&gt;&lt;p&gt;You will be prompted for Project Name and Description but defaults are fine.&lt;/p&gt;&lt;p&gt;The last step of setting up the project is to add Terraform providers to the &lt;code&gt;cdktf.json&lt;/code&gt;. Open the project in your editor and let&amp;#x27;s add the DigitalOcean provider to it as follows.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&amp;quot;language&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;typescript&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&amp;quot;app&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;npm run --silent compile &amp;amp;&amp;amp; node main.js&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&amp;quot;terraformProviders&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&amp;quot;digitalocean/digitalocean@~&amp;gt; 2.9&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&amp;quot;terraformModules&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&amp;quot;context&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&amp;quot;excludeStackIdFromLogicalIds&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&amp;quot;allowSepCharsInLogicalIds&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Install Dependencies&lt;/h2&gt;&lt;p&gt;Run &lt;code&gt;cdktf get&lt;/code&gt; to download the dependencies for using DigitalOcean with Typescript.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ cdktf get
Generated typescript constructs &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; the output directory: .gen&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Let&amp;#x27;s Write Some TypeScript&lt;/h2&gt;&lt;p&gt;Open &lt;code&gt;main.ts&lt;/code&gt; in your editor and let&amp;#x27;s start by creating a DO Project.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Construct &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;constructs&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; App&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TerraformStack&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Token &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;cdktf&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; DigitaloceanProvider &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;./.gen/providers/digitalocean&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Project &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;./.gen/providers/digitalocean&amp;#x27;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyStack&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TerraformStack&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;scope&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Construct&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;scope&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DigitaloceanProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;digitalocean&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      token&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Token&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;DO_TOKEN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Project&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-project&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;Example Rails Project&amp;#x27;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; app &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;App&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyStack&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;cdk-do-example&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;synth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You will create a new &lt;code&gt;DigitaloceanProvider&lt;/code&gt; and pass in the environment variable assigned to your DO personal access token. Next, we create the &lt;code&gt;Project&lt;/code&gt;, which has a required key of &lt;code&gt;name&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Optionally, as a test of the code above, run &lt;code&gt;cdktf deploy&lt;/code&gt; to deploy your CDKTF project. The cli will ask if you want to make the changes listed under Resources. Type &amp;#x27;yes&amp;#x27;, then once it finishes, you will see a green check next to the Resources it successfully created.&lt;/p&gt;&lt;p&gt;cli prompt:
&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:30.061349693251532%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVQY03WOa2rDMBAGfZrElfVeaa235BqnaQi5/3GCYpqCS2H42D+zzNC2R9se+fPm81bWO1N+ZJZwJBxHakZqPpj9j8G4hmHVWJTN0iQBEVxTNmusHALhSKWbxPwXwnHAuFLpBET5lufKdZDQbyrdiejzBOe+em95M8xpC+XLl4svl7zcQr3GnXYVkJjyHKJ4PWI6HGVhkrJZQNRYlS3SZpibND1bY+3N0tEXk5iPsrTFuEVjSe3b+uVEftt67b4/HOQnYmlIGEcc6scAAAAASUVORK5CYII=&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Agree to deployment&quot; title=&quot;Agree to deployment&quot; src=&quot;/static/36c8638b60184ea64006451ef1f83d4a/a6d36/enter-value.png&quot; srcSet=&quot;/static/36c8638b60184ea64006451ef1f83d4a/222b7/enter-value.png 163w,/static/36c8638b60184ea64006451ef1f83d4a/ff46a/enter-value.png 325w,/static/36c8638b60184ea64006451ef1f83d4a/a6d36/enter-value.png 650w,/static/36c8638b60184ea64006451ef1f83d4a/e548f/enter-value.png 975w,/static/36c8638b60184ea64006451ef1f83d4a/3c492/enter-value.png 1300w,/static/36c8638b60184ea64006451ef1f83d4a/f1c64/enter-value.png 1390w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;/p&gt;&lt;p&gt;successful deployment:
&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:12.883435582822086%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAcElEQVQI132NSwoCMRAFcxs/iekmeZO0+djRILOZ+59HHMGdQi0eRcEzOrcoIySV9iy6Fl1vc7OUT5fl6PAfg+uD0QmN0R2Lo+xD9bHy0j+FY7GUv5x92s1bGkajWCH3kJTRUpn76JABGY7lYH8+vwAEoiO1r4PhLwAAAABJRU5ErkJggg==&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;First deployment&quot; title=&quot;First deployment&quot; src=&quot;/static/a0c6aa81007768934b67e4471fba5b37/a6d36/first-deploy.png&quot; srcSet=&quot;/static/a0c6aa81007768934b67e4471fba5b37/222b7/first-deploy.png 163w,/static/a0c6aa81007768934b67e4471fba5b37/ff46a/first-deploy.png 325w,/static/a0c6aa81007768934b67e4471fba5b37/a6d36/first-deploy.png 650w,/static/a0c6aa81007768934b67e4471fba5b37/e548f/first-deploy.png 975w,/static/a0c6aa81007768934b67e4471fba5b37/3c492/first-deploy.png 1300w,/static/a0c6aa81007768934b67e4471fba5b37/2cefc/first-deploy.png 1400w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;/p&gt;&lt;p&gt;Now we will add a VPC, a Postgres Database, and a Droplet. Once those examples are in, we will tie it all together before deploying it again.&lt;/p&gt;&lt;h3&gt;Create a VPC&lt;/h3&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Construct &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;constructs&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; App&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TerraformStack&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Token &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;cdktf&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; DigitaloceanProvider&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Droplet&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Vpc &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;./.gen/providers/digitalocean&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Project &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;./.gen/providers/digitalocean&amp;#x27;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyStack&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TerraformStack&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;scope&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Construct&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;scope&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DigitaloceanProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;digitalocean&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      token&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Token&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;DO_TOKEN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;more code above

    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vpc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-vpc&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-vpc&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      region&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;sfo3&amp;#x27;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; app &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;App&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyStack&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;cdk-do-example&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;synth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;em&gt;*Note: If you do not have VPC in your account already this will become the default VPC which will not be deleted when cleaning up the CDKTF Project.&lt;/em&gt;&lt;/p&gt;&lt;h3&gt;Create a Postgres Database&lt;/h3&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Construct &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;constructs&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; App&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TerraformStack&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Token &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;cdktf&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; DigitaloceanProvider&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Droplet&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Vpc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; DatabaseCluster&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; DatabaseUser&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; DatabaseDb &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;./.gen/providers/digitalocean&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Project &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;./.gen/providers/digitalocean&amp;#x27;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyStack&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TerraformStack&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;scope&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Construct&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;scope&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DigitaloceanProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;digitalocean&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      token&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Token&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;DO_TOKEN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;more code above

    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; postgres &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DatabaseCluster&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-postgres&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-postgres&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      engine&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;pg&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      version&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;13&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      size&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;db-s-1vcpu-1gb&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      region&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;sfo3&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      nodeCount&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DatabaseUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-postgres-user&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      clusterId&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;postgres&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example&amp;#x27;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DatabaseDb&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-postgres-db&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      clusterId&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;postgres&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-db&amp;#x27;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; app &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;App&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyStack&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;cdk-do-example&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;synth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Notice we assigned the &lt;code&gt;DatabaseCluster&lt;/code&gt; to a variable &lt;code&gt;const postgres&lt;/code&gt;. We then use the variable to create the &lt;code&gt;DatabaseUser&lt;/code&gt; and &lt;code&gt;DatabaseDb&lt;/code&gt; on that cluster.&lt;/p&gt;&lt;h3&gt;Create a Droplet&lt;/h3&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Construct &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;constructs&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; App&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TerraformStack&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Token &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;cdktf&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; DigitaloceanProvider&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Droplet&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Vpc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; DatabaseCluster&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; DatabaseUser&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; DatabaseDb &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;./.gen/providers/digitalocean&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Project &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;./.gen/providers/digitalocean&amp;#x27;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyStack&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TerraformStack&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;scope&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Construct&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;scope&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DigitaloceanProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;digitalocean&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      token&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Token&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;DO_TOKEN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;more code above

    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Droplet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-droplet&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-droplet&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      size&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;s-1vcpu-1gb&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      region&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;sfo3&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      image&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;ubuntu-20-04-x64&amp;#x27;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; app &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;App&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyStack&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;cdk-do-example&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;synth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Let&amp;#x27;s Put It All Together&lt;/h2&gt;&lt;p&gt;If you run &lt;code&gt;cdktf deploy&lt;/code&gt; now, it would create everything, but nothing created would be put into the Digital Ocean project or the VPC we create. Let&amp;#x27;s do that now.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Construct &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;constructs&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; App&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; TerraformStack&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Token &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;cdktf&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; DigitaloceanProvider&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Droplet&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Vpc&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;./.gen/providers/digitalocean&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; DatabaseCluster&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; DatabaseUser&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; DatabaseDb &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;./.gen/providers/digitalocean&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Project&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ProjectResources &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;./.gen/providers/digitalocean&amp;#x27;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyStack&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TerraformStack&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;scope&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Construct&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;scope&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DigitaloceanProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;digitalocean&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      token&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; Token&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;DO_TOKEN&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; project &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Project&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-project&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;Example Rails Project&amp;#x27;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; vpc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Vpc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-vpc&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-vpc&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      region&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;sfo3&amp;#x27;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; postgres &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DatabaseCluster&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-postgres&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-postgres&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      engine&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;pg&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      version&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;13&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      size&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;db-s-1vcpu-1gb&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      region&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;sfo3&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      nodeCount&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      privateNetworkUuid&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; vpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DatabaseUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-postgres-user&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      clusterId&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;postgres&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example&amp;#x27;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DatabaseDb&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-postgres-db&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      clusterId&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;postgres&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-db&amp;#x27;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; droplet &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Droplet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-droplet&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      name&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-droplet&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      size&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;s-1vcpu-1gb&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      region&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;sfo3&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      image&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;ubuntu-20-04-x64&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      vpcUuid&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; vpc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ProjectResources&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;example-project-resources&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      project&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; project&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      resources&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
        postgres&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;urn&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        droplet&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;urn
      &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      dependsOn&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; postgres&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; droplet &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; app &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;App&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyStack&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;app&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;cdk-do-example&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;synth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We start by assigning the project, VPC, and droplet to variables. In the &lt;code&gt;DatabaseCluster&lt;/code&gt; definition, we add &lt;code&gt;privateNetworkUuid: [vpc.id](http://vpc.id)&lt;/code&gt; to place the database in our newly created VPC. Similarly, on the &lt;code&gt;Droplet&lt;/code&gt; definition, we place it in the VPC, by adding &lt;code&gt;vpcUuid: vpc.id&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Lastly, create a new &lt;code&gt;ProjectResource&lt;/code&gt; to assign other resources to the Digital Ocean project. In this small example, we will assign the database and droplet to the project using the &lt;code&gt;urn&lt;/code&gt; for each resource. We will wait to assign those until both are created using a Terraform helper &lt;code&gt;dependsOn&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;With all of that in place you can deploy again. The database and droplet creation take a bit, so be patient. 🙂 Once it has finished, check your Digital Ocean Dashboard to see everything created and ready for use.&lt;/p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:33.12883435582822%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA9ElEQVQY001QCW7DIBDMa9r64D6WG+M4qpO4//9OBThtpBGaBWY0s5d0PaRZqIom3sBvcX1SGQekBqS+Ztmg+vi6/H+6xPXp88504pCpDFRFKoMwCxZ+IgZzP1MzEehnR+dVbNO3tIVDlrYwFQVkqmL10omIgJgdMUzENMBE9J9FFYdyF1Bjc525TtIUIjxTEXOHmEXMzdSM+NS8kxa7PFzeXd5DeWi3huUO/urzjpidKTQLN1OLeXUhwiNmMfeneLn95O2AsEmzcJ3y9agtamaPuevomrfm5hQLyG1VccR6QEpA7sYfI+8hW2d48frncxJ9278TTFXTJTsgpAAAAABJRU5ErkJggg==&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Full Example Deployed&quot; title=&quot;Full Example Deployed&quot; src=&quot;/static/4c501a69d17609b1621a03b95d356f40/a6d36/full-example-deployed.png&quot; srcSet=&quot;/static/4c501a69d17609b1621a03b95d356f40/222b7/full-example-deployed.png 163w,/static/4c501a69d17609b1621a03b95d356f40/ff46a/full-example-deployed.png 325w,/static/4c501a69d17609b1621a03b95d356f40/a6d36/full-example-deployed.png 650w,/static/4c501a69d17609b1621a03b95d356f40/e548f/full-example-deployed.png 975w,/static/4c501a69d17609b1621a03b95d356f40/3c492/full-example-deployed.png 1300w,/static/4c501a69d17609b1621a03b95d356f40/c211c/full-example-deployed.png 1502w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;p&gt;&lt;strong&gt;*Make sure you run &lt;code&gt;cdktf destroy&lt;/code&gt; to remove these resources from your account or you will be charged by Digital Ocean.*&lt;/strong&gt;&lt;/p&gt;&lt;h2&gt;Things To Know&lt;/h2&gt;&lt;p&gt;CDKTF is still a young project, so it is changing fast, has limited documentation, and you can run into unclear errors.&lt;/p&gt;&lt;p&gt;There are few things that help with the limited documentation. You can read the provider documentation on the &lt;a href=&quot;https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs&quot;&gt;Terraform registry site&lt;/a&gt; and use it as a guide. Also, using a language like Typescript with VSCode there are a lot of code hints, hover info, and signature information. The gif below is an example of what is shown in VSCode when you hover on the problem. Note the missing properties for &lt;code&gt;DropletConfig&lt;/code&gt;.&lt;/p&gt;&lt;img src=&quot;https://media.giphy.com/media/Ae5Z300UKAWhqZiHfc/source.gif&quot; alt=&quot;Typescript Annotations&quot;/&gt;&lt;p&gt;When you run into unclear errors, prepend &lt;code&gt;CDKTF_LOG_LEVEL=debug&lt;/code&gt; to the deploy and/or destroy commands to get very verbose output.&lt;/p&gt;&lt;h2&gt;Wrapping Up&lt;/h2&gt;&lt;p&gt;In this post, we used CDKTF to create some basic example resources on Digital Ocean which gives you a good primer to build more complex infrastructure in a language of your choice. You can find the code from this post in this &lt;a href=&quot;https://github.com/hintmedia/cdk-do-example&quot;&gt;repo&lt;/a&gt;. If you would like to chat more about CDK or infrastructure as code you can ping me on Twitter &lt;a href=&quot;https://twitter.com/natron99&quot;&gt;@natron99&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Test Like You Fly - Timing is (Almost) Everything]]></title><description><![CDATA[So far in the TLYF series we have covered the  Principles , the  Basics , and the  Impact  of the external components that support your…]]></description><link>https://hint.io/blog/test-like-you-fly-4</link><guid isPermaLink="false">https://hint.io/blog/test-like-you-fly-4</guid><dc:creator><![CDATA[timChambers]]></dc:creator><pubDate>Thu, 05 Aug 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;So far in the TLYF series we have covered the &lt;a href=&quot;https://hint.io/blog/test-like-you-fly-1&quot;&gt;Principles&lt;/a&gt;, the &lt;a href=&quot;https://hint.io/blog/test-like-you-fly-2&quot;&gt;Basics&lt;/a&gt;, and the &lt;a href=&quot;https://hint.io/blog/test-like-you-fly-3&quot;&gt;Impact&lt;/a&gt; of the external components that support your mission. Lets expand on that with the one dimension we have little ability to stop - Time.&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;It&amp;#x27;s about time, it&amp;#x27;s about space, About two men in the strangest place. It&amp;#x27;s about time, it&amp;#x27;s about flight. Traveling faster than the speed of light.&lt;a href=&quot;https://en.wikipedia.org/wiki/It%27s_About_Time_(TV_series)&quot;&gt;*&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;In the real world, not everything happens at once. Probably a good thing. And some activities take much longer than others. Like going to the office could mean a drive to work in heavy morning traffic, or putting on your slippers and walking into the other room.&lt;/p&gt;&lt;p&gt;Applications are no different. Requests take different amounts of time to respond. Operations occur in some order; not all at once nor always in parallel. And sometimes we only need to perform a task once - like swapping one database column for another during a migration.&lt;/p&gt;&lt;p&gt;Let&amp;#x27;s explore considerations from the Test Like You Fly perspective.&lt;/p&gt;&lt;h2&gt;Time and Timing and Time Again&lt;/h2&gt;&lt;h3&gt;Speed&lt;/h3&gt;&lt;p&gt;Performance means speed. Not only do tasks need to complete within some finite amount of time, but they need to meet reasonable expectations supporting user processes. Cascading and serial operations must complete in an overall duration that supports the business objectives. These may be difficult to reproduce in a test environment - especially if this is a recently inaugurated application without a reservoir of built up experience in real production data. However, it is absolutely necessary that the first time real production volumes of data are experienced NOT be in production.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Test using hardware resources comparable to production&lt;ul&gt;&lt;li&gt;A migration may take 2 minutes on your own desktop and 10 minutes in the production environment&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Be clear about expected operation cycle times&lt;ul&gt;&lt;li&gt;Explore any and all deviations from anticipated activity durations&lt;ul&gt;&lt;li&gt;Do different user supplied parameters cause wide swings in operation cycle time?&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;For operations that are deemed too slow what sort of synchronicity is required?&lt;/li&gt;&lt;li&gt;Sometimes too fast an operation can induce race conditions&lt;/li&gt;&lt;li&gt;Variability can be the enemy&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Consider how long people will wait for inline actions and defer to background whenever sub-optimal&lt;ul&gt;&lt;li&gt;Ensure that background actions are idempotent and are failure resistant/tolerant or degrade robustly&lt;/li&gt;&lt;li&gt;If background queues build - will you become aware? How? What tolerance is there for this?&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Timezones&lt;/h3&gt;&lt;p&gt;Most applications today are used in more than a single time zone. In truth most applications of any size are globally accessible. From the perspective of the app&amp;#x27;s user they are in their own zone and most likely want to see all their information in that context. Databases typically are served in a consistent single time zone, with internal data stored with that time zone basis. This is usually UTC, but may be a different zone depending on the evolution of the app.&lt;/p&gt;&lt;p&gt;Ensure that different timezones are considered when determining dates from timestamps and date+time values. Time zone awareness, conversion between zones, and handling of notions like Summertime and Daylight Saving Time are critical as time is portrayed in the app. Calculations which cross DST boundaries (April and November currently) need to acknowledge the loss or gain of an hour. Transitioning across Year boundaries is another concern. The Space Shuttle Team was concerned about launching in one year and being in space when New Year&amp;#x27;s Eve transpired. It&amp;#x27;s critical to simulate all of this before putting the application in production. Be aware that not all timezones change their clocks on the same date. Is that handled? Is it even tested?&lt;/p&gt;&lt;h3&gt;Weekends/Beginning and End of Hour/Day/Month/Year - crossover boundaries&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;Specs may fail on boundaries where factory generated data crosses over a time &amp;quot;milestone&amp;quot;&lt;/li&gt;&lt;li&gt;Test differing size months - span Jan/Feb/Mar with horizon of 30 days from Jan 31 to early March&lt;ul&gt;&lt;li&gt;Note: there is no June 31st.&lt;/li&gt;&lt;li&gt;Does your application assume a standard size month e.g. 30 days? If so errors may accumulate.&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Consider leap years - and for certain applications, leap seconds&lt;ul&gt;&lt;li&gt;What happens when the clock gets set back/forward?&lt;/li&gt;&lt;li&gt;What happens on Feb 29th?&lt;/li&gt;&lt;li&gt;How accurate do you have to be about time durations that span daylight saving time changes?&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Business days vs weekends (non-business days)&lt;/li&gt;&lt;li&gt;Holidays - are they special? to be avoided? Are they locale centric?&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Throttling&lt;/h3&gt;&lt;p&gt;Applications that serve other applications, such as APIs, often have throttling built in to ensure they are not overwhelmed or artificially susceptible to Denial of Service attacks. When we rely on those APIs, it is imperative that we test our application&amp;#x27;s behavior when throttled by these external &amp;quot;forces&amp;quot;.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Controlling response rates can create queue build-up&lt;/li&gt;&lt;li&gt;Does the throttling serve your app or your customer?&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;Sequencing&lt;/h2&gt;&lt;p&gt;Getting ahead of ourselves, especially in the world of multi-core apps and serverless/microservices is a critical concern. Everything has an order. Order may be implicit or explicit. The more explicit the ordering - such as via creating pipelines of activities - the easier to ensure the sequences are maintained.&lt;/p&gt;&lt;h3&gt;Test Independent and Sequential Operations&lt;/h3&gt;&lt;p&gt;Many test frameworks randomize tests, which is important. But purposely running tests in a planned sequence that proves graceful processing in an out-of-sequence manner is also important. Do not trust that randomness will generate all combinations.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Test calling same method repetitively to ensure they handle context properly without side effects&lt;/li&gt;&lt;li&gt;Use immutability to ensure state is retained - improves correctness and makes for easier reasoning about local behavior&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Test Parallel and Concurrent Operations&lt;/h3&gt;&lt;p&gt;System complexity is at the heart of why TLYF is critical yet difficult. Isolating components from each other is the antithesis of this type of testing. This could lead to exponential combinatorial test scenarios. That could be a smell, or it could be a requirement.&lt;/p&gt;&lt;h3&gt;Evaluate Reentrancy and Repeated Use Considerations&lt;/h3&gt;&lt;p&gt;These are some of the most difficult areas to simulate, however perhaps also the ones that can unexpectedly be the most problematic. Methods that work successfully once, may fail on subsequent invocations merely because of prior state. Methods that alter their input parameters invisibly can behave fine, then fail the next time.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Long-lived instances like background workers vs. short-lived objects from request/response controller actions&lt;ul&gt;&lt;li&gt;These long-lived workers need simulation runs over a long period of time or a focused stress test to ensure they will perform without side effects.&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Repeat methods calls with mutable state vs. fresh or immutable objects&lt;ul&gt;&lt;li&gt;Calling a method once is almost never real world behavior&lt;/li&gt;&lt;li&gt;Incorporate a test mechanism that ensures that your tests run multiple times in a random order with the modules still loaded into memory&lt;/li&gt;&lt;li&gt;Memory leakage/object accumulation can overwhelm process resources, but only if sufficiently exercised in the test environment&lt;ul&gt;&lt;li&gt;Monitor resource usage over time in your test environment to identify incremental growth&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;Migrations and Other One-Off Events&lt;/h2&gt;&lt;p&gt;Single occurrence events are not just single first-time activities, but also single last-time activities. You may only get one chance in the production environment to get these correct. Much like single-execution missions (i.e. expendable rockets), migrations and other corrective actions often dissuade time spent on testing. After all, we only need this to be correct once.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Use copies of real-world data for confirming prior to the “mission” that the migrations will process properly&lt;/li&gt;&lt;li&gt;Rename database columns being retired and run specs to ensure they are not &lt;em&gt;indirectly&lt;/em&gt; referenced before removal&lt;/li&gt;&lt;li&gt;Add foreign key constraints wherever possible to mandate data integrity&lt;/li&gt;&lt;li&gt;Provide logged evidence that migrations performed as expected&lt;/li&gt;&lt;li&gt;Where critical one-time execution is required independently design inline confirmation testing&lt;/li&gt;&lt;li&gt;Dry runs are great as long as they emulate the task completely&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;I hope you have found Part 4 on Time and Timing valuable. Next up in our TLYF series - &amp;quot;What Was Your Intent?&amp;quot;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Test Like You Fly - The World Revolves Around You]]></title><description><![CDATA[In  Test Like You Fly - Part 2 - Basics , we discussed the fundamentals of how you practice a TLYF strategy. No systems operate in such…]]></description><link>https://hint.io/blog/test-like-you-fly-3</link><guid isPermaLink="false">https://hint.io/blog/test-like-you-fly-3</guid><dc:creator><![CDATA[timChambers]]></dc:creator><pubDate>Thu, 29 Jul 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In &lt;a href=&quot;https://hint.io/blog/test-like-you-fly-2&quot;&gt;Test Like You Fly - Part 2 - Basics&lt;/a&gt;, we discussed the fundamentals of how you practice a TLYF strategy. No systems operate in such isolation that they are not reliant on some other code foundations. And those foundations rely on other foundations.&lt;/p&gt;&lt;h2&gt;Environments and Configurations - Oh My!&lt;/h2&gt;&lt;p&gt;Our applications don&amp;#x27;t live in a vacuum. They take advantage of the operating systems, databases, caches, networks, and other external services available today in the cloud deployment environment. Let&amp;#x27;s see what we should think about in regard to Testing Like We Fly.&lt;/p&gt;&lt;h3&gt;Predefine and Test&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;Provisioning – Ensure existence/creation of directories&lt;/li&gt;&lt;li&gt;Validate that dependencies (gems, npm packages, etc.) state compatibility with the environment, not just assume future compatibility&lt;/li&gt;&lt;li&gt;Consistency – Verify language (Ruby, Rails, JavaScript, Database, etc.) versions and their dependencies being tested match those in our deployed environment.&lt;/li&gt;&lt;li&gt;Environment variables (and defaults for lack thereof)&lt;/li&gt;&lt;li&gt;IP usage and Port conflicts&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Get Specific&lt;/h3&gt;&lt;p&gt;Specificity is an invaluable ally in operating environments that have been confirmed through testing. Do not make the fatal inference: “It should work”.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Bugs exist in all code.&lt;/li&gt;&lt;li&gt;Bugs existed in code in older versions then you are using&lt;/li&gt;&lt;li&gt;Bugs (especially unknown bugs) can be introduced in code you rely on if it is &lt;em&gt;beyond&lt;/em&gt; your tested version&lt;/li&gt;&lt;li&gt;Upgrading is not only a requirement but a risk&lt;/li&gt;&lt;li&gt;All environmental changes require retesting&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Cautionary Tale - MySQL Version Upgrade&lt;/h3&gt;&lt;p&gt;Let&amp;#x27;s say we have a database running MySQL 8.0.18. We are tasked with upgrading this database to MySQL 8.0.19. Based on semantic versioning, this looks like an innocent patch update. Unfortunately, this is far from the truth. In this update, the code was changed to assume that &lt;code&gt;TINYINT(1)&lt;/code&gt; should be treated as a boolean. However, this was NOT the case any longer if the column was &lt;code&gt;UNSIGNED&lt;/code&gt; when the schema was extracted. When schemas from MySQL 8.0.18 were dumped and loaded into another database running MySQL 8.0.19, these boolean columns became &lt;code&gt;TINYINT(4)&lt;/code&gt; columns. Existing databases were unaffected, but any new databases loading the old schemas signalled to applications that these columns were no longer boolean.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Moral: Always test the full cycle with any change including downstream practices like data transfer/replication&lt;/strong&gt;&lt;/p&gt;&lt;h2&gt;Networking - The Outside World Awaits&lt;/h2&gt;&lt;p&gt;One of the most difficult contexts to emulate in testing is interfacing with networks. APIs with credentials that serve us in production should be secured from testing access. So how do we sufficiently TLYF while still abiding by network security best practices?&lt;/p&gt;&lt;h3&gt;Start Yanking Cables&lt;/h3&gt;&lt;p&gt;If network access is crucial, then taking the network down before and randomly during test execution provides critical insight into how your application handles these inevitable scenarios.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Adjust response to degrade gracefully where possible&lt;/li&gt;&lt;li&gt;Use gentle throttling to handle peaks&lt;/li&gt;&lt;li&gt;Test on a variety of networks to detect &lt;em&gt;hardcoded&lt;/em&gt; expectations&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Log In as Production&lt;/h3&gt;&lt;p&gt;If possible, use or at least test using the same cloud credentials as will be used in production. This will ensure the accessible “user” context is tested. Testing Like You Fly in this respect gives us the confidence in knowing that if we can hit production cloud services in the test environment, the odds are good that we can hit them in production as well. Make absolutely sure that any test system you establish cannot access the production system directly - protect the production environment from mutation during tests.&lt;/p&gt;&lt;h3&gt;Get a Bigger Measuring Tape&lt;/h3&gt;&lt;p&gt;In the age of cloud computing, physical distance between your servers is often overlooked. Consider the availability needs and data processed by the servers physically closest to the user locations they service.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Failover to other regions within same provider&lt;/li&gt;&lt;li&gt;Failover to other providers&lt;/li&gt;&lt;li&gt;Alternate DNS servers for DNS lookup&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Short but important considerations for all parties involved in launching a successful application. Next up is Timing.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Test Like You Fly - Basics]]></title><description><![CDATA[In Test Like You Fly - Part 1 - Introduction  we discussed the characteristics of TLYF as a practice. Let's dive right into the basics. The…]]></description><link>https://hint.io/blog/test-like-you-fly-2</link><guid isPermaLink="false">https://hint.io/blog/test-like-you-fly-2</guid><dc:creator><![CDATA[timChambers]]></dc:creator><pubDate>Thu, 22 Jul 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;https://hint.io/blog/test-like-you-fly-1&quot;&gt;In Test Like You Fly - Part 1 - Introduction&lt;/a&gt; we discussed the characteristics of TLYF as a practice. Let&amp;#x27;s dive right into the basics.&lt;/p&gt;&lt;p&gt;The examples will use Ruby as the language, but should be generic enough to apply to any systems in most any modern language. Unlike Ruby with its duck-typing approach, some technical issues are off the table for statically-typed or type-enforced languages. YMMV, but the concepts are the same.&lt;/p&gt;&lt;h2&gt;Principles&lt;/h2&gt;&lt;p&gt;All strategies are founded on principles. TLYF is no different.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Ensure the developer is not the only tester/reviewer&lt;/li&gt;&lt;li&gt;Measure code coverage - what is measured improves&lt;ul&gt;&lt;li&gt;Skip spec/factory directories when measuring coverage - they are either 100% covered or will bias the numbers&lt;ul&gt;&lt;li&gt;Artificially increases coverage&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Render views/pages in specs to maximize coverage potential&lt;ul&gt;&lt;li&gt;&lt;em&gt;Sometimes&lt;/em&gt; developers introduce business logic in view code&lt;/li&gt;&lt;li&gt;Note: unfortunately many coverage measurement tools do not count lines in views/pages&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Always match test environment versions to the production environment &lt;em&gt;exactly&lt;/em&gt;&lt;ul&gt;&lt;li&gt;Never let developers code with versions you are not going to ship&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Test the hard-to-test stuff&lt;ul&gt;&lt;li&gt;Documentation&lt;/li&gt;&lt;li&gt;Initializers (one-time and first-time code)&lt;/li&gt;&lt;li&gt;Deploy process code (the code that installs and upgrades your app in production)&lt;/li&gt;&lt;li&gt;Data migrations (both upgrading and downgrading, if that is a feature)&lt;/li&gt;&lt;li&gt;Error messaging (go out of the way to make sure errors in error handling do not occur)&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Automate all tests - even the hard ones - so you keep yourself honest&lt;ul&gt;&lt;li&gt;CI/CD should test the deploy processing&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Avoid negative testing (do not use &lt;code&gt;.not_to do xyz&lt;/code&gt;) - the possible non-results of any system is infinite&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Anything declared &amp;quot;cannot be tested&amp;quot; is a critical fault risk and should be treated as such - Tenet #4 - When you cannot test like you fly - worry (or do risk management)&lt;/p&gt;&lt;h2&gt;Coverage - &amp;quot;I got you covered&amp;quot;&lt;/h2&gt;&lt;p&gt;What is measured improves. What is not measured leaves doubt. We have the tools to ensure we know what we have tested, and what we have not. Still, coverage is a vague term. Is the line &lt;code&gt;xyzzy(123) if a == 1&lt;/code&gt; covered if &lt;code&gt;a&lt;/code&gt; is 2? Most coverage tools say YES it is. Let&amp;#x27;s examine some ways to improve the value of line of code coverage analysis.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Can&amp;#x27;t test code you don&amp;#x27;t have, but you can ensure code you do have is executed&lt;/li&gt;&lt;li&gt;Avoid complex single-line conditionals - more than 2 predicates is a caution&lt;/li&gt;&lt;li&gt;Break multi-part conditionals into well-named predicate methods&lt;ul&gt;&lt;li&gt;Naming methods gives you the opportunity to clearly state the one simple function the method provides&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Avoid single in-line conditionals as much as reasonable (they count as covered even if false)&lt;/li&gt;&lt;li&gt;Prefer if/case/when statements over in-line conditionals&lt;ul&gt;&lt;li&gt;Multi-line conditionals don&amp;#x27;t obfuscate line-of-code coverage&lt;/li&gt;&lt;li&gt;They increase definition and comprehension&lt;/li&gt;&lt;li&gt;You can see which lines are &amp;quot;covered&amp;quot; and which are not&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Keep methods short and single-responsibility (SRP)&lt;ul&gt;&lt;li&gt;1-3 line methods are ideal - use complexity metrics as your guide&lt;/li&gt;&lt;li&gt;Keep your lines of code short - easily-read code is easier to see errors&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;A line of code that is not covered by specs/tests will run the first time in production (see Tenet #1)&lt;/p&gt;&lt;h2&gt;Mocking - &amp;quot;Let&amp;#x27;s pretend&amp;quot;&lt;/h2&gt;&lt;p&gt;All developers have moved or stubbed code outside the system-under-test to ensure clear context and to speed up tests. Each time we risk walling off misbehavior at those interfaces. This is necessary. At the boundaries are where many errors creep in.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Avoid mocking/stubbing whenever it is possible without negative impact&lt;/li&gt;&lt;li&gt;Mock only realistic input and responses&lt;ul&gt;&lt;li&gt;This includes data type matching of input and return values&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Never mock entire operation sequences or message chains&lt;/li&gt;&lt;li&gt;Don&amp;#x27;t replace the code under test with mocked code responses that may be correct today and code change away from being hidden&lt;/li&gt;&lt;li&gt;Never partially mock a response - in production you won&amp;#x27;t get half an answer&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Example #1 - SQL&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;Specs tested the &lt;strong&gt;content&lt;/strong&gt; of SQL generated dynamically for user-expressed search options&lt;/li&gt;&lt;li&gt;Confirmed generated SQL was &amp;#x27;as expected&amp;#x27; and specs ran fast (no actual DB queries were made) - it &amp;quot;looked&amp;quot; correct&lt;/li&gt;&lt;li&gt;Did NOT confirm SQL was executable by the DB&lt;/li&gt;&lt;li&gt;Application passed specs and failed to generate valid executable SQL syntax in production&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Moral: Pass requests to the actual destination services using the same version levels and service apps used in production (as in flight)&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;Data - &amp;quot;The fabric of our lives&amp;quot;&lt;/h2&gt;&lt;p&gt;Ok so data is not cotton. But it is fuel and as such can burn us. Treat data and especially changes in data with the reverence it deserves.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Treat immutable data as immutable in tests - don’t alter data that cannot be altered in production&lt;/li&gt;&lt;li&gt;Write-once data should have code to ensure it is immutable&lt;ul&gt;&lt;li&gt;Setter methods can prevent/announce attempts to change immutable data signalling a potential flaw&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Ensure data represents real world data in the normal case - test edge cases to ensure they do not stretch the definition of “realistic”&lt;ul&gt;&lt;li&gt;Ex: Don’t use 1 as a common value if the normal data is in the range of 10,000..10,000,000&lt;/li&gt;&lt;li&gt;Test for negative values if unsigned&lt;/li&gt;&lt;li&gt;Use values prime relative to each other in specs that count/sum/average&lt;ul&gt;&lt;li&gt;1 and 1 are not the same as 0 and 2 but they often end up with the same results&lt;/li&gt;&lt;li&gt;Values such as 2, 3, 5, 7 11, 13 allow us to experience differentiation&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Select production-like data - the data should be something any typical user would recognize&lt;ul&gt;&lt;li&gt;Testing with fake data is fine, as long as the fake data simulates real-world data&lt;/li&gt;&lt;li&gt;I.e. if data is for a name field consider variety of names. If the data will be numeric introduce the proper number of decimals and large values.&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Ensure widest possible variety of test example data content. Per Tenet #1 do not present a certain class of data for the first time in production&lt;/li&gt;&lt;li&gt;Treat meta-data as data. Ex: HTTP params are STRINGS, not objects, as they are received from a browser&lt;ul&gt;&lt;li&gt;Ex: Don’t test with &lt;code&gt;Date&lt;/code&gt; objects when your data is date strings&lt;/li&gt;&lt;li&gt;Don’t test with integers if the input is a numeric STRING&lt;/li&gt;&lt;li&gt;Use &lt;code&gt;Float&lt;/code&gt; values WITH decimals if the numeric values can have decimals&lt;/li&gt;&lt;li&gt;If &lt;code&gt;BigDecimal&lt;/code&gt; values are exchanged ensure they are tested for class&lt;/li&gt;&lt;li&gt;Use the proper number of decimal places. USD$ are in dollars and cents with 2 decimal places&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Case-sensitivity is real. Your DB might or might not be, and your language may or may not have case-insensitive classes of functions/objects&lt;ul&gt;&lt;li&gt;Make sure you test for case matching at any data interface&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Use &lt;code&gt;save!&lt;/code&gt; or &lt;code&gt;update!&lt;/code&gt; where applicable to ensure failed validations bubble up and exceptions are announced&lt;/li&gt;&lt;li&gt;If your data is an &lt;code&gt;Array&lt;/code&gt; ensure the elements are of the type you are expecting&lt;ul&gt;&lt;li&gt;If you always expect an &lt;code&gt;Array&lt;/code&gt; to have content, test for that&lt;/li&gt;&lt;/ul&gt;&lt;/li&gt;&lt;li&gt;Use foreign keys in your database to keep any associated persisted data honest&lt;/li&gt;&lt;li&gt;If using default values for columns in a database, ensure that tests prove they are not the only possible values&lt;/li&gt;&lt;li&gt;Make sure critical columns are marked not null - especially simple booleans that must be true or false - not &amp;quot;falsey&amp;quot; if nil&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Example #2 - String Input&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;A certain controller expects date strings for starting and ending dates (e.g. &amp;quot;2021-01-03&amp;quot;)&lt;/li&gt;&lt;li&gt;Used &lt;code&gt;Date.parse()&lt;/code&gt; to parse and validate&lt;/li&gt;&lt;li&gt;Controller specs did not need to pass in dates because it substituted default dates when input was absent&lt;/li&gt;&lt;li&gt;Default dates were &lt;code&gt;Date&lt;/code&gt; objects not &lt;code&gt;String&lt;/code&gt;&lt;/li&gt;&lt;li&gt;When the default dates were substituted in, the &lt;code&gt;Date.parse()&lt;/code&gt; failed because the &lt;code&gt;Date&lt;/code&gt; objects were not &lt;code&gt;String&lt;/code&gt; objects&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Moral: Always test with expected data types. That includes when they are mocked&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Example #3 - Coordinated Values&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;Parent/child database tables had a denormalized common &amp;quot;start date&amp;quot; value for performance. Start date is &amp;quot;immutable&amp;quot; for all intents and purposes after row is created in both tables&lt;/li&gt;&lt;li&gt;Specs use factories to generate child data which generates consistent parent data (exactly same value)&lt;/li&gt;&lt;li&gt;Specs then &amp;quot;adjust&amp;quot; the child&amp;#x27;s start date to test a particular condition&lt;/li&gt;&lt;li&gt;The specs pass even though the data is not consistent with real world immutability/equality between parent and child&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Moral: Never adjust data in tests to create &amp;quot;impossible&amp;quot; combinations of real world data&lt;/strong&gt;&lt;/li&gt;&lt;li&gt;Hint: Enforce data validations that ensure immutability of data once generated&lt;/li&gt;&lt;li&gt;Hint #2: Ensure tests fail if invalid combinations of data are encountered&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;The above is just a starting point for you as you examine your development and testing practices through the TLYF lens. Our third article in this series will cover &amp;quot;the world around you&amp;quot;. Looking forward to your feedback.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Test Like You Fly - Intro]]></title><description><![CDATA[I practice TLYF. In contrast to all the other important test methodologies, "Test Like You Fly", or TLYF for short, emphasizes testing to…]]></description><link>https://hint.io/blog/test-like-you-fly-1</link><guid isPermaLink="false">https://hint.io/blog/test-like-you-fly-1</guid><dc:creator><![CDATA[timChambers]]></dc:creator><pubDate>Tue, 13 Jul 2021 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;I practice TLYF.&lt;/h2&gt;&lt;p&gt;In contrast to all the other important test methodologies, &amp;quot;Test Like You Fly&amp;quot;, or TLYF for short, emphasizes testing to find fundamental flaws in a system that will prevent it from performing the mission. Most testing methodologies strive to confirm that requirements - the input to our designs - are being met by the system as written.&lt;/p&gt;&lt;p&gt;TLYF is all about confirming that the system - as a whole - will operate in the environment it is designed to operate, the environment we typically refer to as &amp;quot;live&amp;quot; or &amp;quot;production&amp;quot;. It is vitally important to find what doesn’t perform as expected and to understand the reasons for this anomalous behavior, especially where such defects can degrade, cripple, or abruptly end a mission.&lt;/p&gt;&lt;p&gt;During this 7-part series we will cover how to accomplish TLYF in detail in your own applications:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Introduction (this post)&lt;/li&gt;&lt;li&gt;Basically - the basics of testing like you fly&lt;/li&gt;&lt;li&gt;The World Revolves Around You - how do you ensure a consistent environment externally&lt;/li&gt;&lt;li&gt;Timing is (Almost) Everything - The impact time and timing have on our ability to TLYF&lt;/li&gt;&lt;li&gt;What was your Intent? - Writing Intentional Code that minimizes inferences&lt;/li&gt;&lt;li&gt;Logging and Failure Modes - what to ensure before liftoff in case bad things happen&lt;/li&gt;&lt;li&gt;Fly What You Test - What to do when you liftoff&lt;/li&gt;&lt;/ol&gt;&lt;h2&gt;I think I already do this! So what makes TLYF different?&lt;/h2&gt;&lt;p&gt;In our testing strategies we frequently attempt to isolate the component under test - large or small - from the rest of the system. We know what we want to test, and fine-grained or coarse, we test segments of the system. The larger the component, or the broader the test, the more we tend to try and prove it WILL work - work &amp;quot;as designed&amp;quot;.&lt;/p&gt;&lt;p&gt;TLYF comes at the system from the other direction. Testing Like You Fly is designed to as completely as possible drive the system as it will exist in production. It demonstrates that the mission of the system or application can achieve success, not that it merely meets requirements. All components are wired together and available in as real-world an environment as is possible.&lt;/p&gt;&lt;p&gt;Testing Like You Fly originated in the aerospace industry, with the intention of mitigating risks by pre-playing all expected &lt;em&gt;in flight&lt;/em&gt; scenarios in advance of actual flight. Given the one and often only chance to make most flights a success, it is crucial to execute all happy paths and possible failure modes while on the ground. Here we use the term &amp;quot;mission&amp;quot; to represent the activities in the live environment an application is designed for.&lt;/p&gt;&lt;h2&gt;TLYF is a Team Sport&lt;/h2&gt;&lt;p&gt;This testing approach requires all hands on deck. Everyone from design, developers, support personnel, operations, etc. should be engaged in the process of being &amp;quot;LYF Architects&amp;quot;. LYF Architects spend time identifying how the test environment - prior to &lt;em&gt;liftoff&lt;/em&gt; - can replicate the expectations of that live environment and identify gaps in testing to ensure success &lt;em&gt;on the ground&lt;/em&gt; means success &lt;em&gt;in the air&lt;/em&gt;.&lt;/p&gt;&lt;h2&gt;What are the basic tenets of TLYF?&lt;/h2&gt;&lt;ol&gt;&lt;li&gt;The system should NEVER experience expected operations, environments, stresses or their combinations for the first time DURING the mission.&lt;/li&gt;&lt;li&gt;Do only smart things - do not subject the system to potentially damaging situations for which it is underprepared.&lt;/li&gt;&lt;li&gt;TLYF does not replace other traditional forms of perceptive testing (e.g. environmental, stress, performance, unit or functional testing)&lt;/li&gt;&lt;li&gt;When you cannot test like you fly - worry (or do risk management)&lt;/li&gt;&lt;/ol&gt;&lt;h2&gt;Why do we test?&lt;/h2&gt;&lt;p&gt;The purpose of testing is NOT to prove that no flaws exist.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;It is not possible to prove that no flaws exist&lt;/li&gt;&lt;li&gt;You can only prove that you haven&amp;#x27;t found any with the tests you have performed&lt;/li&gt;&lt;li&gt;Systems always have flaws&lt;/li&gt;&lt;li&gt;Ignorance - anywhere in the system - is also a flaw&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;Perspectives of Testing&lt;/h2&gt;&lt;p&gt;There are two types of testing we encounter - &lt;strong&gt;white box&lt;/strong&gt; and &lt;strong&gt;black box&lt;/strong&gt;.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;White Box&lt;/strong&gt; testing is detailed testing based on one premise - &amp;quot;I know how it works&amp;quot;&lt;/p&gt;&lt;p&gt;The input for white box testing are edge cases and extremes - the testing is for specific behaviors. Any &lt;strong&gt;code&lt;/strong&gt; changes demand a re-test. Testing is performed in small increments. Detailed behavior is affirmed.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Black Box&lt;/strong&gt; testing leaves the system opaque to the tester. Input is typical input, and the outcomes measure the results. Any &lt;strong&gt;requirements&lt;/strong&gt; change demands a re-test. Testing is performed as end-to-end &amp;quot;day/weeks/years in the life&amp;quot; (DITL) - a &lt;strong&gt;Total Operations Chain Test&lt;/strong&gt; of all &lt;strong&gt;First Time Activities&lt;/strong&gt;. Testing needs to simulate activities with longer time frames through acceleration of time - as certainly monthly or once-a-year events still need tested.&lt;/p&gt;&lt;h2&gt;What is a &amp;quot;Total Operations Chain Test&amp;quot;?&lt;/h2&gt;&lt;p&gt;Pilots cannot test aircraft by starting from 30,000 feet. They have to taxi to the runway, takeoff, fly to a desired altitude, and then, and only then, can they experience the plane in its natural habitat. Likewise our applications do not magically start processing requests immediately. Their environment is provisioned, they are &amp;quot;booted&amp;quot;, they establish connections to their surroundings.&lt;/p&gt;&lt;p&gt;Only then are they prepared to &amp;quot;operate&amp;quot;. During that operational period they are expected to handle on occasion a peak demand, and gracefully degrade. Should anything unanticipated occur they should log pertinent details for diagnosis, announce their &amp;quot;distress&amp;quot; and not collapse or fail miserably nor abruptly.&lt;/p&gt;&lt;p&gt;The purpose of TLYF is to experience all of the above &lt;em&gt;before launch&lt;/em&gt;. With the comforting knowledge that whatever could happen has been tested, experienced, diagnosed, AND mitigated &lt;em&gt;before launch&lt;/em&gt;. Operate the entire system end-to-end through its full business lifecycle before it becomes critical to the business.&lt;/p&gt;&lt;h2&gt;First Time Activities&lt;/h2&gt;&lt;p&gt;The fundamental principle of TLYF is to perform activities for the first time pre-launch rather than during the actual mission, it follows that we must be cognizant of what those &amp;quot;first time&amp;quot; activities are. A &amp;quot;first-time&amp;quot; activity is not only the literal first time a discrete activity is performed, but is also the first time a repetitive set of activities (e.g., &amp;quot;nominal ops&amp;quot;) is performed. Both versions of a first time activity are needed as the basis for the &amp;quot;days-in-the-life&amp;quot; (DITL) tests, with the second version necessary to flush out accumulation and asynchronous timing errors that need more than a single occurrence or cycle to allow this kind of flaw to manifest.&lt;/p&gt;&lt;h2&gt;Flying Like You Test&lt;/h2&gt;&lt;p&gt;Ok. You have done your best to TLYF. Your application is humming along nicely doing what it does best - serving your customer&amp;#x27;s needs - fulfilling a mission. And over the horizon, you see a scenario brewing that you did not anticipate - a new set of circumstances, a change in the business needs, data that is outside the expected value ranges, etc. What do you do?&lt;/p&gt;&lt;p&gt;What you don&amp;#x27;t do is test in production. Of course not. You would not do that. Standing back you realize that this new scenario was not considered in your TLYF test environment. It may be obvious that you need to introduce this scenario into a full TLYF lifecycle test, in all its nuance, to a) discover how the mission will transpire, and b) to assess what adjustments need to be made to support this new scenario. The critical step in Fly Like You Test is appreciating that you should never &amp;quot;fly&amp;quot; any scenario in the production environment without first testing it.&lt;/p&gt;&lt;h3&gt;TLYF and then FLYT.&lt;/h3&gt;&lt;p&gt;How do I TLYF? Next up in this series: The Basics of Testing Like You Fly.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Active Record Encryption]]></title><description><![CDATA[Rails 7 will be introducing a very cool new feature for ActiveRecord - application-level encryption, summoned by the mighty  encrypts…]]></description><link>https://hint.io/blog/Active-Record-Encryption</link><guid isPermaLink="false">https://hint.io/blog/Active-Record-Encryption</guid><dc:creator><![CDATA[jasonDinsmore]]></dc:creator><pubDate>Tue, 06 Jul 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Rails 7 will be introducing a very cool new feature for ActiveRecord - application-level encryption, summoned by the mighty &lt;code&gt;encrypts&lt;/code&gt; declaration in a model. This new feature provides a layer of encryption that sits between our application code and the database. In essence, when our data using Active Record Encryption has been loaded into an AR object, it will be unencrypted, and when it is sitting in the database it will be encrypted.&lt;/p&gt;&lt;p&gt;In this post, we will take a high-level look at how to use this functionality, discuss some cool things it can do, and acknowledge some of its limitations.&lt;/p&gt;&lt;p&gt;Before we dive in, I would be remiss if I didn&amp;#x27;t point to the excellent documentation in the &lt;a href=&quot;https://guides.rubyonrails.org/active_record_encryption.html&quot;&gt;Rails guide&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;For the duration of the post, I will refer to the feature as &lt;strong&gt;encrypts&lt;/strong&gt; for brevity (and also because I am not sure what else to call it 😉).&lt;/p&gt;&lt;h2&gt;Backstory&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;encrypts&lt;/strong&gt; was merged into Rails in &lt;a href=&quot;https://github.com/rails/rails/pull/41659&quot;&gt;PR 41659&lt;/a&gt; by &lt;a href=&quot;https://github.com/jorgemanrubia&quot;&gt;@jorgemanrubia&lt;/a&gt;. In the PR description he states that the functionality is an extraction from &lt;a href=&quot;https://hey.com/&quot;&gt;HEY&lt;/a&gt;, which had the implementation reviewed by a security firm. If you are interested in hearing more of the story behind the feature, I&amp;#x27;d recommend &lt;a href=&quot;https://world.hey.com/jorge/a-story-of-rails-encryption-ce104b67&quot;&gt;Jorge&amp;#x27;s blog post&lt;/a&gt; on the subject - it&amp;#x27;s an interesting read.&lt;/p&gt;&lt;h2&gt;Deterministic Sidebar&lt;/h2&gt;&lt;p&gt;Let&amp;#x27;s take a quick second to discuss the difference between deterministic and non-deterministic encryption. It&amp;#x27;s really pretty simple, but is a central tenet in understanding how to use &lt;strong&gt;encrypts&lt;/strong&gt;.&lt;/p&gt;&lt;p&gt;Think of encryption as a function that is applied to some input (text), resulting in some output (encrypted text).&lt;/p&gt;&lt;p&gt;If the function is deterministic, then any time the function is applied to the same text, it will output the same result.&lt;/p&gt;&lt;p&gt;If the encryption function is non-deterministic, then we can&amp;#x27;t predict what the output will be the second time we encrypt a given value. In theory, it is possible we would get the same result we got the first time, but the odds of that happening are very, very low. In the context of &lt;strong&gt;encrypts&lt;/strong&gt; with its default non-deterministic configurations, subsequent encryptions of the same plaintext are almost certain to produce different ciphertexts.&lt;/p&gt;&lt;p&gt;If we are using deterministic encryption with &lt;strong&gt;encrypts&lt;/strong&gt; for a model attribute, then any two rows in the database that would have the same plaintext value will also have the same stored encrypted value. If we using non-deterministic encryption, then two rows that have the same plaintext value will generally have different encrypted values. As we&amp;#x27;ll see in a bit, this has implications as to whether we can query the encrypted data.&lt;/p&gt;&lt;h2&gt;Setup&lt;/h2&gt;&lt;p&gt;There&amp;#x27;s not a ton of configuration required to get going with &lt;strong&gt;encrypts&lt;/strong&gt;, but there are some things to be aware of.&lt;/p&gt;&lt;h3&gt;Keys&lt;/h3&gt;&lt;p&gt;The main requisite is that we will need to generate a set of keys and add them to our credentials file(s). We can generate the keys to add by running: &lt;code&gt;bin/rails db:encryption:init&lt;/code&gt;, which will output something like:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;Add&lt;/span&gt; this entry to the credentials of the target environment&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;

active_record_encryption&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  primary_key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; zxMXS0hBbpa5BzRKPv9HOSF9etBySiHQ
  deterministic_key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;pM2UHHBQr1kf1irO6JgakcSOXu0r1Vn
  key_derivation_salt&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;I5AkViD0UJhSqK3NY49Zvsls3ZoifyXx&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;primary key&lt;/code&gt; is used to derive the root encryption key for non-deterministic encryption. Note that the &lt;code&gt;primary_key&lt;/code&gt; value in the credentials file can also be a list of keys.&lt;/p&gt;&lt;p&gt;The &lt;code&gt;deterministic_key&lt;/code&gt; is used for deterministic encryption. If you recall from the section on determinism above, we&amp;#x27;ll get the same result if we encrypt the same data with this key multiple times. Currently, &lt;strong&gt;encrypts&lt;/strong&gt; does not support using a list of keys for deterministic encryption. If we want to completely disable deterministic encryption, not providing the key is a sure-fire off switch.&lt;/p&gt;&lt;p&gt;The &lt;code&gt;key_derivation_salt&lt;/code&gt; is used to derive encryption keys.&lt;/p&gt;&lt;h3&gt;App Configuration&lt;/h3&gt;&lt;p&gt;The &lt;a href=&quot;https://guides.rubyonrails.org/v7.0.0/active_record_encryption.html#configuration-options&quot;&gt;&lt;strong&gt;encrypts&lt;/strong&gt; API&lt;/a&gt; provides several configuration options. All of the options are defined in the &lt;code&gt;config.active_record.encryption&lt;/code&gt; namespace and I&amp;#x27;d encourage reading through them if you are going to use this feature. I believe you&amp;#x27;ll find that most of the options have pretty reasonable defaults.&lt;/p&gt;&lt;p&gt;I will mention the &lt;code&gt;config.active_record.encryption.extend_queries&lt;/code&gt; option as it defaults to &lt;code&gt;false&lt;/code&gt;, but enabling it has several implications:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;enables querying unencrypted data in an encrypted column (also need to enable &lt;code&gt;config.active_record.encryption.support_unencrypted_data&lt;/code&gt; for this)&lt;/li&gt;&lt;li&gt;allows supporting multiple encryption schemes&lt;/li&gt;&lt;li&gt;enables  support for uniqueness validations&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Database&lt;/h3&gt;&lt;p&gt;When an encrypted string or text attribute is stored in the database, it isn&amp;#x27;t stored as an ordinary string or text - it is stored as a more complex data structure that is serialized when written and deserialized when read. This data structure allows some meta information to be stored along with the encrypted text, which gives the app some clues about how the text was encrypted.&lt;/p&gt;&lt;p&gt;This extra meta-info introduces some storage overhead - up to 250 bytes.&lt;/p&gt;&lt;p&gt;The guide recommends increasing the size of a 255 byte string field to 512 bytes if using encryption on a column. It also says that for a text field, the overhead is generally negligible.&lt;/p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:62.576687116564415%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAEFA//EABUBAQEAAAAAAAAAAAAAAAAAAAID/9oADAMBAAIQAxAAAAG7OanSiZCH/8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIAAxITMv/aAAgBAQABBQJvILLZoRbWLWAluep//8QAFxEBAAMAAAAAAAAAAAAAAAAAAAIhYf/aAAgBAwEBPwGGqf/EABcRAQADAAAAAAAAAAAAAAAAAAACIWH/2gAIAQIBAT8Bni3/xAAaEAACAgMAAAAAAAAAAAAAAAAAASIxEyGR/9oACAEBAAY/AmSemWY30skz/8QAGRABAAMBAQAAAAAAAAAAAAAAAQARIUEx/9oACAEBAAE/IaaNFS1dvFiPomJmEa8X5E0UWuZP/9oADAMBAAIAAwAAABCTP//EABgRAAMBAQAAAAAAAAAAAAAAAAABETFR/9oACAEDAQE/EIrWCdH/xAAYEQEAAwEAAAAAAAAAAAAAAAABABExUf/aAAgBAgEBPxBNDqXxP//EAB0QAQEAAwACAwAAAAAAAAAAAAERACExQVFxgfD/2gAIAQEAAT8QQSQlak+zJMPYSF0l/TIEdKVlMpzYjO0vrDZ7APA5O4HEIOAfGf/Z&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Dog burying a bone&quot; title=&quot;Dog burying a bone&quot; src=&quot;/static/ad793e69852299349fc3869fb8f0a079/6aca1/dogbone.jpg&quot; srcSet=&quot;/static/ad793e69852299349fc3869fb8f0a079/d2f63/dogbone.jpg 163w,/static/ad793e69852299349fc3869fb8f0a079/c989d/dogbone.jpg 325w,/static/ad793e69852299349fc3869fb8f0a079/6aca1/dogbone.jpg 650w,/static/ad793e69852299349fc3869fb8f0a079/2551b/dogbone.jpg 748w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;h2&gt;Invocation&lt;/h2&gt;&lt;p&gt;Finally, we can talk about actually using the thing!&lt;/p&gt;&lt;p&gt;In the most basic use case, to encrypt a single column, we simply add an &lt;strong&gt;encrypts&lt;/strong&gt; declaration to our model for the attribute we want to encrypt. For example, if we had a &lt;code&gt;Dog&lt;/code&gt; model with a &lt;code&gt;toy_location&lt;/code&gt; field (dogs like to hide their toys, you know) that needs encryption, our model would look like:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Dog&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ApplicationRecord&lt;/span&gt;
    encrypts &lt;span class=&quot;token symbol&quot;&gt;:toy_location&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Pretty simple, eh?&lt;/p&gt;&lt;h2&gt;Writing&lt;/h2&gt;&lt;p&gt;Writing an encrypted attribute is completely transparent. We just do what we would normally do in Rails:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; dog &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Dog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;Bruno&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; toy_location&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;top secret&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If we were to look at the content sitting in the database directly, we would see something like:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Dog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;connection&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;execute&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;SELECT toy_location FROM dogs LIMIT 1&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;first
   &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.4&lt;/span&gt;ms&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token constant&quot;&gt;SELECT&lt;/span&gt; toy_location &lt;span class=&quot;token constant&quot;&gt;FROM&lt;/span&gt; dogs &lt;span class=&quot;token constant&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;toy_location&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;{\&amp;quot;p\&amp;quot;:\&amp;quot;oVgEJvRaX6DJvA==\&amp;quot;,\&amp;quot;h\&amp;quot;:{\&amp;quot;iv\&amp;quot;:\&amp;quot;WYypcKysgBY05Tum\&amp;quot;,\&amp;quot;at\&amp;quot;:\&amp;quot;OaBswq+wyriuRQO8yCVD3w==\&amp;quot;}}&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The value here is just serialized JSON, let&amp;#x27;s go ahead and parse it:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;JSON&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parse&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;toy_location&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;p&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;oVgEJvRaX6DJvA==&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;h&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;iv&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;WYypcKysgBY05Tum&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;at&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;OaBswq+wyriuRQO8yCVD3w==&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That gave us a Hash. Most of the keys in this Hash are defined in the &lt;a href=&quot;https://github.com/rails/rails/blob/c9a0f1ab9616ca8e94f03327259ab61d22f04b51/activerecord/lib/active_record/encryption/properties.rb#L23-L30&quot;&gt;&lt;code&gt;ActiveRecord::Encryption::Properties::DEFAULT_PROPERTIES&lt;/code&gt;&lt;/a&gt; constant. &lt;code&gt;p&lt;/code&gt; is the payload, aka the encrypted plaintext. &lt;code&gt;h&lt;/code&gt; is a Hash of headers that contain information relating to the encryption operation. Here, &lt;code&gt;iv&lt;/code&gt; is the initialization vector the plaintext was encrypted with - more about this in the next section on searching, and &lt;code&gt;at&lt;/code&gt; is an &lt;code&gt;auth_tag&lt;/code&gt; that will be used during the decryption process to verify that the encrypted text hasn&amp;#x27;t been altered. You may notice other headers from the &lt;code&gt;DEFAULT_PROPERTIES&lt;/code&gt; Hash above depending on how your encryption is set up and being used.&lt;/p&gt;&lt;h2&gt;Reading&lt;/h2&gt;&lt;p&gt;When we load a model with an encrypted attribute, Rails will seamlessly decrypt the encrypted value. Let&amp;#x27;s find the &lt;code&gt;Dog&lt;/code&gt; we created above by his name:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Dog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;find_by&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;Bruno&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;toy_location
&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Dog&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;Bruno&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; toy_location&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;top secret&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; created_at&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;2021-05-28 22:41:23.142635000 +0000&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updated_at&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;2021-05-28 22:41:23.142635000 +0000&amp;quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;As you can see, the encrypted value was automatically translated to a readable attribute on our model instance - pretty slick.&lt;/p&gt;&lt;h2&gt;Searching&lt;/h2&gt;&lt;p&gt;What if we wanted to find Bruno by his &lt;code&gt;toy_location&lt;/code&gt; instead of his name? We can do that just like we would if the field were not encrypted:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; dog &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Dog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;find_by&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;toy_location&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;top secret&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token constant&quot;&gt;Dog&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Load&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.1&lt;/span&gt;ms&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token constant&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;dogs&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;dogs&amp;quot;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;dogs&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;toy_location&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;toy_location&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;{\&amp;quot;p\&amp;quot;:\&amp;quot;oVgEJvRaX6DJvA==\&amp;quot;,\&amp;quot;h\&amp;quot;:{\&amp;quot;iv\&amp;quot;:\&amp;quot;WYypcKysgBY05Tum\&amp;quot;,\&amp;quot;at\&amp;quot;:\&amp;quot;OaBswq+wyriuRQO8yCVD3w==\&amp;quot;}}&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;LIMIT&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#&amp;lt;Dog id: 1, name: &amp;quot;Bruno&amp;quot;, toy_location: &amp;quot;top secret&amp;quot;, created_at: &amp;quot;2021-05-28 22:41:23.142635000 +0000&amp;quot;, updated_at: &amp;quot;2021-05-28 22:41:23.142635000 +0000&amp;quot;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Notice that our query string was automatically converted into the encrypted JSON string we saw when we looked in the database.&lt;/p&gt;&lt;h3&gt;Initialization Vector/Determinism&lt;/h3&gt;&lt;p&gt;When using deterministic encryption, all records with the same plaintext value will use the same initialization vector to encrypt. This is so ActiveRecord will generate the same ciphertext for the same input, which is a prerequisite for being able to search the encrypted data. Under the hood, Rails uses the plaintext to generate the initialization vector for deterministically encrypted data - otherwise the IV is randomly generated.&lt;/p&gt;&lt;p&gt;If two rows with the same plaintext were to use different initialization vectors to perform the encryption, the serialized JSON that ends up in the database would be completely different.&lt;/p&gt;&lt;p&gt;In order to be able to perform searches on the encrypted data, the stored values need to be exactly the same.&lt;/p&gt;&lt;p&gt;This means that all of the stored values in the serialized hash need to be identical for two rows that have the same text value, AND that Rails can re-compute the exact same hash on the fly to find rows that are matches for the search string.&lt;/p&gt;&lt;p&gt;Determinism at its finest.&lt;/p&gt;&lt;h3&gt;Searching Plaintext&lt;/h3&gt;&lt;p&gt;What if we did not have the luxury of starting with pristine data? For example, if our &lt;code&gt;Dog&lt;/code&gt; table already existed and had a pre-existing &lt;code&gt;toy_location&lt;/code&gt; column on it that was not encrypted?&lt;/p&gt;&lt;p&gt;Well, as we can see by the query generated above, if we had a &lt;code&gt;Dog&lt;/code&gt; record with &lt;code&gt;top secret&lt;/code&gt; (unencrypted) as its &lt;code&gt;toy_location&lt;/code&gt;, that query aint gonna find it. Also, it seems pretty likely that if we try to load a &lt;code&gt;Dog&lt;/code&gt; record with stored plaintext into memory, Rails is going to have problems when it attempts to decrypt the plaintext.&lt;/p&gt;&lt;p&gt;One option we have would be to convert our plaintext data to encrypted data, which seems ideal to me. We may have reasons to want to avoid doing a data migration like that, however.&lt;/p&gt;&lt;p&gt;In that case, &lt;strong&gt;encrypts&lt;/strong&gt; will allow us to keep storing the plaintext values as plaintext, and will encrypt any new or updated data. To opt-in to supporting a mix of encrypted/unencrypted data, enable the &lt;code&gt;config.active_record.encryption.support_unencrypted_data&lt;/code&gt; configuration option.&lt;/p&gt;&lt;p&gt;Enabling this behavior will prevent the errors we would get when it tries to decrypt the plaintext and will also allow us to perform searches when a column contains a mismatch of plaintext and encrypted data.&lt;/p&gt;&lt;p&gt;If we enable the setting and re-run our search query above, we&amp;#x27;ll see:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;Dog&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Load&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.3&lt;/span&gt;ms&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token constant&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;dogs&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;dogs&amp;quot;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;dogs&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;toy_location&amp;quot;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;IN&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;toy_location&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;{\&amp;quot;p\&amp;quot;:\&amp;quot;Bd+/TzEysF2CCQ==\&amp;quot;,\&amp;quot;h\&amp;quot;:{\&amp;quot;iv\&amp;quot;:\&amp;quot;R2IUJJ+EmnDnZvQP\&amp;quot;,\&amp;quot;at\&amp;quot;:\&amp;quot;zqG5WAJql1zgctRCPpoBkQ==\&amp;quot;}}&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;toy_location&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;top secret&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;LIMIT&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now, it is looking for records that have the encrypted content or have the plaintext version of that content. Perfect!&lt;/p&gt;&lt;h3&gt;Case Insensitive Searches&lt;/h3&gt;&lt;p&gt;By default, searching is case sensitive. If we need to ignore case when searching for some reason, we have a few options:&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Option 1:&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;We can query for all of the case variations we need to match - eg. &lt;code&gt;Dog.where(toy_location: [&amp;#x27;Top secret&amp;#x27;, &amp;#x27;top secret&amp;#x27;])&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Option 2:&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;We can specify &lt;code&gt;downcase: true&lt;/code&gt; on our &lt;strong&gt;encrypts&lt;/strong&gt; declaration. This will cause the text to be downcased before it is stored. ActiveRecord will automatically downcase our search text when performing queries. The downside here is that all case information is lost when it is downcased. Sorry to be a downer.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Option 3:&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;We can specify &lt;code&gt;ignore_case: true&lt;/code&gt; on the &lt;strong&gt;encrypts&lt;/strong&gt; declaration and add an &lt;code&gt;original_column_name&lt;/code&gt; column to our database (eg. &lt;code&gt;original_toy_location&lt;/code&gt;). With this in place, if we created a dog with an uppercase letter in the encrypted field:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;Dog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;Max&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; toy_location&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;Top secret&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;the &lt;code&gt;toy_location&lt;/code&gt; column would be populated with the encrypted form of &lt;code&gt;&amp;#x27;top secret&amp;#x27;&lt;/code&gt; (the value downcased), and the &lt;code&gt;original_toy_location&lt;/code&gt; column will have the encrypted form of &lt;code&gt;&amp;#x27;Top secret&amp;#x27;&lt;/code&gt; (the value we set).&lt;/p&gt;&lt;p&gt;Any searches would be done against the &lt;code&gt;toy_location&lt;/code&gt; column, and the model&amp;#x27;s &lt;code&gt;toy_location&lt;/code&gt; attribute would be populated from the &lt;code&gt;original_toy_location&lt;/code&gt; column when it is loaded into memory.&lt;/p&gt;&lt;p&gt;One thing to note here - while the &lt;code&gt;toy_location&lt;/code&gt; column is encrypted deterministically in this situation (so it can be searched), the &lt;code&gt;original_toy_location&lt;/code&gt; column appears to be encrypted non-deterministically. This makes sense, since that column does not need to support searching. This can be confirmed by comparing the &lt;code&gt;toy_location&lt;/code&gt; and &lt;code&gt;original_toy_location&lt;/code&gt; values for two records with the same plaintext value. As you can see below, they have the same stored values (initialization vector, payload, etc) for the &lt;code&gt;toy_location&lt;/code&gt; column (searchable and downcased), and different stored values for the &lt;code&gt;original_toy_location&lt;/code&gt; column (not searchable, case preserved):&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;toy_location&amp;quot;&lt;/span&gt;          &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;{\&amp;quot;p\&amp;quot;:\&amp;quot;Bd+/TzEysF2CCQ==\&amp;quot;,\&amp;quot;h\&amp;quot;:{\&amp;quot;iv\&amp;quot;:\&amp;quot;R2IUJJ+EmnDnZvQP\&amp;quot;,\&amp;quot;at\&amp;quot;:\&amp;quot;zqG5WAJql1zgctRCPpoBkQ==\&amp;quot;}}&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&amp;quot;original_toy_location&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;{\&amp;quot;p\&amp;quot;:\&amp;quot;5syLqDK6GCbBDw==\&amp;quot;,\&amp;quot;h\&amp;quot;:{\&amp;quot;iv\&amp;quot;:\&amp;quot;KBGp4FrI7oL4/a3p\&amp;quot;,\&amp;quot;at\&amp;quot;:\&amp;quot;JnH6hxLX35cAwroImk2XqQ==\&amp;quot;}}&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&amp;quot;toy_location&amp;quot;&lt;/span&gt;          &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;{\&amp;quot;p\&amp;quot;:\&amp;quot;Bd+/TzEysF2CCQ==\&amp;quot;,\&amp;quot;h\&amp;quot;:{\&amp;quot;iv\&amp;quot;:\&amp;quot;R2IUJJ+EmnDnZvQP\&amp;quot;,\&amp;quot;at\&amp;quot;:\&amp;quot;zqG5WAJql1zgctRCPpoBkQ==\&amp;quot;}}&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&amp;quot;original_toy_location&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;{\&amp;quot;p\&amp;quot;:\&amp;quot;0246w4+SSqqlJw==\&amp;quot;,\&amp;quot;h\&amp;quot;:{\&amp;quot;iv\&amp;quot;:\&amp;quot;1uEnjlCNot9sYNgR\&amp;quot;,\&amp;quot;at\&amp;quot;:\&amp;quot;UhkhK6YlOTxJg75juqIMGA==\&amp;quot;}}&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Other Cool things&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;encrypts&lt;/strong&gt; does even more than we have looked at so far. In the interest of not writing a book, I&amp;#x27;m not going to go into much detail here, but would like to mention some of its other capabilities.&lt;/p&gt;&lt;p&gt;We have only looked at encrypting simple strings, but &lt;strong&gt;encrypts&lt;/strong&gt; can encrypt rich text attributes too.&lt;/p&gt;&lt;p&gt;It also provides support for &lt;a href=&quot;https://guides.rubyonrails.org/v7.0.0/active_record_encryption.html#support-for-previous-encryption-schemes&quot;&gt;previous encryption schemes&lt;/a&gt;. This means that we can start out using non-deterministic encryption on a column and change to using deterministic encryption later on. I would definitly recommend reading the fine print before using this feature.&lt;/p&gt;&lt;p&gt;We can &lt;a href=&quot;https://guides.rubyonrails.org/v7.0.0/active_record_encryption.html#rotating-keys&quot;&gt;rotate our (non-deterministic) keys&lt;/a&gt;. This is pretty cool, just note that it is not currently supported for deterministic encryption.&lt;/p&gt;&lt;p&gt;Related to the rotating keys, we can configure &lt;strong&gt;encrypts&lt;/strong&gt; to &lt;a href=&quot;https://guides.rubyonrails.org/v7.0.0/active_record_encryption.html#storing-key-references&quot;&gt;store a reference&lt;/a&gt; to the key used to encrypt in the encrypted data itself.&lt;/p&gt;&lt;p&gt;If using deterministic encryption, &lt;strong&gt;encrypts&lt;/strong&gt; supports using &lt;a href=&quot;https://guides.rubyonrails.org/v7.0.0/active_record_encryption.html#unique-constraints&quot;&gt;&lt;code&gt;unique&lt;/code&gt; constraints&lt;/a&gt;. If we need to ensure uniqueness in any of our encrypted columns, there are some things to be aware of. Be sure to read up on it first.&lt;/p&gt;&lt;p&gt;Encrypted columns are automatically filtered from Rails logs by default. &lt;strong&gt;encrypts&lt;/strong&gt; provides a way to disable this functionality.&lt;/p&gt;&lt;p&gt;This might be a good place to mention that the implementation is modular, and allows quite a bit of customization. Many of &lt;strong&gt;encrypts&lt;/strong&gt; options can be set on a per-attribute basis, or at more global levels.&lt;/p&gt;&lt;h2&gt;Limitations&lt;/h2&gt;&lt;p&gt;Even with all of its glory, &lt;strong&gt;encrypts&lt;/strong&gt; does have limitations. We&amp;#x27;ll take a look at a few that stood out to me. Given the variety of applicable use cases and the breadth of the functionality, I am sure other folks will have their own list.&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Fuzzy searching&lt;/strong&gt; - The search functionality &lt;strong&gt;encrypts&lt;/strong&gt; provides requires an exact match on search text. This means doing a &lt;code&gt;LIKE&lt;/code&gt; query, for example, won&amp;#x27;t work. It also means that any queries done on encrypted columns will need to go through Rails and ActiveRecord vs being manually crafted in SQL.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Rich text search&lt;/strong&gt; - While it is rad that &lt;strong&gt;encrypts&lt;/strong&gt; can encrypt rich text, it can only do so non-deterministically right now. This means that we won&amp;#x27;t be able to search rich text.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Deterministic searching does not support multiple keys&lt;/strong&gt; - Something good to be aware of going in - if using deterministic encryption/searching, we won&amp;#x27;t have the ability to use more than one key at a time. If we need to change keys, we&amp;#x27;ll likely need to do something fancy.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Rails console exposes data&lt;/strong&gt; - This may seem obvious, but if a malicious person gets access to our Rails console, they can load encrypted data into objects and view the plaintext all day long. In &lt;a href=&quot;https://world.hey.com/jorge/a-story-of-rails-encryption-ce104b67&quot;&gt;Jorge&amp;#x27;s post&lt;/a&gt;, he mentioned that HEY is using a console extension that sits on top of the encryption feature that protects and audits console access. Unfortunately, that is a private gem (named console1984) and not available in Rails (at this time).&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Deterministic encryption reduces security&lt;/strong&gt; - I don&amp;#x27;t think this is a fault of the implementation per se, but if we use deterministic encryption, then any two rows that have the same value for an encrypted attribute will have the same value stored in the database. While we can&amp;#x27;t necessarily reverse engineer how it was encrypted, if we know what one of the row&amp;#x27;s plaintext value is, then we know what the other row&amp;#x27;s plaintext value is as well. Non-deterministic encryption doesn&amp;#x27;t have this same weakness.&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;Summary&lt;/h2&gt;&lt;p&gt;TLDR: I am pretty excited and intrigued by this feature. I think it will be cool to see how people use it and how it evolves over time. My hunch is that some of the current limitations will go away (like not supporting multiple keys for deterministically encrypted attributes) as more people begin using it and digging through the code.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[ImageMagick policy.xml constraints]]></title><description><![CDATA[A little while ago I found myself updating a client's version of Ruby. They were currently on version 2.2 and I was bringing them up to 2.…]]></description><link>https://hint.io/blog/imagemagick-policy-xml</link><guid isPermaLink="false">https://hint.io/blog/imagemagick-policy-xml</guid><dc:creator><![CDATA[joelHayhurst]]></dc:creator><pubDate>Tue, 29 Jun 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;A little while ago I found myself updating a client&amp;#x27;s version of Ruby. They were currently on version 2.2 and I was bringing them up to 2.4. However, we discovered an unexpected problem in CI. One of the RSpec tests that was processing PDF files was stalling out, and the CI job would never complete.&lt;/p&gt;&lt;p&gt;I suspected this might have something to do with resource issues, but didn&amp;#x27;t know what would be causing them. I compared the versions of Debian provided by the Ruby 2.2 Docker image I was using with the 2.4 version, and found that the 2.2 version was running Debian 8 while the 2.4 version was running Debian 10. This made me suspect that the problem might be related to the change in Debian version.&lt;/p&gt;&lt;p&gt;I did some googling around and came to the conclusion it was caused by a change to the ImageMagick configuration. Specifically, a change to the policy.xml file which was released with ImageMagick on Debian 9. Some other people online were reporting similar issues.&lt;/p&gt;&lt;p&gt;The Debian team &lt;a href=&quot;https://wiki.debian.org/imagemagick/security&quot;&gt;had decided&lt;/a&gt; that some new defaults had to be added to this file for security reasons. ImageMagick by itself does not define these constraints. Because Debian made this change, it went downstream to Ubuntu, and is also present in 18.04.&lt;/p&gt;&lt;p&gt;The security concern is that people may upload malicious image files that are designed to overwhelm the resources of the server in processing. These new constraints are designed to prevent unusual levels of memory usage in image processing, amongst other things.&lt;/p&gt;&lt;p&gt;However, the constraints were too strict for our intended usage. Therefore, I had to alter the constraints.&lt;/p&gt;&lt;p&gt;At first, I tried removing the constraints entirely, on recommendation of someone I found online. This did in fact solve the issue in CI. However, I decided this solution is not ideal, as the constraints do serve a legitimate security purpose.&lt;/p&gt;&lt;p&gt;Instead, I changed the values of the constraints to be significantly higher, and this also solved our CI problem.&lt;/p&gt;&lt;p&gt;The code I used in our Dockerfile to edit the default policy.xml is the following:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;# Increase memory and map constraints in ImageMagick
RUN sed -i &amp;#x27;s/name=&amp;quot;memory&amp;quot; value=&amp;quot;256MiB&amp;quot;/name=&amp;quot;memory&amp;quot; value=&amp;quot;1GiB&amp;quot;/&amp;#x27; /etc/ImageMagick-6/policy.xml
RUN sed -i &amp;#x27;s/name=&amp;quot;map&amp;quot; value=&amp;quot;512MiB&amp;quot;/name=&amp;quot;map&amp;quot; value=&amp;quot;1GiB&amp;quot;/&amp;#x27; /etc/ImageMagick-6/policy.xml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In another related issue, I had to re-enable GhostScript formats, which were vital to this application. They had been disabled by a new change to policy.xml. The code I used for re-enabling them simply deletes the relevant lines from policy.xml.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;# Re-enable GhostScript formats in ImageMagick
RUN sed -i &amp;#x27;/disable ghostscript format types/,+6d&amp;#x27; /etc/ImageMagick-6/policy.xml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I thought this experience might be worth relaying for the benefit of anyone else dealing with similar problems. Thank you for reading.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[The Future of Hint]]></title><description><![CDATA[This is an article about Hint, and it's the first of its kind. We commonly write about the technical work we're doing, but never about the…]]></description><link>https://hint.io/blog/the-future-of-hint</link><guid isPermaLink="false">https://hint.io/blog/the-future-of-hint</guid><dc:creator><![CDATA[benWood]]></dc:creator><pubDate>Wed, 16 Jun 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;This is an article about Hint, and it&amp;#x27;s the first of its kind. We commonly write about the technical work we&amp;#x27;re doing, but never about the work we&amp;#x27;re doing on the business itself. That changes now, and we are committed to sharing about the journey we&amp;#x27;re on. Spoiler alert - it&amp;#x27;s going to be awesome!&lt;/p&gt;&lt;p&gt;Before I go any further, I&amp;#x27;d be remiss if I did not shout out to Heather Corallo of the &lt;a href=&quot;https://www.thecanoeproject.com/&quot;&gt;Canoe Project&lt;/a&gt;. She was instrumental in our transformation and continues to guide us as we work towards our goals. Thank you, Heather; we couldn&amp;#x27;t have done it without you.&lt;/p&gt;&lt;p&gt;In the past six months, we&amp;#x27;ve spent countless hours discussing what brought us to where we are today, and how we&amp;#x27;d like to evolve over the next ten years. We realized that what got us this far won&amp;#x27;t take us to the next level, especially if our goals are ambitious (and they are!). Our core values and purpose haven&amp;#x27;t materially changed, but we&amp;#x27;ve evolved them in a way that offers more clarity than we&amp;#x27;ve ever had before. We have a clear vision of where we&amp;#x27;re headed as a company, and I couldn&amp;#x27;t be more excited to share it with you.&lt;/p&gt;&lt;h2&gt;Our evolved values&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;Kindness:&lt;/strong&gt; We treat people with compassion and respect.&lt;/p&gt;&lt;p&gt;People come first. Software is only the venue.&lt;/p&gt;&lt;p&gt;We believe that all people are equally valuable, no matter who they are, where they come from, or what we have to gain from them. With this in mind, we pay equal respect to all and approach each relationship with compassion, considering the &lt;em&gt;whole&lt;/em&gt; person. It&amp;#x27;s people, not code, that will be our legacy.&lt;/p&gt;&lt;p&gt;Kindness sometimes requires respectful communication of difficult things to our clients or co-workers (kindness != niceness).&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Integrity:&lt;/strong&gt; We do what we know is right, and when we don&amp;#x27;t know, we&amp;#x27;ll tell you.&lt;/p&gt;&lt;p&gt;We do what we say. We do the right thing. Sometimes the right thing is to say &amp;quot;I don&amp;#x27;t know&amp;quot; and then commit to figuring it out. Integrity requires us to be honest with our assessments and our abilities.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Teamwork:&lt;/strong&gt; We do our best work when we work together.&lt;/p&gt;&lt;p&gt;Together we accomplish things that would be impossible alone. We invest in each other through pairing &amp;amp; mentorship. Our accomplishments are recognized by each other. When we make mistakes, we learn together.&lt;/p&gt;&lt;p&gt;Most importantly, we&amp;#x27;re building meaningful relationships rooted in trust and safety.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Improvement:&lt;/strong&gt; Continuous improvement applies to everything that we do and everything that we are.&lt;/p&gt;&lt;p&gt;We continuously improve the software systems we touch, but it doesn&amp;#x27;t stop there. We seek continuous improvement in every aspect of our work and even our personal lives.&lt;/p&gt;&lt;p&gt;Giving consideration to the whole person, we believe in supporting our team&amp;#x27;s personal and professional goals, which are unique to each individual.&lt;/p&gt;&lt;h2&gt;Our evolved purpose&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;At Hint, we are on a mission to help all software teams reach their full potential.&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;We want to amplify the impact of the work we do. The best way to do that is to focus our efforts on helping others be the best they can be. &amp;quot;Full potential&amp;quot; looks a little different for every team, and we are sensitive to that. Our goal is not to make carbon copies of ourselves but rather to help teams understand what they are capable of and then help them achieve great things.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Everything is DevOps.&lt;/strong&gt; Every day we&amp;#x27;re building towards a development process where everyone wins regardless of where they sit in the software development lifecycle (SDLC). We are reshaping our services and doubling down on things like:&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Sustainable SDLC Practices and Methodology&lt;/li&gt;&lt;li&gt;Developer Tooling Strategy &amp;amp; Engineering&lt;/li&gt;&lt;li&gt;Continuous Integration / Pipeline Optimization&lt;/li&gt;&lt;li&gt;Continuous Delivery / Infrastructure as Code&lt;/li&gt;&lt;li&gt;Seamless Application Dependency Upgrades&lt;/li&gt;&lt;li&gt;Application Architecture Review &amp;amp; Refactoring&lt;/li&gt;&lt;li&gt;Training, Mentoring, and Pair Programming&lt;/li&gt;&lt;/ol&gt;&lt;h2&gt;#Goals&lt;/h2&gt;&lt;p&gt;Within ten years...&lt;/p&gt;&lt;p&gt;&lt;strong&gt;We are considered a genuinely innovative consulting company. We live at the forefront of SDLC evolution.&lt;/strong&gt;  &lt;em&gt;We constantly challenge ourselves to think about how things could be different, better, and less complex. As a result, we&amp;#x27;re doing groundbreaking work, the kind of work that may affect the industry as a whole, not only our current clients.&lt;/em&gt;&lt;/p&gt;&lt;p&gt;No doubt, this is an audacious goal. It won&amp;#x27;t come easy, but we&amp;#x27;re prepared to fight for it. We&amp;#x27;ve developed six short(er)-term goals to help position ourselves for this.&lt;/p&gt;&lt;p&gt;&lt;strong&gt;Within 12 months...&lt;/strong&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;We will have a minimum of 2 Hint employees working on every project.&lt;/li&gt;&lt;li&gt;We will codify our own dynamic coding standards, process, and practices, and all Hint employees will adopt them.&lt;/li&gt;&lt;li&gt;We will define our software tooling philosophy and begin to provide advanced infrastructure and DevOps strategy to our customers as a service.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;strong&gt;Within three years...&lt;/strong&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;We will evolve the Hint Brand.&lt;/li&gt;&lt;li&gt;We will be considered an employer of choice in the software developer community.&lt;/li&gt;&lt;li&gt;Each vertical (e.g., operations, sales, development) inside Hint will consist of at least 50% under-represented groups.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;We&amp;#x27;ve already made some practical day-to-day changes to set our trajectory for success, but I&amp;#x27;ll cover those in a future article.&lt;/p&gt;&lt;p&gt;We have much work to do, and I, for one, am eager to invest myself in this exciting journey. If what you&amp;#x27;ve read resonates with you, ping me on Twitter (&lt;a href=&quot;https://twitter.com/benjaminwood&quot;&gt;@benjaminwood&lt;/a&gt;) to let me know. I&amp;#x27;d love to hear from you. Better yet, if you&amp;#x27;re interested in joining our team, please send us an email at &lt;a href=&quot;mailto:join@hint.io&quot;&gt;join@hint.io&lt;/a&gt; or see our &lt;a href=&quot;/careers&quot;&gt;careers page&lt;/a&gt; for more information (we&amp;#x27;re hiring!).&lt;/p&gt;</content:encoded></item><item><title><![CDATA[WSL for Rails Developers]]></title><description><![CDATA[It is now possible, thankfully, to develop in Rails on Windows. For many years, it seemed one needed a Mac for this purpose; and I have…]]></description><link>https://hint.io/blog/wsl-for-rails-devs</link><guid isPermaLink="false">https://hint.io/blog/wsl-for-rails-devs</guid><dc:creator><![CDATA[joelHayhurst]]></dc:creator><pubDate>Tue, 18 May 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;It is now possible, thankfully, to develop in Rails on Windows. For many years, it seemed one needed a Mac for this purpose; and I have nothing against Macs, and enjoy the MacBook Pro, which I have used throughout my career. But I also have a Windows machine. I like to play games sometimes, and now that I work from home, along with an increasing number of people, I have access to it. I like the idea that developers should be able to enjoy their preference in environment, where reasonable. Some prefer to boot directly into Linux, which is also a perfectly fine choice. On a whim, I decided to try Rails development on Windows, and it has worked out nicely.&lt;/p&gt;&lt;p&gt;With WSL, the Windows Subsystem for Linux, we can now run a Linux distribution &lt;em&gt;within&lt;/em&gt; Windows 10. You can use it similarly to how you might use Homebrew on a Mac, and the whole thing is surprisingly seamless, especially after some recent improvements. All of the Linux development and server tools you&amp;#x27;re used to are present, and work the same as you are familiar with.&lt;/p&gt;&lt;h3&gt;Installation&lt;/h3&gt;&lt;p&gt;It&amp;#x27;s relatively easy to install; first you have to enable WSL as a &amp;quot;Windows feature&amp;quot;, and then you go to the Microsoft Store and install your preferred distro. I know they have Debian and Ubuntu available, as well as some others. I chose Debian.&lt;/p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:404px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:62.576687116564415%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACJklEQVQoz3WS627bIBiGff+XsguYummatrbLwXGaLqmPYMAG20DiA47jU5xkIv3TH92jl0/AJwR6eQ3fcwmJ4jgmmCCIpNwPw9i2Xdf1H3U8NqdTW9dHzkXfD3lexJQZeb5XValUWauqyPP21Fwv03QetabzNJ3Po2YYhnEcu65TSull3wkhjJDmXpi9BfwNcIDlzkt3fuKCFBIBiXBASqis66pSqlKaStVto74sooe5bURxSpMsgAQiGjOOoySANKYZIky3GE9SfjgcsizjnOsihBQcMeEBbJjzxWa9WVsvy9nMWpqvm41prl4sa7Vcrpfm9vXVXJor05o9Pf/+9bheWZa5enp89lztlEEpI6GbpXFEYoQwo4xSihHCGBNCIICMsTRN0yRJWMI519P7DoChcWqnMvmZJ6br4TAMCcKu7SCEeJalWZYk2eVyuX3ger3ebre6rj3PN+pmkPihyqwAxBjjOCK+50m5196e2nEcbp9xHkcIQ0PVfQa/VnwdBBEhhEYxBAAEQEopOC+K4tPDTdN4vm807VTS70Wy8IMIBj6EIfADGMDbf3h/thDi73Zn1MdTwe1qj7jItRtpqq8Usuu6tm27tu37rr9HpOs1wzBcLpeyLH0/MKqqLEv99Uqp+s57GIo7h7x4tJMfy7dvs+0fhzmI2rvtfDb3fB8AaEi5F4ILwTnX4161dBaE5EK+BGzlINMON4BBwkIIHdvBGDuO+w8aTsIOt6sgiAAAAABJRU5ErkJggg==&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Enabling the WSL Windows feature&quot; title=&quot;Enabling the WSL Windows feature&quot; src=&quot;/static/01a94ce590d03e7fd06a7d472a7a841f/494f9/wsl-features.png&quot; srcSet=&quot;/static/01a94ce590d03e7fd06a7d472a7a841f/222b7/wsl-features.png 163w,/static/01a94ce590d03e7fd06a7d472a7a841f/ff46a/wsl-features.png 325w,/static/01a94ce590d03e7fd06a7d472a7a841f/494f9/wsl-features.png 404w&quot; sizes=&quot;(max-width: 404px) 100vw, 404px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:45.39877300613497%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABfUlEQVQoz4XQz0sbQRQH8BG8ePIPiGIJZn/M7sybmc1kNzszu+NuRBG7obS1QqkKCmLrodBDq7EFD977x5RQz/oPeBE8xIMH8c8oCQYMFPLhe3iH93iPh6SU7XZCGfd87Pt+MILxc+15HsbYdV3HcdwxZ8R1XeT7HmGRANISwBgXgidJAgCcc6UU51xKiTH2/gcRQoCSV9U3f+V9bpTKrDZZnttmMxLTIEIpkKD+rheWW2umVVpT5Gq1U0gpo2kQpYQQgpPC0a8b6WYj3azrrhepSDAhBDyj40xAlJCAwtxRH/UGqHc3c3KLeoNa9+TT9tudvf2tD9vAWEiAAhtm0nA4JDD3uY9OB/bg7/KXa/TzoVb9aMaG2Qr0OrQ0JEWYrgXxSgh82D6GRlfD7PHl/Nebp/ru7/YFOn9crL6XWpadUjajJI7LokjiFmdMvHgi53y8+aiPzu7bH/8sHV6hXw8L3dM3Gx1blFobk2XGZFqbPLfWWmOMtVZprdL0H3Oie7K12eFJAAAAAElFTkSuQmCC&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Debian on the Microsoft Store&quot; title=&quot;Debian on the Microsoft Store&quot; src=&quot;/static/2721cc4426397ceddd210396f62a9514/a6d36/wsl-microsoft-store.png&quot; srcSet=&quot;/static/2721cc4426397ceddd210396f62a9514/222b7/wsl-microsoft-store.png 163w,/static/2721cc4426397ceddd210396f62a9514/ff46a/wsl-microsoft-store.png 325w,/static/2721cc4426397ceddd210396f62a9514/a6d36/wsl-microsoft-store.png 650w,/static/2721cc4426397ceddd210396f62a9514/1fbe8/wsl-microsoft-store.png 757w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;h3&gt;Terminals&lt;/h3&gt;&lt;p&gt;As for terminals, there&amp;#x27;s a few options. The default terminal that comes with WSL is named after the distribution you installed, so for me it is simply called &amp;quot;Debian&amp;quot;. It has the Debian swirl logo, which I like, and the default color scheme and font it comes with I find pleasant. On the downside, I&amp;#x27;ve found it will always scroll down if new content comes up (say you are tailing a test log), so I got in the habit of waiting for the tests to finish before examining logs. It also doesn&amp;#x27;t have tabbing, but I found I don&amp;#x27;t need tabbing as much as I thought; I&amp;#x27;m not on a laptop screen, so I have enough space to keep separate terminals open. It is possible to use PowerShell to access WSL, by running the &lt;code&gt;wsl&lt;/code&gt; command, but I find the color scheme is a bit off. And there&amp;#x27;s other options, like the new Windows Terminal, which does have tabbing and lots of customization options, but requires editing a text file to change settings (you can do it, you&amp;#x27;re a developer!), and still feels kind of in beta. In general though, I&amp;#x27;m fine with the default WSL terminal.&lt;/p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:494px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:33.74233128834356%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAeklEQVQY06XOwQrCMBAE0Bw2uNvZphskNSBI0qY/4DH//2GiPSulPua2DLPumddl2+qjKEBE/gsiYmbvfYwRgKqmlNx1mWy1+Z5vc2a+/MCfs4gws4iUUtwwAWHQUc0shDAe1nt3Ct2zP3MQgPeyngKg1nq+/Ndya+0FfokVUMAmsJUAAAAASUVORK5CYII=&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Default Debian WSL terminal&quot; title=&quot;Default Debian WSL terminal&quot; src=&quot;/static/a2569589606893caa4307c1e9b736f0f/d72d4/wsl-terminal3.png&quot; srcSet=&quot;/static/a2569589606893caa4307c1e9b736f0f/222b7/wsl-terminal3.png 163w,/static/a2569589606893caa4307c1e9b736f0f/ff46a/wsl-terminal3.png 325w,/static/a2569589606893caa4307c1e9b736f0f/d72d4/wsl-terminal3.png 494w&quot; sizes=&quot;(max-width: 494px) 100vw, 494px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;h3&gt;VSCode&lt;/h3&gt;&lt;p&gt;WSL also integrates perfectly with VSCode, which I use for most of my code editing. You can edit files directly within WSL and have them immediately affect the app. I mention this because there used to be an issue with this in WSL 1, but it has been resolved since WSL 2.&lt;/p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:545px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:27.607361963190186%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABR0lEQVQY0z2NXUvCUACG9zvS3EZnm+XOxz7OnLpcbLXNnbOtqBspgrrwwgsriQKFROhCiAghkSiwnxpa9PLw3D28gqppGCNuOzlLszzvJJ0sy5IkbrgNhBDejBCi67ooirIsS7KsqIqiKpqmCZRSCHVG63maMsYyznnKoijyfZ9S+t//xaJYqaoVm+DanlOtClCHGCFmO0XGGedFURyGoeu6nudZpoURJpgQTCCEkiStnyVJAQAAZQcAwTCJ23DPTk8Y61Bq113Hti1MECaIGNgwiWES0zIggqXtUrlc2gJymdR2qwpRgeC3Ap4c93uDy/ProH0U+FF4ECchS0IWB2kcpmsHLGxHJqQ2cgxct5z9ptXyzKYwf/h8H33N75dvw4/FaLUcfy/Gq6f+y+PV86g3mw5ex73Z8GI6vJjedie/3G180538AKqIXEeHG23CAAAAAElFTkSuQmCC&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Debian WSL in VSCode&quot; title=&quot;Debian WSL in VSCode&quot; src=&quot;/static/b7ec1ff558e9e80d189d5ac23b2587ef/3ddad/wsl-vscode.png&quot; srcSet=&quot;/static/b7ec1ff558e9e80d189d5ac23b2587ef/222b7/wsl-vscode.png 163w,/static/b7ec1ff558e9e80d189d5ac23b2587ef/ff46a/wsl-vscode.png 325w,/static/b7ec1ff558e9e80d189d5ac23b2587ef/3ddad/wsl-vscode.png 545w&quot; sizes=&quot;(max-width: 545px) 100vw, 545px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;h3&gt;Docker&lt;/h3&gt;&lt;p&gt;Docker Desktop also integrates very nicely with WSL since version 2. Before WSL 2, Docker had to use Hyper-V to emulate Linux, but now we don&amp;#x27;t even need Hyper-V enabled. Docker now uses the WSL 2 backend, and it seems quite a bit faster to start as well, in my experience.&lt;/p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:357px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:35.58282208588957%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABYklEQVQY0z3LSU7jQACFYe9ZIbV6iZTEcmpwTa4qV6UGG48k6gAhqFuIEOhecAEugMQx2HAdLsBlWKGoJZ6+5fuT+aLB1ZKRnIvDtNKMMjAHEEAEEIQYAvQNAURRLnPquFwQnqDto9g/tVa2XVfHaugGv/DpNAUZyNIsS+cwgznE/xGIOc41YbUy7hDPJmCWTpEC0wnFtI51UzXRxejC0PRn3ei0JQBzTBjMGcAC5hpTmzNPRUIwO354+/H8cVLtHSO7m7v9zW57vvm9uf57e/9vd/9nc22FckXppQmyjLKMQgVaBFoklLujp/fZ6+fPyxeP5mMzDlXbx2asu7FuW1etmmF12ve+vhhWF/1y3YyjqwJTkcnEEg5P7ybbZyl8EPry7NfVcr3ul0EaX5RBGie049pz7ZhyVHomPVOB68DLxHLjCfMQOSodLw+/QkdlorLfgrShsLEwUZgoyijKcGC+AKVFXgxk+UG9AAAAAElFTkSuQmCC&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Booting Docker Desktop on WSL 2&quot; title=&quot;Booting Docker Desktop on WSL 2&quot; src=&quot;/static/c22bef4097273d285ea7dc197d847246/22d0a/wsl-docker.png&quot; srcSet=&quot;/static/c22bef4097273d285ea7dc197d847246/222b7/wsl-docker.png 163w,/static/c22bef4097273d285ea7dc197d847246/ff46a/wsl-docker.png 325w,/static/c22bef4097273d285ea7dc197d847246/22d0a/wsl-docker.png 357w&quot; sizes=&quot;(max-width: 357px) 100vw, 357px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;h3&gt;Filesystem&lt;/h3&gt;&lt;p&gt;When you use WSL, you will want to store all of your relevant code within the WSL filesystem, not on the Windows filesystem. In WSL 1 there was more crossover, but not in WSL 2; everything goes on the Linux virtual drive. It is still possible to browse these files using Windows Explorer, if you are so inclined, but in general probably best to stick with Linux tools when using this drive. Still I do open one of my WSL directories in Explorer regularly for the purpose of easily opening screenshots produced by Capybara.&lt;/p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:549px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:36.19631901840491%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABIklEQVQY012NSW7CMABFcwZGCcdTcDzGJokdJ3HJAjotuuoNUDel979AVVAR4i3+6j+97PMjPqXBe8/LsqoqpVSMkTFW1zXnXEppjBFS6gv5BQA2AAAIYeYbtd0WhFDGOCYYY1wUBaWU/IMxLstSCCGlRAjmeX49AAAyguliuZSCvRwGKdX1fVtCCELIuV13QRsNITTGtG3LGMvW69V8vopefp+etbJ3SXKTrbX90IfgY4wQ5krplNLO2Yzzcr5Yh1acT29NEyilt+Zd2fVD34Uu+PAna73fTzvnMkrIbLYMjTifXjlXUgrG2GPZuXEcuq7z3iMIldLjmKytsoLSDYCptz9f7ylNIXit1H0cIVQ3zTRN034axxHmwFTV8XBsm/oXv4hC3gV0Wq4AAAAASUVORK5CYII=&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Viewing WSL files in Explorer&quot; title=&quot;Viewing WSL files in Explorer&quot; src=&quot;/static/1348a707d563e5d1ee4c5991973d8286/928ea/wsl-explorer.png&quot; srcSet=&quot;/static/1348a707d563e5d1ee4c5991973d8286/222b7/wsl-explorer.png 163w,/static/1348a707d563e5d1ee4c5991973d8286/ff46a/wsl-explorer.png 325w,/static/1348a707d563e5d1ee4c5991973d8286/928ea/wsl-explorer.png 549w&quot; sizes=&quot;(max-width: 549px) 100vw, 549px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;h3&gt;Copy-and-paste&lt;/h3&gt;&lt;p&gt;One other note about transitioning from Mac, you&amp;#x27;ll probably want to enable the Ctrl-Shift-C and Ctrl-Shift-V copy-paste functionality in the terminal. On Mac, we have that handy Command key, but on Windows we are stuck with just Ctrl, which is used plenty by Linux itself; so Ctrl-Shift is a necessary compromise. It&amp;#x27;s not that hard to get accustomed to, and besides that, we can also use right-click to copy and paste text.&lt;/p&gt;&lt;h3&gt;Caveats&lt;/h3&gt;&lt;p&gt;I&amp;#x27;ve been developing with this system for over a year now and haven&amp;#x27;t run into any serious problems. Probably the biggest issue I had is that WSL, combined with the code repositories of some large apps I&amp;#x27;m working on, used up a lot of disk space, and my C: drive only has 256 GB. I did however find a way to move WSL to a separate drive, a nice 1 TB SSD, and that solved my space issues. This can be accomplished using the &lt;code&gt;wsl --export&lt;/code&gt; and &lt;code&gt;wsl --import&lt;/code&gt; commands without much fuss.&lt;/p&gt;&lt;p&gt;Another issue I&amp;#x27;ve faced is that when working on a larger application, a lot of memory is used up by WSL. Running two operating systems simultaneously uses more resources. Even after quitting the applications, and quitting Docker, this memory would still be reserved by WSL. The solution is that when I&amp;#x27;m done with using WSL for the day, I run &lt;code&gt;wsl --shutdown&lt;/code&gt; in PowerShell and that frees up all the memory again. I went ahead and upgraded to 32 GB of RAM to avoid these paging annoyances. However, this upgrade is only necessary because of the size of this application. Every other application I&amp;#x27;ve worked in was comfortable with 16 GB.&lt;/p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:28.22085889570552%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA9UlEQVQY023LX2uCUBjH8ed4zPmPpLQihdTlmTUjWqjDWDe7XBvRZnFsIxPU9/8SxllttDH48L15nh/0TbPX61qmpSgKAEKIYzgMrCeY4xsY8z8kSRaEK/bvLgo7OQ6SXAtSZfTK6m9EstaCVPY36u2bRNYweEL26sx55pwVOC8GWUJzVsiTgzrN9ag2oqoTs+phaYSVHlZGXHfiSpwcwKOIZN8okI8WeYRuVFpJ3b8vW/OdHOy16bs4znifnjR8KowovqHI213Ygpcp9gK0Wd6eF+27ozRmB0xYYbi99Ht5HqvOA4CbwnXKOvya/f37Fxs33eUnifU2F0WIHEIAAAAASUVORK5CYII=&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;Shutting down WSL with PowerShell&quot; title=&quot;Shutting down WSL with PowerShell&quot; src=&quot;/static/49110ef872ccda4fd8a33ee8052f9b3d/a6d36/wsl-powershell.png&quot; srcSet=&quot;/static/49110ef872ccda4fd8a33ee8052f9b3d/222b7/wsl-powershell.png 163w,/static/49110ef872ccda4fd8a33ee8052f9b3d/ff46a/wsl-powershell.png 325w,/static/49110ef872ccda4fd8a33ee8052f9b3d/a6d36/wsl-powershell.png 650w,/static/49110ef872ccda4fd8a33ee8052f9b3d/889a4/wsl-powershell.png 658w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;h3&gt;Conclusion&lt;/h3&gt;&lt;p&gt;These are all of the thoughts I have on WSL at this time. I hope you find it useful to be able to program in Rails on Windows, if that is your desire. If you give it a shot, you might find it&amp;#x27;s more comfortable than you expected. Thanks for reading.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[What's Cooking in Rails 7?]]></title><description><![CDATA[A new version of Rails always brings new and exciting features. This writeup takes a look at some of the things Rails 7 has in store for us…]]></description><link>https://hint.io/blog/Whats-Cooking-in-Rails-7</link><guid isPermaLink="false">https://hint.io/blog/Whats-Cooking-in-Rails-7</guid><dc:creator><![CDATA[jasonDinsmore]]></dc:creator><pubDate>Tue, 20 Apr 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;A new version of Rails always brings new and exciting features. This writeup takes a look at some of the things Rails 7 has in store for us.&lt;/p&gt;&lt;p&gt;To find these examples, I dug through the &lt;a href=&quot;https://edgeguides.rubyonrails.org/7_0_release_notes.html&quot;&gt;Changelogs&lt;/a&gt; and selected some of the features that have me most excited so far, primarily based on how I currently use Rails.&lt;/p&gt;&lt;p&gt;I encourage you to do the same - you may find something awesome that impacts a feature you use regulary or provides functionality you&amp;#x27;ve been lying awake at night fantasizing about.&lt;/p&gt;&lt;p&gt;For each feature, I have included the PR that introduced it and the GitHub user who submitted the PR.&lt;/p&gt;&lt;p&gt;Note that several of these features have followup PRs from people making essential contributions by updating documentation, adding changelog entries, tweaking implementations, etc. If you are one of those folks, please know that while you&amp;#x27;re not given explicit credit here, we are very grateful for all you do! 🙏&lt;/p&gt;&lt;h1&gt;Railties&lt;/h1&gt;&lt;h2&gt;The &lt;em&gt;main&lt;/em&gt; Branch&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/40254&quot;&gt;PR 40254&lt;/a&gt; by &lt;a href=&quot;https://github.com/prateekkish&quot;&gt;@prateekkish&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;When generating a new Rails project or plugin without the &lt;code&gt;--skip-git&lt;/code&gt; flag, the default branch of the created repository will now be &lt;code&gt;main&lt;/code&gt; instead of &lt;code&gt;master&lt;/code&gt;. If you&amp;#x27;ve got a different branch set in your git config&amp;#x27;s &lt;code&gt;init.defaultBranch&lt;/code&gt;, that default will be used instead.&lt;/p&gt;&lt;p&gt;Rails began initializing the Git repository &lt;a href=&quot;https://guides.rubyonrails.org/v5.1.0/5_1_release_notes.html#railties-notable-changes&quot;&gt;in 5.1&lt;/a&gt; via &lt;a href=&quot;https://github.com/rails/rails/pull/27632&quot;&gt;PR 27632&lt;/a&gt; by &lt;a href=&quot;https://github.com/dixpac&quot;&gt;@dixpac&lt;/a&gt;.&lt;/p&gt;&lt;h2&gt;&lt;em&gt;benchmark&lt;/em&gt; Anywhere&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/40734&quot;&gt;PR 40734&lt;/a&gt; by &lt;a href=&quot;https://github.com/semaperepelitsa&quot;&gt;@semaperepelitsa&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;This PR adds the &lt;code&gt;ActiveSupport::Benchmarkable.benchmark&lt;/code&gt; method to the &lt;code&gt;Rails&lt;/code&gt; namespace, which allows you to easily benchmark a block of code anywhere without having to declare a &lt;code&gt;logger&lt;/code&gt; or &lt;code&gt;extend&lt;/code&gt;/&lt;code&gt;include&lt;/code&gt; the &lt;code&gt;ActiveSupport::Benchmarkable&lt;/code&gt; module.&lt;/p&gt;&lt;p&gt;To use the new functionality, you&amp;#x27;d do something like this:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;  &lt;span class=&quot;token constant&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;benchmark&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;Print bar&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# code to benchmark&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;100.&lt;/span&gt;times &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; puts &lt;span class=&quot;token string&quot;&gt;&amp;#x27;bar&amp;#x27;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After your code executes, the message you provided and the time it took the code to execute in milliseconds will be passed along to the Rails logger, ie: &lt;code&gt;Print bar (0.6ms)&lt;/code&gt;. The &lt;code&gt;benchmark&lt;/code&gt; call will return the return value of the block, &lt;code&gt;100&lt;/code&gt; in this case.&lt;/p&gt;&lt;h2&gt;Support Stats For Stylesheets and ERB Views&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/40597&quot;&gt;PR 40597&lt;/a&gt; by &lt;a href=&quot;https://github.com/joelhawksley&quot;&gt;@joelhawksley&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;If you&amp;#x27;ve run &lt;code&gt;rails stats&lt;/code&gt;, you know that it provides various statistics about your app&amp;#x27;s codebase. This new functionality adds &lt;code&gt;Views&lt;/code&gt; and &lt;code&gt;Stylesheets&lt;/code&gt; to the output, providing stats for files in &lt;code&gt;app/views&lt;/code&gt; and &lt;code&gt;app/assets/stylesheets&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Note that stylesheets need to have a &lt;code&gt;.css&lt;/code&gt; or &lt;code&gt;.scss&lt;/code&gt; extension, and view files need to have the &lt;code&gt;.erb&lt;/code&gt; extension in order to be processed.&lt;/p&gt;&lt;h1&gt;ActionPack&lt;/h1&gt;&lt;h2&gt;Redirect Back or To&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/40671&quot;&gt;PR 40671&lt;/a&gt; by &lt;a href=&quot;https://github.com/dhh&quot;&gt;@dhh&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Adds &lt;code&gt;redirect_back_or_to(fallback, **)&lt;/code&gt; as a nice shorthand for &lt;code&gt;redirect_back(fallback_location:, **)&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;This avoids having to specify the &lt;code&gt;fallback_location&lt;/code&gt; kwarg (keyword argument) to &lt;code&gt;redirect_back&lt;/code&gt;. &lt;code&gt;redirect_back_or_to&lt;/code&gt; will redirect the user back to whence they came if it can, and will redirect to the fallback location if it can&amp;#x27;t.&lt;/p&gt;&lt;p&gt;The old syntax still works and hasn&amp;#x27;t been explicitly deprecated, but now &lt;code&gt;redirect_back&lt;/code&gt; calls &lt;code&gt;redirect_back_or_to&lt;/code&gt; &lt;a href=&quot;https://github.com/rails/rails/blob/07233426e693ea0b8292050fb926de4d52fbfeeb/actionpack/lib/action_controller/metal/redirecting.rb#L69-L71&quot;&gt;under the hood&lt;/a&gt;.&lt;/p&gt;&lt;h2&gt;Unpermitted Parameter Context&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/41809&quot;&gt;PR 41809&lt;/a&gt; by &lt;a href=&quot;https://github.com/bbuchalter&quot;&gt;@bbuchalter&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;This PR provides controller and request context when the parameters object is initialized so that when unpermitted attributes are logged, the controller, action, request, and filtered parameters will be logged as well.&lt;/p&gt;&lt;h1&gt;ActionView&lt;/h1&gt;&lt;h2&gt;Lazy Load Images&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/38452&quot;&gt;PR 38452&lt;/a&gt; by &lt;a href=&quot;https://github.com/jonathanhefner&quot;&gt;@jonathanhefner&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Currently, apps can take advantage of the HTML standard&amp;#x27;s lazy loading of images by manually specifying the &lt;code&gt;loading&lt;/code&gt; attribute as &lt;code&gt;lazy&lt;/code&gt; in calls to &lt;code&gt;image_tag&lt;/code&gt;. This new configuration allows you to set the default to &lt;code&gt;&amp;quot;lazy&amp;quot;&lt;/code&gt; app-wide, so that the attribute will only need to be specified for places you want an image to be eager loaded.&lt;/p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:600px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:60.122699386503065%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAADfklEQVQoz3WSbVDTBRzHf/9N3YwHw7GxJ6LxuE3W/tvYAzTGtkbhFeSShAGNY/tvboOxAUcGiwOUbXmaAmnxwjtBxoB5KnbZi9qlnXZxV0d6Zr0ou7q6sxfVeb5Ib8P/r9Nelp9Xn1efN98vwBNordoOxQBQxgDwW/PhXtpCIEbh6kKhYyNVfuPqHBevr0l/+yypa/xlvRW+WqtlXDxF/n/MrSkAIQCwAeDIa5VMzJqZy8MAXx6D9p8ubMXfr+ThzVVO9tvlPPwhrb2Jd1XQbuPDzGEJ8Z+YU5kPZM6/jt9PElOvlD5SJqINzsaemvnkvR14+QT7wTeLLPp6gkXf+liyeWVFHbbagKVUwJNBXIcb77wMQw2CjrkuxdfzPcofoz0Nd8OttTjdKafDbSQdpSo2L0XVmJiUzu05GwEAAiBk5DGGGvjERqwRVnwqqOcCLHlrGO93VMMBqzi87NPih4N1eD6kx1SvBiPtdfSow4ijdhU90qLILLpIjJrLqfzZYjd58FkrjLwggrcsIphqljBfFDOgr45HNIoIMHGh5LSL/Pt82IALXjJzZr/qYdKvoU+5FDjuacblPh294n8Oj7dVYxMlXJVNlz2QRMUeGDTx9YPGIkm8RQKpN2uJYYuIFW8ph7GXSkIrAS0m/JpMMqDFpYCWnnfJ6QtxN/1pOk3HR4I4uU955+TA3mtv+JSHHPtl5wbaySYYtvLvj+1+5t4Bi8BztEsO9XyAW+82w/Q+6UIyUIMJrzK74JLRS341naB20ReP9NHzi0m630dlg3bDbMShCVHd1cFVnYk/66jPBf/znD/6G7gYNgtw0CxY8xo4+kerTrdJv0j1qvF00Ly5OkXRi0ETznvIh2fc1ZkPqFoca6nCYYs47KGU3aqp0p93Hi3S2yZlAE7NzmhvPQ8DxkL0GXnoMnCxq4ZzO/a6PHOiowLPnRzHaxvfbUYCndnxPVUYbZVhzF6GozaBfbS7AmAC2OpY2Yb8cGnq8T00TNjSqSoYoQyFlz0Gzq89Os79bi3nzwm79M6EvTI7sFtKB1/VYcAswiGb+HbIIr7kVBekTUXAL3n8LwDoJ/IEbxflFrtzCajLB3DquPDX5xSYROwcuzSXbykEdseuHJ5T9bSsSQgaSrk15tXtWLdXbLN9FN8LbsW27T49d0sQZ6AyIgQYYoH4oBBKenLgH68sULPFCj4cAAAAAElFTkSuQmCC&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;An eager beaver&quot; title=&quot;An eager beaver&quot; src=&quot;/static/96cf9fd94187fd4f47029d68a8ef5a78/0a47e/beaver.png&quot; srcSet=&quot;/static/96cf9fd94187fd4f47029d68a8ef5a78/222b7/beaver.png 163w,/static/96cf9fd94187fd4f47029d68a8ef5a78/ff46a/beaver.png 325w,/static/96cf9fd94187fd4f47029d68a8ef5a78/0a47e/beaver.png 600w&quot; sizes=&quot;(max-width: 600px) 100vw, 600px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;h2&gt;Tag Attributes From Hash&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/40657&quot;&gt;PR 40657&lt;/a&gt; by &lt;a href=&quot;https://github.com/seanpdoyle&quot;&gt;@seanpdoyle&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;This cool addition provides a slick way to tranform a hash of attributes into attributes on an ERB tag.&lt;/p&gt;&lt;p&gt;For example:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; tag&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;attributes&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;percent-loaded&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; role&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;progressbar&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; aria&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; valuenow&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;75&amp;#x27;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;%&amp;gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Would render:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;html&quot;&gt;&lt;pre class=&quot;language-html&quot;&gt;&lt;code class=&quot;language-html&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;quot;&lt;/span&gt;percent-loaded&lt;span class=&quot;token punctuation&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;role&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;quot;&lt;/span&gt;progressbar&lt;span class=&quot;token punctuation&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;aria-valuenow&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation attr-equals&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;quot;&lt;/span&gt;75&lt;span class=&quot;token punctuation&quot;&gt;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Perhaps not the greatest example, but if the hash were generated programmatically and required logic, this could be pretty useful.&lt;/p&gt;&lt;h1&gt;ActiveModel&lt;/h1&gt;&lt;h2&gt;Add Numericality In Range Validation&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/41022&quot;&gt;PR 41022&lt;/a&gt; by &lt;a href=&quot;https://github.com/mpapis&quot;&gt;@mpapis&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;When validating &lt;code&gt;numericality&lt;/code&gt; of a model attribute, this new syntax lets you specify a range for the numericality validator versus having to sandwich between the &lt;code&gt;greater_than_or_equal_to&lt;/code&gt; and &lt;code&gt;less_than_or_equal_to&lt;/code&gt; options.&lt;/p&gt;&lt;p&gt;Example usage:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;validates &lt;span class=&quot;token symbol&quot;&gt;:latitude&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; numericality&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;90.&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;.90&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1&gt;ActiveRecord&lt;/h1&gt;&lt;h2&gt;Invert a &lt;em&gt;where&lt;/em&gt; Clause&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/40249&quot;&gt;PR 40249&lt;/a&gt; by &lt;a href=&quot;https://github.com/kddeisz&quot;&gt;@kddeisz&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;This addition provides a handy way to get at the inverse of a where clause by via &lt;code&gt;invert_where&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;For example:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;good_students &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Student&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;where&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;grade&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80.&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;.100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# SELECT \&amp;quot;students\&amp;quot;.* FROM \&amp;quot;students\&amp;quot; WHERE \&amp;quot;students\&amp;quot;.\&amp;quot;grade\&amp;quot; BETWEEN 80 AND 100&lt;/span&gt;

bad_students &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; good_students&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;invert_where
&lt;span class=&quot;token comment&quot;&gt;# SELECT \&amp;quot;students\&amp;quot;.* FROM \&amp;quot;students\&amp;quot; WHERE NOT (\&amp;quot;students\&amp;quot;.\&amp;quot;grade\&amp;quot; BETWEEN 80 AND 100)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Exclude a Record From Results&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/41439&quot;&gt;PR 41439&lt;/a&gt; by &lt;a href=&quot;https://github.com/GlenCrawford&quot;&gt;@GlenCrawford&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Ever need a way to get all records matching some condition except a record you already have? &lt;code&gt;excluding&lt;/code&gt; may be your jam.&lt;/p&gt;&lt;p&gt;Instead of:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;other_users &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;where&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rating&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;where&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;not&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; primary_user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You can:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;other_users &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;where&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;rating&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;excluding&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;primary_user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Build or Create Association on Has One Through&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/40007&quot;&gt;PR 40007&lt;/a&gt; by &lt;a href=&quot;https://github.com/perezperret&quot;&gt;@perezperret&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Enables the &lt;code&gt;build_association&lt;/code&gt; and &lt;code&gt;create_association&lt;/code&gt; functionality for &lt;code&gt;has_one through:&lt;/code&gt; relations. Previously these were not available on &lt;code&gt;through&lt;/code&gt; associations.&lt;/p&gt;&lt;p&gt;For example, if you had:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Dog&lt;/span&gt;
  has_many &lt;span class=&quot;token symbol&quot;&gt;:toys&lt;/span&gt;
  has_one &lt;span class=&quot;token symbol&quot;&gt;:toy_box&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Toy&lt;/span&gt;
  belongs_to &lt;span class=&quot;token symbol&quot;&gt;:dog&lt;/span&gt;
  has_one &lt;span class=&quot;token symbol&quot;&gt;:toy_box&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; through&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:dog&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ToyBox&lt;/span&gt;
  belongs_to &lt;span class=&quot;token symbol&quot;&gt;:dog&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You&amp;#x27;ll now be able to:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;toy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;build_toy_box
&lt;span class=&quot;token comment&quot;&gt;# &amp;lt;ToyBox:0x00007f572007e170 id: nil, dog_id: 3&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Or:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;toy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create_toy_box
&lt;span class=&quot;token comment&quot;&gt;# &amp;lt;ToyBox:0x00005601f2ac09a0 id: 5, dog_id: 3&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Respect Column Type When Calculating Average&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/40351&quot;&gt;PR 40351&lt;/a&gt; by &lt;a href=&quot;https://github.com/schmijos&quot;&gt;@schmijos&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;In prior versions of Rails, calling &lt;code&gt;ActiveRecord::Caculations#calculate&lt;/code&gt; with &lt;code&gt;:average&lt;/code&gt; would result in a &lt;code&gt;BigDecimal&lt;/code&gt;, even if a column was of a &lt;code&gt;Float&lt;/code&gt; or &lt;code&gt;Integer&lt;/code&gt; type.&lt;/p&gt;&lt;p&gt;For example:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;Coordinate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;longitude&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# Float&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Coordinate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;calculate&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:average&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:longitude&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# BigDecimal&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Coordinate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;calculate&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:average&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:longitude&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 0.13002356e3&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;With the new behavior, it honors the type of the database column:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;Coordinate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;calculate&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:average&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:longitude&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# Float&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;Coordinate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;calculate&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:average&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:longitude&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 130.02356&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;One of the motivators for this change was that JSON conversions of &lt;code&gt;BigDecimal&lt;/code&gt; result in a string value, whereas &lt;code&gt;Float&lt;/code&gt; results in a numeric value.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;JSON&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parse&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; avg_longitude&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;130.02356&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to_d &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to_json&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# { &amp;quot;avg_longitude&amp;quot; =&amp;gt; &amp;quot;130.02356&amp;quot; }&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;JSON&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parse&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; avg_longitude&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;130.02356&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to_json&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# { &amp;quot;avg_longitude&amp;quot; =&amp;gt; 130.02356 }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Automatically Encrypt/Decrypt a Model Attribute&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/41659&quot;&gt;PR 41659&lt;/a&gt; by &lt;a href=&quot;https://github.com/jorgemanrubia&quot;&gt;@jorgemanrubia&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Finally, we get to &lt;code&gt;encrypts&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;This is deserving of a post all its own. The TLDR; version is that this feature adds a mechanism to auto-encrypt/decrypt an &lt;code&gt;ActiveRecord&lt;/code&gt; attribute by declaring &lt;code&gt;encrypts attr_name&lt;/code&gt; in the model. When a record is written to the database, it will automatically be encrypted, and when it is loaded from the database, the attribute will automatically be decrypted.&lt;/p&gt;&lt;p&gt;&lt;code&gt;encrypts&lt;/code&gt; also provides a workflow for changing the encryption scheme being used, without needing to re-encrypt all previously encrypted records under the new scheme.&lt;/p&gt;&lt;p&gt;Data can be encrypted in a non-deterministic manner (encrypting the same text twice will result in different ciphertexts), or can be encrypted deterministically - which allows querying the encrypted attribute.&lt;/p&gt;&lt;p&gt;Other niceties are the capability to encrypt &lt;code&gt;Action Text&lt;/code&gt; and to filter encrypted attributes from the application log files.&lt;/p&gt;&lt;p&gt;It really does quite a lot and provides several ways to customize behavior, depending on your needs.&lt;/p&gt;&lt;h1&gt;What Else?&lt;/h1&gt;&lt;p&gt;I touched on the things I am most excited about so far, but there is other great work underway. &lt;a href=&quot;https://github.com/rails/rails/blob/main/actionpack/CHANGELOG.md&quot;&gt;ActionPack&lt;/a&gt;, &lt;a href=&quot;https://github.com/rails/rails/blob/main/actionview/CHANGELOG.md&quot;&gt;ActionView&lt;/a&gt;, &lt;a href=&quot;https://github.com/rails/rails/blob/main/activerecord/CHANGELOG.md&quot;&gt;ActiveRecord&lt;/a&gt;, and &lt;a href=&quot;https://github.com/rails/rails/blob/main/activesupport/CHANGELOG.md&quot;&gt;ActiveSupport&lt;/a&gt; in particular, all have rapidly growing lists of changes.&lt;/p&gt;&lt;p&gt;Thanks again to all the contributors who are making this next release possible. It&amp;#x27;s shaping up nicely!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Ruby on Lambda: Integrating with ActiveStorage]]></title><description><![CDATA[This article is part of our Ruby on AWS Lambda blog series. A recent project had us migrating an existing PDF document processing system…]]></description><link>https://hint.io/blog/lambda-and-active-storage</link><guid isPermaLink="false">https://hint.io/blog/lambda-and-active-storage</guid><dc:creator><![CDATA[nateShoemaker]]></dc:creator><pubDate>Thu, 06 Aug 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;This article is part of our Ruby on AWS Lambda blog series. A recent project had us migrating an existing PDF document processing system from Rails Sidekiq to AWS Lambda. The processing includes OCR, creating preview images, splicing the PDF, and more. Moving to Lambda reduced processing time by 300 times in some cases.&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;This series of articles will serve less as a step-by-step process to get OCR serverless infrastructure up and running and more of a highlight reel of our &amp;quot;Aha!&amp;quot; moments. In part one, we talk about creating a AWS Lambda Layer with Docker. In part two, we chatted about architecting a serverless app. In part three, we went through some strategies surrounding deployment. Here in part four, we&amp;#x27;ll investigate what&amp;#x27;s needed to integrate a Rails app that uses Active Storage with AWS Lambda. Check out the other posts in the series:&lt;/em&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;em&gt;&lt;a href=&quot;/blog/lambda-layer-dependencies&quot;&gt;Layer Dependencies&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;&lt;li&gt;&lt;em&gt;&lt;a href=&quot;/blog/lambda-planning-and-architecture&quot;&gt;Planning &amp;amp; Architecting&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;&lt;li&gt;&lt;em&gt;&lt;a href=&quot;/blog/aws-lambda-ship-it&quot;&gt;Package &amp;amp; Ship It!&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;em&gt;Note: there are some assumptions made in this article regarding architecture and reading &lt;a href=&quot;/blog/lambda-planning-and-architecture&quot;&gt;Planning &amp;amp; Architecting&lt;/a&gt; may be useful before diving in here.&lt;/em&gt;&lt;/p&gt;&lt;p&gt;Performance was our main reason for moving from Sidekiq to AWS Lambda. We used Active Storage on a few models and wanted to continue using it after the migration. Specifically, we wanted to take advantage of Active Storage &lt;a href=&quot;https://api.rubyonrails.org/classes/ActiveStorage/Variant.html&quot;&gt;variants&lt;/a&gt; via a GraphQL API and React frontend. The app had multiple views that requested all of the variants at once, and because the variants are created at the time of the request, the user experience under Sidekiq was very poor. What if we could create all of those variants on Lambda as we processed the document? It sounded plausible to us, so we spiked on it.&lt;/p&gt;&lt;p&gt;Note that we&amp;#x27;ll be touching on specific pieces of code that directly relate to the integration; this won&amp;#x27;t be a tutorial on how to use Active Storage or setup AWS Lambda. We are using S3 as our storage service, and will be referencing it as a standalone entity. Let&amp;#x27;s dive in!&lt;/p&gt;&lt;h2&gt;Uploading&lt;/h2&gt;&lt;p&gt;Instead of passing form params to a model, we’ll take more of a manual approach. In the controller:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;@document&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;upload&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We have a &lt;code&gt;Document&lt;/code&gt; model with &lt;code&gt;has_one_attached :file&lt;/code&gt;. This allows the file to be uploaded to S3 without creating the backing Active Storage record. Delaying that allows us to process the document on Lambda, create the needed variants, and respond back with data that will be used to create those records.&lt;/p&gt;&lt;p&gt;Lambda has no knowledge of the Rails app or Active Storage, but if we can point it to the file we just uploaded, it can reference and process it. After a &lt;code&gt;Document&lt;/code&gt; has been created, we send &lt;code&gt;document.file.key&lt;/code&gt; to the vent function (LINK TO PLANNING AND ARCHITECTURE POST) that starts the processing work. The document’s key is the name of the file on S3. On Lambda, the real fun begins.&lt;/p&gt;&lt;h2&gt;Variant Creation&lt;/h2&gt;&lt;p&gt;Essentially, we needed to trick Active Storage. When requesting a variant, Active Storage will look for &lt;code&gt;variant.jpg&lt;/code&gt; in a specific location on S3:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;variants/&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;key&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;/&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;variant_key&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;key&lt;/code&gt; is the original file&amp;#x27;s key (&lt;code&gt;document.file.key&lt;/code&gt;), and &lt;code&gt;variant_key&lt;/code&gt; is a hash derived from the variant&amp;#x27;s transformation options (e.g. &lt;code&gt;{auto_orient: true, resize: &amp;#x27;1000x1000&amp;#x27;}&lt;/code&gt;) and the Rails app&amp;#x27;s &lt;code&gt;ENV[&amp;#x27;SECRET_KEY_BASE&amp;#x27;]&lt;/code&gt;. Let&amp;#x27;s look at the Lambda  code:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;create_variant&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;image&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; transformation&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token comment&quot;&gt;# create message verifier and variant key&lt;/span&gt;
 verifier_key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; verifier&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;generate&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;transformation&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; purpose&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:variation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 variant_key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Digest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;SHA256&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;hexdigest&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;verifier_key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 
 tmp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Tempfile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;variant.jpg&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 
 &lt;span class=&quot;token constant&quot;&gt;MiniMagick&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Tool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Convert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;convert&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
   convert &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; image&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;path
   &lt;span class=&quot;token comment&quot;&gt;# apply transformations here, like:&lt;/span&gt;
   &lt;span class=&quot;token comment&quot;&gt;# convert.auto_orient&lt;/span&gt;
   &lt;span class=&quot;token comment&quot;&gt;# convert.resize transformation[:resize]&lt;/span&gt;
   convert &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; tmp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;path
 &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
 
 s3 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Aws&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;S3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Client&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;
 s3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;put_object&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
   bucket&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;       &lt;span class=&quot;token string&quot;&gt;&amp;quot;some-cool-bucket&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;          &lt;span class=&quot;token string&quot;&gt;&amp;quot;variants/&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;key&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;/&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;variant_key&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   body&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;         tmp&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   content_type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;image/jpeg&amp;#x27;&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;#create_variant&lt;/code&gt; takes a &lt;code&gt;File&lt;/code&gt;, &lt;code&gt;document.file.key&lt;/code&gt;, and the transformation options as arguments. The &lt;code&gt;variant_key&lt;/code&gt; is created (we&amp;#x27;ll look at what &lt;code&gt;verifier&lt;/code&gt; is soon), and the actual image conversion is handled with ImageMagick. Note the actual ImageMagick conversions depend on the transformation options being passed in. For an example I used the options that were previously mentioned, &lt;code&gt;{auto_orient: true, resize: &amp;#x27;1000x1000&amp;#x27;}&lt;/code&gt;. After the image is processed, we then place it on S3, using the specific path Active Storage expects.&lt;/p&gt;&lt;p&gt;Figuring out how to create the &lt;code&gt;verifier_key&lt;/code&gt; was quite difficult. It took a late night fueled by coffee and spelunking into the bowels of Active Storage, but it proved fruitful. Let&amp;#x27;s take a look at &lt;code&gt;#verifier&lt;/code&gt;:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;verifier&lt;/span&gt;&lt;/span&gt;
 key_generator &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ActiveSupport&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;CachingKeyGenerator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
   &lt;span class=&quot;token constant&quot;&gt;ActiveSupport&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;KeyGenerator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;SECRET_KEY_BASE&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; iterations&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; key_generator&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;generate_key&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;ActiveStorage&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token constant&quot;&gt;ActiveSupport&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;MessageVerifier&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Active Storage was created by people much smarter than I, and I&amp;#x27;ll be the first to admit that I did not look at &lt;em&gt;all&lt;/em&gt; the implementation details surrounding &lt;code&gt;ActiveSupport::CachingKeyGenerator&lt;/code&gt;,  than I, and I&amp;#x27;ll be the first to admit that I did not look at &lt;em&gt;all&lt;/em&gt; the implementation details surrounding &lt;code&gt;ActiveSupport::KeyGenerator&lt;/code&gt;, &lt;code&gt;ActiveSupport::MessageVerifier&lt;/code&gt;. However, their names are descriptive and give us a good bird&amp;#x27;s-eye view. A key is generated from your Rails app&amp;#x27;s &lt;code&gt;SECRET_KEY_BASE&lt;/code&gt;, and that key is then turned into a digest that is used to create the path to the variant. A few notes:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;The &lt;code&gt;iterations&lt;/code&gt; option when instantiating &lt;code&gt;ActiveSupport::KeyGenerator&lt;/code&gt; does not have to be 1,000. I, of course, didn&amp;#x27;t test &lt;em&gt;every&lt;/em&gt; number, but the natural numbers I tested all had the same result. Active Storage uses 1,000, so I thought I would too.&lt;/li&gt;&lt;li&gt;The argument passed to &lt;code&gt;#generate_key&lt;/code&gt; is the salt, and for our intended purposes on Lambda it can be any string.&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;Data for the &lt;code&gt;active_storage_attachments&lt;/code&gt; record&lt;/h2&gt;&lt;p&gt;Early on in the spike, we hit a lot of &lt;code&gt;ActiveStorage::IntegrityError&lt;/code&gt;s. While you can find yourself raising this error on accident in many scenarios, the reason why is always the same: the hashed contents of the file don&amp;#x27;t match what&amp;#x27;s stored in the database. Since we uploaded the file straight to S3, we purposefully didn&amp;#x27;t create a record in &lt;code&gt;active_storage_attachments&lt;/code&gt;, and don&amp;#x27;t have the reference to the file anymore without downloading it (which would be a waste). We had to create the digest on Lambda while we still had a reference to the file.&lt;/p&gt;&lt;p&gt;Here&amp;#x27;s the data we collect for each page in a document (note that &lt;code&gt;file&lt;/code&gt; is a &lt;code&gt;File&lt;/code&gt; object):&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 content_md5&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;  &lt;span class=&quot;token constant&quot;&gt;Digest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;MD5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;base64digest&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
 byte_size&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;    &lt;span class=&quot;token builtin&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;size&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to_s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
 key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;          key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
 content_type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; content_type
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;After every page is processed, our sink function collects all the data and sends a JSON response back to the Rails app.&lt;/p&gt;&lt;h2&gt;All together now&lt;/h2&gt;&lt;p&gt;When the Rails app receives the JSON, Sidekiq workers are started that process the response. Part of the workers&amp;#x27; responsibility is to create a record in &lt;code&gt;active_storage_attachments&lt;/code&gt;:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;create_blob&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 params &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;          data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;key&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   filename&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;     data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;key&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   checksum&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;     data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;content_md5&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   byte_size&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;    data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;byte_size&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   content_type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;content_type&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
 
 &lt;span class=&quot;token constant&quot;&gt;ActiveStorage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Blob&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create_before_direct_upload&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;a href=&quot;https://api.rubyonrails.org/classes/ActiveStorage/Blob.html#method-c-create_before_direct_upload-21&quot;&gt;&lt;code&gt;#create_before_direct_upload!&lt;/code&gt;&lt;/a&gt; allows us to create the record and &lt;em&gt;not&lt;/em&gt; upload the file to S3 as it already exists there. Tricking Active Storage, and all.&lt;/p&gt;&lt;p&gt;And with that, Active Storage works just as it normally would. With our implementation, however, we process &lt;em&gt;all&lt;/em&gt; variants in parallel, improving load times and user experience for everyone!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Ruby on AWS Lambda: Package & Ship it]]></title><description><![CDATA[This article is part of our Ruby on AWS Lambda series. A recent project had us migrating an existing pdf document processing system from…]]></description><link>https://hint.io/blog/aws-lambda-ship-it</link><guid isPermaLink="false">https://hint.io/blog/aws-lambda-ship-it</guid><dc:creator><![CDATA[nateShoemaker]]></dc:creator><pubDate>Wed, 29 Jul 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;This article is part of our Ruby on AWS Lambda series. A recent project had us migrating an existing pdf document processing system from Rails/Sidekiq to AWS Lambda. The processing includes OCR, creating preview images, splicing the pdf, and more. Moving to Lambda reduced processing time by 300% in some cases; parallelization for the win!&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;This series will serve less as a step-by-step process to get OCR serverless infrastructure up and running and more of a highlight reel of our &amp;quot;Aha!&amp;quot; moments. In part one, we talked about creating an AWS Lambda Layer with Docker. In part two, we chatted about architecture. Here in part three, we&amp;#x27;ll go through some strategies surrounding deployment. Check out the other posts in the series:&lt;/em&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;em&gt;&lt;a href=&quot;/blog/lambda-layer-dependencies&quot;&gt;Layer Dependencies&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;&lt;li&gt;&lt;em&gt;&lt;a href=&quot;/blog/lambda-planning-and-architecture&quot;&gt;Planning &amp;amp; Architecting&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;&lt;li&gt;&lt;em&gt;&lt;a href=&quot;/blog/lambda-and-active-storage&quot;&gt;Integrating with Active Storage&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Deploying to Lambda gets more complicated as the application grows. There is a big difference between deploying a single &lt;code&gt;hello world&lt;/code&gt; function with zero dependencies, and deploying multiple functions in multiple languages along with dependencies in a Lambda Layer. We discovered some useful things along the way while making that transition. Let&amp;#x27;s dive in.&lt;/p&gt;&lt;h2&gt;Function naming conventions and environment variables&lt;/h2&gt;&lt;p&gt;We followed a straightforward convention for differentiating between function names and their environments:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{function_name}_{environment}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Given our three Rails environments (&lt;code&gt;development&lt;/code&gt;, &lt;code&gt;staging&lt;/code&gt;, and &lt;code&gt;production&lt;/code&gt;) and a function name of &lt;code&gt;pdf_processor&lt;/code&gt;, we&amp;#x27;d have three separate functions: &lt;code&gt;pdf_processor_development&lt;/code&gt;, &lt;code&gt;pdf_processor_staging&lt;/code&gt;, and &lt;code&gt;pdf_processor_production&lt;/code&gt;. Adding more functions may seem a bit overwhelming in terms of function count, but the clear distinctions between functions and their environments allow for isolated development, testing, and debugging.&lt;/p&gt;&lt;p&gt;Along with other normal environment variables that the functions use, we added a &lt;code&gt;RUBY_ENV&lt;/code&gt; environment variable that was either &lt;code&gt;development&lt;/code&gt;, &lt;code&gt;staging&lt;/code&gt;, or &lt;code&gt;production&lt;/code&gt;. This is primarily used for name-spacing S3 buckets, DynamoDB tables, and calling other lambda functions. This decision played out well because we now have isolation in how we use other systems and services. This also makes reading logs and tracking performance metrics a lot easier.&lt;/p&gt;&lt;h2&gt;Instrumentation&lt;/h2&gt;&lt;p&gt;Instrumentation refers to the measure of a product&amp;#x27;s performance, to diagnose errors, and to write trace information. Early on in development, we added instrumentation to gain insight into how the bulk of the processing work performs.&lt;/p&gt;&lt;p&gt;Here’s our implementation:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# instrument.rb&lt;/span&gt;
 
&lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Instrument&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;instrument&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tag&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clock_gettime&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;CLOCK_MONOTONIC&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; puts&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;--&amp;gt; &lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;tag&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt; took &lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clock_gettime&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;CLOCK_MONOTONIC&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; start&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;round&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;ms&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then it is used like:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;instrument&amp;#x27;&lt;/span&gt;
 
i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; instrument&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;doing some work&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
do_the_work&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
i&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;call&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The log would look like:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;--&amp;gt; doing some work took 300ms&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;start&lt;/code&gt; variable gets caught in a closure and is available for the Proc that is returned. The semi-cryptic looking &lt;code&gt;Process.clock_gettime&lt;/code&gt; is used to read from the OS clock, and is more accurate than Ruby&amp;#x27;s &lt;code&gt;Time&lt;/code&gt; class.&lt;/p&gt;&lt;h2&gt;Serverless&lt;/h2&gt;&lt;p&gt;When we first started building on Lambda, we &lt;a href=&quot;https://docs.aws.amazon.com/lambda/latest/dg/ruby-package.html&quot;&gt;deployed the AWS way&lt;/a&gt;: zip the code up and ship it via the AWS CLI. This was fine in the beginning, but it left a lot to be desired. It puts the responsibility on the developer to know about the deployment process, something that should be handled by configuration. That added responsibility also detracted from a deployment being deterministic. If you missed a small detail, a deployment, and thus the function itself, could be botched. We don&amp;#x27;t zip and deploy our Rails apps up manually, and we shouldn&amp;#x27;t have to do that with our serverless functions either!&lt;/p&gt;&lt;p&gt;In comes &lt;a href=&quot;https://www.serverless.com/&quot;&gt;Serverless Framework&lt;/a&gt;. Everything we love about configuration and deterministic deployments are handled by Serverless. All configuration is written in YAML and is concise, intuitive, and incredibly powerful.. Environment variables, runtime specification, memory configuration, AWS roles, and layer versioning can all be done in a single YAML file. These features became even more valuable when we rewrote our vent function in JavaScript. We  now have a separate serverless config for each lambda function that allows us to achieve true language isolation. If you&amp;#x27;d like to learn more about using Serverless, take a look at &lt;a href=&quot;https://www.serverless.com/framework/docs/providers/aws/guide/quick-start/&quot;&gt;their AWS quickstart guide&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Shipping a Lambda application doesn’t have to be difficult. I hope what we’ve learned has helped you!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Ruby on AWS Lambda: Planning & Architecting]]></title><description><![CDATA[This article is part of our Ruby on AWS Lambda blog series. A recent project had us migrating an existing pdf document processing system…]]></description><link>https://hint.io/blog/lambda-planning-and-architecture</link><guid isPermaLink="false">https://hint.io/blog/lambda-planning-and-architecture</guid><dc:creator><![CDATA[nateShoemaker]]></dc:creator><pubDate>Tue, 21 Jul 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;This article is part of our Ruby on AWS Lambda blog series. A recent project had us migrating an existing pdf document processing system from Rails Sidekiq to AWS Lambda. The processing includes OCR, creating preview images, splicing the pdf, and more. Moving to Lambda reduced processing time by 300% in some cases; parallelization for the win!&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;This series will serve less as a step-by-step process to get OCR serverless infrastructure up and running and more of a highlight reel of our &amp;quot;Aha!&amp;quot; moments. In part one, we talked about creating an AWS Lambda Layer with Docker. In part two, we&amp;#x27;ll chat about architecting a serverless app. Check out the other posts in the series:&lt;/em&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;em&gt;&lt;a href=&quot;/blog/lambda-layer-dependencies&quot;&gt;Layer Dependencies&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;&lt;li&gt;&lt;em&gt;&lt;a href=&quot;/blog/aws-lambda-ship-it&quot;&gt;Package &amp;amp; Ship It!&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;&lt;li&gt;&lt;em&gt;&lt;a href=&quot;/blog/lambda-and-active-storage&quot;&gt;Integrating with Active Storage&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;The Problem&lt;/h2&gt;&lt;p&gt;Rails devs, tell me if you&amp;#x27;ve been here before: you have small units of work that should be processed concurrently, so you reach for Sidekiq. Solved! Well, usually solved. Sidekiq is an amazing tool that we use at Hint, and it solves most concurrency problems.&lt;/p&gt;&lt;p&gt;However, a bottleneck is always a possibility. In our case, the document processor we engineered could process a PDF with one page, or 500. But since each page has to be processed and there is no page limit when uploading, it was common to process hundreds of pages. This work took much too time with Sidekiq, even with tens of workers. We wanted to see the same performance whether the PDF a user uploads has 50 pages, or 500.&lt;/p&gt;&lt;h2&gt;The Solution&lt;/h2&gt;&lt;p&gt;AWS Lambda was a good solution for our performance problem. It allows us to run our workers in parallel independent of the number of pages we are processing. However, Lambda doesn&amp;#x27;t give you any guidance on &lt;em&gt;how&lt;/em&gt; to design a serverless application. You are provided the basic building blocks: a function that calls other functions, and the ability to use any other AWS service. Quite open-ended! Luckily, there are some standard architecture practices that have emerged in the serverless community. We&amp;#x27;ll be focusing on the most popular strategy: fan-out, fan-in.&lt;/p&gt;&lt;h3&gt;&amp;quot;What do you mean, software architecture?&amp;quot;&lt;/h3&gt;&lt;p&gt;Glad you asked! Martin Fowler said it best:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;When people in the software industry talk about “architecture”, they refer to a hazily defined notion of the most important aspects of the internal design of a software system.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;When we talk about architecture in the context of Lambda, we&amp;#x27;ll be touching on function composition, utilizing other AWS services, and how the application communicates with the real world. If you haven&amp;#x27;t, check out &lt;a href=&quot;https://martinfowler.com/architecture/&quot;&gt;Martin Fowler&amp;#x27;s thoughts on software architecture&lt;/a&gt;.&lt;/p&gt;&lt;h2&gt;Fan-out, Fan-in&lt;/h2&gt;&lt;p&gt;The fan-out, fan-in architecture is simple: one function starts &lt;code&gt;n&lt;/code&gt; number of functions, and when those finish, another function does something with the results. The first function is referred to as the ventilator (or vent). The vent function calls worker functions. Once the worker functions finish, the sink function is called. So, vent -&amp;gt; workers -&amp;gt; sink.&lt;/p&gt;&lt;p&gt;For example, let&amp;#x27;s use a hypothetical 100-page pdf.. The vent function is triggered from an outside application and 100 worker functions are called. Each worker process a single page. The sink function is then invoked when all 100 are done, and we do things with the result. In theory, 1,000,000 pages should take as long as 100, since all the processing is happening in parallel. Let&amp;#x27;s go into a little bit more detail about the whole process:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;User uploads PDF from Rails app&lt;/li&gt;&lt;li&gt;PDF is uploaded to S3 via Active Storage&lt;/li&gt;&lt;li&gt;Vent function is triggered with the file key as an argument&lt;/li&gt;&lt;li&gt;Vent function calls &lt;code&gt;n&lt;/code&gt; number of worker functions, passing file key as an argument so workers can find the file on S3&lt;/li&gt;&lt;li&gt;Worker function processes page, stores preview image, collects information about page and stores that in DynamoDB, and a record in DynamoDB that holds the keeps track of the pages left is decreased by one&lt;/li&gt;&lt;li&gt;If the worker is the final worker in the queue, the sink function is called&lt;/li&gt;&lt;li&gt;Sink function collects all page information from DynamoDB and sends results as JSON back to the Rails app&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;a href=&quot;https://aws.amazon.com/dynamodb/&quot;&gt;DynamoDB&lt;/a&gt; is a NoSQL database offered by AWS. When using the fan-out, fan-in pattern you must keep track of progress so the sink function can be called when all workers are completed. The nature of serverless means that no state can be held, thus an external, stateful service must be used. In our case, we are using it as a glorified counter. When a worker function finishes, we decrease the records count column (&lt;code&gt;pages_left&lt;/code&gt;) by one:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;decrement_pages_left&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;job_id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    db &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Aws&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;DynamoDB&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Client&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;
    resp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;update_item&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      table_name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;                  &lt;span class=&quot;token string&quot;&gt;&amp;quot;documents-&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;RUBY_ENV&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;                         &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; job_id&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; job_id &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      update_expression&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;           &lt;span class=&quot;token string&quot;&gt;&amp;#x27;set pages_left = pages_left - :val&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      expression_attribute_values&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;:val&amp;#x27;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      return_values&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;               &lt;span class=&quot;token string&quot;&gt;&amp;#x27;UPDATED_NEW&amp;#x27;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    invoke_sink_function&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;job_id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; resp&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:attributes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;pages_left&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Note that the sink function is then called if there are no pages left to process. Easy!&lt;/p&gt;&lt;p&gt;For a more in-depth look into the fan-out, fan-in pattern take a look at &lt;a href=&quot;https://theburningmonk.com/2018/04/how-to-do-fan-out-and-fan-in-with-aws-lambda/&quot;&gt;this fantastic blog post by Yan Cui&lt;/a&gt;.&lt;/p&gt;&lt;h2&gt;Knowing what language is better suited for a certain task&lt;/h2&gt;&lt;p&gt;We initially used Ruby for our vent, worker, and sink functions. However, we hit a bottleneck in the vent function. Invoking hundreds of concurrent network requests (which are IO bound) is not one of Ruby&amp;#x27;s strong suits. Using any kind of library that takes advantage of CPU cores doesn&amp;#x27;t gain any advantage because of Lambda&amp;#x27;s CPU limitations (more on that in the next section). So, what language does Lambda support that has asynchronous IO bound operations out of the box? JavaScript!&lt;/p&gt;&lt;p&gt;Now, this isn&amp;#x27;t a bash on Ruby. All programming languages have their strengths and weaknesses, and a rewrite in a different language should be well researched and thought out beforehand. Luckily for us, we have lots of Ruby &lt;em&gt;and&lt;/em&gt; JS experience. Also, the vent function encapsulates very little business logic, so a rewrite would be a good fit if an initial spike proved fruitful. And it did! When processing a 186-page document, the vent function took 30 seconds in Ruby, and 2 seconds in JS. Nailed it!&lt;/p&gt;&lt;p&gt;If you experience performance issues on Lambda, make sure to research the problem thoroughly. The cool thing about Lambda is that you can use different languages throughout the application process. If part of the process would perform much better with a different language, try it out!&lt;/p&gt;&lt;h2&gt;CPU/RAM limitations&lt;/h2&gt;&lt;p&gt;When assigning resources to your Lambda functions, memory is the only configurable option. Why? Well, there is no obvious answer in the UI, and even worse, it&amp;#x27;s hidden &lt;a href=&quot;https://aws.amazon.com/lambda/faqs/&quot;&gt;deep in a FAQ&lt;/a&gt;. When you choose the amount of memory you want to allocate for a function, you are given proportional CPU power and other resources. What the docs don&amp;#x27;t tell you, however, is that if you allocate &lt;em&gt;enough&lt;/em&gt; memory, you&amp;#x27;ll be given two cores instead of one.&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/a/47582392&quot;&gt;This Stack Overflow comment&lt;/a&gt; has more info. TL;DR: if you are using 1.8GB or more of memory, you get to use two CPU cores, instead of one. Even two cores is not a lot, and that&amp;#x27;s why asynchronous operations in programming languages that utilize multiple cores don&amp;#x27;t perform well on Lambda. When architecting a serverless application, it&amp;#x27;s better to split larger tasks into smaller subtasks, when possible.&lt;/p&gt;&lt;p&gt;I hope you learned something new today! Architecting serverless applications come with their own unique set of challenges, but the community has great solutions that have been production-tested for quite some time.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Ruby on AWS Lambda: Layer Dependencies]]></title><description><![CDATA[This article is part of our Ruby on AWS Lambda blog series. A recent project had us migrating an existing PDF document processing system…]]></description><link>https://hint.io/blog/lambda-layer-dependencies</link><guid isPermaLink="false">https://hint.io/blog/lambda-layer-dependencies</guid><dc:creator><![CDATA[joelHayhurst]]></dc:creator><pubDate>Mon, 13 Jul 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;This article is part of our Ruby on AWS Lambda blog series. A recent project had us migrating an existing PDF document processing system from Rails Sidekiq to AWS Lambda. The processing includes OCR, creating preview images, splicing the PDF, and more. Moving to Lambda reduced processing time by 300 times in some cases.&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;This series of articles will serve less as a step-by-step process to get OCR serverless infrastructure up and running and more of a highlight reel of our &amp;quot;Aha!&amp;quot; moments. In part one, we talk about creating a AWS Lambda Layer with Docker. Check out the other posts in the series:&lt;/em&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;em&gt;&lt;a href=&quot;/blog/lambda-planning-and-architecture&quot;&gt;Planning &amp;amp; Architecture&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;&lt;li&gt;&lt;em&gt;&lt;a href=&quot;/blog/aws-lambda-ship-it&quot;&gt;Package &amp;amp; Ship It!&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;&lt;li&gt;&lt;em&gt;&lt;a href=&quot;/blog/lambda-and-active-storage&quot;&gt;Integrating with Active Storage&lt;/a&gt;&lt;/em&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Building dependencies for Lambda can be confusing. They need to be compiled, zipped up, and then made into a layer. We also have to keep the file size for the dependencies under Lambda&amp;#x27;s limit. Here is how we did that using a Dockerfile.&lt;/p&gt;&lt;p&gt;You can &lt;a href=&quot;https://gist.github.com/joelmichael/efe48be65d789c555459067b5a54e42d&quot;&gt;check out the full Dockerfile here&lt;/a&gt;.&lt;/p&gt;&lt;h2&gt;Dockerfile details&lt;/h2&gt;&lt;p&gt;One question when building the dependencies was which Docker image to use. We first tried using the &lt;code&gt;amazonlinux&lt;/code&gt; image, but this actually resulted in some build problems with one of our dependencies. We later found the LambCI images and ended up using &lt;code&gt;lambci/lambda:build-ruby2.7&lt;/code&gt;, because we are using Ruby. This worked perfectly for us, and it has the benefit of already having build tools installed, making for faster Docker builds.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Use AWS Lambda ruby2.7 build environment&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; lambci/lambda&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;build&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ruby2.7&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;AWS Lambda currently has a limit of 250 MB for its dependencies. If you are building significantly larger dependencies, as we were, then you are likely to reach this limit. It is therefore very important to compile your dependencies in a way that reduces file size. By using the &lt;code&gt;-Os&lt;/code&gt; compile time option, we were able to reduce the size of our binaries by over 90%.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Optimize compilation for size to try and stay below Lambda&amp;#x27;s 250 MB limit&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# This reduces filesize by over 90% (!) compared to the default -O2&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; CFLAGS &lt;span class=&quot;token string&quot;&gt;&amp;quot;-Os&amp;quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; CXXFLAGS $CFLAGS&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;While slightly less performant than the default &lt;code&gt;-O2&lt;/code&gt;, the massively reduced file size is worth it in this situation.&lt;/p&gt;&lt;p&gt;Next up is building Leptonica.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /root

&lt;span class=&quot;token comment&quot;&gt;# Leptonica image-reading dependencies&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; yum install &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;y libjpeg&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;devel libpng&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;devel libtiff&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;devel

&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; curl &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;O http&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;//www.leptonica.org/source/leptonica&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;1.79.0.tar.gz
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; tar zxvf leptonica&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;1.79.0.tar.gz

&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; leptonica&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;1.79.0
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; ./configure &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;prefix=/opt
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; make install&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You will need to install the &lt;code&gt;-devel&lt;/code&gt; packages when compiling, but won&amp;#x27;t need the &lt;code&gt;-devel&lt;/code&gt; variant when providing the dependencies for runtime.&lt;/p&gt;&lt;p&gt;Then Tesseract:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /root

&lt;span class=&quot;token comment&quot;&gt;# Optional Tesseract foreign language training dependencies&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# libicu-devel on Yum is of insufficient version (50, 52 is required)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# These are also not really necessary for our usage.&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#RUN yum install -y libicu-devel pango-devel cairo-devel&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; curl &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;Lo tesseract&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;4.1.1.tar.gz \
  https&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;//github.com/tesseract&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ocr/tesseract/archive/4.1.1.tar.gz
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; tar zxvf tesseract&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;4.1.1.tar.gz

&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; tesseract&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;4.1.1
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; ./autogen.sh &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;prefix=/opt
&lt;span class=&quot;token comment&quot;&gt;# These ENV vars have to be set or it will not build&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; LEPTONICA_CFLAGS &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;I/opt/include/leptonica
&lt;span class=&quot;token keyword&quot;&gt;ENV&lt;/span&gt; LEPTONICA_LIBS &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;L/opt/lib &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;lleptonica
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; ./configure &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;prefix=/opt
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; make install

&lt;span class=&quot;token comment&quot;&gt;# English training data&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /opt/share/tessdata
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; curl &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;LO https&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;//github.com/tesseract&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ocr/tessdata_best/raw/master/eng.traineddata&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;GhostScript was technically installable via RPM, but the amount of dependencies was too great. More on that later. We decided to just compile it with a minimal dependency set.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /root

&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; curl &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;LO \
  https&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;//github.com/ArtifexSoftware/ghostpdl&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;downloads/releases/download/gs952/ghostscript&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;9.52.tar.gz
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; tar zxvf ghostscript&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;9.52.tar.gz

&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; ghostscript&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;9.52
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; ./configure &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;prefix=/opt
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; make install&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Ironically, we end up installing &lt;code&gt;ghostscript-devel&lt;/code&gt; so that ImageMagick can be built. It might be possible to use the prior GhostScript installation here, but this was simple enough for build purposes.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /root

&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; yum install &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;y ghostscript&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;devel

&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; curl &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;Lo ImageMagick&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;7.0.10&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;6.tar.gz \
  https&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;//github.com/ImageMagick/ImageMagick/archive/7.0.10&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;6.tar.gz
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; tar zxvf ImageMagick&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;7.0.10&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;6.tar.gz

&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; ImageMagick&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;7.0.10&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;6
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; ./configure &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;prefix=/opt
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; make install&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We considered using libvips instead of ImageMagick, but it would have added scope to the project. Nonetheless I have some commented out code in the Dockerfile for building libvips in case we decide to switch to it in the future.&lt;/p&gt;&lt;p&gt;For Ruby gems, a Gemfile in the same directory that contains all of the gems is all we need.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;source &lt;span class=&quot;token string&quot;&gt;&amp;#x27;https://rubygems.org&amp;#x27;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# PDF processing gems&lt;/span&gt;
gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;simhash2&amp;#x27;&lt;/span&gt;
gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;phashion&amp;#x27;&lt;/span&gt;
gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;rtesseract&amp;#x27;&lt;/span&gt;
gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;mini_magick&amp;#x27;&lt;/span&gt;
gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;pdf-reader&amp;#x27;&lt;/span&gt;
gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;hexapdf&amp;#x27;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Other gems used in these files&lt;/span&gt;
gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;procto&amp;#x27;&lt;/span&gt;
gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;adamantium&amp;#x27;&lt;/span&gt;
gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;concord&amp;#x27;&lt;/span&gt;
gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;activesupport&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;~&amp;gt; 6.0.2&amp;#x27;&lt;/span&gt;
gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;chronic&amp;#x27;&lt;/span&gt;
gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;activestorage&amp;#x27;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Note that a little bit of trickery is necessary to modify the gem paths for loading in Lambda.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /root

&lt;span class=&quot;token comment&quot;&gt;# Phashion dependencies&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# Can skip this step because they are already installed above for Leptonica&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#RUN yum install -y libjpeg-devel libpng-devel&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Copy Gemfile from host into container&amp;#x27;s current directory&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;COPY&lt;/span&gt; Gemfile .

&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; bundle config set path vendor/bundle
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; bundle

&lt;span class=&quot;token comment&quot;&gt;# Modify directory structure for Lambda load path&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; vendor/bundle
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; mkdir ruby/gems
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; mv ruby/2.* ruby/gems
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; mv ruby /opt
&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /root&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now the RPM packages. I left in the installation for GhostScript and its dependencies from RPM as a comment, mainly so you can see how many packages I had to specify manually.&lt;/p&gt;&lt;p&gt;Note that you will have to specify the &lt;code&gt;x86_64&lt;/code&gt; variants of these packages when using these tools.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /root

&lt;span class=&quot;token comment&quot;&gt;# Install yumdownloader and rpmdev-extract&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; yum install &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;y yum&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;utils rpmdevtools

&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; mkdir rpms
&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; rpms

&lt;span class=&quot;token comment&quot;&gt;# Download dependency RPMs&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; yumdownloader libjpeg&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;turbo.x86_64 libpng.x86_64 libtiff.x86_64 \
  libgomp.x86_64 libwebp.x86_64 jbigkit&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;libs.x86_64
&lt;span class=&quot;token comment&quot;&gt;# GhostScript and dependencies&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# To reduce dependencies, we are compiling GhostScript from source instead&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# RUN yumdownloader ghostscript.x86_64 cups-libs.x86_64 fontconfig.x86_64 \&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#   fontpackages-filesystem freetype.x86_64 ghostscript-fonts jasper-libs.x86_64 \&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#   lcms2.x86_64 libICE.x86_64 libSM.x86_64 libX11.x86_64 libX11-common \&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#   libXau.x86_64 libXext.x86_64 libXt.x86_64 libfontenc.x86_64 libxcb.x86_64 \&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#   poppler-data stix-fonts urw-fonts xorg-x11-font-utils.x86_64 avahi-libs.x86_64 \&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#   acl.x86_64 audit-libs.x86_64 cracklib.x86_64 cracklib-dicts.x86_64 cryptsetup-libs.x86_64 \&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#   dbus.x86_64 dbus-libs.x86_64 device-mapper.x86_64 device-mapper-libs.x86_64 \&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#   elfutils-default-yama-scope elfutils-libs.x86_64 gzip.x86_64 kmod.x86_64 kmod-libs.x86_64 \&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#   libcap-ng.x86_64 libfdisk.x86_64 libpwquality.x86_64 libsemanage.x86_64 \&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#   libsmartcols.x86_64 libutempter.x86_64 lz4.x86_64 pam.x86_64 qrencode-libs.x86_64 \&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#   shadow-utils.x86_64 systemd.x86_64 systemd-libs.x86_64 ustr.x86_64 util-linux.x86_64 \&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#   expat.x86_64 xz-libs.x86_64 libgcrypt.x86_64 libgpg-error.x86_64 elfutils-libelf.x86_64 \&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#   bzip2-libs.x86_64&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Extract RPMs&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; rpmdev&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;extract *.rpm
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; rm *.rpm

&lt;span class=&quot;token comment&quot;&gt;# Copy all package files into /opt/rpms&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; cp &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;vR */usr/* /opt

&lt;span class=&quot;token comment&quot;&gt;# The x86_64 packages extract as lib64, we need to move these files to lib&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; yum install &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;y rsync
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; rsync &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;av /opt/lib64/ /opt/lib/
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; rm &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;r /opt/lib64&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Notice some more path management. We used &lt;code&gt;rsync&lt;/code&gt; for copying because &lt;code&gt;cp&lt;/code&gt; gave us some problems.&lt;/p&gt;&lt;p&gt;Now we just need to zip up the dependencies.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;WORKDIR&lt;/span&gt; /opt
&lt;span class=&quot;token keyword&quot;&gt;RUN&lt;/span&gt; zip &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;r /root/ProcessDocumentLayer.zip *&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And lastly, the entrypoint for the Dockerfile, which copies the zip file to an output directory.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;ENTRYPOINT&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;/bin/cp&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;/root/ProcessDocumentLayer.zip&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;/output&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now we just need the Docker commands to build this. I put them at the very top of the file under a &amp;quot;Usage&amp;quot; section.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Usage:&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# docker build -t lambda .&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# docker run -v $(pwd):/output lambda&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# ./publish_layer.sh.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;publish_layer.sh&lt;/code&gt; script is a small one we wrote that uses &lt;code&gt;awscli&lt;/code&gt; to upload and publish the layer. You&amp;#x27;ll have to authenticate with AWS for it to work. I used &lt;code&gt;aws configure&lt;/code&gt; for this purpose but you can &lt;a href=&quot;https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-welcome.html&quot;&gt;check out this article&lt;/a&gt; for more info.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;#!/bin/sh
aws s3 cp ProcessDocumentLayer.zip s3://process-document-layers
aws lambda publish-layer-version --layer-name ProcessDocumentLayer --description &amp;quot;Process Document dependencies&amp;quot; \
  --content S3Bucket=process-document-layers,S3Key=ProcessDocumentLayer.zip --compatible-runtimes ruby2.7&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And that&amp;#x27;s it. With this Dockerfile, we are able to easily build and publish a dependency layer for our OCR system on Lambda. We hope this was useful for you!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[5 Ways to Splat in Ruby]]></title><description><![CDATA[In honor of it being 5/5 today (aka Cinco de Mayo), I thought we'd continue the pattern and take a quick look at 5 different ways to use…]]></description><link>https://hint.io/blog/5-ways-to-splat-in-ruby</link><guid isPermaLink="false">https://hint.io/blog/5-ways-to-splat-in-ruby</guid><dc:creator><![CDATA[jasonDinsmore]]></dc:creator><pubDate>Tue, 05 May 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In honor of it being 5/5 today (aka Cinco de Mayo), I thought we&amp;#x27;d continue the pattern and take a quick look at 5 different ways to use Ruby&amp;#x27;s infamous splat (&lt;code&gt;*&lt;/code&gt;) operator.&lt;/p&gt;&lt;p&gt;Let&amp;#x27;s hop right into it! &lt;/p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:300px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:100%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFsklEQVQ4yx3T/1MT9h3H8Q+EJCRmxCBIpOWU1q1dW7uhnXN2HaUKIhWQgoJASIQAJgQSQiDkqxBRUQQDhMBCAuQbJCRgAirtvG299Xa3u+127W632+52+2W33e6233e79fN+7dw/8LjnL0828+IUd+4ryLYrp+mDb9NoVkqzmXMU3e2lydQ7dP/gdfJ/qqTHT09QKNZDoUgXOXYk5HleQp79QrqzJ6bJTAGNPMmlyaeKr5k9W0y3M4XwZIrh2S/FxDMFFmcbEPykGl5jM+xbr2LiIB+eB7XwNVRi+WYTPMk34H5eCFe2BBPZIriTCoxmxLDuyTkbSOaQZVcKR+wb5IzKyLMvo6k7H1CkqoxiV35AuuF3qdcvpClNC31e9y3aUH9M0+k3ybQtosG4hMwJBZmiQrq/fQzuVCln3cEc6k/kYjAgomGfBHf3lXD4TuLRxbNYq30P7TVvQdVTiofXPsZnTT/EqqEL06n30B1nsKTkGNjKhS0mpemNMgxsSDnThBiN7xTAkpBSX1gAT/YobOlDGBs4hwddKjSer8CV98+i94PvI2o24merQfxpNw1f6Br0USFubjDcCAqoaZ5Bv3mIM0tKQsOJPExkT9JIQg5jLB+9EYY7kQu4XlWHC29/D/qqGmg/rEJq9hG+jMWwb7XiD7NezPgqUe9laFrKoa5VBm1YxtlYSkSGhACj2woa3jwCc0KIyc238EXEi9URBwZ/VI2FDg32Zrz4824S/4z8GEmnHQm9Bj9dcaLlXj5uLDIyp+QwxPM4M6dEZNoVQhdlZAhKMLQpwPa8BlONrZjR9WK6qRmOmlqsu91YHp/AVzOT+EsmgsHL1diackPvOYF2PyNnQgF7WsGZeVtA/XEGw1YOmbcFsEaVWB9qw2jdZdha6tH97knMXa/BpwsPse5yY99lw1c+F+6q1FgetGNptRldK4xsERnMCQlnw0k56eKHYN8pJefzMox6j2NR0wl93WVYGi+gvvwwLJfO4bPFBwha9Nh0OfHF/SGsmU34xYwfyaQRrYs5pI8egjmVz9n0swryvjgLT/YkjWaOYnBGCVfDRehabmBcrcJU7Vms97difeo2dC1XERy+hWcuLZIPpxC32JCZt+JWUEbasBADW1LOhhIicuwegzN+nDrDDPrHJRj46LuY1PXDO3kX+tpqRO548CQQwNrcPBK2m4iNazFn6Ybj+id4EXDj5RBNPgZdoICzgYSYdBEhTPEi6ngJBhVoq3oNV06VoLXqbXx0uhCGa+cxZ+rG41uXsNxbiei4HtauOiyYe/CruAOGWAHVLzB0BgSc6WKi/4NjiddJvZ4D3UYRjIYKXD1djrozR3HlO0I0V0ihOn8Ct1srEdPW4bcLt2Hrb8KU7n0cLLXBFC2gZj9Da4Bx1h8RkjEhgzX9ChnCMgykxJjzXcJdzU30XaxEZZkc5TIBbDVn8NelMfw7YsUfww8wN92LtoslcD0uR/syI2O4DN0hIWfuzDFy7CnhzJaQPX0E2q08+FP1SOg6Mf+OHCOnilBRVoxf2xqBtBb/mFchsdsG7bwUxnuvoDMoQ8eKjJypN9C5KuLMtV1G7qdFGE0dJndWCe2GBKbNowjbTuNvPWfwm+EP0V/7Jv51sIj/fP4IP9lpx9hOMbQxCUzpYqhDOdBFFeTZew3GzWLOHKlXaWRLhpHtw2TaUpBqVUzqsJisoXL60nON/h6fpID7KuF3P6dfPhkiXVRKfTExWZMnqCckpfZAHqmCYhoOi6FekXJmT5VTf0gEfUQGzYoEPUE5dGtKtAWEmHB/E79fvoexhkrMjlbDvVH+sgaGSCEcO6XoXRehwcug8uejLyDGjeVczizhY1+bo8W8yyfgnUtirgnIuNp/hPesFvHGGcbV3cd5faecty8xrg/LuWGtgJsjSm5PK3nHci7vWJHwvg0ZV6+Iebs/77//Aybvd1zQkBTyAAAAAElFTkSuQmCC&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;hoppity hop&quot; title=&quot;hoppity hop&quot; src=&quot;/static/a893fed7126307cfdb371e4658fd1f11/5a46d/rabbit.png&quot; srcSet=&quot;/static/a893fed7126307cfdb371e4658fd1f11/222b7/rabbit.png 163w,/static/a893fed7126307cfdb371e4658fd1f11/5a46d/rabbit.png 300w&quot; sizes=&quot;(max-width: 300px) 100vw, 300px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;h2&gt;1. Interpolate Into an Array&lt;/h2&gt;&lt;p&gt;Splat can be used to expand the contents of one array into another:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;middle &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;%i(bar baz)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;middle&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:qux&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# [:foo, :bar, :baz, :qux]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;2. Capture an Argument List&lt;/h2&gt;&lt;p&gt;You can use splat to capture a list of arguments into an Array. Below, we&amp;#x27;re capturing the entire list of arguments being passed to &lt;code&gt;foo&lt;/code&gt; into an Array named &lt;code&gt;bar&lt;/code&gt;:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;bar&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;: &lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;bar&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&amp;quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

foo&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:b&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:c&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Array: [:a, :b, :c]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;3. Capture First/Last or First/Rest Values&lt;/h2&gt;&lt;p&gt;Splat can also be leveraged to split up an array into parts. Kinda like pattern matching:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;arr &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
first&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; last &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; arr
puts first &lt;span class=&quot;token comment&quot;&gt;# 1&lt;/span&gt;
puts last &lt;span class=&quot;token comment&quot;&gt;# 5&lt;/span&gt;

first&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;rest &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; arr
puts first &lt;span class=&quot;token comment&quot;&gt;# 1&lt;/span&gt;
puts rest &lt;span class=&quot;token comment&quot;&gt;# [2, 3, 4, 5]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;4. Coerce a Value Into an Array&lt;/h2&gt;&lt;p&gt;If you want to ensure the thing you are dealing with is an Array, you can splat it.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;foo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
bar &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;foo
puts bar &lt;span class=&quot;token comment&quot;&gt;# [1]&lt;/span&gt;

foo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
bar &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;foo
puts bar &lt;span class=&quot;token comment&quot;&gt;# [1, 2, 3]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;5. Convert an Array Into a Hash&lt;/h2&gt;&lt;p&gt;Lastly, splat can convert an Array into a Hash. Your Array needs to contain an even number of elements for this to work. If the Array were grouped into pairs, the first element in each pair will become a key in your Hash, and the second element of the pair will be the corresponding value.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;arr &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:baz&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token builtin&quot;&gt;Hash&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;arr&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# { foo: 1, bar: 2, baz: 3 }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Rails System Tests In Docker]]></title><description><![CDATA[At Hint, we use Docker extensively. It is our development environment for all of our projects. On a recent greenfield project, we wanted to…]]></description><link>https://hint.io/blog/rails-system-test-docker</link><guid isPermaLink="false">https://hint.io/blog/rails-system-test-docker</guid><dc:creator><![CDATA[nateVick]]></dc:creator><pubDate>Tue, 28 Apr 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;At Hint, we use Docker extensively. It is our development environment for all of our projects. On a recent greenfield project, we wanted to use Rails &lt;a href=&quot;https://weblog.rubyonrails.org/2017/4/27/Rails-5-1-final/&quot;&gt;System Tests&lt;/a&gt; to validate the system from end to end. &lt;/p&gt;&lt;p&gt;In order to comfortably use System Tests inside of Docker we had to ask ourselves a few questions: &lt;/p&gt;&lt;ol&gt;&lt;li&gt;How do we use RSpec for System Tests?&lt;/li&gt;&lt;li&gt;How do we run the tests in headless mode in a modern browser?&lt;/li&gt;&lt;li&gt;Can we run the test in a non-headless browser for building and debugging efficiently?&lt;/li&gt;&lt;/ol&gt;&lt;h2&gt;Context&lt;/h2&gt;&lt;p&gt;In the context of answering these questions, we are going to first need to profile the Rails project to which these answers apply. Our Rails app:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Uses Docker and Docker Compose.&lt;/li&gt;&lt;li&gt;Uses RSpec for general testing.&lt;/li&gt;&lt;li&gt;Has an entrypoint or startup script.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;&lt;em&gt;If some or none of the above apply to your app and you would like to learn more about our approach to Docker, take a look at this post: &lt;a href=&quot;https://hint.io/blog/rails-development-with-docker&quot;&gt;Dockerizing a Rails Project&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;&lt;h2&gt;Prep Work&lt;/h2&gt;&lt;p&gt;If your project was started before Rails 5.1, some codebase preparation is necessary. Beginning in Rails 5.1, the Rails core team integrated Capybara meaning Rails now properly handles all the painful parts of full system tests, e.g. database rollback. This means tools like &lt;code&gt;database_cleaner&lt;/code&gt; are no longer needed. If it is present, remove &lt;code&gt;database_cleaner&lt;/code&gt; from your Gemfile and remove any related config (typically found in &lt;code&gt;spec/support/database_cleaner.rb&lt;/code&gt; , &lt;code&gt;spec/spec_helper.rb&lt;/code&gt; , or &lt;code&gt;spec/rails_helper.rb&lt;/code&gt;).&lt;/p&gt;&lt;h2&gt;Dependency Installation&lt;/h2&gt;&lt;p&gt;After that codebase prep has been completed, verify that RSpec ≥ 3.7 and the required system tests helper gems are installed. &lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;group &lt;span class=&quot;token symbol&quot;&gt;:development&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:test&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;rspec-rails&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;&amp;gt;= 3.7&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

group &lt;span class=&quot;token symbol&quot;&gt;:test&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;capybara&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;&amp;gt;= 2.15&amp;#x27;&lt;/span&gt;
  gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;selenium-webdriver&amp;#x27;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# gem &amp;#x27;chromedriver-helper&amp;#x27; don&amp;#x27;t leave this cruft in your Gemfile.:D&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;These are the default system test helper gems installed with &lt;code&gt;rails new&lt;/code&gt; after Rails 5.1. We will not need &lt;code&gt;chromedriver-helper&lt;/code&gt; since we will be using a separate container for headless Chrome with &lt;code&gt;chromedriver&lt;/code&gt;. &lt;/p&gt;&lt;p&gt;&lt;em&gt;Note: The configuration below has been tested on Mac and Linux, but not Windows.&lt;/em&gt;&lt;/p&gt;&lt;h2&gt;Docker&lt;/h2&gt;&lt;p&gt;Speaking of containers, let&amp;#x27;s add that service to the &lt;code&gt;docker-compose.yml&lt;/code&gt; configuration file.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# other services...&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selenium&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; selenium/standalone&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;chrome&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We have added the &lt;code&gt;selenium&lt;/code&gt; service, which pulls down the latest &lt;code&gt;selenium/standalone-chrome&lt;/code&gt; image. You may notice I have not mapped a port to the host. This service is for inter-container communication, so there is no reason to map a port. We will need to add an environment variable to the service (app in this case) that Rails/RSpec will be running on for setting a portion of the Selenium URL.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; .
    &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; bundle exec rails server &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;p 3000 &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;b &amp;#x27;0.0.0.0&amp;#x27;
    &lt;span class=&quot;token comment&quot;&gt;# ... more config ...&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;3000:3000&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;43447:43447&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# ... more config ...&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; SELENIUM_REMOTE_HOST=selenium&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Capybara&lt;/h2&gt;&lt;p&gt;We added a port mapping for Capybara as well: &lt;code&gt;43447:43447&lt;/code&gt;. Now let&amp;#x27;s add the Capybara config at &lt;code&gt;spec/support/capybara.rb&lt;/code&gt;.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# frozen_string_literal: true&lt;/span&gt;

&lt;span class=&quot;token constant&quot;&gt;RSpec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;configure &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;config&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
  headless &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fetch&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;HEADLESS&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;false&amp;#x27;&lt;/span&gt;

  config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;before&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:each&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    driven_by &lt;span class=&quot;token symbol&quot;&gt;:rack_test&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;before &lt;span class=&quot;token symbol&quot;&gt;:each&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; js&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    url &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; headless
            &lt;span class=&quot;token string&quot;&gt;&amp;quot;http://&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;SELENIUM_REMOTE_HOST&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;:4444/wd/hub&amp;quot;&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
            &lt;span class=&quot;token string&quot;&gt;&amp;#x27;http://host.docker.internal:9515&amp;#x27;&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    driven_by &lt;span class=&quot;token symbol&quot;&gt;:selenium&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; using&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:chrome&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      browser&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;              &lt;span class=&quot;token symbol&quot;&gt;:remote&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      url&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;                  url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      desired_capabilities&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:chrome&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;# Find Docker IP address&lt;/span&gt;
    &lt;span class=&quot;token constant&quot;&gt;Capybara&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;server_host &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; headless
                             `&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;sbin&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;ip route&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;awk &lt;span class=&quot;token string&quot;&gt;&amp;#x27;/scope/ { print $9 }&amp;#x27;&lt;/span&gt;`&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;strip
                           &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
                             &lt;span class=&quot;token string&quot;&gt;&amp;#x27;0.0.0.0&amp;#x27;&lt;/span&gt;
                           &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token constant&quot;&gt;Capybara&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;server_port &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;43447&amp;#x27;&lt;/span&gt;
    session_server       &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Capybara&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current_session&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;server
    &lt;span class=&quot;token constant&quot;&gt;Capybara&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;app_host    &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;http://&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;session_server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;host&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;:&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;session_server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;port&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;after &lt;span class=&quot;token symbol&quot;&gt;:each&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; js&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    page&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;driver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;browser&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;manage&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;logs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:browser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;each&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;log&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;message
        &lt;span class=&quot;token keyword&quot;&gt;when&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;/This page includes a password or credit card input in a non-secure context/&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;# Ignore this warning in tests&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;next&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
          message &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;[&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;level&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;] &lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;message&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&amp;quot;&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;raise&lt;/span&gt; message
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Let&amp;#x27;s break it down section by section.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;headless &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fetch&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;HEADLESS&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;false&amp;#x27;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We are using the &lt;code&gt;headless&lt;/code&gt; variable to make some decisions later in the file. This variable allows us to run &lt;code&gt;bundle exec rspec&lt;/code&gt; normally and run system tests against headless Chrome in the &lt;code&gt;selenium&lt;/code&gt; container. Or we run &lt;code&gt;HEADLESS=false bundle exec rspec&lt;/code&gt; and when a system test will attempt to connect to &lt;code&gt;chromedriver&lt;/code&gt; running on the host machine.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;before &lt;span class=&quot;token symbol&quot;&gt;:each&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:system&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  driven_by &lt;span class=&quot;token symbol&quot;&gt;:rack_test&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Our default driver for system tests will be &lt;code&gt;rack_test&lt;/code&gt;. It is the fastest driver available because it does not involve starting up a browser. It also means we cannot test JavaScript while using it, which brings us to the next section.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;before &lt;span class=&quot;token symbol&quot;&gt;:each&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; js&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  url &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; headless
          &lt;span class=&quot;token string&quot;&gt;&amp;quot;http://&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;SELENIUM_REMOTE_HOST&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;:4444/wd/hub&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;&amp;#x27;http://host.docker.internal:9515&amp;#x27;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  driven_by &lt;span class=&quot;token symbol&quot;&gt;:selenium&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; using&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:chrome&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; options&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    browser&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;              &lt;span class=&quot;token symbol&quot;&gt;:remote&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    url&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;                  url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    desired_capabilities&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:chrome&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	
  &lt;span class=&quot;token comment&quot;&gt;# ...more config...		&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Any specs with &lt;code&gt;js: true&lt;/code&gt; set will use this config. We set the &lt;code&gt;url&lt;/code&gt; for Selenium to use depending on if we are running headless or not. Notice the special Docker domain we are setting the non-headless url to; it is a URL that points to the host machine. The special domain is currently only available on Mac and Windows, so we will need to handle that for Linux later.&lt;/p&gt;&lt;p&gt;We set our driver to &lt;code&gt;:selenium&lt;/code&gt; with config options for &lt;code&gt;browser, url, desired_capabilities&lt;/code&gt; .&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;before &lt;span class=&quot;token symbol&quot;&gt;:each&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; type&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:system&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; js&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  
  &lt;span class=&quot;token comment&quot;&gt;# ...selenium config...&lt;/span&gt;
  
  &lt;span class=&quot;token constant&quot;&gt;Capybara&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;server_host &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; headless
                           `&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;sbin&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;ip route&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;awk &lt;span class=&quot;token string&quot;&gt;&amp;#x27;/scope/ { print $9 }&amp;#x27;&lt;/span&gt;`&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;strip
                         &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
                           &lt;span class=&quot;token string&quot;&gt;&amp;#x27;0.0.0.0&amp;#x27;&lt;/span&gt;
                         &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token constant&quot;&gt;Capybara&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;server_port &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;43447&amp;#x27;&lt;/span&gt;
  session_server       &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Capybara&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;current_session&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;server
  &lt;span class=&quot;token constant&quot;&gt;Capybara&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;app_host    &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;http://&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;session_server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;host&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;:&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;session_server&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;port&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&amp;quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here we set the &lt;code&gt;Capybara.server_host&lt;/code&gt; address to the &lt;code&gt;app&lt;/code&gt; container IP address if headless or &lt;code&gt;0.0.0.0&lt;/code&gt; if not.&lt;/p&gt;&lt;p&gt;The last part of RSpec configuration is to require this config in &lt;code&gt;spec/rails_helper.rb&lt;/code&gt; . &lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# frozen_string_literal: true&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# This file is copied to spec/ when you run &amp;#x27;rails generate rspec:install&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;spec_helper&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;RAILS_ENV&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;test&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;expand_path&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;../../config/environment&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; __FILE__&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# Prevent database truncation if the environment is production&lt;/span&gt;
abort&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;The Rails environment is running in production mode!&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Rails&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;production&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;rspec/rails&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;support/capybara&amp;#x27;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Next, we need to install &lt;a href=&quot;https://sites.google.com/a/chromium.org/chromedriver/downloads&quot;&gt;ChromeDriver&lt;/a&gt; on the host machine. You will need to place it in a location in your &lt;code&gt;$PATH&lt;/code&gt;. Once it is there, when you want to run non-headless system tests, you will need to start ChromeDriver &lt;code&gt;chromedriver --whitelisted-ips&lt;/code&gt; in a new terminal session.  Now on a Mac, you should be able to run headless or non-headless system tests. Those commands again are:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;#HEADLESS&lt;/span&gt;
bundle &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; rspec

&lt;span class=&quot;token comment&quot;&gt;#NON-HEADLESS&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;HEADLESS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;false bundle &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; rspec&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Special Linux Config&lt;/h2&gt;&lt;p&gt;There is one last step for Linux users because of the special &lt;code&gt;host.docker.internal&lt;/code&gt; URL is not available. We need to add some config to the entrypoint or startup script to solve that issue.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${HOST_DOMAIN&lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt;&amp;quot;host.docker.internal&amp;quot;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function-name function&quot;&gt;check_host&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ping&lt;/span&gt; -q -c1 &lt;span class=&quot;token variable&quot;&gt;$HOST_DOMAIN&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; /dev/null &lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;2&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;&amp;amp;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# check if the docker host is running on mac or windows&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt; check_host&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
  &lt;span class=&quot;token assign-left variable&quot;&gt;HOST_IP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; route &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;awk&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;NR==1 {print &lt;span class=&quot;token variable&quot;&gt;$3&lt;/span&gt;}&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token variable&quot;&gt;$HOST_IP&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$HOST_DOMAIN&lt;/span&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; /etc/hosts
&lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We set an environment variable to the special Docker URL. We then create a function to check if the host responds to that URL. If it responds, we move on assuming we are running on Mac or Windows. If it does not respond, we assign the container&amp;#x27;s IP to an environment variable, then append a record to &lt;code&gt;/etc/hosts&lt;/code&gt;. We are now all set to run system tests on Linux as well.&lt;/p&gt;&lt;h2&gt;Bonus: CI Setup&lt;/h2&gt;&lt;p&gt;Let&amp;#x27;s wrap this up with config to run system tests on Circle CI. We need to add &lt;code&gt;SELENIUM_REMOTE_HOST&lt;/code&gt; and the Selenium Docker image to &lt;code&gt;.circleci/config.yml&lt;/code&gt;&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;jobs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;parallelism&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;docker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; circleci/ruby&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;2.6.0&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;node
        &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;SELENIUM_REMOTE_HOST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; localhost
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; selenium/standalone&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;chrome&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Connect with me on Twitter(&lt;a href=&quot;https://twitter.com/natron99&quot;&gt;@natron99&lt;/a&gt;) to continue the conversation about Rails and Docker!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Macro See, Macro Do]]></title><description><![CDATA[This post assumes you have Erlang/Elixir installed and that you can spin up a Phoenix project I've been diving into Elixir and Phoenix as of…]]></description><link>https://hint.io/blog/elixir-demystifying-quote</link><guid isPermaLink="false">https://hint.io/blog/elixir-demystifying-quote</guid><dc:creator><![CDATA[nateShoemaker]]></dc:creator><pubDate>Fri, 17 Apr 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;This post assumes you have Erlang/Elixir installed and that you can spin up a Phoenix project&lt;/em&gt;&lt;/p&gt;&lt;p&gt;I&amp;#x27;ve been diving into Elixir and Phoenix as of late. I have thoroughly enjoyed my time spent with both and could gush about them for far, far too long. Elixir has some features whose underlying implementation wasn&amp;#x27;t obvious at first glance, namely the macro &lt;code&gt;quote/2&lt;/code&gt; (that slash and number indicates the arity).&lt;/p&gt;&lt;p&gt;I first came across &lt;code&gt;quote/2&lt;/code&gt; in a fresh Phoenix project. Let&amp;#x27;s create one now! Run &lt;code&gt;mix phx.new foo&lt;/code&gt;, open up &lt;code&gt;lib/foo_web/foo_web.ex&lt;/code&gt; and see &lt;code&gt;quote/2&lt;/code&gt; being used:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;elixir&quot;&gt;&lt;pre class=&quot;language-elixir&quot;&gt;&lt;code class=&quot;language-elixir&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# lib/foo_web/foo_web.ex&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;defmodule&lt;/span&gt; FooWeb &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; controller &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    quote &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; Phoenix&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Controller&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;namespace:&lt;/span&gt; FooWeb

      &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Plug&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Conn
      &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; FooWeb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Gettext
      &lt;span class=&quot;token keyword&quot;&gt;alias&lt;/span&gt; FooWeb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Router&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Helpers&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;as:&lt;/span&gt; Routes
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;controller/0&lt;/code&gt; is then used in controllers like this:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;elixir&quot;&gt;&lt;pre class=&quot;language-elixir&quot;&gt;&lt;code class=&quot;language-elixir&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# lib/foo_web/controllers/page_controller.ex&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;defmodule&lt;/span&gt; FooWeb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;PageController &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; FooWeb&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token atom symbol&quot;&gt;:controller&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Going through &lt;a href=&quot;https://pragprog.com/book/phoenix14/programming-phoenix-1-4&quot;&gt;Programming Phoenix&lt;/a&gt; I saw this macro being used again and again. I understood what it &lt;em&gt;meant&lt;/em&gt;: the &lt;code&gt;use&lt;/code&gt;, &lt;code&gt;import&lt;/code&gt;, and &lt;code&gt;alias&lt;/code&gt; macros are being injected into &lt;code&gt;PageController&lt;/code&gt;, so dependencies can be shared across modules. But why not just include them in the function definition? What is going behind the scenes? Why &lt;code&gt;quote/2&lt;/code&gt;? Being a Rails developer accustomed to magic, I accepted it and moved on.&lt;/p&gt;&lt;p&gt;One of Phoenix&amp;#x27;s (and Elixir) strengths is that nothing is hidden from the developer. Everything is gloriously defined, displayed, and explicitly composed right in front of you. There really &lt;em&gt;isn&amp;#x27;t&lt;/em&gt; any magic. Thus my acceptance of it bothered me, so let&amp;#x27;s dive in and learn about &lt;code&gt;quote&lt;/code&gt; together!&lt;/p&gt;&lt;h2&gt;Copy and (almost) paste&lt;/h2&gt;&lt;p&gt;The best way to learn is by doing, so why don&amp;#x27;t we create some modules and reproduce what we&amp;#x27;ve seen. Here&amp;#x27;s a very simple example I came up with:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;elixir&quot;&gt;&lt;pre class=&quot;language-elixir&quot;&gt;&lt;code class=&quot;language-elixir&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# bar.exs&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;defmodule&lt;/span&gt; Bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Math &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; sum&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;do:&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; y
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;defmodule&lt;/span&gt; Bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AllTheThings &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; things &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    quote &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;alias&lt;/span&gt; Bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Math
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;defmodule&lt;/span&gt; Bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Work &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; Bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AllTheThings&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token atom symbol&quot;&gt;:things&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; print_sum&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    IO&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;puts&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;the sum of &lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;#{&lt;/span&gt;x&lt;span class=&quot;token delimiter punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; and &lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;#{&lt;/span&gt;y&lt;span class=&quot;token delimiter punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; is &lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;#{&lt;/span&gt;sum&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token delimiter punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

Bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Work&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;print_sum&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Again, I don&amp;#x27;t &lt;em&gt;really&lt;/em&gt; know what &lt;code&gt;quote/2&lt;/code&gt; is doing and why, but we mimicked what we saw in Phoenix pretty close. I think we&amp;#x27;re ready to try this out, let&amp;#x27;s run &lt;code&gt;elixir bar.exs&lt;/code&gt; and see what happens:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cli&quot;&gt;&lt;pre class=&quot;language-cli&quot;&gt;&lt;code class=&quot;language-cli&quot;&gt;&amp;gt; elixir bar.exs
** (UndefinedFunctionError) function Bar.AllTheThings.__using__/1 is undefined or private
    Bar.AllTheThings.__using__(:things)
    bar.exs:18: (module)
    bar.exs:17: (file)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;:thinking:&lt;/p&gt;&lt;p&gt;It seems that we&amp;#x27;re missing a function that Elixir assumes we have implemented. I&amp;#x27;ll be honest - I&amp;#x27;ve never written a module that was consumed by &lt;code&gt;use&lt;/code&gt;, so let&amp;#x27;s double back to &lt;code&gt;FooWeb&lt;/code&gt; in our Phoenix App to see if we missed anything. At the bottom of the file, you&amp;#x27;ll see:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;elixir&quot;&gt;&lt;pre class=&quot;language-elixir&quot;&gt;&lt;code class=&quot;language-elixir&quot;&gt;  defmacro __using__&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;which&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;when&lt;/span&gt; is_atom&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;which&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    apply&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;__MODULE__&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; which&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Ah! Elixir was looking for that function, so let&amp;#x27;s slap that it in &lt;code&gt;Bar.AllTheThings&lt;/code&gt;:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;elixir&quot;&gt;&lt;pre class=&quot;language-elixir&quot;&gt;&lt;code class=&quot;language-elixir&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;defmodule&lt;/span&gt; Bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AllTheThings &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; things &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    quote &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;alias&lt;/span&gt; Bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Math
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  defmacro __using__&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;which&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;when&lt;/span&gt; is_atom&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;which&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    apply&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;__MODULE__&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; which&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Diving into &lt;code&gt;defmacro&lt;/code&gt; is outside the scope of this post, but we can acknowledge it as a requirement of a module that&amp;#x27;s consumed by &lt;code&gt;use&lt;/code&gt;. The use of &lt;code&gt;apply/3&lt;/code&gt; is straightforward: take a module, an atom that represents the function name, and call it with some arguments.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;elixir&quot;&gt;&lt;pre class=&quot;language-elixir&quot;&gt;&lt;code class=&quot;language-elixir&quot;&gt;apply&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AllTheThings&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token atom symbol&quot;&gt;:things&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# is equivalent to&lt;/span&gt;
Bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AllTheThings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;things&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And then:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cli&quot;&gt;&lt;pre class=&quot;language-cli&quot;&gt;&lt;code class=&quot;language-cli&quot;&gt;&amp;gt; elixir bar.exs
the sum of 2 and 2 is 4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Great, our dependency injection works. Now that we understand the structure let&amp;#x27;s dig into what&amp;#x27;s happening under the hood.&lt;/p&gt;&lt;h2&gt;I heard you like Elixir, so let&amp;#x27;s represent some Elixir with Elixir&lt;/h2&gt;&lt;p&gt;From the &lt;a href=&quot;https://hexdocs.pm/elixir/Kernel.SpecialForms.html#quote/2&quot;&gt;docs&lt;/a&gt;:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;gt; quote(opts, block)

Gets the representation of any expression.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Let&amp;#x27;s try it out:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;gt; iex
iex(1)&amp;gt; quote do sum(2, 2) end
{:sum, [], [2, 2]}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That&amp;#x27;s right! We are representing Elixir with Elixir. Elixir&amp;#x27;s AST (&lt;a href=&quot;https://en.wikipedia.org/wiki/Abstract_syntax_tree&quot;&gt;abstract syntax tree&lt;/a&gt;) is... Elixir! Pretty cool, huh? Macros, such as &lt;code&gt;quote/2&lt;/code&gt;, are represented by a tuple of three elements. The first element is (usually) an atom, the second is for metadata, and the third is the argument list.&lt;/p&gt;&lt;p&gt;I wonder what our &lt;code&gt;import Bar.Math&lt;/code&gt; looks like as an AST? Let&amp;#x27;s find out! Comment out everything in &lt;code&gt;bar.exs&lt;/code&gt; except for the &lt;code&gt;Bar.Math&lt;/code&gt; module. Rename the file to &lt;code&gt;bar.ex&lt;/code&gt; so Elixir can compile it, and run &lt;code&gt;iex&lt;/code&gt;:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cli&quot;&gt;&lt;pre class=&quot;language-cli&quot;&gt;&lt;code class=&quot;language-cli&quot;&gt;&amp;gt; iex
iex(1)&amp;gt; c &amp;quot;bar.ex&amp;quot;
[Bar.Math]
iex(2)&amp;gt; quote do
...(2)&amp;gt;   import Bar.Math
...(2)&amp;gt; end
{:import, [context: Elixir], [{:__aliases__, [alias: false], [:Bar, :Math]}]}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There it is! We can see the AST as a three element tuple. It holds all the information that Elixir needs to know to &lt;code&gt;import&lt;/code&gt; a module. &lt;code&gt;quote/2&lt;/code&gt; gives us some fantastic syntax sugar; could you imagine writing these tuples everywhere? Just for fun, let&amp;#x27;s see how deep into the rabbit hole we can go. Rename &lt;code&gt;bar.ex&lt;/code&gt; back to &lt;code&gt;bar.exs&lt;/code&gt;, uncomment all the code, and change the &lt;code&gt;import Bar.Math&lt;/code&gt; to the AST representation without &lt;code&gt;quote/2&lt;/code&gt;:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;elixir&quot;&gt;&lt;pre class=&quot;language-elixir&quot;&gt;&lt;code class=&quot;language-elixir&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# bar.exs&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;defmodule&lt;/span&gt; Bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AllTheThings &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; things &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token atom symbol&quot;&gt;:import&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;context:&lt;/span&gt; Elixir&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token atom symbol&quot;&gt;:__aliases__&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;alias:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token atom symbol&quot;&gt;:Bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token atom symbol&quot;&gt;:Math&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  defmacro __using__&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;which&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;when&lt;/span&gt; is_atom&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;which&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    apply&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;__MODULE__&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; which&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cli&quot;&gt;&lt;pre class=&quot;language-cli&quot;&gt;&lt;code class=&quot;language-cli&quot;&gt;&amp;gt; elixir bar.exs
the sum of 2 and 2 is 4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It works! Let&amp;#x27;s go another level in by removing &lt;code&gt;things/0&lt;/code&gt; and placing our AST directly in &lt;code&gt;__using/1&lt;/code&gt;:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;elixir&quot;&gt;&lt;pre class=&quot;language-elixir&quot;&gt;&lt;code class=&quot;language-elixir&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# bar.exs&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;defmodule&lt;/span&gt; Bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AllTheThings &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  defmacro __using__&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;which&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;when&lt;/span&gt; is_atom&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;which&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token atom symbol&quot;&gt;:import&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;context:&lt;/span&gt; Elixir&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token atom symbol&quot;&gt;:__aliases__&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token attr-name&quot;&gt;alias:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token atom symbol&quot;&gt;:Bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token atom symbol&quot;&gt;:Math&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You know the drill:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cli&quot;&gt;&lt;pre class=&quot;language-cli&quot;&gt;&lt;code class=&quot;language-cli&quot;&gt;&amp;gt; elixir bar.exs
the sum of 2 and 2 is 4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Nice! Is it possible to inline the AST we have &lt;em&gt;in&lt;/em&gt; our &lt;code&gt;Bar.Work&lt;/code&gt; module? Sadly, we can&amp;#x27;t. The &lt;code&gt;use/2&lt;/code&gt; macro changes this:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;elixir&quot;&gt;&lt;pre class=&quot;language-elixir&quot;&gt;&lt;code class=&quot;language-elixir&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; Bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AllTheThings&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token atom symbol&quot;&gt;:things&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;to:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;elixir&quot;&gt;&lt;pre class=&quot;language-elixir&quot;&gt;&lt;code class=&quot;language-elixir&quot;&gt;Bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;AllTheThings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;__using__&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token atom symbol&quot;&gt;:things&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We&amp;#x27;ve come to the end of this Elixir in Elixir train! There are no other stops on this line.&lt;/p&gt;&lt;h3&gt;Wrapping up&lt;/h3&gt;&lt;p&gt;So, what did we learn? The &lt;code&gt;quote&lt;/code&gt; macro transforms Elixir code to an AST. We can then leverage that to achieve real dependency injection in a functional language. How cool is that?&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Strong Opinions About Strong Parameters]]></title><description><![CDATA[Rails announced  strong_parameters  as a replacement for  protected_attributes  nearly eight years ago. In 2020 many Rails apps have not…]]></description><link>https://hint.io/blog/strong-parameters-strong-opinions</link><guid isPermaLink="false">https://hint.io/blog/strong-parameters-strong-opinions</guid><dc:creator><![CDATA[benWood]]></dc:creator><pubDate>Fri, 10 Apr 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Rails announced &lt;code&gt;strong_parameters&lt;/code&gt; as a replacement for &lt;code&gt;protected_attributes&lt;/code&gt; nearly eight years ago. In 2020 many Rails apps have not completed the migration. Others have made the migration, but are worse off than before. Was &lt;code&gt;strong_parameters&lt;/code&gt; a bad idea? I don&amp;#x27;t think so. But like many things, it depends on how you use it.&lt;/p&gt;&lt;h2&gt;Strong Opinions&lt;/h2&gt;&lt;h3&gt;Instances of &lt;code&gt;ActionController:Parameters&lt;/code&gt; leak outside of the controller&lt;/h3&gt;&lt;p&gt;This is undoubtedly the most common mistake I&amp;#x27;ve seen. The reason that &lt;code&gt;strong_parameters&lt;/code&gt; is superior to &lt;code&gt;protected_attributes&lt;/code&gt; is that it narrows the concern of mass-assignment protection to the controller. With &lt;code&gt;protected_attributes&lt;/code&gt;, the entire app had to consider which attributes could mass-assigned, and which could not. This led to anti-patterns like the use of &lt;code&gt;without_protection&lt;/code&gt; which allowed developers to skip mass-assignment protection under certain circumstances.&lt;/p&gt;&lt;p&gt;The benefit of &lt;code&gt;strong_parameters&lt;/code&gt; is lost when &lt;code&gt;ActionController::Parameters&lt;/code&gt; are passed outside of a controller and suddenly you have to be concerned about mass-assignment protection everywhere, again.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;  &lt;span class=&quot;token comment&quot;&gt;# FILE: app/lib/payment_processor.rb&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PaymentProcessor&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token variable&quot;&gt;@params&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; params
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;# ... payment processing logic, etc&lt;/span&gt;
      &lt;span class=&quot;token constant&quot;&gt;Payment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;payment_params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;payment_params&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token variable&quot;&gt;@params&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:payment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;permit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:some&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:payment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:attrs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# FILE: app/controllers/payments_controller.rb&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PaymentsController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ApplicationController&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;/span&gt;
      payment &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PaymentProcessor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; payment&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;process
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;&lt;p&gt;&lt;strong&gt;Strong Opinion&lt;/strong&gt;: Parameters should be permitted at the controller level. If you pass some params on to another object (like a service class), first permit the params that are allowed for mass-assignment, then call &lt;code&gt;to_h&lt;/code&gt; on it to convert the object to a good ol&amp;#x27; &lt;code&gt;ActiveSupport::HashWithIndifferentAccess&lt;/code&gt;.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;  &lt;span class=&quot;token comment&quot;&gt;# FILE: app/lib/payment_processor.rb&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PaymentProcessor&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;payment_params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token variable&quot;&gt;@payment_params&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; payment_params
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;# ... payment processing logic, etc&lt;/span&gt;
      &lt;span class=&quot;token constant&quot;&gt;Payment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;create&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;@payment_params&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# FILE: app/controllers/payments_controller.rb&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PaymentsController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ApplicationController&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;/span&gt;
      payment &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PaymentProcessor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;payment_params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to_h&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; payment&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;process
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;payment_params&lt;/span&gt;&lt;/span&gt;
      params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:payment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;permit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:some&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:payment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:attrs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr/&gt;&lt;h3&gt;Use of strong parameters where mass assignment is not being performed&lt;/h3&gt;&lt;p&gt;The Rails community is pretty split on this one. Should you &lt;em&gt;always&lt;/em&gt; permit parameters? Or only permit parameters when mass-assignment is being performed? Here&amp;#x27;s an example:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;  &lt;span class=&quot;token comment&quot;&gt;# FILE: app/controllers/users_controller.rb&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UsersController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ApplicationController&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;special_update_action&lt;/span&gt;&lt;/span&gt;
      user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;find&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user_params&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;special_attribute &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; user_params&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:special_attribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;save
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;user_params&lt;/span&gt;&lt;/span&gt;
      params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;permit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token symbol&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token symbol&quot;&gt;:special_attribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token symbol&quot;&gt;:some&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token symbol&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token symbol&quot;&gt;:attrs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token symbol&quot;&gt;:including&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;&lt;p&gt;&lt;strong&gt;Strong Opinion&lt;/strong&gt;: Don&amp;#x27;t complicate your controllers by permitting params when mass assignment is &lt;em&gt;not&lt;/em&gt; being performed.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;  &lt;span class=&quot;token comment&quot;&gt;# FILE: app/controllers/users_controller.rb&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UsersController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ApplicationController&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;special_update_action&lt;/span&gt;&lt;/span&gt;
      user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;find&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;params&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;# Notice that special_attribute is pulled off of `params` directly&lt;/span&gt;
      user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;special_attribute &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; params&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:special_attribute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;save
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr/&gt;&lt;h3&gt;Order of operations when mutating a params object&lt;/h3&gt;&lt;p&gt;Remember, &lt;code&gt;strong_parameters&lt;/code&gt; is meant to sanitize &lt;em&gt;externally-provided&lt;/em&gt; parameters. If you add a key to the params object, then call &lt;code&gt;permit&lt;/code&gt;, you&amp;#x27;ll end up having to permit the parameter you just added.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;  &lt;span class=&quot;token comment&quot;&gt;# FILE: app/controllers/credit_cards_controller.rb&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CreditCardsController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ApplicationController&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;/span&gt;
      credit_card &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CreditCard&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;find&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;params&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      params&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:top_secret_token&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;TopSecretToken&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; credit_card&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;update&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;credit_card_params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;credit_card_params&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;# Notice the addition of top_secret_token is included in this&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;# scenario so that it can be mass-assigned above&lt;/span&gt;
      params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:credit_card&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;permit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token symbol&quot;&gt;:top_secret_token&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token symbol&quot;&gt;:some&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token symbol&quot;&gt;:credit_card&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token symbol&quot;&gt;:attrs&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;&lt;p&gt;&lt;strong&gt;Strong Opinion&lt;/strong&gt;: Permit your params &lt;em&gt;before&lt;/em&gt; mutating the object. This allows you to permit only the externally-provided parameters, then modify the object as you see fit.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;  &lt;span class=&quot;token comment&quot;&gt;# FILE: app/controllers/credit_cards_controller.rb&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CreditCardsController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ApplicationController&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;/span&gt;
      credit_card &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CreditCard&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;find&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;params&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      assignable_params &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; credit_card_params
      assignable_params&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:top_secret_token&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;TopSecretToken&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; credit_card&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;update&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;assignable_params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;credit_card_params&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;# Notice that top_secret_token does *not* need to be included&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;# here because it is assigned to the (permitted) return value&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;# of credit_card_params&lt;/span&gt;
      params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:credit_card&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;permit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:some&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:credit_card&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:attrs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;hr/&gt;&lt;h3&gt;Defining permitted attributes multiple (sometimes many) times&lt;/h3&gt;&lt;p&gt;With &lt;code&gt;protected_attributes&lt;/code&gt;, the model provided a central place to specify which attributes were permitted for mass-assignment. With &lt;code&gt;strong_parameters&lt;/code&gt;, permitted parameters are often defined multiple times for the same resource in different controllers. This is not DRY and it is not maintainable. Add in consideration for &lt;code&gt;accepts_nested_attributes_for&lt;/code&gt; and you&amp;#x27;re maintaining countless lists of the same parameters.&lt;/p&gt;&lt;p&gt;&lt;em&gt;Note: In the previous examples parameters were permitted directly in the controller as seen below. This was done for simplicity&amp;#x27;s sake, and also on the basis that no other controllers duplicated the same set of permitted parameters.&lt;/em&gt;&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;  &lt;span class=&quot;token comment&quot;&gt;# FILE: app/controllers/departments_controller.rb&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DepartmentsController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ApplicationController&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;/span&gt;
      department &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Department&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;department_params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; department&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;save
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;department_params&lt;/span&gt;&lt;/span&gt;
      params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:department&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;permit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token symbol&quot;&gt;:some&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:department&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:attrs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        employees_attributes&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;token symbol&quot;&gt;:some&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:employee&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:attrs&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# FILE: app/controllers/special/departments_controller.rb&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Special&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DepartmentsController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ApplicationController&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;/span&gt;
        department &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Department&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;department_params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; department&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;save
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;# Copy pasta&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;department_params&lt;/span&gt;&lt;/span&gt;
        params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:department&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;permit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token symbol&quot;&gt;:some&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:department&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:attrs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          employees_attributes&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;token symbol&quot;&gt;:some&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:employee&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:attrs&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;br/&gt;&lt;p&gt;&lt;strong&gt;Strong Opinion&lt;/strong&gt;: Duplicated parameters should be permitted in a module that can be included wherever it is needed. Furthermore, nested attributes should not be redefined multiple times. Here&amp;#x27;s an example:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;
  &lt;span class=&quot;token comment&quot;&gt;# FILE: app/controllers/concerns/strong_parameters/employee.rb&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Concerns&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;StrongParameters&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Employee&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;employee_params&lt;/span&gt;&lt;/span&gt;
          params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:employee&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;permit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;permitted_attrs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;permitted_attrs&lt;/span&gt;&lt;/span&gt;
          &lt;span class=&quot;token string&quot;&gt;%i(some employee attrs)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# FILE: app/controllers/concerns/strong_parameters/department.rb&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Concerns&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;StrongParameters&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Department&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;department_params&lt;/span&gt;&lt;/span&gt;
          params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:department&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;permit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;permitted_attrs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;permitted_attrs&lt;/span&gt;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;token symbol&quot;&gt;:some&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:department&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:attrs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; employees_attributes&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
              &lt;span class=&quot;token symbol&quot;&gt;:id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:_destroy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Concerns&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;StrongParameters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Employee&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;permitted_attrs&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# FILE: app/controllers/departments_controller.rb&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DepartmentsController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ApplicationController&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Concerns&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;StrongParameters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Department&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;/span&gt;
      department &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Department&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;department_params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; department&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;save
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# FILE: app/controllers/special/departments_controller.rb&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;module&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Special&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;DepartmentsController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ApplicationController&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Concerns&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;StrongParameters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Department&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;/span&gt;
        department &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Department&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;department_params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; department&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;save
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# FILE: app/controllers/employees_controller.rb&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EmployeesController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ApplicationController&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Concerns&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;StrongParameters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Employee&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;create&lt;/span&gt;&lt;/span&gt;
      employee &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; employee&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;employee_params&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; employee&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;save
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Summary&lt;/h2&gt;&lt;p&gt;We follow these practices at Hint, and it&amp;#x27;s helped us (and our clients) a lot. Does your organization need help wrangling strong parameters? We can help. Ping me on twitter: @benjaminwood.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[ActiveStorage & S3 Server-side Encryption]]></title><description><![CDATA[TIL, it is possible to use S3 server-side encryption and ActiveStorage. This  commit to Rails  in 2017 adds the ability but did not add…]]></description><link>https://hint.io/blog/activestorage-s3-sse</link><guid isPermaLink="false">https://hint.io/blog/activestorage-s3-sse</guid><dc:creator><![CDATA[nateVick]]></dc:creator><pubDate>Thu, 26 Mar 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;TIL, it is possible to use S3 server-side encryption and ActiveStorage.&lt;/p&gt;&lt;p&gt;This &lt;a href=&quot;https://github.com/rails/rails/commit/32331b19e1da8bdab3c9f6d1666ac2d3108e5042&quot;&gt;commit to Rails&lt;/a&gt; in 2017 adds the ability but did not add documentation or an example of how to use the &lt;code&gt;upload_options&lt;/code&gt; feature. Below is a vanilla S3 service config for ActiveStorage.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;amazon&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; S3
  &lt;span class=&quot;token key atrule&quot;&gt;access_key_id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ACCESS_KEY_ID
  &lt;span class=&quot;token key atrule&quot;&gt;secret_access_key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; SECRET_ACCESS_KEY
  &lt;span class=&quot;token key atrule&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; us&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;east&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;bucket&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; BUCKET&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here is a S3 service config using &lt;code&gt;upload&lt;/code&gt;:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;amazon&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; S3
  &lt;span class=&quot;token key atrule&quot;&gt;access_key_id&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ACCESS_KEY_ID
  &lt;span class=&quot;token key atrule&quot;&gt;secret_access_key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; SECRET_ACCESS_KEY
  &lt;span class=&quot;token key atrule&quot;&gt;region&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; us&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;east&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;bucket&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; BUCKET
  &lt;span class=&quot;token key atrule&quot;&gt;upload&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;server_side_encryption&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;aws:kms&amp;#x27;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# &amp;#x27;AES256&amp;#x27;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;upload&lt;/code&gt; hash is passed to &lt;code&gt;Aws::S3::Client#put_object(params = {})&lt;/code&gt;. One of the configuration options for &lt;code&gt;put_object&lt;/code&gt; is &lt;code&gt;:server_side_encryption (String)&lt;/code&gt;. For more options checkout the &lt;a href=&quot;https://docs.aws.amazon.com/sdk-for-ruby/v3/api/Aws/S3/Client.html#put_object-instance_method&quot;&gt;Ruby SDK docs&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;💡If you are using KMS keys, the bucket user will need the following policies:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;(&lt;span class=&quot;token string&quot;&gt;&amp;quot;kms:Decrypt&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token string&quot;&gt;&amp;quot;kms:Encrypt&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token string&quot;&gt;&amp;quot;kms:GenerateDataKey&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token string&quot;&gt;&amp;quot;kms:ReEncryptTo&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token string&quot;&gt;&amp;quot;kms:DescribeKey&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token string&quot;&gt;&amp;quot;kms:ReEncryptFrom&amp;quot;&lt;/span&gt;)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To help other Rails devs, here is a &lt;a href=&quot;https://github.com/rails/rails/pull/38801&quot;&gt;PR to Rails&lt;/a&gt; to add the above example to the official guides.&lt;/p&gt;&lt;p&gt;Have a great day!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Rails Development with Docker]]></title><description><![CDATA[As a software consultancy, we switch between many projects throughout the year. A critical factor in delivering value is the ease at which…]]></description><link>https://hint.io/blog/rails-development-with-docker</link><guid isPermaLink="false">https://hint.io/blog/rails-development-with-docker</guid><dc:creator><![CDATA[nateVick]]></dc:creator><pubDate>Tue, 17 Dec 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;As a software consultancy, we switch between many projects throughout the year. A critical factor in delivering value is the ease at which we are able to move between projects.&lt;/p&gt;&lt;p&gt;Over the years, we have used many tools to manage dependencies needed to run and develop our clients&amp;#x27; projects. The problem with most tools has been the ability to have consistent, reproducible development environments across our team. About two years ago, we discovered that Docker was a viable option for building consistent development environments. Since then, we continue to iterate on our configuration as we learn new ways to handle the complexity of the projects while simplifying the setup process for our team.&lt;/p&gt;&lt;p&gt;In this guide, we will cover the basics of our Docker development environment for Rails.&lt;/p&gt;&lt;h2&gt;Getting started&lt;/h2&gt;&lt;p&gt;If you would like to follow along, &lt;a href=&quot;https://hub.docker.com/search/?type=edition&amp;amp;offering=community&quot;&gt;install Docker CE&lt;/a&gt; and create, &lt;a href=&quot;https://github.com/hintmedia/base-rails-app&quot;&gt;clone&lt;/a&gt;, or have a working Rails app.&lt;/p&gt;&lt;p&gt;We will be using a combination of Dockerfiles, Docker Compose, and bash scripts throughout this guide, so let&amp;#x27;s make a place for most of those files to live.
Start by creating a &lt;code&gt;docker&lt;/code&gt; folder in the root of the Rails project. Here we will store Dockerfiles and bash scripts to be referenced from the &lt;code&gt;docker-compose.yml&lt;/code&gt; file we will be creating later.&lt;/p&gt;&lt;p&gt;Inside the &lt;code&gt;docker&lt;/code&gt; folder, create another folder named &lt;code&gt;ruby&lt;/code&gt;. Inside the newly created &lt;code&gt;ruby&lt;/code&gt; folder, create a file named &lt;code&gt;Dockerfile&lt;/code&gt;. This file will contain commands to build a custom image for your Rails app.&lt;/p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:241px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:39.877300613496935%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAABP+AAAT/gEHlDmEAAAA8ElEQVQY043P20rDQBSF4bxJM+fjzkxmTGYSk1gbUQtWi6UiQgXf/yWkN161tvDffrBWYX1y4dbGzg8jtL0fJki99klBc7Giin3u53i/uvvaDh+b6fNteXi3sdPQ6Kr9v4KpmghHpGPSU+4Id5Q7puprKhDTuoouZBGin6eblweT25JoxMzFCsQM157LioGDsffzZPtuUUpETYlViRWi5zHmlnDDXaKQqHUcaqJAhEB0pdtG50RUdc4fMaaq2f3Um28Ycrdft9vHvHvu9uvwtBwPr241LkqJuT09mwggAhDViBssLZaABWBuj89PmT/8C29pVIifhxjyAAAAAElFTkSuQmCC&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;initial Docker directories&quot; title=&quot;initial Docker directories&quot; src=&quot;/static/6114a0bd4d92449898365d9fbf747ce0/2f862/initial-dirs.png&quot; srcSet=&quot;/static/6114a0bd4d92449898365d9fbf747ce0/222b7/initial-dirs.png 163w,/static/6114a0bd4d92449898365d9fbf747ce0/2f862/initial-dirs.png 241w&quot; sizes=&quot;(max-width: 241px) 100vw, 241px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;h2&gt;Hello Dockerfile&lt;/h2&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;  ARG &lt;span class=&quot;token assign-left variable&quot;&gt;RUBY_VERSION&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.6&lt;/span&gt;
  FROM ruby:&lt;span class=&quot;token variable&quot;&gt;$RUBY_VERSION&lt;/span&gt;
  ARG &lt;span class=&quot;token assign-left variable&quot;&gt;DEBIAN_FRONTEND&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;noninteractive&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In this block, we set the &lt;code&gt;RUBY_VERSION&lt;/code&gt; and &lt;code&gt;DEBIAN_FRONTEND&lt;/code&gt; build arguments and specify the docker image we will use as our base image.&lt;/p&gt;&lt;p&gt;The first &lt;code&gt;ARG&lt;/code&gt; sets a default value for &lt;code&gt;RUBY_VERSION&lt;/code&gt;, but passing in a value from the command line or a &lt;code&gt;docker-compose&lt;/code&gt; file will override it, as you&amp;#x27;ll see later in the guide. An &lt;code&gt;ARG&lt;/code&gt; defined before &lt;code&gt;FROM&lt;/code&gt; is only available for use in &lt;code&gt;FROM&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;&lt;code&gt;FROM&lt;/code&gt; in a &lt;code&gt;Dockerfile&lt;/code&gt; is the base image for building our image and the start of the build stage. In our case, we are using the official Ruby image from Docker Hub, defaulting to Ruby 2.6.&lt;/p&gt;&lt;p&gt;The next &lt;code&gt;ARG&lt;/code&gt; is used to set the build stage shell to &lt;code&gt;noninteractive&lt;/code&gt; mode, which is the general expectation during the build process. We don&amp;#x27;t want this environment variable to carry over to when we are using the images in our development environment, which is why we are using &lt;code&gt;ARG&lt;/code&gt; instead of &lt;code&gt;ENV&lt;/code&gt;.&lt;/p&gt;&lt;h3&gt;Base Software Install&lt;/h3&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;  ARG &lt;span class=&quot;token assign-left variable&quot;&gt;NODE_VERSION&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;
  RUN &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; -sL https://deb.nodesource.com/setup_&lt;span class=&quot;token variable&quot;&gt;$NODE_VERSION&lt;/span&gt;.x &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bash&lt;/span&gt; -
  RUN &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; -sS https://dl.yarnpkg.com/debian/pubkey.gpg &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; apt-key &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; - &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;deb https://dl.yarnpkg.com/debian/ stable main&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; /etc/apt/sources.list.d/yarn.list

  RUN &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; update &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; -y &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    build-essential &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    nodejs &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    locales &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    netcat &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;vim&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here we are setting up the necessary software and tools for running a modern Rails app. Like in the previous section, we are setting a default for our &lt;code&gt;NODE_VERSION&lt;/code&gt; build argument.&lt;/p&gt;&lt;p&gt;The next two &lt;code&gt;RUN&lt;/code&gt; lines set up the defined version of the node apt repository and the latest stable yarn apt repo. Since Webpacker started being officially supported in Rails 5.1, it is important we have a recent version of node and yarn available in the image we will be running Rails on.&lt;/p&gt;&lt;p&gt;The third &lt;code&gt;RUN&lt;/code&gt; will look familiar if you have used any Debian based OS. It updates the apt repositories, which is important since we just installed two new ones, and then it installs our base software and tools.&lt;/p&gt;&lt;p&gt;I want to point out &lt;code&gt;netcat&lt;/code&gt; and &lt;code&gt;sudo&lt;/code&gt; specifically. &lt;code&gt;netcat&lt;/code&gt; is a networking tool we will use to verify the other services are up when we are bringing up our Rails app through Docker Compose. We install &lt;code&gt;sudo&lt;/code&gt; since by default it is not installed on the Debian based Docker images, and we will be using a non-root user in our Docker image.&lt;/p&gt;&lt;h3&gt;Non-root User&lt;/h3&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;  ARG &lt;span class=&quot;token environment constant&quot;&gt;UID&lt;/span&gt;
  ENV &lt;span class=&quot;token environment constant&quot;&gt;UID&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$UID&lt;/span&gt;
  ARG GID
  ENV GID &lt;span class=&quot;token variable&quot;&gt;$GID&lt;/span&gt;
  ARG &lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;USER&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ruby
  ENV &lt;span class=&quot;token environment constant&quot;&gt;USER&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt;

  RUN &lt;span class=&quot;token function&quot;&gt;groupadd&lt;/span&gt; -g &lt;span class=&quot;token variable&quot;&gt;$GID&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;useradd&lt;/span&gt; -u &lt;span class=&quot;token environment constant&quot;&gt;$UID&lt;/span&gt; -g &lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt; -m &lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;usermod&lt;/span&gt; -p &lt;span class=&quot;token string&quot;&gt;&amp;quot;*&amp;quot;&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;usermod&lt;/span&gt; -aG &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
      &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt; ALL=NOPASSWD: ALL&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; /etc/sudoers.d/50-&lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Docker containers generally use the root user, which is not inherently bad, but is problematic for file permissions in a development environment. Our solution for this is to create a non-root user and pass in our &lt;code&gt;UID&lt;/code&gt;, &lt;code&gt;GID&lt;/code&gt;, and username as build arguments.&lt;/p&gt;&lt;p&gt;If we pass in our &lt;code&gt;UID&lt;/code&gt; and &lt;code&gt;GID&lt;/code&gt;, all files created or modified by the user in the container will share the same permissions as our user on the host machine.&lt;/p&gt;&lt;p&gt;You will notice here that we use the build arguments to set the environment variable (via &lt;code&gt;ENV&lt;/code&gt;) since we will also want these variables available when we bring up the container.&lt;/p&gt;&lt;p&gt;In the &lt;code&gt;RUN&lt;/code&gt; instruction we add a standard Linux user/group and then we add the new user to the &lt;code&gt;sudoers&lt;/code&gt; file with no password. This gives us all the benefits of running as root while keeping file permissions correct.&lt;/p&gt;&lt;h3&gt;Ruby, RubyGems, and Bundler Defaults&lt;/h3&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;  ENV &lt;span class=&quot;token environment constant&quot;&gt;LANG&lt;/span&gt; C.UTF-8

  ENV BUNDLE_PATH /gems
  ENV BUNDLE_HOME /gems

  ARG &lt;span class=&quot;token assign-left variable&quot;&gt;BUNDLE_JOBS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;
  ENV BUNDLE_JOBS &lt;span class=&quot;token variable&quot;&gt;$BUNDLE_JOBS&lt;/span&gt;
  ARG &lt;span class=&quot;token assign-left variable&quot;&gt;BUNDLE_RETRY&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;
  ENV BUNDLE_RETRY &lt;span class=&quot;token variable&quot;&gt;$BUNDLE_RETRY&lt;/span&gt;

  ENV GEM_HOME /gems
  ENV GEM_PATH /gems

  ENV &lt;span class=&quot;token environment constant&quot;&gt;PATH&lt;/span&gt; /gems/bin:&lt;span class=&quot;token environment constant&quot;&gt;$PATH&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Explicitly setting the &lt;code&gt;LANG&lt;/code&gt; environment variable specifies the fallback locale setting for the image. &lt;code&gt;UTF-8&lt;/code&gt; is a sane fallback and is what locale defaults to when it&amp;#x27;s working properly.&lt;/p&gt;&lt;p&gt;We will be using a &lt;code&gt;volume&lt;/code&gt; with Compose, so we need to point RubyGems and Bundler to where that &lt;code&gt;volume&lt;/code&gt; will mount in the file system. We also set the gem executables in the path and set some defaults for Bundler, which are configurable via build arguments.&lt;/p&gt;&lt;h4&gt;Optional Software Install&lt;/h4&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;  &lt;span class=&quot;token comment&quot;&gt;#-----------------&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# Postgres Client:&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;#-----------------&lt;/span&gt;
  ARG &lt;span class=&quot;token assign-left variable&quot;&gt;INSTALL_PG_CLIENT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;false

  RUN &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token variable&quot;&gt;$INSTALL_PG_CLIENT&lt;/span&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; -y postgresql-client &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Here is an example of how to set up optional software installs in the Dockerfile. In this scenario, &lt;code&gt;postgresql-client&lt;/code&gt; will not be installed by default, but will be installed if we pass a build argument set to true (&lt;code&gt;INSTALL_PG_CLIENT=true&lt;/code&gt;).&lt;/p&gt;&lt;h3&gt;Dockerfile Final Touches&lt;/h3&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;  RUN &lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token variable&quot;&gt;$GEM_HOME&lt;/span&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;chown&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token variable&quot;&gt;$GEM_HOME&lt;/span&gt;&amp;quot;&lt;/span&gt;
  RUN &lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p /app &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;chown&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt; /app

  WORKDIR /app

  RUN &lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p node_modules &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;chown&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt; node_modules
  RUN &lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p public/packs &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;chown&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt; public/packs
  RUN &lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p tmp/cache &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;chown&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt; tmp/cache

  &lt;span class=&quot;token environment constant&quot;&gt;USER&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$USER&lt;/span&gt;

  RUN gem &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; bundler&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To wrap up the &lt;code&gt;Dockerfile&lt;/code&gt;, we create and set permissions on needed directories that were referenced previously in the file or that we will be setting up as volumes with Docker Compose.&lt;/p&gt;&lt;p&gt;We call &lt;code&gt;USER $USER&lt;/code&gt; here at the end of the file, which will set the user for the image when you boot it as a container.&lt;/p&gt;&lt;p&gt;The last &lt;code&gt;RUN&lt;/code&gt; command installs Bundler, which may not be required depending on the version of Ruby.&lt;/p&gt;&lt;p&gt;Next, we&amp;#x27;ll take a look at our &lt;code&gt;docker-compose.yml&lt;/code&gt; file.&lt;/p&gt;&lt;h2&gt;Docker Compose&lt;/h2&gt;&lt;p&gt;Docker&amp;#x27;s definition of Compose is a great place to start.&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application&amp;#x27;s services. Then, with a single command, you create and start all the services from your configuration.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;That is what we are going to be doing in this section of the guide, adding support for a multi-container Docker application.&lt;/p&gt;&lt;p&gt;The first thing we will need is a &lt;code&gt;docker-compose.yml&lt;/code&gt; file at the root of the Rails app. If you would like to copy and paste the following YAML into a &lt;code&gt;docker-compose.yml&lt;/code&gt; file, I&amp;#x27;ll breakdown its parts below.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;  &lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;3.7&amp;#x27;&lt;/span&gt;

  &lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;rails&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./docker/ruby
        &lt;span class=&quot;token key atrule&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; RUBY_VERSION=2.6
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; BUNDLE_JOBS=15
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; BUNDLE_RETRY=2
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; NODE_VERSION=12
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; INSTALL_PG_CLIENT=true
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; UID=500
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; GID=500
      &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; DATABASE_USER=postgres
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; DATABASE_HOST=postgres
      &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; bundle exec rails server &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;p 3000 &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;b &amp;#x27;0.0.0.0&amp;#x27;
      &lt;span class=&quot;token key atrule&quot;&gt;entrypoint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; docker/ruby/entrypoint.sh
      &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; .&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/app&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;cached
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; gems&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/gems
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; node_modules&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/app/node_modules
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; packs&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/app/public/packs
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; rails_cache&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/app/tmp/cache
      &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;3000:3000&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ruby
      &lt;span class=&quot;token key atrule&quot;&gt;tty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;stdin_open&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; postgres
    &lt;span class=&quot;token key atrule&quot;&gt;postgres&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; postgres&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; POSTGRES_HOST_AUTH_METHOD=trust
      &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; postgres&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/var/lib/postgresql/data

  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;gems&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;postgres&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;node_modules&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;packs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    rails_cache&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In this file, we are defining two services: the &lt;code&gt;rails&lt;/code&gt; service, which our Rails app will run in, and the &lt;code&gt;postgres&lt;/code&gt; service, which will accommodate PostgreSQL. The names for these services are arbitrary and could easily be &lt;code&gt;foo&lt;/code&gt; and &lt;code&gt;bar&lt;/code&gt;, but since the service names are used for building, starting, stopping, and networking, I would recommend naming them close to the actual service they are running.&lt;/p&gt;&lt;p&gt;We also are setting our Compose file compatibility to &lt;code&gt;version: &amp;#x27;3.7&amp;#x27;&lt;/code&gt; which is the latest at the time of this writing.&lt;/p&gt;&lt;h3&gt;The App Service Broken Down&lt;/h3&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;  &lt;span class=&quot;token key atrule&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;3.7&amp;#x27;&lt;/span&gt;

  &lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;rails&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ./docker/ruby
        &lt;span class=&quot;token key atrule&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; RUBY_VERSION=2.6
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; BUNDLE_JOBS=15
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; BUNDLE_RETRY=2
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; NODE_VERSION=12
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; INSTALL_PG_CLIENT=true
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; UID=500
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; GID=500&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The first part of the &lt;code&gt;rails&lt;/code&gt; service is to set up to build the image from the &lt;code&gt;Dockerfile&lt;/code&gt; we created earlier. Once built, it uses the local image from that point forward. We set the &lt;code&gt;context&lt;/code&gt;, which is the directory path where our &lt;code&gt;Dockerfile&lt;/code&gt; is stored. The &lt;code&gt;args:&lt;/code&gt; key specifies the build arguments we set up in the &lt;code&gt;Dockerfile&lt;/code&gt; earlier in the guide. Notice that we are overriding some of our earlier defaults here.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;  &lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;rails&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      . . .
      &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; DATABASE_USER=postgres
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; DATABASE_HOST=postgres
      &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; bundle exec rails server &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;p 3000 &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;b &amp;#x27;0.0.0.0&amp;#x27;
      &lt;span class=&quot;token key atrule&quot;&gt;entrypoint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; docker/ruby/entrypoint.sh
      &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; .&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/app&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;cached
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; gems&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/gems
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; node_modules&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/app/node_modules
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; packs&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/app/public/packs
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; rails_cache&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/app/tmp/cache
      &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;3000:3000&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In the next part, we set up &lt;code&gt;environment&lt;/code&gt; variables for connecting to the &lt;code&gt;postgres&lt;/code&gt; service, which will require updating your &lt;code&gt;database.yml&lt;/code&gt;&lt;a href=&quot;https://gist.github.com/nvick/c4e80964c7a7990b3bf4387de2f2b5b6&quot;&gt;example&lt;/a&gt; file to take advantage of these variables.&lt;/p&gt;&lt;p&gt;We also set the default &lt;code&gt;command&lt;/code&gt; that will run when &lt;code&gt;docker-compose up&lt;/code&gt; runs, which in this case starts the Rails server on port 3000 and binds it to all IP addresses.&lt;/p&gt;&lt;p&gt;Next, we point to our &lt;code&gt;entrypoint&lt;/code&gt; script, which we&amp;#x27;ll revisit after breaking down the rest of the Compose file.&lt;/p&gt;&lt;p&gt;After the &lt;code&gt;entrypoint&lt;/code&gt;, we set up &lt;code&gt;volumes&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;The first volume mounts the current directory (&lt;code&gt;.&lt;/code&gt;) to &lt;code&gt;/app&lt;/code&gt; in the container. The mapping for this one is &lt;code&gt;HOST:CONTAINER&lt;/code&gt;. If you are on Mac, I would recommend using &lt;code&gt;.:/app:cached&lt;/code&gt; since file sharing on Docker for Mac is CPU bound. By setting &lt;code&gt;:cached&lt;/code&gt; on the mount point it allows files to be out of sync with the host being authoritative. &lt;a href=&quot;https://docs.docker.com/docker-for-mac/osxfs-caching/&quot;&gt;Here are more details&lt;/a&gt; about file sharing performance on Docker for Mac. In our testing &lt;code&gt;:cached&lt;/code&gt; has been the best option for speed vs. tradeoffs.&lt;/p&gt;&lt;p&gt;The next volumes are named volumes. Creating them happens when we bring up the containers for the first time and then they are persistent from up and down. These volumes are native to the Docker environment, so they operate at native speeds. The persistence and speed are why we have chosen to use them for &lt;code&gt;gem&lt;/code&gt;, &lt;code&gt;node_modules&lt;/code&gt;, &lt;code&gt;packs&lt;/code&gt;, and &lt;code&gt;rails_cache&lt;/code&gt; storage; otherwise, we would have to reinstall both every time we bring our environment back up. Lastly, there is a top-level &lt;code&gt;volumes&lt;/code&gt; key at the very bottom of the &lt;code&gt;docker-compose.yml&lt;/code&gt; file, which is where they are defined.&lt;/p&gt;&lt;p&gt;The last key in this section is &lt;code&gt;ports&lt;/code&gt;. Ports &lt;strong&gt;only&lt;/strong&gt; need to be defined to access the containers from the host otherwise container to container communication happens on the internal Docker network generally using service names.&lt;/p&gt;&lt;p&gt;The mapping &lt;code&gt;&amp;quot;3000:3000&amp;quot;&lt;/code&gt; allows us to connect to the Rails server at &lt;code&gt;[localhost:3000](http://localhost:3000)&lt;/code&gt;. The mapping is &lt;code&gt;HOST:CONTAINER&lt;/code&gt; just like the volume mount, and it is recommended to pass them in as strings because YAML parses numbers in &lt;code&gt;xx:yy&lt;/code&gt; as base-60.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;  &lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;rails&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      . . .
      &lt;span class=&quot;token key atrule&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ruby
      &lt;span class=&quot;token key atrule&quot;&gt;tty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;stdin_open&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; postgres&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This last section explicitly sets the &lt;code&gt;user&lt;/code&gt; to &lt;code&gt;ruby&lt;/code&gt;, which was set up in our &lt;code&gt;Dockerfile&lt;/code&gt; above.&lt;/p&gt;&lt;p&gt;Use the next two keys: &lt;code&gt;tty&lt;/code&gt; and &lt;code&gt;stdin_open&lt;/code&gt;, for debugging with &lt;code&gt;binding.pry&lt;/code&gt; while hitting the Rails server. &lt;a href=&quot;https://gist.github.com/nvick/b4458670f9395de7d19a8e2d06894d9b&quot;&gt;Check out this gist&lt;/a&gt; for more info.&lt;/p&gt;&lt;p&gt;One thing to call out from that gist is to use &lt;strong&gt;ctrl-p + ctrl-q&lt;/strong&gt; to detach from the Docker container and leave it in a running state. The &lt;code&gt;depends_on&lt;/code&gt; key is used to declare other containers that are required to start with the service. Currently, it is only dependent on &lt;code&gt;postgres&lt;/code&gt;. No other health checks or validations are run; we will handle those in the &lt;code&gt;entrypoint&lt;/code&gt;.&lt;/p&gt;&lt;h3&gt;The Postgres Service&lt;/h3&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;  &lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;rails&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      . . .
    &lt;span class=&quot;token key atrule&quot;&gt;postgres&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; postgres&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; POSTGRES_HOST_AUTH_METHOD=trust
      &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; postgres&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/var/lib/postgresql/data&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We define our &lt;code&gt;postgres&lt;/code&gt; service next with pretty minimal configuration compared to what we went through for the &lt;code&gt;rails&lt;/code&gt; service.&lt;/p&gt;&lt;p&gt;The first key, &lt;code&gt;image&lt;/code&gt;, will check locally first, then download the official postgres image from Docker Hub with a matching tag if needed. In this case, it will pull in &lt;code&gt;11.5&lt;/code&gt;. I chose 11 for this example because that is now the default on Heroku, but there are lots of image options available on Docker Hub.&lt;/p&gt;&lt;p&gt;We are using a named volume here as well for our &lt;code&gt;postgres&lt;/code&gt; data.&lt;/p&gt;&lt;p&gt;And, that wraps up the Compose file.&lt;/p&gt;&lt;h2&gt;Enter The Entrypoint&lt;/h2&gt;&lt;p&gt;There are a few requirements for starting a Rails server, e.g., the database running and accepting connections. We use the entrypoint, which is a bash script, to fulfill those requirements. Looking back at the compose file we should create this bash script at &lt;code&gt;docker/ruby/entrypoint.sh&lt;/code&gt; and make it executable.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;  &lt;span class=&quot;token comment&quot;&gt;#! /bin/bash&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; -e

  &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${APP_PATH&lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt;&amp;quot;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;app&amp;quot;}&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${APP_TEMP_PATH&lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt;&amp;quot;$APP_PATH&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;tmp&amp;quot;}&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${APP_SETUP_LOCK&lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt;&amp;quot;$APP_TEMP_PATH&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;setup.lock&amp;quot;}&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${APP_SETUP_WAIT&lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt;&amp;quot;5&amp;quot;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# 1: Define the functions to lock and unlock our app container&amp;#x27;s setup&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# processes:&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function-name function&quot;&gt;lock_setup&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; -p &lt;span class=&quot;token variable&quot;&gt;$APP_TEMP_PATH&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;touch&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$APP_SETUP_LOCK&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function-name function&quot;&gt;unlock_setup&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; -rf &lt;span class=&quot;token variable&quot;&gt;$APP_SETUP_LOCK&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function-name function&quot;&gt;wait_setup&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;Waiting for app setup to finish...&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$APP_SETUP_WAIT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# 2: &amp;#x27;Unlock&amp;#x27; the setup process if the script exits prematurely:&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;trap&lt;/span&gt; unlock_setup HUP INT QUIT KILL &lt;span class=&quot;token environment constant&quot;&gt;TERM&lt;/span&gt; EXIT

  &lt;span class=&quot;token comment&quot;&gt;# 3: Wait for postgres to come up&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;DB is not ready, sleeping...&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;until&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;nc&lt;/span&gt; -vz postgres &lt;span class=&quot;token number&quot;&gt;5432&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;gt;&lt;/span&gt;/dev/null&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;DB is ready, starting Rails.&amp;quot;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# 4: Specify a default command, in case it wasn&amp;#x27;t issued:&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; -z &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token variable&quot;&gt;$1&lt;/span&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; -- bundle &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; rails server -p &lt;span class=&quot;token number&quot;&gt;3000&lt;/span&gt; -b &lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt;.0.0 &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token variable&quot;&gt;$@&lt;/span&gt;&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;# 5: Run the checks only if the app code is executed:&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token variable&quot;&gt;$3&lt;/span&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;rails&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# Clean up any orphaned lock file&lt;/span&gt;
    unlock_setup
    &lt;span class=&quot;token comment&quot;&gt;# 6: Wait until the setup &amp;#x27;lock&amp;#x27; file no longer exists:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; -f &lt;span class=&quot;token variable&quot;&gt;$APP_SETUP_LOCK&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; wait_setup&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;# 7: &amp;#x27;Lock&amp;#x27; the setup process, to prevent a race condition when the&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# project&amp;#x27;s app containers will try to install gems and set up the&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# database concurrently:&lt;/span&gt;
    lock_setup
    &lt;span class=&quot;token comment&quot;&gt;# 8: Check if dependencies need to be installed and install them&lt;/span&gt;
    bundle &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# 9: Run migrations or set up the database if it doesn&amp;#x27;t exist&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# Rails &amp;gt;= 6&lt;/span&gt;
    bundle &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; rails db:prepare
    &lt;span class=&quot;token comment&quot;&gt;# Rails &amp;lt; 6&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# bundle exec rake db:migrate 2&amp;gt;/dev/null || bundle exec rake db:setup&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;# 10: &amp;#x27;Unlock&amp;#x27; the setup process:&lt;/span&gt;
    unlock_setup

    &lt;span class=&quot;token comment&quot;&gt;# 11: If the command to execute is &amp;#x27;rails server&amp;#x27;, then we must remove any&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# pid file present. Suddenly killing and removing app containers might leave&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# this file, and prevent rails from starting-up if present:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token variable&quot;&gt;$4&lt;/span&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;s&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token variable&quot;&gt;$4&lt;/span&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;server&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; -rf /app/tmp/pids/server.pid&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# 12: Replace the shell with the given command:&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token variable&quot;&gt;$@&lt;/span&gt;&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I will only call out a few things specific to working with Rails from this file. Below, we are using &lt;code&gt;nc&lt;/code&gt;(&lt;a href=&quot;https://www.digitalocean.com/community/tutorials/how-to-use-netcat-to-establish-and-test-tcp-and-udp-connections-on-a-vps#how-to-use-netcat-for-port-scanning&quot;&gt;netcat&lt;/a&gt;) to verify that &lt;code&gt;postgres&lt;/code&gt; is up before running any database commands. &lt;code&gt;nc&lt;/code&gt; doesn&amp;#x27;t just ping the server; it is checking that the service is responding on a specific port. This check runs every second until it boots. &lt;strong&gt;Note:&lt;/strong&gt; We are using the service name &lt;code&gt;postgres&lt;/code&gt; to connect to the container.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;  &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;DB is not ready, sleeping...&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;until&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;nc&lt;/span&gt; -vz postgres &lt;span class=&quot;token number&quot;&gt;5432&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;gt;&lt;/span&gt;/dev/null&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;DB is ready, starting Rails.&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Next, we run our bundle and yarn install commands to make sure we have the latest dependencies. Once both of those have run, we will use the new Rails 6 &lt;code&gt;db:prepare&lt;/code&gt; method to either set up the database or run migrations. This can be handled in many different ways but my preference is to use Rails tools. (Note: the comment is how you would do it on Rails 5 or older)&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;  bundle &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;yarn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# Rails &amp;gt;= 6&lt;/span&gt;
    bundle &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; rails db:prepare
    &lt;span class=&quot;token comment&quot;&gt;# Rails &amp;lt; 6&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# bundle exec rake db:migrate 2&amp;gt;/dev/null || bundle exec rake db:setup&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Lastly, we check for any dangling PID files left from killing and removing the app containers. If the PID files are left our &lt;code&gt;rails server&lt;/code&gt; command will fail.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token variable&quot;&gt;$4&lt;/span&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;s&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;&lt;span class=&quot;token variable&quot;&gt;$4&lt;/span&gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;server&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; -rf /app/tmp/pids/server.pid&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Start It Up&lt;/h2&gt;&lt;p&gt;With all of this in place, we run &lt;code&gt;docker-compose up&lt;/code&gt;, which will build and start our containers. It is also a great time to get coffee because building the app container will take some time. Once everything is built and up, point your browser at &lt;a href=&quot;http://localhost:3000&quot;&gt;localhost:3000&lt;/a&gt; and your homepage, or if this is a new app, it will display the default Rails homepage. If you need to run specs or any other Rails command, running &lt;code&gt;docker-compose exec app bash&lt;/code&gt; in a separate terminal will launch a Bash session on the running app container.&lt;/p&gt;&lt;h2&gt;Wrapping Up&lt;/h2&gt;&lt;p&gt;We now have a base-level Rails Docker development environment. &lt;a href=&quot;https://gist.github.com/nvick/96c22b18b6cb31fa458fafba32fa000f&quot;&gt;Here is a gist&lt;/a&gt; of all the three files referenced in this guide. Now that you have an understanding of how to set up a Docker development environment, check out &lt;a href=&quot;https://github.com/hintmedia/railsdock&quot;&gt;Railsdock&lt;/a&gt;! It is a CLI tool we are working on that will generate most of this config for you. PR&amp;#x27;s appreciated!&lt;/p&gt;&lt;p&gt;In the next part of the series, we will set up more services and use Compose features to share config between similar services.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Case Study: Mon Ami]]></title><description><![CDATA[Executive Summary Silicon Valley startup  Mon Ami  engaged Hint to build a two-sided marketplace where seniors can book time with visitors…]]></description><link>https://hint.io/blog/monami-case-study</link><guid isPermaLink="false">https://hint.io/blog/monami-case-study</guid><dc:creator><![CDATA[benWood]]></dc:creator><pubDate>Fri, 06 Dec 2019 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;Executive Summary&lt;/h2&gt;&lt;p&gt;Silicon Valley startup &lt;a href=&quot;https://www.monami.io&quot;&gt;Mon Ami&lt;/a&gt; engaged Hint to build a two-sided marketplace where seniors can book time with visitors for meaningful socialization, activity, and task-based care. Visitors can earn flexible income and engage with their community while seniors can get out of the house, start a new project, or get a helping hand.&lt;/p&gt;&lt;h3&gt;Challenges&lt;/h3&gt;&lt;p&gt;As many early-stage startups do, Mon Ami started with limited technology to support day to day operations. When the company began to grow, co-founders Joy Zhang, Madeline Dangerfield-Cha, and Steve Fram knew that it was time to build a technology platform that would support the business for years to come.&lt;/p&gt;&lt;p&gt;One of the core functions that Mon Ami serves is to match seniors with visitors, based on criteria like interests, schedule, and location. The process of matching a new customer to an available visitor was measured in days and required a lot of hands-on intervention.&lt;/p&gt;&lt;p&gt;Visitors are often college students who have unusual work schedules, and they expect well-designed technology to do the footwork for them. On the other end of the marketplace, customers are often family members of the actual person being visited. Family members want to stay informed about how their loved one is fairing, as well as pictures of the visit so they can take part in the joy.&lt;/p&gt;&lt;h2&gt;How we helped&lt;/h2&gt;&lt;p&gt;Mon Ami partnered with Hint to build a technology platform that would allow the business to scale while also remaining flexible to change. Using best-in-class technologies, Hint delivered web and mobile applications that have transformed day-to-day business operations, delighted customers, and provided visitors with the tools they need to be successful.&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&amp;quot;We hoped a firm would understand our challenges and take a step back in helping us solve them- not just execute our vision but collaborate with us on the dream of it. Hint was such a phenomenal partner in that.&amp;quot;&lt;/p&gt;&lt;p&gt;- Madeline Dangerfield-Cha&lt;/p&gt;&lt;/blockquote&gt;&lt;h3&gt;Command Center&lt;/h3&gt;&lt;p&gt;The foundation of the platform was built using Ruby on Rails, React JS, PostgreSQL, and GraphQL. The application features an extensive admin interface called the “Command Center”. This interface allows Mon Ami staff to onboard new customers, facilitate the visitor matching process, manage visits, customer invoices, visitor payouts, and much more. The Command Center integrates with Mon Ami&amp;#x27;s Slack, allowing team members not only to stay informed with regards to the happenings of the business but also take action on certain notifications where time is critical.&lt;/p&gt;&lt;div class=&quot;row no-gutters&quot;&gt;&lt;div class=&quot;col-6&quot;&gt;  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:70.5521472392638%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0UlEQVQ4y41T22rcQAzd//+DNi+FfEXfSmjZkL4FEjtrs7Dr225ZWs/F9lx9iuS1E4gDEcjSaOQzOtLMBgCqosDt7Tfc/fyFLMuQJCnS9AVpmrK/ps9Jgt1uh4eH3/jy9QZPT88EhQ19mrrG/fYH0uQRx+MRL/keuyzHfr/H4XD4UCk3z3Nst/fIsvwVsO97vBXvPfphgLUOnxWtNUIIE6BSGr3+izEY3jTGcIwsJZHGcWRLh4UQEWNknyyt27ZlfzOj951C8JYBnXOcNPvOe4zjyABK62k/RijdcYz23gFSwNgJ0Dq3JJL1PrBPwJQzXqsdBsMgq4BzD+aq1vo30yQhkMniY0ACIhmMwb9WQEgFISWEkJDsT2vyh2HgHjtrEWNYpyyEoDPhQoS2Hr31XJHz/kr9VYmNCwHKBZgQIdYqpOszU/mMSA98/xOQqAglWh7UAkjVzUMh6l3XQetu6SsdxINxjvMoTn0ejIV1/n2FSsmlh8ZY/omovZ04UafJ0tSttdxbrRViWOkh0aXAPM24THFc7uR8pYjayC8qwF8ZEMMFUErJ77YoCpzPZ5RlhbIscTqdUFUVimLy67rGsSg4VjcNmubE8aZpcLlc+C3/B4EgOMaZ9qg0AAAAAElFTkSuQmCC&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;new customer&quot; title=&quot;new customer&quot; src=&quot;/static/e3ca1df1da645ef0d9c6f7c640e2250f/a6d36/new-customer.png&quot; srcSet=&quot;/static/e3ca1df1da645ef0d9c6f7c640e2250f/222b7/new-customer.png 163w,/static/e3ca1df1da645ef0d9c6f7c640e2250f/ff46a/new-customer.png 325w,/static/e3ca1df1da645ef0d9c6f7c640e2250f/a6d36/new-customer.png 650w,/static/e3ca1df1da645ef0d9c6f7c640e2250f/e548f/new-customer.png 975w,/static/e3ca1df1da645ef0d9c6f7c640e2250f/3c492/new-customer.png 1300w,/static/e3ca1df1da645ef0d9c6f7c640e2250f/b6d22/new-customer.png 2986w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;col-6&quot;&gt;  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:70.5521472392638%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAABp0lEQVQ4y4VT21LCMBD1//9AfXBG/8TxQfQZWzrAkHEsKFDaJC00t+PspmBRwMycdpvsnuzu2V4BwMf7Ox7u7/D49ITxeII0HTGSU0hSJGmKJEmQZRleXl9xfXOL4fCNqHBFjzzPMXh5xluSYjQi5yGmkzGEmELMfkHMMBOCIYTAKMvwPBhgMpn+EDZNg/3yVgNe0i6AGvBlZzdAUEAwB98QDia2TQPnXCRUSsEYA+scdL1Fs21hrIN1HtZ6DvQETwgIIcJ7zyBbSsn2gZDYacNai92uRU1Zc2AMADr00+Is4zcRHmVIH5wJpdGVY3kvBtC5687o7bqzs4TeOxhj8bUqsKkUl75cb7AuJaRuUJQSq6KE1DVKqfiM/HatOUPoHIy17EiBStdYrgq2K1Wj2FR8WSU1ykrhc7nGeiO5PRdKDrAkho3lcdOPBPgrxj89DHDOd2KcRl+MfwkJpG4UJqoaL3EHtG3LI0YXXySkcenPV9+mPpFgFEA/AZGSP7VmPxVHhFprXFquNz7n1r5KJqyqiv/nxWJxEnk+Z5A9n89P+hRFwZd+A/itOnWJF7PMAAAAAElFTkSuQmCC&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;opportunity&quot; title=&quot;opportunity&quot; src=&quot;/static/497921a0af0fb49aa865ec9c570aa93b/a6d36/opportunity.png&quot; srcSet=&quot;/static/497921a0af0fb49aa865ec9c570aa93b/222b7/opportunity.png 163w,/static/497921a0af0fb49aa865ec9c570aa93b/ff46a/opportunity.png 325w,/static/497921a0af0fb49aa865ec9c570aa93b/a6d36/opportunity.png 650w,/static/497921a0af0fb49aa865ec9c570aa93b/e548f/opportunity.png 975w,/static/497921a0af0fb49aa865ec9c570aa93b/3c492/opportunity.png 1300w,/static/497921a0af0fb49aa865ec9c570aa93b/b6d22/opportunity.png 2986w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;h3&gt;The customer portal&lt;/h3&gt;&lt;p&gt;Customers have a web-based portal where they can manage upcoming visits, review past visits, communicate with their visitors, as well as manage payment information.&lt;/p&gt;&lt;div class=&quot;row no-gutters&quot;&gt;&lt;div class=&quot;col-6&quot;&gt;  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:70.5521472392638%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACE0lEQVQ4y52T3WrbMBTH+3h7iMLYW+wBdr1d7wPGyMWu9gaDQWlLkjHG2qZRPmQnthNnSer4U7Zsyf9xZCdbS0phguOjcyT9+Evn+AQAFq6LTucjzs4vMJ5McTtkYIxhyBrP2AhsNG58mxsOGcbjCfr973j77j0Gg1tC4YQ+y+USvV4X49E1vPkYts0xnXLYtg1u2eCTAdjNJfjkBlNuwbIscN6sE7Tb7Zn4ABRCmEDrCrlIUdcadW1SIFcrAZWvAJXisUEMpVQDTJIEVVUhSQW2YYJdGCHNRGsZ8qJEUdYQ5KWELEtISfPG13WNOI6htW6AFNBwZhxfPrzBZrtBsAshpTR5f+Xhc6eD65+/kIkcRSHN4bKqkBfNHmIcFEZRZJLn377i5ekzrH3XxHvgZe8CL06fo3/WNTHdhlQppY8D6cpa10jiGBa7QprEEHmBqlJQWhtVd0GILJdGXd4a7TkK3F/Z91x8ev0KnDNoo0C1xdKQZXWA7EGPAhuFGkmawVtuEEbJ4SAposffxw/tSaD/e427YIcwik2VCbYNdvdUmflTQAqEyA2IWoHej6pIbbINwv8DZkKYdqEi/HuY4qNXbvM0qJD3gCaZ5fD8tVEURAniNEecCqSiMEWRlYIsWzPzCloprEtgGURUvb996Ps+XNeDZc8wmzuYOw4c123Mcc3aQ3NcD/5igR/chb3amH/5D5fBKDliuhE/AAAAAElFTkSuQmCC&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;customer request new visit&quot; title=&quot;customer request new visit&quot; src=&quot;/static/b8d9d2fd99e274355f1952f6a0555d15/a6d36/customer-request-visit.png&quot; srcSet=&quot;/static/b8d9d2fd99e274355f1952f6a0555d15/222b7/customer-request-visit.png 163w,/static/b8d9d2fd99e274355f1952f6a0555d15/ff46a/customer-request-visit.png 325w,/static/b8d9d2fd99e274355f1952f6a0555d15/a6d36/customer-request-visit.png 650w,/static/b8d9d2fd99e274355f1952f6a0555d15/e548f/customer-request-visit.png 975w,/static/b8d9d2fd99e274355f1952f6a0555d15/3c492/customer-request-visit.png 1300w,/static/b8d9d2fd99e274355f1952f6a0555d15/b6d22/customer-request-visit.png 2986w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;col-6&quot;&gt;  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:70.5521472392638%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAACaUlEQVQ4y4WT30sUURTH/WOCHnoN66HHHkQw6EU07SHFFMwgE0Ut6IcUURoSBv7+uQWWRgX1ZhBGavkirM7+mF1xa91tRdf9MbO7M3c+MXdX15W1DpyZOYd7P/M959xbAvA7EGB6epyvi99we7xsbCgoisKGoqC43CiKKx/n3F7jdntYWfnB4NAwTue6jaLEfgSDQZaXl3Apa2xtuvD5vHi8Kj5VweX8jupdR1X9+P1+VNWHT75VGdvQpaVlGR8CNU0jawIsk7wJRCoMQsc6yFgWxcxmmKaZBcZiMRl4tyKsrK7i9LhZ8wTY+rWJnjZJJDUSySSarqNpOqlUGsMwyGSyblmWZAgh8kDbZj/O0dBSS9eDZlp7bvHm/TApPUU4HCKl63KNvfmo25CjogqAQyO9VNZVcbXxGmWXSxmdekI8A9u7+8QzJim5t7DkfwLvP+7k9NlTVNRUc76sgvbOVpnXDZOMsDCEJYEH6v4LfNH/iNLSM1RVllN28RwTYy+zm0wzp6yw3BOB8XhcJhcXFng3NcXA8z6a6uv4MP/2sG8nmRBWcaCdXv+5iGNiiP5nT6mpqcXhcMjFSU2Tk80cTNYw8t8Zoxgwhv2jxMoMdzqvc/fGFRqqypl7PYkupxxGz51VW5F9FkWubFMIKaawh7ZCIXB9meVe923a2tuob2pk/tNntLRBZG8fLZ3BOHZkJNDM9jARLzKU2ZkRGi5doKO1hY7GamZeTWZLFpAGjBP6+CcNwd19W34WGI1G2YnsMDAxxsOum4z29dDb3cz42CB7e1HC29uEQyHpoWMeCYVYVQP4QxF5l/8CjSPzGSIxVMIAAAAASUVORK5CYII=&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;customer visit stories&quot; title=&quot;customer visit stories&quot; src=&quot;/static/c98044ca433e5349cf3cb8ff3db79897/a6d36/customer-visit-stories.png&quot; srcSet=&quot;/static/c98044ca433e5349cf3cb8ff3db79897/222b7/customer-visit-stories.png 163w,/static/c98044ca433e5349cf3cb8ff3db79897/ff46a/customer-visit-stories.png 325w,/static/c98044ca433e5349cf3cb8ff3db79897/a6d36/customer-visit-stories.png 650w,/static/c98044ca433e5349cf3cb8ff3db79897/e548f/customer-visit-stories.png 975w,/static/c98044ca433e5349cf3cb8ff3db79897/3c492/customer-visit-stories.png 1300w,/static/c98044ca433e5349cf3cb8ff3db79897/b6d22/customer-visit-stories.png 2986w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;h3&gt;A mobile app for visitors&lt;/h3&gt;&lt;p&gt;Visitors have a dedicated mobile application where they can manage their availability, browse opportunities, book new visits, submit photos, and more. Built with React, the app targets three platforms with a single codebase, including iOS, Android, and the web.&lt;/p&gt;&lt;div class=&quot;row no-gutters&quot;&gt;&lt;div class=&quot;col-3&quot;&gt;  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:300px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:216.5644171779141%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAYAAAB4pah1AAAACXBIWXMAAAsTAAALEwEAmpwYAAAHa0lEQVRIx6VW629cVxFfBbVSKwpCfOA/qPgAUoHmZccxauw0hcRxK2gTWyGOHTclNClNJWiiVqihCeRLQVChPFooAhEeSaFEhSqN48Z2nPXu3n3v+rG73rfXu+t9733vvT905t7dtV0HPnBWozlnZvZ3Z87MmXMsvLMTda4DjP8/1MSwNCeMr59/mravsVsPxrilLdhh/mEb8fa6qesA7+o2QbpMu9W2pocE6NgCcf77kMI/ghg6RXNxbgRi6GVIkVchBA9DnHueSIqchjg3aujDr0CcP2Z+YDUgW7h3Q/A9AyFwEIL/O+DdvRB8T5OMzXnvXvCuJwyd5ykIvv00Z5x52gq5Hf828rTu2Iw6t8UMpwPi7BHyUoqcoQ/U7V83t2KrYc9tXZuU9Vmus/0g3kl7w3v3QfB/1/TsSSMppr7+35JSc3QaxO1AjVvFHdtQs28xyLF9A71BvNP4kIVNmEILdAKzHdAD24lU7xaons0G9241qS1DsAMIdNB/Gr6OFqilznVC8XbA+tdOXD6/A5fPd+HKz3bi2qX9eP/y00TXL/W3iK2vXdyPi2924tL5Lrx7oQveGzuh+lh9dsKCYCeuvvUNfOWrj+MHJ0/jtZ9cwEunXsODD30RFstDsGz6LD7zwOex6YHPYdODX4DF8jAefuRLOHvuF3jjzbcw8vzLePTRL+PWe9spSovg6sJz+x/H3z/4N1aP118/g76+b+PggWcxOHAAAwefw+DAQfT17cW5c2fX2F68/Ae8cGgz9EAXLGV7N0YOPQnO6YOsNNBoNKDresuYFwTk83lUKhXwPN+SqyqzVVGuCfhkwoYfHuuF5OmGpWLvxpHB3Zixu8mQAWqaBlVVaV6pVlEoFFAsFlGtVknOiNkwPRtj49N4abQHsrcblqpzN0aGnoHN7iSlJElQFKUFyLxt+svmTKY2GmTDbNn45I4VJ47uMgArjm9iaHAPOKe35SEboXAYXq8PoVAIs7Oz8Hg8iMXiiEajSCQSa2wnpuw4OdoE5HZh+NBecE4PKTVmpOsQRZH2jHFRlCAIIs0FQYAkySag1gI8cfQJA7Dm2oPR4WfhcLhIWREU1CS26Roq1TqKpTIKxTKWszkUSxWUKzWUK1UkU0s0J8BJK1448i0I7l2wVLkeDH+vD07OA1HS4MrmEFmJIyMBkXAENjtHNDF5Fz5/EE6XB6HwIlLpDErlKgHembiH46P9EL272yE7OCPL/lwai1k7olVgJZtFNJ5EIplGMp1BeimLVHqZOPMuly9C01nIVhw/agI2Q7abIa/UVeREoFZOoZDPIZ5aRiyRRjyZRjqTQzy5ROvFaALL2ZV2yMN7IXh6WNn0YuRwf8tDWZbRUBUqXFlRoSgNKGqDEiHLCs0V0jWgyIoR8qQNL47sMgq7bN+JoYEeOilsiLJCxkSySqCSrFAtspxKpFehKiryvGx6aGuXDTt6QwO9BMhOnNPth9PtowxLsgpBlKFqQHw+iER4Hg0dyJd4ZPNleHM8REHF1JQNJzYEBAgsOBciIBYaK91keB4/H/gafvfjfixncrh94xquvHEcftsUeTh+x7rewx64PAHUanUEgnNYCEUwvxBGIpEkwGw0gMUPTiM7fgHLkRlcOX8UZwYeg23in8bRm9gA0OnyQ5RkcE430dxCCAKvYLmehacSx2/ci3jbPQe+4EPgYgq3X/Eh71XNs3yfPTSyrJpZVKE2dMp4kpfx6zjwdlLHUl7D0j8aSP4NyDkks7DXAw72wsEZzaFgHi9F1ah0GK+ydb0KaEYHYr+KVEa5XmmVzRrAI4O9sDuM5hCKxODxBY1WRnWnwT+7AP9sCJKikUzTWDeKI7wYN/dw5v4hszMaS6TA8yI1CBZ+PJFGMpUhcLYWBAkL4UXE4qmNPWwmhX3dOmOnZsCA2UinMySbnJpuyVjXmbE5YHdwVGpr+mEz5OYerhRLKJRLUBsaGpqOQrGEfL6AbDZPbYsVP0tWsVim1raxh4PtkBuqCrmmQ5J0KOwa0PQWCaKEWp0n4gWROP6Xh5m6ikJKhFIpQlQaEEUZoqQQRRZj1AujsQRxdggEUcTkXUf7TmGAhwd64HPNIqqu4FfxP+Oj/BhqfBaSrBFQ80xHognK7J0pKyLROO5a7ahUa5ia5tYCDg32wO0KoqTXMZYdw60VPzKCCFVWDUCT2FWQL5SwtJzDSrGMdCb76aRUzLKxc0Yd0uHV2GXFkqJB03Rouk589WDJacrW1GET8N6M0bGrbMPZ7SZKqPMiqjWeWhnj7AQxGSsv5jkvSOZFb10P2IMZh7f9dZOzlu/1BehyYuTx+qkWWYEL4n0AWcceObQHt8YmMH7zX7hx7Srujn0I683ryCRjYFcvaxSy2alZ82AeMmJRsHFr/F4bsDTThWPD+3D1T3/BUP9OnD1xAB+9cwHv/fRFeKY/pj8oimw8SegRpZsylWqRAG9Pt7NcsnXRnfrbd3+PU4f3wXv9lyjefAf+D/+I+YAL6aUMIpEIwuFI6y3TBG8+RT6+PY2T5mPpP/rZG3AQHPVYAAAAAElFTkSuQmCC&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;companion 1&quot; title=&quot;companion 1&quot; src=&quot;/static/f100b559a2efecc4bc062b79dc6d62fc/5a46d/companion-1.png&quot; srcSet=&quot;/static/f100b559a2efecc4bc062b79dc6d62fc/222b7/companion-1.png 163w,/static/f100b559a2efecc4bc062b79dc6d62fc/5a46d/companion-1.png 300w&quot; sizes=&quot;(max-width: 300px) 100vw, 300px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;col-3&quot;&gt;  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:300px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:216.5644171779141%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAYAAAB4pah1AAAACXBIWXMAAAsTAAALEwEAmpwYAAAHrElEQVRIx6WW6W9U5xXGR1RUaRW1aj/0T0D90FSqQqB4TcBmScNaNcQ2BPDYGBvMFrpAUUkgmKAWEoqSGANiU0Ld0hSKIQZjvK8z3jOA2fE6vrNv986d7Vfd9854Az71So/e+27nPc89zznvNfg7kgh0Jv/fSNgxJDqTMX1hYmz6+4vGDHonlUBnGv6OeeJdaxOY2JSYS7ynjM9P8dDfMRf5zvsoD7ajPNiJci8f5X4xwUe7Ras83IXy8AOU/iIxFnyyD+XuBpT+ApR7RpT+TSgPdsQPSHjY9RaB7kzkvpUEehYjW1aLQ+S+VQS6FyL3LiPQs4RA71J9brz/jj6m7UtQ1l80er/Gb54z0ZpfJ9CZhHJ/i/BO8162ZOM3/UpfIzBXh9g3TnlaEESbordd6Sj3NiJ/9ztky3sEehbFN+rz/vH1ydM9TMJnTtbRkYKvI95qfdNcfKY5Oszzps53JI/v09j4ddkkiYmoJRnuJhGzzBMI984h3POG3vbOjWNijDtJYEkSeyJ9SeNGDf6OZEK9SbT+M5mykhTKSlI5eSiNSyeW803ZSoF/n1gxDq1/qXQ5pR8nc6IkldOHU+m9mka4T5NTMgbuJHPx6Ov84rXZbN66m737DrNt516+/8pPMRhewTDjVb4388fMmPkjZsz8CQbDD/jhqz9j/8FP+ejjoxg37mDWrJ9z6+w8wdIgd6Wyevls/nPlWyY/+/btZdXK5WRlvUtO9ntkZ60mJydLjB0qOTBlbWnZBTatfYOYJRWD25SOce0izJ19BNUw4XBYLAqHQjidTnw+Hy6XG4/HI2C328V8NBolEg7j9snU1rezvSCTYE86Bo8pnQ05C2k3desL46fKahCXyyWMOBxOnC4XbrdbHBIIBIjFYkQiEbG2uqaFbfkZqL3pGLydCzGuX0VjUxtBuxdpYBSH1YZzcIyATyYgBwVkJQFV9P0BBa/PLwxWVTdRnLdAN+huTycvfwXXy8qpX2Kk88IRei5/TkVKDgNXm3R3ozFBMRyJEAqFCQZVlKBmWBHTt243Txj0mN/CmLuK2stXMJfuovrvRbSXbqX6QB6SuR2bx8PI8DDBYHBKIGIx/TsmDG7Jm68b9HUuomDTWqrLL3HNuIzKA1u4eXA7lzb9BmtzMyN2J4MDg0g2G3aHE4/Xi8Ppwu3xMCZJ8W/YRMGGt5F7FmhBmc/GzVlc/dsprizIofniF9TuL+Zk2myeVdRiDXgYs45hszsYGh7B5XYL2moohCzLcQ8bKcxbgdK7UKM8n7zcldz85hrmm7eprKzk+JZCNr82i+HODoYVB5JNEl5Jkm1cVjrtWNxgw4RBX9di8nPfpaGpFSJ+zC31XPzqAruKirF0d6FtsdnsjEk2Qdc6Jgm62pOQjebhptx3kHsyMHg7FmDMzaGp6hT0JhNoSSPQ8Evarx9j+OkIuNzEHC7QYHMQs0rEfH5x0ITBZjYb5+vCdptSWZe9mObGW+CvJGqvBGcFXqkfj9snoisrikBQQzhCOBLVZRSnX1XdzNb8BYR645myPjuDlvZepj8ut0dEVocDh8OBUwkRjOq6mezhhLBNaWzIyaSxyYTH7WRo4BljI0PYrMP4fH7k6ZkiKwQCSjxTArqHt3UPhUFXWyoFuUv5+utycn+bwQfrl3Hur3v4/I9rsJjq9WhqhSAaHc8WVQ0RVEPiMwgPa1omPHS1pVCYt5wzp89QnLOIpotHGK06i/m/5+n/rlNEd3R0dGqWxCWToFw1mbKzLYUtBSv59LMv+X32Eh7+o4SHXx2m5fxR+i1dSJKDUatV6FATt9frE5VHk5B22PMetqdSaFzK6fMX+eRPhXSX7uLBuUNcPbyNPnMDktvF8MiI2Dw4NCwyRYuuRltRXlAc3O2pGN9/m8pvr3On7gKVnxTR+cWfuXl8DyNPLIzKDqzSmCiymoeqqk7KlOjzlBMGb1RU8KDhLJeP7OBaSRFXj+1EemZBDYPD6cSu0fX5sFrH8Hi8L/+GQjZrFlFT04Bj6B5D97t41tfGI0sbLrsVNRwR4laUoF4HQ2FC04U9pR6OC7v7JcJ2CGh0HXZN2GHUqB7rFwpbGMzJpLm1U9Dwev1CvH6/PEnMcSiq8FSJj2lrnhO27mEmLW1dYtLmcIq7QsvX0KRSpVeXqB7doCro+wPy87LRDK7LzqC1Tad88vhnlJ8qwy/uixgOhx2r1YokSahqMH7FxF4eFGEwK4M2Uw+hUJAD24o4sW831sEBkRGPHz3h8ZOnDMSvAU3YWo5rkbbF7+jqF3nY1q5T/vLgfs4e/BDZ6xEX0eDIsKg2ks3OyKhViHtAE7jLLX4C9KC0TJZNuqg2dY0m6h+7KNz1EX/5wx76pDAuv8oz1wB2p2P8so/GC8XkZwplV3saG9ctpvxaHXvKGyk89i8+PHeD0/UPuTvkFL8bmmS01NPoaveKN+7ZS4VtXLOQGzXNdDwdpfX+AD0DdjoejWD3+olFQ+LbBoMy4bBKUFVEcKKRMOGQGq/YjRTnT/mGmbSa7j0nbKdbxeZUBCSngt0h4wxBIpsj8fZWbdfkP4c32ZCTQdPtM+BvwWetIWCr1SHVItsSqJvU1qHY6vCP1YDSRlXFibiw3+R/Bwnxt6CWL5AAAAAASUVORK5CYII=&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;companion 2&quot; title=&quot;companion 2&quot; src=&quot;/static/8bca40b8948f268be28dd84e682b2335/5a46d/companion-2.png&quot; srcSet=&quot;/static/8bca40b8948f268be28dd84e682b2335/222b7/companion-2.png 163w,/static/8bca40b8948f268be28dd84e682b2335/5a46d/companion-2.png 300w&quot; sizes=&quot;(max-width: 300px) 100vw, 300px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;col-3&quot;&gt;  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:300px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:216.5644171779141%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAYAAAB4pah1AAAACXBIWXMAAAsTAAALEwEAmpwYAAAGeElEQVRIx61W2W9UVRi/wWiicYnxwf/A+KBPAtoOpWoXXLAFdyhY6KIggmvcAjEuYDBGH3wBjErcNagYYzRSK5HuM9My0w3oQtvpTLe5M3c9d535mfPde4cpCvTBk/xyznfPd3/3+863nCto0VLovaH/BZxL8BYluBRxsM/nYt1imQhJ6CvHOeI7fJQUySX+iyVFRMEeJ1tV2BP4whx7Feb4HhhnnoE59grM8d1gQ3UwTjXCGHkexultYAOPwBh9ydM7vZ32zdGXYYy+SM/02Br6ALmsn6wE618PFn8AbHADjFPN0OP3g8VrwAYeButfB73vLk+HUAs9di/psv4HwQYeIg4iDFzRIiuhRW+HFlkBLbLcW5PsPw90CvIdvm7wzHd50cH7oDMpki8ErneBKJdCjYQ8RFf5CF0Cvo7/nt5bSh8R+IJv5AZDwHAp8oMlBCe+Ek5shY+VRVhBexgqBQZL6R23v7RAKmjREOx4Kbq+D+HQvlU4tK8MH7+7GkcO1uLHQ+sJPxxcVwCXjxyoxYF3Qji4rwyf7C9D/JfVcPp5LEIQMBTCNx/chltuXY5ndr2G3W/sx7Mv7MYVV94AQbgSwrKrcdnl12HZ5ddi2RXXQxCuwlXX3Ii39n6IN9/5AI1PPo+bbroZLYdLyEuB9ZXhsdrl+Onn31A89ux5HTU192PD449i48bHCHV1G1BTsxZ79761SPfAoS+wbfMK5AfLIEjhcjRurka0r582XddFPp8vKGuahkwmi3RapHUwHMeB6zqQVB3H/+7Bc09VwYyVQ5DD5dhaV42e8MkCYS6Xg+O6tFZVFZIkIZPNQpYVIuLgOnyfjz//6sCzzZWw4uUQlN5qNNY/iPbOMJAHVEWDzkxoOoOmG2CGBaMI/JnGDOjMgKJ4Fh9r7cDOpgqPUI7ciS11a9DZcxJwXKiTSejTMzCmZ2FNz8KcSsFMzHhzcg5mah7m9AzM5CzYZBJwc2g53oVdAaESrcDWzWsR7unzDierAaIKV5TBRAkGRzpLs8nXGdl7JkrQM5Lvcid2Nt3tEap992B74+P4pa0dR7QUvpwfw+GFcYwbKvJuHqbjwnIcWI4L07Zptl2OHMkeYTue2nof2MkKCFK0Ak/Xr8fh43+hfjaKJ8bb8fDYCcRMGXlmYnRsDJMTkxgdHcXZs2dhmqbnST6PXM4LSkvrCWxvWgcjXg1B9l3u7Ip6erkczVOJBBFwwjNnRjAyMoJEYhqpVAoTExOUWkGUFxFyl5sbHkV7R9hLG8fLQ54alm3Dth1Ylg3LsmCTbJPs6QSEbdjWsBYsVsnTpgqN9evQ0RnxLOT5x3NPVqCq2qKK0PLAgsqQyWSQFkXIsuwTdmBHw91eYkvh1ajfWImOrl7aNJgBk3JQBzNMWLYD0/KsMiyH8lJnDDrpsEIe7mqugB33K2XLxkp0h2O0aTl5cEe4N4Zpw7ScAnhiM2YSKYeqeYQtlDZ+HnILGzavQVtbF/p7O3F6oA+nY91ITo6RZbz0eMnxOubnGozioPzd1nOOMNtdhu1Ntfj6y6+x/4VNGP7xI7R8+h5afz+KtJhB/8AAhoaHMTx8CpIk8+osNJBzhGHsbC4ifLqpBoc//xZfvb0Ds0fexx8fvYFjv/7AUw2qLNNZmaYFlzcNnuCWvag5cMJdAaHUU4amJ+5FS2srWj97E93v78TRd3fgxO/fgddBX9rAQlpEanYOM3PzmJtPUycKOtO/CcOrqX1FwmFoyQEMtR7FeM8xqAsTsN08FpjtR1SnNFJUjSy9CCGPchUivX6DxdLG+Wd4noVV1GAVRUEyNQNRFJHlTTWThZjJQlYUzM0v0Dro5hchLMeWuipEonHa5O4xv4HyQJh+yRmGQeUXkC3JQl4VmawMWdEgKSoRW/a5OqYPmNalLeSE4UiMXspmJSiKCkVVkclKJEuyjKwk0xGoRRdVzg/OBQn54PWrGyaVHaPZ+lcwvBvPJQP+0+WGTdXo6u6lDjKVmEZiOkmYmk5SkDgmpxK0x69TUczQPL+QvriF/KvcRV673E0Ocj2TpbLjcuDmklzmCcGj67UoE3ZRMzjf7YtGmbvMr4Cg6PN0X+QIgVyMJUU5yEMeCK/484ss+q9x4Tz0g8LPa3ZuHolkig6cVwszjEVuLoFwsYW8Mqj1WzadZ3ARLZmQXwENm9ZQpfCkXRAzdEHNp0UiDjrLpQm9n6V/ALJdQDzHKtS7AAAAAElFTkSuQmCC&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;companion 3&quot; title=&quot;companion 3&quot; src=&quot;/static/357cfe9fbb35d12669e82a58e3366156/5a46d/companion-3.png&quot; srcSet=&quot;/static/357cfe9fbb35d12669e82a58e3366156/222b7/companion-3.png 163w,/static/357cfe9fbb35d12669e82a58e3366156/5a46d/companion-3.png 300w&quot; sizes=&quot;(max-width: 300px) 100vw, 300px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;col-3&quot;&gt;  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:300px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:216.5644171779141%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAArCAYAAAB4pah1AAAACXBIWXMAAAsTAAALEwEAmpwYAAAF40lEQVRIx6VV229URRjfoJhAvMSY+Cfgg/GJUNrdlhpoK3IH5dbS9EYtsRZp0AdBYiCA4UF9hRoTE2NMRLzEGB+8cGmx2721u+22iBSh7e62bHf37O6Zc92zP505Z07PtrQlOsmXmfPNzO983/f7zYxLDLpBQp7/bRzHxT+4g4/n/2g5nw1oDipBQlUQgxWOhRUQg+utvgJ83dxcubWvsmSfi24i4S1Q7p2DfLsLyt2TkKL1kG8fhXznHUijjZBvtTG/Mn4CUnQ/WyffOc7WKH+fhjSy1/oBi7ACZLAa0shrkIb3QBreDTJUBxLZzhaSoRqQ8KuQRl4358KbIUUPQooeAIlsgzSyj/l4lHM1DJTNWbDcTDewzhqXl85RP5tbb/scKc8r9CNZpWVLsJwPeEwLVlrmWcbMNTlrHwm52Q9cdEAnjKgHGHOjGK1gpkfKoIfXQQ+XmWNu1BcpA0bdpo25URh226AuMeiBFnHD+7UHPeepVeLTDzfgm0s78W3Pblzp2YUrl7iZvssXd+DiWTcuna/EZxcqEflxA/RhKicPXBj14KuP1+LFl9ai8+h7eP+DC3i7+ySeWPUcXK5VcK14Eo+tfAYrHn8aK1Y+C5drNVY/9TzOnPsEp89+hNb2bqxZ8wJ+/bwcxagHLmmwCvt3rsV3P/wMZzt16gR2bN+Kgwf2of7gftPqDzDfubNnStZe7PkCRxrXoRitgkvwV6P1UB0CoWGoWgGFQgHFYtFeLEkSstks0ukMZFm2/XqBrtUh5CVc6/XhWEctlHA1XFl/NZobajHgHzQX6joMw7D7fD4PQRCYiaJozxWNIvs5bb9d7cfR9k1QI9Vw5UJ1aGvagwFfkE1qmsYW0l5RVGi6Dl0vMKNjRVWhWsYjvnrdi67DFmA28DKaG15BMBRhqSZnU8hkBAZGm2EUmX++oViEopsR3uj1oYtHmA1uQkvjVgRDYTYpigQiIVA1jW2kKVJQs+djE1TV9TnAwxtNwPzgZrS37oPPH7IAzTo5W9E5ZsGZgIZVw96bPnS0bIE0tIlGWIO2pp3wDgQQi8UwNnYLqXQahYLB6qhpOqspJYLWjRNBf6MWeMr9ePPwLsiROjPl1sZt8AcG2QYqjxS1VJrVc+ZB0vSl0ojFE8iLoh1qRjVAFAW/X+1FZ/tuE5Cl3LKXAZqyKVhpOVJz6JLXlfYFXsM+Lzpat0EK11DZ1KKtaRd8lg65JLjAqVERy4rCiGKSKhiMYVnVLEAfOts2msIW/BvQ0lCLP7wBTEzcx/j4XYyPjyMej5uyoWxqOu5PxnB/corVlKg67mVVjGdkiBbLtrDZSamvQTA0jPnNjNDUolE05ULJ4hKipPEIbWELDkBN11jhKQm0+NlcDg+SSeTyeccP5oQ9TTTMAujrcwh7DjBiC5ueEn7UVFVjPY/QFrZhgDhq2OVMuekhKdungqdqGAtMt1i+3luSMiWlDv3eINLpFBO3aGnNTm+RxkV+o88/H7AWA74QFEVGJpNhd2BptFak80y3dehfWMPQ4AibnE2lIckyMoLATgol5GG3DbscOMtO2XDAgEUKZZYCUiETIrExPy3Ok0N7qklOyrI6ZJut2+VhhBSYDhclpRbegSCyWQGJRAKzs7P2eV3KliTFFxhCPicgFosjmUza7D4yywuEPTjKJikZ2Vye9U7QZSNsd0TY3LAZQX8fUPgTeVFijw8nY6koFwGsQvOhrQj1/wQIl5HKiOzJzAjZBRH+p5QJIZAkBTPJFDJC7tFJKQWstS8HWVbYhSBk8xCJjKUaf8wWidDUYZ4QEEmComrsUSeSKXJaU5FIJd/87aaAC4QdsgDjsZht04kEErE4piYmEJ+aQiIex9TkJGamp5GcmWHz7Bkt1aEJ6KcXLIAHooJZSWN9kqhsPENUTOdNP/elFR2JLAEtyrVeR4QZfzWONNbh+5thHPsLeGNIwpGIwqwjoqAzoqB7REV3VMVbw6aPzYcVtvb4XeDLXwbwbkcNlH8B/wHLAVVSGbkZLgAAAABJRU5ErkJggg==&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;companion 4&quot; title=&quot;companion 4&quot; src=&quot;/static/6f36700faa5842a54b89213156ba8065/5a46d/companion-4.png&quot; srcSet=&quot;/static/6f36700faa5842a54b89213156ba8065/222b7/companion-4.png 163w,/static/6f36700faa5842a54b89213156ba8065/5a46d/companion-4.png 300w&quot; sizes=&quot;(max-width: 300px) 100vw, 300px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;h2&gt;Results&lt;/h2&gt;&lt;p&gt;After a short beta period, Mon Ami migrated all customers &amp;amp; visitors to the new platform with no downtime. It wasn&amp;#x27;t long before the benefits of the new platform became clear. For example, the time required to match a new customer with a visitor has been significantly reduced.&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;&amp;quot;Scheduling is difficult because students have weird schedules. You want to be able to match people and settle a visit fairly quickly. Before, the process was very manual, and the time to match was measured in days. Now the time to match is measured in minutes or hours.&amp;quot;&lt;/p&gt;&lt;p&gt;- Steve Fram, CTO&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Since the successful platform launch, Mon Ami has worked with Hint to transition further development of their platform to the Mon Ami internal team. The rapid development of the platform has afforded the team time to focus on expansion to new markets in 2020 and beyond.&lt;/p&gt;&lt;h3&gt;More than software&lt;/h3&gt;&lt;p&gt;Hint partnered with Mon Ami to build a culture of engineering excellence. Sustainable code, extensive automated testing, and strong development processes have set Mon Ami up for success in the years to come.&lt;/p&gt;&lt;h4&gt;How can we help you?&lt;/h4&gt;&lt;p&gt;Interested in finding out how partnering with Hint could help your company reach the next level? We&amp;#x27;d love to talk! &lt;a href=&quot;/contact&quot;&gt;Contact us&lt;/a&gt; to get started.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[10 New Things in Active Record]]></title><description><![CDATA[In this post, we will take a look at 10 new additions to Active Record in Rails 6. For each addition, I'll include a link to the PR the…]]></description><link>https://hint.io/blog/10-New-Things-in-Active-Record</link><guid isPermaLink="false">https://hint.io/blog/10-New-Things-in-Active-Record</guid><dc:creator><![CDATA[jasonDinsmore]]></dc:creator><pubDate>Wed, 20 Nov 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In this post, we will take a look at 10 new additions to Active Record in Rails 6. For each addition, I&amp;#x27;ll include a link to the PR the feature was introduced in, a link to the author&amp;#x27;s GitHub profile, and a brief description of what the feature provides.&lt;/p&gt;&lt;p&gt;We&amp;#x27;ve got a lot to cover, so let&amp;#x27;s get going!&lt;/p&gt;&lt;h2&gt;1. &lt;code&gt;rails db:prepare&lt;/code&gt;&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/35768&quot;&gt;PR 35678&lt;/a&gt; by &lt;a href=&quot;https://github.com/robertomiranda&quot;&gt;@robertomiranda&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;When this rake task is run, if the database exists, it runs any pending migrations. If a database does not exist, it runs the &lt;code&gt;db:setup&lt;/code&gt; rake task.&lt;/p&gt;&lt;p&gt;This feature was designed to be idempotent, allowing it to be run over and over again until it completes successfully.&lt;/p&gt;&lt;p&gt;The &lt;code&gt;rake db:prepare&lt;/code&gt; task functions like this:&lt;/p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:82.82208588957054%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAARABQDASIAAhEBAxEB/8QAGQABAQEAAwAAAAAAAAAAAAAAAAMBAgQF/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAEDAv/aAAwDAQACEAMQAAAB9zJdhPUgU4hmQnH/xAAbEAACAgMBAAAAAAAAAAAAAAAAARAiAgMRMf/aAAgBAQABBQKrMUlGtWOOH4f/xAAWEQADAAAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8BI//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABkQAAIDAQAAAAAAAAAAAAAAAAEgABEhMv/aAAgBAQAGPwLKMwJ2n//EABwQAAICAwEBAAAAAAAAAAAAAAABETEQIWFB8P/aAAgBAQABPyFQNdEEvpw5NK8HWnHT5JYsFR//2gAMAwEAAgADAAAAEHPvwf/EABwRAAEDBQAAAAAAAAAAAAAAAAEAEDERIVGx0f/aAAgBAwEBPxCLBUZ3xGC3/8QAGREAAgMBAAAAAAAAAAAAAAAAABEBECEx/9oACAECAQE/EFrGTyv/xAAcEAEAAwACAwAAAAAAAAAAAAABABExECFBccH/2gAIAQEAAT8QVbCdENkcRt1DeFVTFonn1CrLLlLqFemTvE+k/9k=&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;rake db:prepare flowchart&quot; title=&quot;rake db:prepare flowchart&quot; src=&quot;/static/a4b35d326897597a315f2cd6e4843251/6aca1/rake-db-prepare.jpg&quot; srcSet=&quot;/static/a4b35d326897597a315f2cd6e4843251/d2f63/rake-db-prepare.jpg 163w,/static/a4b35d326897597a315f2cd6e4843251/c989d/rake-db-prepare.jpg 325w,/static/a4b35d326897597a315f2cd6e4843251/6aca1/rake-db-prepare.jpg 650w,/static/a4b35d326897597a315f2cd6e4843251/ad059/rake-db-prepare.jpg 758w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;p&gt;If you&amp;#x27;re not familiar with it, the &lt;code&gt;db:setup&lt;/code&gt; rake task:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Creates the database&lt;/li&gt;&lt;li&gt;Loads the &lt;code&gt;schema.rb&lt;/code&gt; or &lt;code&gt;structure.sql&lt;/code&gt; file (whichever your application is configured to use)&lt;/li&gt;&lt;li&gt;Runs the &lt;code&gt;db:seed&lt;/code&gt; task, which executes the code in the &lt;code&gt;db/seeds.rb&lt;/code&gt; file&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;2. &lt;code&gt;rails db:seed:replant&lt;/code&gt;&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/34779&quot;&gt;PR 34779&lt;/a&gt; by &lt;a href=&quot;https://github.com/bogdanvlviv&quot;&gt;@bogdanvlviv&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;This new &lt;code&gt;db:seed:replant&lt;/code&gt; rake task does two things:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Runs &lt;code&gt;truncate&lt;/code&gt; on all tables managed by ActiveRecord in the Rails environment the rake task is being run under. (Note that &lt;code&gt;truncate&lt;/code&gt; deletes all of the data in the table, but does not reset the table&amp;#x27;s auto-increment (ID) counter)&lt;/li&gt;&lt;li&gt;Runs the &lt;code&gt;db:seed&lt;/code&gt; Rails rake task to populate seed data&lt;/li&gt;&lt;/ul&gt;&lt;h2&gt;3. Automatic Database Switching&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/35073&quot;&gt;PR 35073&lt;/a&gt; by &lt;a href=&quot;https://github.com/eileencodes&quot;&gt;@eileencodes&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Rails 6 provides a framework for auto-routing incoming requests to either the primary database connection, or a read replica.&lt;/p&gt;&lt;p&gt;By default, this new functionality allows your app to automatically route read requests (&lt;code&gt;GET&lt;/code&gt;, &lt;code&gt;HEAD&lt;/code&gt;) to a read-relica database if it has been at least 2 seconds since the last write request (any request that is &lt;em&gt;not&lt;/em&gt; a &lt;code&gt;GET&lt;/code&gt; or &lt;code&gt;HEAD&lt;/code&gt; request) was made.&lt;/p&gt;&lt;p&gt;The logic that specifies when a read request should be routed to a replica is specified in a resolver class, &lt;code&gt;ActiveRecord::Middleware::DatabaseSelector::Resolver&lt;/code&gt; by default, which you would override if you wanted custom behavior.&lt;/p&gt;&lt;p&gt;The middleware also provides a session class, &lt;code&gt;ActiveRecord::Middleware::DatabaseSelector::Resolver::Session&lt;/code&gt; that is tasked with keeping track of when the last write request was made. Like the resolver, this class can also be overridden.&lt;/p&gt;&lt;p&gt;To enable the default behavior, you would add the following configuration options to one of your app&amp;#x27;s environment files - &lt;code&gt;config/environments/production.rb&lt;/code&gt; for example:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;active_record&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;database_selector &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; delay&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2.&lt;/span&gt;seconds &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;active_record&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;database_resolver &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; 
  &lt;span class=&quot;token constant&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Middleware&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;DatabaseSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Resolver&lt;/span&gt;
config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;active_record&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;database_operations &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; 
  &lt;span class=&quot;token constant&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Middleware&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;DatabaseSelector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Resolver&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Session&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If you decide to override the default functionality, you can use these configuration options to specify the delay you&amp;#x27;d like to use, the name of your custom resolver class, and the name of your custom session class, both of which should be descendants of the default classes.&lt;/p&gt;&lt;h2&gt;4. Negative Scopes for Enums&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/35381&quot;&gt;PR 35381&lt;/a&gt; by &lt;a href=&quot;https://github.com/dhh&quot;&gt;@dhh&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;While &lt;a href=&quot;https://rubydocs.org/d/rails-6-0-0/classes/ActiveRecord/Enum.html&quot;&gt;&lt;code&gt;enum&lt;/code&gt;&lt;/a&gt; has traditionally provided scopes to find items by their enum value, it has not provided scopes to find items not matching a specific enum value.&lt;/p&gt;&lt;p&gt;For example, given a &lt;code&gt;Post&lt;/code&gt; model for a blog, with an enum on the &lt;code&gt;status&lt;/code&gt; field:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;enum status &lt;span class=&quot;token string&quot;&gt;%i(draft published archived)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The following scopes have been provided automatically for some time:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;scope &lt;span class=&quot;token symbol&quot;&gt;:draft&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; where&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;status&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
scope &lt;span class=&quot;token symbol&quot;&gt;:published&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; where&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;status&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
scope &lt;span class=&quot;token symbol&quot;&gt;:archived&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; where&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;status&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now, the following negative scopes are also available:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;scope &lt;span class=&quot;token symbol&quot;&gt;:not_draft&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; where&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;not&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;status&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
scope &lt;span class=&quot;token symbol&quot;&gt;:not_published&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; where&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;not&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;status&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
scope &lt;span class=&quot;token symbol&quot;&gt;:not_archived&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; where&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;not&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;status&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This makes it easy, for example, to find unpublished posts:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;Post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;not_published&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;5. &lt;code&gt;#extract_associated&lt;/code&gt;&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/35784&quot;&gt;PR 35784&lt;/a&gt; by &lt;a href=&quot;https://github.com/dhh&quot;&gt;@dhh&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;The new &lt;a href=&quot;https://rubydocs.org/d/rails-6-0-0/classes/ActiveRecord/QueryMethods.html#method-i-extract_associated&quot;&gt;&lt;code&gt;#extract_associated&lt;/code&gt;&lt;/a&gt; method is literally just a shorthand for &lt;a href=&quot;https://rubydocs.org/d/rails-6-0-0/classes/ActiveRecord/QueryMethods.html#method-i-preload&quot;&gt;&lt;code&gt;preload&lt;/code&gt;&lt;/a&gt; plus &lt;a href=&quot;https://rubydocs.org/d/ruby-2-6-5/classes/Enumerable.html#method-i-collect&quot;&gt;&lt;code&gt;map/collect&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Here&amp;#x27;s the source code of the method:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;extract_associated&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;association&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  preload&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;association&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;collect&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;association&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Be aware that &lt;code&gt;preload&lt;/code&gt; does not allow you to specify conditions on the association being &amp;quot;preloaded&amp;quot;. You&amp;#x27;d want to use a different eager-loading mechanism for that, likely &lt;code&gt;includes&lt;/code&gt;, &lt;code&gt;eager_load&lt;/code&gt; or &lt;code&gt;joins&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Usage of &lt;code&gt;#extract_associated&lt;/code&gt; might look like this:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;commented_posts &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;comments&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;extract_associated&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;6. &lt;code&gt;#annotate&lt;/code&gt;&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/35617&quot;&gt;PR 35617&lt;/a&gt; by &lt;a href=&quot;https://github.com/mattyoho&quot;&gt;@mattyoho&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;This is a nifty addition that could be used to add useful information to your application&amp;#x27;s log files. The &lt;a href=&quot;https://rubydocs.org/d/rails-6-0-0/classes/ActiveRecord/QueryMethods.html#method-i-annotate&quot;&gt;&lt;code&gt;#annotate&lt;/code&gt;&lt;/a&gt; method provides a mechanism to embed comments into the SQL generated by ActiveRecord queries. As an added benefit, the comments it generates could be completely dynamic.&lt;/p&gt;&lt;p&gt;Inserting &lt;code&gt;annotate&lt;/code&gt; into your query chain like below:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;User&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;annotate&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;there can be only one!&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;find_by&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;highlander&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Would generate the following SQL:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;users&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;users&amp;quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;users&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;highlander&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ? &lt;span class=&quot;token comment&quot;&gt;/* there can be only one! */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;LIMIT&lt;/span&gt; ? &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;highlander&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;LIMIT&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;7. &lt;code&gt;#touch_all&lt;/code&gt;&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/31513&quot;&gt;PR 31513&lt;/a&gt; by &lt;a href=&quot;https://github.com/fatkodima&quot;&gt;@fatkodima&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Another &lt;a href=&quot;https://rubydocs.org/d/rails-6-0-0/classes/ActiveRecord/Relation.html&quot;&gt;&lt;code&gt;ActiveRecord::Relation&lt;/code&gt;&lt;/a&gt; method, &lt;a href=&quot;https://rubydocs.org/d/rails-6-0-0/classes/ActiveRecord/Relation.html#method-i-touch_all&quot;&gt;&lt;code&gt;#touch_all&lt;/code&gt;&lt;/a&gt; touches all records in the current scope, updating their timestamps.&lt;/p&gt;&lt;p&gt;You can pass an array of columns to touch, and optionally provide a time value to use. &lt;code&gt;touch_all&lt;/code&gt; defaults to the current time in whatever timezone the app&amp;#x27;s config has set for &lt;code&gt;config.active_record.default_timezone&lt;/code&gt; (the setting defaults to UTC).&lt;/p&gt;&lt;p&gt;For example, to update the &lt;code&gt;updated_at&lt;/code&gt; field of all comments associated with a given blog post, &lt;code&gt;@post&lt;/code&gt;, you could:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;@post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;comments&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;touch_all&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To update a given field on the comments, say &lt;code&gt;:reviewed_at&lt;/code&gt;, you would provide the column name:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;@post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;comments&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;touch_all&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:reviewed_at&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And, to specify a time value, you would:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;@post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;comments&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;touch_all&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:reviewed_at&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; the_time&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;8. &lt;code&gt;#destroy_by&lt;/code&gt; and &lt;code&gt;#delete_by&lt;/code&gt;&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/35316&quot;&gt;PR 35316&lt;/a&gt; by &lt;a href=&quot;https://github.com/abhaynikam&quot;&gt;@abhaynikam&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;The &lt;a href=&quot;https://rubydocs.org/d/rails-6-0-0/classes/ActiveRecord/Relation.html#method-i-destroy_by&quot;&gt;&lt;code&gt;destroy_by&lt;/code&gt;&lt;/a&gt; and &lt;a href=&quot;https://rubydocs.org/d/rails-6-0-0/classes/ActiveRecord/Relation.html#method-i-delete_by&quot;&gt;&lt;code&gt;delete_by&lt;/code&gt;&lt;/a&gt; methods are intended to provide symmetry (&lt;a href=&quot;https://github.com/rails/rails/issues/35304#issuecomment-464489289&quot;&gt;&amp;quot;in spirit&amp;quot;&lt;/a&gt;) with  &lt;code&gt;ActiveRecord&lt;/code&gt;&amp;#x27;s &lt;a href=&quot;https://rubydocs.org/d/rails-6-0-0/classes/ActiveRecord/FinderMethods.html#method-i-find_by&quot;&gt;&lt;code&gt;find_by&lt;/code&gt;&lt;/a&gt; and &lt;a href=&quot;https://rubydocs.org/d/rails-6-0-0/classes/ActiveRecord/Relation.html#method-i-find_or_create_by&quot;&gt;&lt;code&gt;find_or_create_by&lt;/code&gt;&lt;/a&gt; methods.&lt;/p&gt;&lt;p&gt;I believe there is an important distinction you should be aware of. &lt;code&gt;find_by&lt;/code&gt; returns one record, or &lt;code&gt;nil&lt;/code&gt;, whereas &lt;code&gt;destroy_by&lt;/code&gt; and &lt;code&gt;delete_by&lt;/code&gt; will match on entire collections of records.&lt;/p&gt;&lt;p&gt;Using &lt;code&gt;find_by&lt;/code&gt; like this:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;find_by&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;admin&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Generates the following SQL:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;SELECT&lt;/span&gt;  &lt;span class=&quot;token string&quot;&gt;&amp;quot;users&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;users&amp;quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;users&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; $&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;LIMIT&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Whereas, using &lt;code&gt;delete_by&lt;/code&gt; with the same parameters:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;delete_by&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;admin&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Results in the following SQL:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sql&quot;&gt;&lt;pre class=&quot;language-sql&quot;&gt;&lt;code class=&quot;language-sql&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;DELETE&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;users&amp;quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;users&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ?  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Definitely something to keep in mind when using these methods!&lt;/p&gt;&lt;p&gt;Also, it&amp;#x27;s worth noting that there are no bang ( &lt;code&gt;!&lt;/code&gt;) versions of the &lt;code&gt;delete_by/destroy_by&lt;/code&gt; methods.&lt;/p&gt;&lt;h2&gt;9. Endless Ranges in &lt;code&gt;#where&lt;/code&gt;&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/34906&quot;&gt;PR 34906&lt;/a&gt; by &lt;a href=&quot;https://github.com/gregnavis&quot;&gt;@gregnavis&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;Ruby 2.6 introduced infinite ranges. This new feature lets you use them in Rails&amp;#x27; &lt;code&gt;#where&lt;/code&gt; clauses.&lt;/p&gt;&lt;p&gt;For example, when trying to find a Post with more than 10 comments (contrived example, I know).&lt;/p&gt;&lt;p&gt;Before you would have to use SQL like:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;Post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;where&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;num_comments &amp;gt; ?&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now you can use syntax that is more idiomatic Ruby:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;where&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;num_comments&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;10. Implicit Ordering&lt;/h2&gt;&lt;h3&gt;&lt;a href=&quot;https://github.com/rails/rails/pull/34480&quot;&gt;PR 34480&lt;/a&gt; by &lt;a href=&quot;https://github.com/tekin&quot;&gt;@tekin&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;This feature makes implicit ordering configurable for a database table. Rails  implicitly orders results by the table&amp;#x27;s primary key, which can give surprising results when the primary key is something that isn&amp;#x27;t an auto-incrementing  integer (like a UUID).&lt;/p&gt;&lt;p&gt;Setting a table&amp;#x27;s implicit order column allows you to specify a default order,  without using a default scope, meaning that you don&amp;#x27;t need to use &lt;code&gt;reorder&lt;/code&gt; in  your code to change the order downstream, you can use &lt;code&gt;order&lt;/code&gt; (assuming you have not already specified explicit ordering earlier in the query chain).&lt;/p&gt;&lt;p&gt;For example, if you declare an implicit ordering on your &lt;code&gt;Post&lt;/code&gt; table:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Post&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ActiveRecord&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Base&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;implicit_order_column &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;title&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Be aware, that if you declare implicit ordering on a column that does not ensure unique values, your results may not be what you expect.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Sr. Ruby on Rails Developer]]></title><description><![CDATA[Do you enjoy debugging, killing tech-debt, and refactoring code?  We're seeking an experienced  Ruby on Rails developer  to join our team…]]></description><link>https://hint.io/blog/we-are-hiring</link><guid isPermaLink="false">https://hint.io/blog/we-are-hiring</guid><dc:creator><![CDATA[benWood]]></dc:creator><pubDate>Thu, 03 Oct 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;Do you enjoy debugging, killing tech-debt, and refactoring code?&lt;/strong&gt; We&amp;#x27;re seeking an experienced &lt;strong&gt;Ruby on Rails developer&lt;/strong&gt; to join our team &lt;strong&gt;remotely or on-site&lt;/strong&gt; at our downtown Vancouver, WA office location.&lt;/p&gt;&lt;p&gt;We believe that &lt;strong&gt;happy people create better software.&lt;/strong&gt; Clients deserve an experience that is reliable, understandable, and delivers results while maximizing investment. Developers deserve security, enrichment, and fulfillment—personally as well as professionally.&lt;/p&gt;&lt;p&gt;We’re &lt;strong&gt;Hint&lt;/strong&gt; – a growing &lt;strong&gt;team&lt;/strong&gt; of developers who are passionate about creating and maintaining &lt;strong&gt;high-quality software&lt;/strong&gt;. Our mission is to transform how software is made by building a better, more &lt;strong&gt;sustainable&lt;/strong&gt; development process for &lt;strong&gt;everyone&lt;/strong&gt;.&lt;/p&gt;&lt;h3&gt;Our Core Values&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Kindness&lt;/strong&gt; Our highest priority is treating people with compassion and respect.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Autonomy&lt;/strong&gt;: We are self-driven, proactive, and confident in our abilities.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Integrity&lt;/strong&gt;: We do what we say. We do the right thing.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Teamwork&lt;/strong&gt;: We succeed as a team. There are no rock stars here.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Improvement&lt;/strong&gt;: In our software, process and personal lives.&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Requirements&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;&lt;strong&gt;5+ years&lt;/strong&gt; of experience working with &lt;strong&gt;Ruby on Rails&lt;/strong&gt;.&lt;/li&gt;&lt;li&gt;Advanced ruby &lt;strong&gt;debugging skills&lt;/strong&gt;.&lt;/li&gt;&lt;li&gt;No fear of &lt;strong&gt;reading the source of Rails &amp;amp; other dependencies&lt;/strong&gt; to understand how things work.&lt;/li&gt;&lt;li&gt;Excellent &lt;strong&gt;communication skills&lt;/strong&gt;, both verbal &amp;amp; written.&lt;/li&gt;&lt;li&gt;Value &lt;strong&gt;collaboration&lt;/strong&gt;, &lt;strong&gt;mentorship&lt;/strong&gt;, and &lt;strong&gt;open source&lt;/strong&gt;.&lt;/li&gt;&lt;li&gt;Love for &lt;strong&gt;testing&lt;/strong&gt;, &lt;strong&gt;performance&lt;/strong&gt;, and &lt;strong&gt;clean-code&lt;/strong&gt;.&lt;/li&gt;&lt;li&gt;Familiarity with &lt;strong&gt;common patterns&lt;/strong&gt; in Rails (and anti-patterns).&lt;/li&gt;&lt;li&gt;Know more than enough &lt;strong&gt;Git&lt;/strong&gt; to be dangerous.&lt;/li&gt;&lt;li&gt;Experience with &lt;strong&gt;Docker&lt;/strong&gt; a bonus, but not required.&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Responsibilities&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;&lt;strong&gt;Lead&lt;/strong&gt; client projects start to finish.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Communicate&lt;/strong&gt; with clients, manage expectations, deliver on-time.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Invest&lt;/strong&gt; in team members.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Contribute&lt;/strong&gt; to Hint blog &amp;amp; open source projects.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Extend&lt;/strong&gt; internal knowledge base, systems, and tooling.&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Represent&lt;/strong&gt; Hint well, stay involved in the Ruby/Rails community.&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Compensation &amp;amp; Benefits&lt;/h3&gt;&lt;ul&gt;&lt;li&gt;$100k+ &lt;strong&gt;salary&lt;/strong&gt; depending on qualifications&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Medical insurance&lt;/strong&gt; (Hint pays &lt;strong&gt;100% employee&lt;/strong&gt; and 30% dependents)&lt;/li&gt;&lt;li&gt;&lt;strong&gt;401k&lt;/strong&gt; (Hint matches employee contribution up to 4% of salary)&lt;/li&gt;&lt;li&gt;&lt;strong&gt;Paid vacation&lt;/strong&gt; (10 days first year, 15 days second year, 20 days third year)&lt;/li&gt;&lt;li&gt;Six &lt;strong&gt;paid holidays including a minimum of 5 days at Christmas&lt;/strong&gt;&lt;/li&gt;&lt;li&gt;Client work Mon-Thursday, &lt;strong&gt;Friday reserved&lt;/strong&gt; for internal Hint projects, open source contributions, and continued learning.&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;Sound good? We think so! We&amp;#x27;d love to have you join the team. Submit your resume to [jobs@hint.io](mailto: &lt;a href=&quot;mailto:jobs@hint.io&quot;&gt;jobs@hint.io&lt;/a&gt;) and tell us about yourself.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Easily Integrate Ramda into Your React Workflow]]></title><description><![CDATA[Here at Hint, we often use React for writing our user interfaces. We enjoy its declarative API, the mental-model that makes it easier to…]]></description><link>https://hint.io/blog/react-and-ramda</link><guid isPermaLink="false">https://hint.io/blog/react-and-ramda</guid><dc:creator><![CDATA[nateShoemaker]]></dc:creator><pubDate>Fri, 13 Sep 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Here at Hint, we often use React for writing our user interfaces. We enjoy its declarative API, the mental-model that makes it easier to communicate and collaborate with teams, and especially, the recent addition of hooks. React doesn&amp;#x27;t provide the entire toolkit, however. It&amp;#x27;s missing a few things out of the box: data fetching, handling async functions, applying styles in a pragmatic way, etc.&lt;/p&gt;&lt;p&gt;As I was learning React, the biggest hole in React&amp;#x27;s feature set actually turned out to be an issue with JavaScript itself. Compared to other toolkit heavy languages such as Ruby or Elixir, JavaScript doesn&amp;#x27;t give you a ton to work with. I started writing my own helper libraries until a friend told me about Ramda. Straight from &lt;a href=&quot;https://ramdajs.com/&quot;&gt;their homepage&lt;/a&gt;:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;A practical functional library for JavaScript programmers.&lt;/p&gt;&lt;/blockquote&gt;&lt;p&gt;Hey! I like functional things, libraries, JavaScript... and I&amp;#x27;m a programmer! It was love at first byte (no, I don&amp;#x27;t feel any shame for that).&lt;/p&gt;&lt;p&gt;The first Ramda hurdle is functional programming. If you have never dipped a toe in the functional waters, please read &lt;a href=&quot;http://randycoulman.com/blog/2016/05/24/thinking-in-ramda-getting-started/&quot;&gt;Randy Coulman&amp;#x27;s &amp;quot;Thinking in Ramda&amp;quot; series&lt;/a&gt;, it&amp;#x27;s brilliant.&lt;/p&gt;&lt;p&gt;The second Ramda hurdle (as a React developer) is knowing how to use it with React &lt;em&gt;effectively&lt;/em&gt;. I&amp;#x27;m still learning and experimenting with how the two libraries can work together, and I wanted to share some of the patterns that I have held onto over the past few years. Let&amp;#x27;s get into it!&lt;/p&gt;&lt;h2&gt;Make Your Code Read Better With &lt;code&gt;isNil&lt;/code&gt; And &lt;code&gt;isEmpty&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;Sometimes, React code isn&amp;#x27;t the easiest to read. I would argue that post-hooks this has gotten even worse. More and more logic is being added to the component&amp;#x27;s body, and without lifecycle methods that automatically help organize code out of &lt;code&gt;render&lt;/code&gt;, any help I can get to cleanup, I take.&lt;/p&gt;&lt;p&gt;Ramda&amp;#x27;s &lt;code&gt;isNil&lt;/code&gt; and &lt;code&gt;isEmpty&lt;/code&gt; are a great start to make your component&amp;#x27;s body dazzle 🕺. For example:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Entry&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; client &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Query&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;currentUserQuery&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; loading&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; data &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;loading &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;posts&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;NoPosts&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token function&quot;&gt;setErrorTrackingContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token function&quot;&gt;getPostMetaData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;// code that renders things here&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Query&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;em&gt;Note on code examples: all code in this article is based on real life code that I&amp;#x27;ve written. There are some references to &lt;a href=&quot;https://github.com/apollographql/react-apollo&quot;&gt;Apollo&amp;#x27;s React library&lt;/a&gt;, which Hint loves. Most imports have been removed for brevity. No blogpost-ed, &lt;code&gt;fooBar&lt;/code&gt;-filled, faux-code here. Nearly Production Ready™.&lt;/em&gt;&lt;/p&gt;&lt;p&gt;Note the first &lt;code&gt;if&lt;/code&gt;: we&amp;#x27;ll return a component early if we&amp;#x27;re done loading and the &lt;code&gt;data.user.posts&lt;/code&gt; is falsy. The second &lt;code&gt;if&lt;/code&gt;: if we have a user, let&amp;#x27;s set the context for whatever error tracking we&amp;#x27;re using (at Hint we love &lt;a href=&quot;https://www.honeybadger.io/&quot;&gt;Honeybadger&lt;/a&gt;), then get some post metadata. Let&amp;#x27;s not worry about any implementations of these functions and focus on our logic. At first glance, things aren&amp;#x27;t that bad - but &amp;quot;not that bad&amp;quot; is not the bar. Excellence is! Let&amp;#x27;s take another pass, but with Ramda:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; isNil&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; isEmpty &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;ramda&amp;#x27;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Entry&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; client &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Query&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;currentUserQuery&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; loading&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; data &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isNil&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;loading&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;posts&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;NoPosts&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token function&quot;&gt;setErrorTrackingContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token function&quot;&gt;getPostMetaData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;// code that renders things here&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Query&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Note the &lt;code&gt;import&lt;/code&gt; at the top and the update to our first &lt;code&gt;if&lt;/code&gt;. &lt;code&gt;isNil&lt;/code&gt; will return &lt;code&gt;true&lt;/code&gt; if &lt;code&gt;loading&lt;/code&gt; is &lt;code&gt;null&lt;/code&gt; or &lt;code&gt;undefined&lt;/code&gt;. This function is extremely helpful because it doesn&amp;#x27;t just check if the value is &lt;code&gt;falsy&lt;/code&gt;, which is essentially what it did before (&lt;code&gt;!loading&lt;/code&gt;). Hindquarters saved from a nasty bug!&lt;/p&gt;&lt;p&gt;On the same line, &lt;code&gt;isEmpty&lt;/code&gt; will return &lt;code&gt;true&lt;/code&gt; if the value passed in is &lt;code&gt;&amp;#x27;&amp;#x27;&lt;/code&gt;, &lt;code&gt;[]&lt;/code&gt;, or &lt;code&gt;{}&lt;/code&gt;. When working with GraphQL, if you ask for a collection of things but there are none, more often than not you&amp;#x27;ll get back an empty array. Our logic check before, &lt;code&gt;!data.user.posts&lt;/code&gt; could have also introduced an unintended bug! Hindquarters saved AGAIN.&lt;/p&gt;&lt;h3&gt;Pro-Tip&lt;/h3&gt;&lt;p&gt;First point and already a pro-tip? Today is a good day.&lt;/p&gt;&lt;p&gt;Ramda is built of many tiny functions that have a single specific purpose. Assembled together properly, you can create some fun stuff! Let&amp;#x27;s create a helper that&amp;#x27;s the inverse of &lt;code&gt;isNil&lt;/code&gt;:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; isNil&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; isEmpty&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; complement &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;ramda&amp;#x27;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; isPresent &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;complement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isNil&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Entry&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; client &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Query&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;currentUserQuery&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; loading&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; data &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isNil&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;loading&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;posts&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;NoPosts&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isPresent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token function&quot;&gt;setErrorTrackingContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token function&quot;&gt;getPostMetaData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;// code that renders things here&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Query&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;complement&lt;/code&gt; takes a function as its first argument, and a value as its second. If a falsy value is returned when it&amp;#x27;s called, the output will be &lt;code&gt;true&lt;/code&gt; (the inverse is also true). Using &lt;code&gt;complement&lt;/code&gt; makes our second &lt;code&gt;if&lt;/code&gt; a little nicer.&lt;/p&gt;&lt;p&gt;You may say, &lt;em&gt;&amp;quot;Well that&amp;#x27;s really simple. Why doesn&amp;#x27;t Ramda come with a helper like that?&amp;quot;&lt;/em&gt; Think of Ramda functions like individual LEGOS pieces. On their own, they don&amp;#x27;t do a ton, but put them together, and you can create something incredibly useful. If you want a more &lt;em&gt;&amp;quot;comprehensive set of utilities&amp;quot;&lt;/em&gt;, check out &lt;a href=&quot;https://char0n.github.io/ramda-adjunct&quot;&gt;Ramda Adjunct&lt;/a&gt;.&lt;/p&gt;&lt;h2&gt;It&amp;#x27;s Dangerous to Operate on Objects Alone! Take These Functions: &lt;code&gt;prop&lt;/code&gt; and &lt;code&gt;path&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;&lt;em&gt;+1 internet points if you get the title joke&lt;/em&gt;&lt;/p&gt;&lt;p&gt;As a developer, nothing is more scary than deeply accessing an object. If this doesn&amp;#x27;t make you slightly cringe:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;foo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;baz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;theLastPropertyIPromise&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;justKiddingOneMore&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;doTheThing&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then we need to have a talk. If this is your proposed solution:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  foo &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  foo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bar &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  foo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;baz &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  foo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;baz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;theLastPropertyIPromise &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  foo&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bar&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;baz&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;theLastPropertyIPromise&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;justKiddingOneMore
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;doTheThing&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then we &lt;em&gt;really&lt;/em&gt; need to talk.&lt;/p&gt;&lt;p&gt;Joking aside, we&amp;#x27;ve all been there. It&amp;#x27;s easy to gloss over complex checks completely or write conditionals that take up too many bytes and are difficult to read. Ramda gives us &lt;code&gt;prop&lt;/code&gt; and &lt;code&gt;path&lt;/code&gt; to safely access objects. Let&amp;#x27;s see how they work:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; prop&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; pipe &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;ramda&amp;#x27;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foo&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;bar&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; baz&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; a&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; getFoo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;foo&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;getFoo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;obj&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// =&amp;gt; &amp;#x27;bar&amp;#x27;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; getBazA &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;baz&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;a&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;getBazA&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;obj&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// =&amp;gt; 1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Great! &amp;quot;But what about that is safe? All the properties you asked for are present!&amp;quot; Glad you asked:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; pipe &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;ramda&amp;#x27;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foo&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;bar&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; baz&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; a&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; getSomethingThatDoesNotExist &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&amp;#x27;foo&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&amp;#x27;bar&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&amp;#x27;baz&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&amp;#x27;theLastPropertyIPromise&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&amp;#x27;justKiddingOneMore&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;getSomethingThatDoesNotExist&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;obj&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// =&amp;gt; undefined&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Thanks Ramda! Hindquarters, yet again, saved. Note that &lt;code&gt;undefined&lt;/code&gt;, a falsy value is returned. Very useful for presence checks! Let&amp;#x27;s apply our new learnings to our &lt;code&gt;&amp;lt;Entry /&amp;gt;&lt;/code&gt; component:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; isNil&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; isEmpty&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; complement&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; prop &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;ramda&amp;#x27;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; getUser &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;user&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; userIsPresent &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pipe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    getUser&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;complement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isNil&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;Entry&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; client &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Query&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;currentUserQuery&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; loading&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; data &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;isNil&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;loading&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;isEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;posts&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;NoPosts&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;userIsPresent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; user &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getUser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token function&quot;&gt;setErrorTrackingContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token function&quot;&gt;getPostMetaData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;user&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;// code that renders things here&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Query&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Looking better for sure. Further refactoring could be done in our second &lt;code&gt;if&lt;/code&gt; condition. For fun, see if you can figure out how to use Ramda to bring that &lt;code&gt;if&lt;/code&gt; into one function. Answer is at the end of this post!&lt;/p&gt;&lt;h2&gt;Prep Your Props With &lt;code&gt;evolve&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;Transforming component props into something useful is common practice. Let&amp;#x27;s take a look at this example where we concat a first and last name as well as format a date:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;NameAndDateDisplay&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; date&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; firstName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; lastName &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      Hello &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;firstName&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toUpperCase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;lastName&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toUpperCase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;!
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;It is &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;dayjs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;date&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;M/D/YYYY dddd&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Straightforward, but there is something fishy about this code, though. Can you spot it? The problem is that it&amp;#x27;s a little &lt;em&gt;too&lt;/em&gt; straightforward. When working with real data, real API&amp;#x27;s, and real code that humans have written, things aren&amp;#x27;t always straightforward. Sometimes you are working on a project that consumes a third-party API and you don&amp;#x27;t have full control on what you get back from the server.&lt;/p&gt;&lt;p&gt;In these cases, we tend to throw all of our logic in our component bodies, like so:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;NameAndDateDisplay&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; date&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; firstName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; lastName &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; formattedDate &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;formatDate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;date&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; formattedFirstName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;formatFirstName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;firstName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; formattedLastName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;formatLastName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lastName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        Hello &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;firstName&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;lastName&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;!
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;It is &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;formattedDate&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This presents a few issues. Some very important logic is tied to the body of our component, making testing difficult. The only way to test those formatters is to render the component. Also, it&amp;#x27;s &lt;em&gt;really&lt;/em&gt; bloating the body of our component. In Rails you&amp;#x27;ll here &amp;quot;Fat models, skinny controllers&amp;quot;; an analogous term in React would be &amp;quot;Fat helpers, skinny component body&amp;quot;.&lt;/p&gt;&lt;p&gt;Luckily, Ramda&amp;#x27;s &lt;code&gt;evolve&lt;/code&gt; can really help us out. &lt;code&gt;evolve&lt;/code&gt; takes two arguments; the first is an object whose values are functions, and the second argument is the object you want to operate on.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; evolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; toUpper &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;ramda&amp;#x27;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;evolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foo&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; toUpper &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foo&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;weeee&amp;#x27;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// =&amp;gt; { foo: &amp;#x27;WEEEE&amp;#x27; }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Pretty neat! Two important things to note about &lt;code&gt;evolve&lt;/code&gt;: it&amp;#x27;s recursive and it doesn&amp;#x27;t operate on values you don&amp;#x27;t specify in the first argument.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; evolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; toUpper&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; add &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;ramda&amp;#x27;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; format &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;evolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  foo&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; toUpper&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  numbers&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; a&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  dontTouchMe&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;foobar&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; foo&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;weeee&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; numbers&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; a&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// =&amp;gt; { foo: &amp;#x27;WEEEE&amp;#x27;, numbers: { a: 5 }, dontTouchMe: &amp;#x27;foobar&amp;#x27; }&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;With this newfound knowledge, let&amp;#x27;s refactor our component:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; evolve&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; pipe &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;ramda&amp;#x27;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; prepProps &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;evolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  date&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; formatDate&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  firstName&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; formatFirstName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  lastName&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; formatLastName
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;NameAndDateDisplay&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; date&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; firstName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; lastName &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      Hello &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;firstName&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;lastName&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;!
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;It is &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;date&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pipe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;prepProps&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; NameAndDateDisplay&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Sick! We have successfully split our formatting code away from our rendering code.&lt;/p&gt;&lt;h2&gt;Wrapping Up&lt;/h2&gt;&lt;p&gt;React and Ramda are both incredibly powerful tools. Learning how they work and interact together can simplify and speed up development time.&lt;/p&gt;&lt;p&gt;Going forward, keep Ramda in mind when you find yourself copying &amp;amp; pasting helper libraries from one project to the next. Odds are, a Ramda function exists that can accomplish the same task, and more! There are many, many more Ramda functions not covered in this article. Look to &lt;a href=&quot;https://ramdajs.com/docs/&quot;&gt;Ramda&amp;#x27;s documentation&lt;/a&gt; to learn more.&lt;/p&gt;&lt;h2&gt;Refactoring Answer&lt;/h2&gt;&lt;p&gt;Our second &lt;code&gt;if&lt;/code&gt; condition, fully refactored:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// setErrorTrackingContextAndGetPostMetaData.js&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; prop&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; pipe&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; complement&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; when&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; converge&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; curry&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; __ &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;ramda&amp;#x27;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; getUser &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;prop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;user&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; userIsPresent &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pipe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  getUser&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;complement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isNil&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; curriedGetPostMetaData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curry&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;getPostMetaData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;setErrorTrackingContextAndGetPostMetaData&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;client&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    userIsPresent&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;converge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;getUser&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;setErrorTrackingContext&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curriedGetPostMetaData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;__&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; setErrorTrackingContextAndGetPostMetaData

&lt;span class=&quot;token comment&quot;&gt;// Entry.js&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// in the body of &amp;lt;Entry /&amp;gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;setErrorTrackingContextAndGetPostMetaData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// ...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Have you called your method object lately?]]></title><description><![CDATA[Allow me to introduce you to another library that has proven itself
useful when writing Ruby: the  Procto  gem. Procto Overview Procto is a…]]></description><link>https://hint.io/blog/procto-method-object</link><guid isPermaLink="false">https://hint.io/blog/procto-method-object</guid><dc:creator><![CDATA[jasonDinsmore]]></dc:creator><pubDate>Mon, 10 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Allow me to introduce you to another library that has proven itself
useful when writing Ruby: the &lt;a href=&quot;https://github.com/snusnu/procto&quot;&gt;Procto&lt;/a&gt; gem.&lt;/p&gt;&lt;h2&gt;Procto Overview&lt;/h2&gt;&lt;p&gt;Procto is a gem that lets you turn a Ruby class into a method object.
This helps clean up code that instantiates a class
to perform a single task, calculation, etc.&lt;/p&gt;&lt;p&gt;To better understand what it&amp;#x27;s trying to facilitate, perhaps a review of method
objects in Ruby would help.&lt;/p&gt;&lt;h3&gt;Ruby Method Objects&lt;/h3&gt;&lt;p&gt;A method object is essentially an object that has a bound context and provides a
single method.&lt;/p&gt;&lt;p&gt;Consider this example:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;  &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; meth_obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:baz&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;method&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Array&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;#size()&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; meth_obj&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Method&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;Object&lt;/span&gt; 
  &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; meth_obj&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;call
  &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Above, &lt;code&gt;meth_obj&lt;/code&gt; is a method object that is bound to the array containing
&lt;code&gt;[:foo, :bar, :baz]&lt;/code&gt;. In this case, when &lt;code&gt;call&lt;/code&gt; is executed on the method
object, the &lt;code&gt;size&lt;/code&gt; message is passed to the context the method object is bound to
(&lt;code&gt;[:foo, :bar, :baz]&lt;/code&gt;) and the result is &lt;code&gt;3&lt;/code&gt;. Interestingly (though unrelated),
Ruby allows you to unbind and rebind in cases like this.&lt;/p&gt;&lt;p&gt;For example:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;  &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; meth_obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:baz&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;method&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; meth_obj&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;call
  &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; meth_obj &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; meth_obj&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;unbind&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;bind&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:waldo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:fred&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; meth_obj&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;call
  &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Use&lt;/h2&gt;&lt;p&gt;To use Procto, you&amp;#x27;ll need to ensure you&amp;#x27;ve got the gem installed and that it
has been loaded by your program or application. If the gem is available, but
hasn&amp;#x27;t been loaded, you can just use &lt;code&gt;require &amp;#x27;procto&amp;#x27;&lt;/code&gt; at the top of your Ruby
class.&lt;/p&gt;&lt;p&gt;Once the gem is loaded and available for you to use, you&amp;#x27;ll just need to:
&lt;code&gt;include Procto.call&lt;/code&gt; right after your class definition, ala:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;procto&amp;#x27;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Foo&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Procto&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;call

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bar&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token variable&quot;&gt;@bar&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bar
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;call&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# do stuff&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;When invoking your class, you will supply &lt;code&gt;call&lt;/code&gt; with the parameters you would
normally pass to your class&amp;#x27;s initializer.&lt;/p&gt;&lt;p&gt;E.g.:&lt;/p&gt;&lt;p&gt;Instead of &lt;code&gt;Foo.new(bar).call&lt;/code&gt;, you would do &lt;code&gt;Foo.call(bar)&lt;/code&gt;.&lt;/p&gt;&lt;h2&gt;Blocks&lt;/h2&gt;&lt;p&gt;Although Procto is &lt;em&gt;very&lt;/em&gt; useful, it&amp;#x27;s not the answer for everything. One thing
you might find yourself wanting to do is pass a block to your &lt;code&gt;call&lt;/code&gt; method.
Unfortunately, Procto does not support this.&lt;/p&gt;&lt;p&gt;Consider the following code:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FooWithBlock&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Procto&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;call

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bar&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token variable&quot;&gt;@bar&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bar
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;call&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# do something&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;yield&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; block_given&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt;

  attr_reader &lt;span class=&quot;token symbol&quot;&gt;:bar&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You might expect to be able to use the above code like this:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;FooWithBlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;call&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;Hello&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  puts &lt;span class=&quot;token string&quot;&gt;&amp;quot;I&amp;#x27;m in a block!&amp;quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Sadly, your block will never be executed.&lt;/p&gt;&lt;p&gt;If you &lt;em&gt;need&lt;/em&gt; to do the above, you&amp;#x27;ll have to do so without using Procto, so
you&amp;#x27;d need to remove &lt;code&gt;include Procto.call&lt;/code&gt; from your class, and invoke your
class as follows:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;FooWithBlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;Hello&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;call &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
  puts &lt;span class=&quot;token string&quot;&gt;&amp;quot;I&amp;#x27;m in a block!&amp;quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Bonus&lt;/h2&gt;&lt;p&gt;If you haven&amp;#x27;t used it before, I also highly recommend the
&lt;a href=&quot;https://github.com/mbj/concord&quot;&gt;Concord gem&lt;/a&gt;. When used in conjunction with
Procto, it really creates a nice interface for invoking method objects.&lt;/p&gt;&lt;p&gt;Concord abstracts away having to define the initializer and attribute accessors
for your class and its attributes. It also happens to play very nicely with
Procto.&lt;/p&gt;&lt;p&gt;Using both, you can turn:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Foo&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;initialize&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; baz&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token variable&quot;&gt;@bar&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bar
    &lt;span class=&quot;token variable&quot;&gt;@baz&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; baz
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;call&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# do stuff&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;protected&lt;/span&gt;

  attr_reader &lt;span class=&quot;token symbol&quot;&gt;:bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:baz&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token constant&quot;&gt;For&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; baz&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;call&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Into:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Foo&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Concord&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:baz&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Procto&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;call

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;call&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# do stuff&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token constant&quot;&gt;Foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;call&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;bar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; baz&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I should mention that Concord limits your initializer to three parameters.
You can work around this by passing a more complex data structure as one
(or more) of the parameters, and extracting the parameters from that object, or
by using the &lt;a href=&quot;https://github.com/mbj/anima&quot;&gt;Anima gem&lt;/a&gt; instead, which does not
cap the number of parameters you can pass, but takes an initialization hash
(keyword arguments) instead of parameters.&lt;/p&gt;&lt;h2&gt;Summary&lt;/h2&gt;&lt;p&gt;Procto is a fantastic tool for cleaning up your class&amp;#x27;s interface. When used
in conjunction with the Concord gem, you&amp;#x27;ll find yourself writing significantly
less boilerplate code to get your classes up and running. Your code will also
end up generating a smaller abstract syntax tree (AST), which is generally a
very good thing.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[I Updated Rails. Now Everything's on Fire.]]></title><description><![CDATA[Following up on my  best practices post , I have a prime example of one common issue that surfaces when upgrading a Rails app. I decided to…]]></description><link>https://hint.io/blog/updated-rails-everything-is-on-fire</link><guid isPermaLink="false">https://hint.io/blog/updated-rails-everything-is-on-fire</guid><dc:creator><![CDATA[nateVick]]></dc:creator><pubDate>Mon, 03 Jun 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Following up on my &lt;a href=&quot;https://hint.io/blog/rails-6-upgrade-best-practices&quot;&gt;best practices post&lt;/a&gt;, I have a prime example of one common issue that surfaces when upgrading a Rails app.&lt;/p&gt;&lt;p&gt;I decided to spike on upgrading a small internal app to Rails &lt;code&gt;6.0.0.rc1&lt;/code&gt;. The test suite is green on Rails &lt;code&gt;5.2.3&lt;/code&gt; and Ruby &lt;code&gt;2.6.2&lt;/code&gt;, so I bumped the Rails version in the Gemfile.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;source &lt;span class=&quot;token string&quot;&gt;&amp;#x27;&amp;lt;https://rubygems.org&amp;gt;&amp;#x27;&lt;/span&gt;
git_source&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:github&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;repo&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;&amp;lt;https://github.com/&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;repo&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;.git&amp;gt;&amp;quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

ruby &lt;span class=&quot;token string&quot;&gt;&amp;#x27;2.6.2&amp;#x27;&lt;/span&gt;

gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;rails&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;6.0.0.rc1&amp;#x27;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In the terminal, I ran &lt;code&gt;bundle update rails&lt;/code&gt; and it updated without issue (I mentioned this is a small app, right?). Even on small apps, this should make you raise an eyebrow.&lt;/p&gt;&lt;p&gt;Skeptically, I ran the test suite.&lt;/p&gt;&lt;p&gt;Errors all the way down.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;An error occurred &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; loading ./spec/services/step_processor_spec.rb.
Failure/Error: require File.expand_path&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;../../config/environment&amp;#x27;&lt;/span&gt;, __FILE__&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

TypeError:
  Rails::SourceAnnotationExtractor is not a class/module
&lt;span class=&quot;token comment&quot;&gt;# /gems/gems/haml-rails-1.0.0/lib/haml-rails.rb:49:in `block in &amp;lt;class:Railtie&amp;gt;&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# ...more output...&lt;/span&gt;

Finished &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.00027&lt;/span&gt; seconds &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;files took &lt;span class=&quot;token number&quot;&gt;1.41&lt;/span&gt; seconds to load&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; examples, &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; failures, &lt;span class=&quot;token number&quot;&gt;17&lt;/span&gt; errors occurred outside of examples&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Based on the error, let&amp;#x27;s take a look at &lt;code&gt;haml-rails&lt;/code&gt; and &lt;code&gt;SourceAnnotationExtractor&lt;/code&gt; in Rails to see what changed and if there is a newer version of &lt;code&gt;haml-rails&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;But wait. You may ask: &amp;quot;Why not try upgrading the gem and move on?&amp;quot;. Taking the time to understand the root cause of a problem provides confidence in the solution and clear direction to resolve broader symptoms throughout the codebase.&lt;/p&gt;&lt;div class=&quot;callout&quot;&gt;Taking the time to understand the root cause of a problem provides confidence in the solution and clear direction to resolve broader symptoms throughout the codebase.&lt;/div&gt;&lt;p&gt;Here is line 49 in &lt;code&gt;lib/haml-rails.rb&lt;/code&gt;:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;SourceAnnotationExtractor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Annotation&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;register_extensions&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;haml&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;tag&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Sure enough, there is a change in Rails 6 that moves &lt;code&gt;SourceAnnotationExtractor&lt;/code&gt; to &lt;code&gt;Rails::SourceAnnotationExtractor&lt;/code&gt; (&lt;a href=&quot;https://github.com/rails/rails/pull/32065&quot;&gt;PR #32065&lt;/a&gt;). The top-level class has been deprecated, but the deprecation warning does not apply to the sub-classes which raise the &lt;code&gt;TypeError&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Knowing the source of the error, we can check if there is a newer version of &lt;code&gt;haml-rails&lt;/code&gt; compatible with Rails 6. Again, you will find value by not just upgrading the gem, but understanding the changes in the newer versions. With &lt;code&gt;haml-rails&lt;/code&gt;, there is a newer version that has a fix for the issue. By bumping up to that version, I&amp;#x27;m able to run the test suite without errors and get back to the upgrade at hand.&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;https://calendly.com/natevick/upgrade-intro-call&quot;&gt;Schedule a quick call&lt;/a&gt; with me to see how our expertise can keep your team delivering features during your Rails upgrade.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Rails 6 Upgrade Best Practices]]></title><description><![CDATA[Rails 6 is right around the corner, 6.0.0.rc1 was released in late April. Is your app ready for the latest version of Rails? Follow these…]]></description><link>https://hint.io/blog/rails-6-upgrade-best-practices</link><guid isPermaLink="false">https://hint.io/blog/rails-6-upgrade-best-practices</guid><dc:creator><![CDATA[nateVick]]></dc:creator><pubDate>Mon, 06 May 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Rails 6 is right around the corner, 6.0.0.rc1 was released in late April. Is your app ready for the latest version of Rails? Follow these best practices to make your upgrade go as smoothly as possible.&lt;/p&gt;&lt;h2&gt;Make a Plan&lt;/h2&gt;&lt;p&gt;The first step of any upgrade should be to determine your current Ruby and Rails versions, then collect data about your code, test suite, and their dependencies. Part of your planning will be to decide what can be done before the upgrade and what can be put off until after. You always want to limit the scope of the changes, so when errors occur it is much simpler to nail down the change(s) that caused the errors.&lt;/p&gt;&lt;p&gt;&lt;em&gt;Note:&lt;/em&gt;  We recommend migrating to new Rails conventions sooner rather than later. Too many teams choose to put off these migrations, which often means not coming back to them until they are forced by the next major Rails upgrade.&lt;/p&gt;&lt;h3&gt;Ruby and Rails&lt;/h3&gt;&lt;p&gt;Rails 5.x requires Ruby 2.2.2 or newer, while Rails 6.x requires Ruby 2.5.0 or newer. Run &lt;code&gt;ruby -v&lt;/code&gt; from within your project to see what version of Ruby your app is on. If you&amp;#x27;re on an old version, then you will need to upgrade Ruby before you upgrade Rails.&lt;/p&gt;&lt;p&gt;Rails &lt;code&gt;5.2.3&lt;/code&gt; is the &lt;a href=&quot;https://rubygems.org/gems/rails/versions&quot;&gt;current stable version&lt;/a&gt;. We recommend upgrading to the latest patch version of the minor version your app is on before taking the next step in the upgrade. For example, if your app is on &lt;code&gt;5.2.0&lt;/code&gt; then you will update to &lt;code&gt;5.2.3&lt;/code&gt;. There should not be any issues making this patch update since patch releases are only bug and security fixes. The Rails Core Team states they will make API and feature changes for security fixes, so this is the reasoning of validating the latest patch version.&lt;/p&gt;&lt;h3&gt;App Review&lt;/h3&gt;&lt;p&gt;When reviewing your app, one of the first things to do is check the production logs for any deprecation warnings. Over the years, the Rails Core Team has implemented a strong deprecation policy, so these are very helpful warnings to clear up before the upgrade. Many gem developers have implemented similar deprecation policies, so don&amp;#x27;t ignore those while doing this work.&lt;/p&gt;&lt;p&gt;&lt;em&gt;Note:&lt;/em&gt; All too often, we see that people have disabled deprecation warnings in the production and test environments. Be skeptical if you don&amp;#x27;t see any deprecations in those log files.&lt;/p&gt;&lt;p&gt;Review any monkeypatches as they will most likely need to be modified to work with the next version of Rails. This is a great time to look at new Rails APIs to decide if there is a Rails way to replace them.&lt;/p&gt;&lt;p&gt;Look for any uses of undocumented Rails methods. The Rails Core Team considers any undocumented method as private and changeable at any time. If you discover any, make sure to review the changes in the next version of Rails. This is a great time to decide if this code currently necessary or if you should replace the usage with a more solid solution.&lt;/p&gt;&lt;h3&gt;Test Suite&lt;/h3&gt;&lt;p&gt;A solid automated test suite is invaluable when performing an upgrade; tests ensure that your app executes the same way before and after the upgrade.&lt;/p&gt;&lt;p&gt;How many lines of code are covered? Get your latest coverage stats and look for the holes. Test coverage isn&amp;#x27;t everything, but is a metric to help ensure your code paths are being exercised by your test suite. Your test suite doesn&amp;#x27;t just validate that needed changes return the same results, it also exercises the code paths of the app which will bubble up deprecation warnings. If you have little or low test coverage, or you are generally not confident in the suite, now is the time to invest in strengthening it.&lt;/p&gt;&lt;h3&gt;Gem Dependencies&lt;/h3&gt;&lt;p&gt;Many surprises could be lurking for you in your &lt;code&gt;Gemfile&lt;/code&gt;. The best way to get a clear picture of which dependencies will need to be upgraded alongside Rails is to use Bundler to step through the upgrade, with the goal of a successful build.&lt;/p&gt;&lt;p&gt;Let&amp;#x27;s say your app is currently locked at Rails &lt;code&gt;5.1.7&lt;/code&gt;. Your first step to getting to Rails 6.0 will be to bump Rails to &lt;code&gt;5.2.3&lt;/code&gt; (currently the latest in the &lt;code&gt;5.x&lt;/code&gt; series) then run &lt;code&gt;bundle update rails&lt;/code&gt;.&lt;/p&gt;&lt;p&gt;Bundler will attempt to bundle the app against Rails &lt;code&gt;5.2.3&lt;/code&gt; but will most likely require other gems to be updated.&lt;/p&gt;&lt;p&gt;The output from Bundler can be daunting, but for the sake of brevity let&amp;#x27;s say one gem that needed to be updated is &lt;code&gt;devise&lt;/code&gt;. Once you find a compatible version of &lt;code&gt;devise&lt;/code&gt; you continue to run &lt;code&gt;bundle update&lt;/code&gt; adding each gem to the list as necessary until you get the app to bundle. Once it is bundled on &lt;code&gt;5.2.3&lt;/code&gt; you would follow the same pattern to upgrade to Rails 6.0.&lt;/p&gt;&lt;p&gt;Now that you have a dependency roadmap it is time to review which gems can be upgraded now and get them into production. It is especially important in the case of gems that require syntax changes to upgrade them separately from the Rails upgrade. If the gem is not required to be upgraded then now is &lt;em&gt;not&lt;/em&gt; the time to upgrade the gem and it should be added to the post-upgrade list of projects.&lt;/p&gt;&lt;h3&gt;Pre-Upgrade Plan&lt;/h3&gt;&lt;p&gt;Since you have collected all the data, let&amp;#x27;s review some things that should be tackled before jumping into the actual upgrade. Each of these steps should go through your production release process separately.&lt;/p&gt;&lt;ol&gt;&lt;li&gt;Upgrade Ruby to a compatible version for the target version of Rails&lt;/li&gt;&lt;li&gt;Update Rails to the current patch version&lt;/li&gt;&lt;li&gt;Resolve all deprecation warnings&lt;/li&gt;&lt;li&gt;Ensure compatibility of monkeypatches or calls to private Rails methods&lt;/li&gt;&lt;li&gt;Expand the test suite where needed&lt;/li&gt;&lt;li&gt;Review your gem dependency roadmap and upgrade gems that are compatible with your current version of Rails&lt;/li&gt;&lt;/ol&gt;&lt;h2&gt;Rails Upgrade&lt;/h2&gt;&lt;p&gt;With the pre-upgrade work done and in production it is time to begin upgrading Rails.&lt;/p&gt;&lt;h3&gt;Bundle and Boot&lt;/h3&gt;&lt;p&gt;The first step is to use the dependency roadmap as a guide to get the app to bundle with the next version of Rails. Once it is bundled you need to work on getting the app to boot. We generally try to run the test suite since that is what will be used to iterate changes needed to support the next version of Rails.&lt;/p&gt;&lt;p&gt;At this point, there will probably be errors due to configuration that must be changed to be compatible with the new version of Rails. The official &lt;a href=&quot;https://guides.rubyonrails.org/upgrading_ruby_on_rails.html&quot;&gt;Upgrade Ruby on Rails&lt;/a&gt; guide is a good place to look for these needed Rails configuration changes.&lt;/p&gt;&lt;h3&gt;Iterate, Iterate, Iterate&lt;/h3&gt;&lt;p&gt;Now, you can start iterating on the many test failures you undoubtedly have at the moment. You will benefit by starting at low-level tests like unit specs and working up to browser specs. Next, parse the output of the test suite and group the failures by similar type to be fixed at the same time. While iterating over the test suite, do your future-self a favor and make small commits with verbose commit messages. A commit message like &lt;code&gt;fixed spec&lt;/code&gt; is not going to be helpful when you have a production error and you need to know why you had to make that change in the first place.&lt;/p&gt;&lt;p&gt;Once you have a green test suite, you can move on to clearing up deprecation warnings. Again, parse the output of the test suite and group the deprecations by type - then start iterating on them.&lt;/p&gt;&lt;p&gt;With a green test suite and deprecation warnings cleaned up, it is time to follow your process for getting new code into production!!!&lt;/p&gt;&lt;h2&gt;Post-Upgrade Plan&lt;/h2&gt;&lt;p&gt;After the upgrade is in production and any issues have been resolved, it is time to circle back around to the items you held off on earlier. Where possible, opt-in to new configuration, migrate to new tools and features of Rails (ActionText, Webpacker, parallel testing), and update gems to the latest version you&amp;#x27;re able to.&lt;/p&gt;&lt;p&gt;If you would rather stay focused on shipping features, let us build a plan, expand your test suite, or perform the entire upgrade. &lt;a href=&quot;https://www.upgraderails.com&quot;&gt;Contact us&lt;/a&gt; at UpgradeRails.com to tell us more about your upgrade.&lt;/p&gt;&lt;h2&gt;Helpful Links&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html&quot;&gt;Official Rails Upgrade Guide&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;http://guides.rubyonrails.org/maintenance_policy.html&quot;&gt;Rails Maintenance Policy&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://www.ruby-lang.org/en/news/2019/03/31/support-of-ruby-2-3-has-ended/&quot;&gt;Ruby Version Support List&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Moderate Parameters: The Path From Protected Attributes to Strong Parameters]]></title><description><![CDATA[We all know Strong Parameters isn't exactly cutting edge technology in 2019. It was originally introduced in Rails 3.2 (March 20, 2012) and…]]></description><link>https://hint.io/blog/moderate-parameters</link><guid isPermaLink="false">https://hint.io/blog/moderate-parameters</guid><dc:creator><![CDATA[kyleBoe]]></dc:creator><pubDate>Tue, 23 Apr 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;We all know Strong Parameters isn&amp;#x27;t exactly cutting edge technology in 2019. It was originally introduced in Rails 3.2 (March 20, 2012) and was made the default/standard in 4.0 (June 25, 2013).&lt;/p&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:650px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:95.0920245398773%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAAE5klEQVQ4yyWTWXNTBQCFrzCIoiBCBUvL0hZis3RLmjTN2iw3y03vmntzsze0tFRKqUVKBVxQEaVgKW5FXABfnFHHYRxGedMXngSXX/Q5xYfz+s2Z880R5hcmOfXaUV6da/L9T/f57fe/+fnXh6x9fou1zz7li5vrrN9c5/qNVa6sfMCl99/kwvkTzEyX0JU0UnqYbMxBKtKFoYQRpqarTM1UqU8YXLz0AT/88gf3Hjxk/fZdVlavcunyZRZOztIoG9RtnalWldML0yyenmQ8HyEd6yMV6kZKuGhUCgilsky1oVNvmUxMlfnx3gM+/+pbrt1Y4+Pra0w1y2SCbiwx8iTR/iMUxkaoGBKGmkUS/WjSKDVTpFIUEeyKQq1pMHW8hl1TWFm9xtXVq7z5zkUW5mfJRQaYrzb45Nz7rC+/wblGmboUxUgFMaUMJTVFNtFPQfShj48i2FWZetPg1ZPHnrRcWn6NlZUrLJyaRxaDlKUMlxfPc2PpHF8vL3Hr9Bwzyhj1QhRTDNFQElj5ERIhB6YSQbDsAqaVo94qYlVl3nrrDB9eegdNSiJGvczWGny0eJYbZ8/z7bllvls+xUk9TSUbpCqNUc7FOKqnKKlxbC2GYNoypl2g2tAw7AJnzsyzeGIa/0APvv5uMuEAC7USFyZt5qwCV060OGVmqIoB9ESACTXJbClLsyRR0eMIhjWOVZaxyxrVWpFms4JWGMNxaBep6CjHJ2b4dHGB1RN1ZuwiizWZuWISOzGE6HdQyY8yW0rTKmWxi0mEoqlgmHlKZZ1Wq85Eo0wy4iXsc9EsmixNznLn9Bx3z8xza3mJq3MNlsoZCkE3ab+TSm6U41aKhpnFNvMIZklF1SV0o0C9alKvFFHHM+RTUcbTCfLhISazQV63JT6arvHelMGMFkUK95ENuqnkQ1TyESZtlWZV3bBsoFsyRUulVrGwiiqakkdKhYn0O0h6nWS8DvTYALOWyDEjRTHlR44NkBtxURL/33GmotOsahtAjQ1ofaKGZWgoUppcIkwuNoSRGqGZS1KK+ZDDfejJYazsKGrCSz7kJhNwUUz6mTKSHKuqNCoqgqqL1GoWupYnJ8bJJkPEgn3EAx7kdJDx+DCpYTfZoIf08CtIEQ+5YC+pgIN00IUa89HSxqgWM5TNHIKiZtE1FVFMMOg5iH/wMK4j++hzdhINuBns7cTds5cRTyc+xx68PbuJew/S27WbyGAXlVyAaTNN3di4Xg4hI2XwB3wkYgGc3W0c7NjJ7l3baWt7HmfPHnq7X6Kncwd9h9sY6HqR/gM7aW97lp3btxB0dqCGjnBUjdHU09R1EWHvoZdxOg4w5j3AK53b2LZVYNNTAk8JAk9vFtj7wmZefE6ga9cm+vZspmOHQPuup3lhq0DvgR1k/d0oUQ/Z0ABybgzh2Z3PMDJ4hIx/HxFPO7qcwVJENClBMhFGzkTJbEgSY6TCgyi5MYpygvF8nLqtoiV8pEZ6SQZdJBMBhG3bn6Hf2UXc24Ecc/Ho0WP+/PMRf//zL+ufrHHx/DL379/n8eO/uP3NV9y5c5v33n2bL29+wfVrK5SkEBFvB8nRLsYLfoTNWzbR2bEbn6udUP8+lKSTuuJjQvFRlKL4BxwMufYz4jlE1N1ONuwh6O1lyL2f+PBhVHEYWQ6jKVFaTYP/AIzl2o2LFVjRAAAAAElFTkSuQmCC&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;image&quot; title=&quot;image&quot; src=&quot;/static/a1c2a00be739027341934957249b0899/a6d36/whatyearisit.png&quot; srcSet=&quot;/static/a1c2a00be739027341934957249b0899/222b7/whatyearisit.png 163w,/static/a1c2a00be739027341934957249b0899/ff46a/whatyearisit.png 325w,/static/a1c2a00be739027341934957249b0899/a6d36/whatyearisit.png 650w,/static/a1c2a00be739027341934957249b0899/8ae3e/whatyearisit.png 756w&quot; sizes=&quot;(max-width: 650px) 100vw, 650px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;p&gt;Even with Strong Parameters 7 years in the rear view mirror, there was still legacy security support in the form of the &lt;code&gt;protected_attributes&lt;/code&gt; gem. However, with the release of Rails 5, this gem was officially unmaintained.&lt;/p&gt;&lt;p&gt;Based on our &lt;a href=&quot;https://www.upgraderails.com&quot;&gt;UpgradeRails&lt;/a&gt; experience helping clients move to the latest and greatest versions of Rails, this is still a large technical hurdle that many teams face.&lt;/p&gt;&lt;p&gt;With this in mind, we built a tool that allows for safe and confident migration to strong parameters.&lt;/p&gt;&lt;p&gt;We call it Moderate Parameters.&lt;/p&gt;&lt;h2&gt;Here&amp;#x27;s How It Works&lt;/h2&gt;&lt;p&gt;Moderate Parameters is a tool that provides safety nets and logging of data sources in the controller by extending &lt;code&gt;ActionController::Parameters&lt;/code&gt; functionality.&lt;/p&gt;&lt;p&gt;Add the gem (&lt;a href=&quot;https://github.com/hintmedia/moderate_parameters&quot;&gt;repo&lt;/a&gt;/&lt;a href=&quot;https://rubygems.org/gems/moderate_parameters&quot;&gt;rubygems&lt;/a&gt;) to your application&amp;#x27;s Gemfile:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;gem &lt;span class=&quot;token string&quot;&gt;&amp;#x27;moderate_parameters&amp;#x27;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Then, inside of the recommended strong parameters private method, replace &lt;code&gt;permit&lt;/code&gt; with &lt;code&gt;moderate&lt;/code&gt; and add a little context:&lt;/p&gt;&lt;p&gt;&lt;em&gt;(Note:&lt;/em&gt; &lt;code&gt;controller_path&lt;/code&gt; &lt;em&gt;and&lt;/em&gt; &lt;code&gt;action_name&lt;/code&gt; &lt;em&gt;need to be included as shown. They are methods that provide naming context for the logger.)&lt;/em&gt;&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UsersController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ActionController&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Base&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# def user_params&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#   params.require(:user).permit(:email, :first_name, . . .)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# end&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;user_params&lt;/span&gt;&lt;/span&gt;
    params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;moderate&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;controller_path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; action_name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:email&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:first_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;And...that&amp;#x27;s it.&lt;/p&gt;&lt;p&gt;Moderate Parameters will begin logging controller context and parameter keys that have not yet been whitelisted. This means that, in the above example, if you forgot to include &lt;code&gt;:last_name&lt;/code&gt; in the list of permitted parameters while creating a user, your log would look like this:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;log&quot;&gt;&lt;pre class=&quot;language-log&quot;&gt;&lt;code class=&quot;language-log&quot;&gt;Users#create is missing :last_name from the permitted parameters&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;Test Like You Fly&lt;/h2&gt;&lt;p&gt;We have built Moderate Parameters to be deployed to production. This way we can ensure that all parameters are being accounted for every controller in the entire Rails app. Data will still flow through the app as expected, with the added benefit of painting a clear picture of what moving to Strong Parameters **looks like.&lt;/p&gt;&lt;p&gt;Once the full parameter list has been clearly outlined (meaning your Moderate Parameters logs are empty), switching over to Strong Parameters is as easy as swapping &lt;code&gt;moderate&lt;/code&gt; for &lt;code&gt;permit&lt;/code&gt;:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UsersController&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ActionController&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Base&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token method-definition&quot;&gt;&lt;span class=&quot;token function&quot;&gt;user_params&lt;/span&gt;&lt;/span&gt;
    params&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:user&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;permit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token symbol&quot;&gt;:email&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:first_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token symbol&quot;&gt;:last_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# def user_params&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#   params.require(:user).moderate(controller_path, action_name, :email, :first_name, :last_name)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# end&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2&gt;We Can Help!&lt;/h2&gt;&lt;p&gt;We have built up a set of services that can run alongside Moderate Parameters in production to procedurally parse and generate exactly what Strong Parameters should look like.&lt;/p&gt;&lt;p&gt;If Strong Parameters or something like it is preventing you or your team from enjoying the latest in Rails security and features, let us help you ensure your success. Our team has decades of experience helping teams turn unmanageable upgrades into cutting-edge products taking advantage of all that Rails has to offer.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Gems, Some of Our Favorites - PaperTrail + PaperTrailScrapbook]]></title><description><![CDATA[This is the first in a series of blog posts taking an introductory look at various Ruby gems that we find useful and regularly use or have…]]></description><link>https://hint.io/blog/paper-trail-scrapbook</link><guid isPermaLink="false">https://hint.io/blog/paper-trail-scrapbook</guid><dc:creator><![CDATA[jasonDinsmore]]></dc:creator><pubDate>Fri, 02 Mar 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;This is the first in a series of blog posts taking an introductory look at various Ruby gems that we find useful and regularly use or have used in our projects over the years.&lt;/p&gt;&lt;p&gt;Today I am going to cover two related gems: PaperTrail, and PaperTrailScrapbook. These gems facilitate keeping an auditable trail of changes made to rows of a tracked table in your Rails application&amp;#x27;s database.&lt;/p&gt;&lt;hr/&gt;&lt;h2&gt;PaperTrail&lt;/h2&gt;&lt;h3&gt;Overview&lt;/h3&gt;&lt;p&gt;The &lt;a href=&quot;https://github.com/airblade/paper_trail&quot;&gt;PaperTrail gem&lt;/a&gt; allows you to track changes made to your Rails models over time. Any time a tracked record in your database is changed, it creates a corresponding entry in a &lt;code&gt;PaperTrail::Version&lt;/code&gt; table. It accomplishes this by tying into the ActiveRecord callback chain and storing a new version when the record is created, updated, or destroyed.&lt;/p&gt;&lt;h3&gt;Setup&lt;/h3&gt;&lt;p&gt;To start using PaperTrail, you&amp;#x27;ll need to follow the steps outlined in the README on the project&amp;#x27;s GitHub page, which essentially guide you through the process of adding the gem to your gemfile, bundling, and then generating and running a migration that creates the &lt;code&gt;PaperTrail::Version&lt;/code&gt; table. This table will be leveraged to store an entry for each &amp;quot;version&amp;quot; of your model.&lt;/p&gt;&lt;h3&gt;Use&lt;/h3&gt;&lt;p&gt;Once you&amp;#x27;ve got the gem set up, you can start using it. To start tracking versions for a model, you&amp;#x27;ll just need to add &lt;code&gt;has_paper_trail&lt;/code&gt; to your model file (usually near the top, inside the class):&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyModel&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;ApplicationRecord&lt;/span&gt;
  has_paper_trail
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now that your versions are being tracked, you will be able to go into your Rails console and view the various versions of your models using PaperTrail&amp;#x27;s API.&lt;/p&gt;&lt;p&gt;For a specific object, &lt;code&gt;obj&lt;/code&gt;, you can access a collection of its versions using: &lt;code&gt;obj.versions&lt;/code&gt;. This will show you a list of versions that each have this structure:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;#&amp;lt;PaperTrail::Version:0x007fe111b03f70&amp;gt; {&lt;/span&gt;
                    &lt;span class=&quot;token symbol&quot;&gt;:id&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;314159&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
             &lt;span class=&quot;token symbol&quot;&gt;:item_type&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;Invoice&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
               &lt;span class=&quot;token symbol&quot;&gt;:item_id&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;555&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                 &lt;span class=&quot;token symbol&quot;&gt;:event&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;update&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
             &lt;span class=&quot;token symbol&quot;&gt;:whodunnit&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;1234&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token symbol&quot;&gt;:object&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;---\nid: 5455\nactor_id: 2183\nsale_id: \namount: !ruby/object:BigDecimal 27:0.1276E3\nauthorization_id: \npaid_on: \ncreated_at: 2018-02-15 17:14:16.718224000 Z\nupdated_at: 2018-02-16 17:14:16.718224000 Z\nstatus: active\n&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token symbol&quot;&gt;:created_at&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Mon&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;19&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Feb&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2019&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;59&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;49&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;08&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;00&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token symbol&quot;&gt;:object_changes&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;---\nsale_id:\n- \n - 123\npaid_on:\n- \n- 2018-02-20 20:39:19.956256107 Z\nauthorization_id:\n- 412\nupdated_at:\n- 2018-02-19 20:39:19.956256107 Z\n- 2018-02-19 19:59:49.270910041 Z\n&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The fields of a version break down like this:&lt;/p&gt;&lt;table&gt;&lt;thead&gt;&lt;tr&gt;&lt;th align=&quot;right&quot;&gt;Field&lt;/th&gt;&lt;th&gt;Description&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td align=&quot;right&quot;&gt;&lt;code&gt;id&lt;/code&gt;&lt;/td&gt;&lt;td&gt;The primary key for this &lt;code&gt;PaperTrail::Version&lt;/code&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td align=&quot;right&quot;&gt;&lt;code&gt;item_type&lt;/code&gt;&lt;/td&gt;&lt;td&gt;Type of record being tracked&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td align=&quot;right&quot;&gt;&lt;code&gt;item_id&lt;/code&gt;&lt;/td&gt;&lt;td&gt;The primary key of the record being tracked&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td align=&quot;right&quot;&gt;&lt;code&gt;event&lt;/code&gt;&lt;/td&gt;&lt;td&gt;The type of change that occurred&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td align=&quot;right&quot;&gt;&lt;code&gt;whodunnit&lt;/code&gt;&lt;/td&gt;&lt;td&gt;The &lt;code&gt;id&lt;/code&gt; of the person making the change (you can set the class of the &lt;code&gt;whodunnit&lt;/code&gt; in your PaperTrail configuration, ie. &lt;code&gt;User&lt;/code&gt;, &lt;code&gt;Actor&lt;/code&gt;, etc.)&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td align=&quot;right&quot;&gt;&lt;code&gt;object&lt;/code&gt;&lt;/td&gt;&lt;td&gt;A serialized version of the object being updated in its pre-update state&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td align=&quot;right&quot;&gt;&lt;code&gt;created_at&lt;/code&gt;&lt;/td&gt;&lt;td&gt;When this version was created&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td align=&quot;right&quot;&gt;&lt;code&gt;object_changes&lt;/code&gt;&lt;/td&gt;&lt;td&gt;A serialized list of changes that were applied to the object as shown in the &lt;code&gt;object&lt;/code&gt; field of the version&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;p&gt;PaperTrail also provides the ability to revert an object to a previous state. To restore an object to a previous version, you can  call &lt;code&gt;reify&lt;/code&gt; (which means to make something abstract more concrete or real) on the version.&lt;/p&gt;&lt;p&gt;For example, using the version from our last example:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;last_version &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;versions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;last  &lt;span class=&quot;token comment&quot;&gt;# gets PaperTrail::Version shown above&lt;/span&gt;
puts last_version&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;reify

&lt;span class=&quot;token constant&quot;&gt;Invoice&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;314159&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                  &lt;span class=&quot;token symbol&quot;&gt;:id&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;314159&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token symbol&quot;&gt;:actor_id&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2183&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
             &lt;span class=&quot;token symbol&quot;&gt;:sale_id&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token symbol&quot;&gt;:amount&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;27.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token symbol&quot;&gt;:authorization_id&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
             &lt;span class=&quot;token symbol&quot;&gt;:paid_on&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token symbol&quot;&gt;:created_at&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Mon&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;19&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Feb&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;59&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;49&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;08&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;00&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token symbol&quot;&gt;:updated_at&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Mon&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;19&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Feb&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;59&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;49&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;08&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;00&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token symbol&quot;&gt;:status&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;active&amp;#x27;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;code&gt;reify&lt;/code&gt; will give you an instance of the object that corresponds to the version before the &lt;code&gt;object_changes&lt;/code&gt; have been applied, which matches what is in the &lt;code&gt;object&lt;/code&gt; field of the version. &lt;/p&gt;&lt;p&gt;Calling &lt;code&gt;reify&lt;/code&gt; does not affect the object&amp;#x27;s current state in the database unless you call &lt;code&gt;save&lt;/code&gt; on the reified object. Doing so will persist the reified version to the database, creating a new version for the object in the process.&lt;/p&gt;&lt;h3&gt;Caveats&lt;/h3&gt;&lt;p&gt;PaperTrail falters a bit when tracking changes to a model&amp;#x27;s associations. For example, consider an &lt;code&gt;Invoice&lt;/code&gt; class that  &lt;code&gt;has_many :line_items&lt;/code&gt; where &lt;code&gt;LineItem&lt;/code&gt; &lt;code&gt;belongs_to :invoice&lt;/code&gt;. If you had an &lt;code&gt;invoice&lt;/code&gt; that has several &lt;code&gt;line_items&lt;/code&gt; associated with it, you could remove the line items by calling some code like:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;invoice&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;line_items &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
invoice&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;save&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If you did so and took a look at the tracked versions of one of the &lt;code&gt;line_items&lt;/code&gt; that had been associated with the &lt;code&gt;invoice&lt;/code&gt;, you&amp;#x27;d see that the removal of the &lt;code&gt;invoice_id&lt;/code&gt; from the &lt;code&gt;line_item&lt;/code&gt; was not captured in a version.&lt;/p&gt;&lt;p&gt;PaperTrail has some information in the project&amp;#x27;s &lt;a href=&quot;https://github.com/airblade/paper_trail#4b1-known-issues&quot;&gt;README&lt;/a&gt; mentioning this and suggests some &amp;quot;experimental&amp;quot; workarounds, but your mileage may vary.&lt;/p&gt;&lt;p&gt;In my opinion, PaperTrail&amp;#x27;s API is a bit cumbersome and does not provide a concise summary of the changes that have been made to a model over time. The information is definitely there, but extracting it into a meaningful, complete history can be painful.&lt;/p&gt;&lt;p&gt;This is where &lt;a href=&quot;https://github.com/tjchambers/paper_trail_scrapbook&quot;&gt;PaperTrailScrapbook&lt;/a&gt; comes in.&lt;/p&gt;&lt;hr/&gt;&lt;h2&gt;PaperTrailScrapbook&lt;/h2&gt;&lt;h3&gt;Overview&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/tjchambers/paper_trail_scrapbook&quot;&gt;PaperTrailScrapbook&lt;/a&gt; was conceptualized by &lt;a href=&quot;https://github.com/tjchambers&quot;&gt;Tim Chambers&lt;/a&gt; in 2017. Its intent is to provide a human-readable summary of changes made to a model tracked by PaperTrail. It accomplishes this by providing a simple interface to obtain either a complete history of an object, or a list of changes a specific person has made. &lt;em&gt;Disclaimer: I am a contributor on this project :)&lt;/em&gt;&lt;/p&gt;&lt;h3&gt;Setup&lt;/h3&gt;&lt;p&gt;To set up PaperTrailScrapbook, you&amp;#x27;ll just need to add &lt;code&gt;gem &amp;#x27;paper_trail_scrapbook&amp;#x27;&lt;/code&gt; to your Gemfile and bundle your application. The other thing you&amp;#x27;ll need to do is specify the class of your app&amp;#x27;s &lt;code&gt;whodunnit&lt;/code&gt;. Most often, this is going to be &lt;code&gt;User&lt;/code&gt;. I&amp;#x27;d recommend adding an initializer (e.g. &lt;code&gt;config/initializers/paper_trail_scrapbook.rb&lt;/code&gt;) for PaperTrailScrapbook.&lt;/p&gt;&lt;p&gt;If your whodunnit class is &lt;code&gt;User&lt;/code&gt;, your configuration would look similar to this:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;PaperTrailScrapbook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;configure &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;config&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;
  config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;whodunnit_class &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;User&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Once you&amp;#x27;ve got the configuration in place, restart your app server and you should be good to go.&lt;/p&gt;&lt;h3&gt;Use&lt;/h3&gt;&lt;p&gt;PaperTrailScrapbook currently has two modes of use, &lt;code&gt;LifeHistory&lt;/code&gt; and &lt;code&gt;UserJournal&lt;/code&gt;. Each mode provides a &lt;code&gt;story&lt;/code&gt; for a given object or &lt;code&gt;whodunnit&lt;/code&gt;. &lt;/p&gt;&lt;h4&gt;LifeHistory&lt;/h4&gt;&lt;p&gt;The &lt;code&gt;LifeHistory&lt;/code&gt; module takes a model instance as its argument, and generates a list of changes made to that object over time. &lt;/p&gt;&lt;p&gt;For example, the following query for history:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;widget &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;find&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;123&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

puts &lt;span class=&quot;token constant&quot;&gt;PaperTrailScrapbook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;LifeHistory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;widget&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;story&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Could output the following story:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;On&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Friday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;08&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Dec&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2017&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;01&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;AM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Fred&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Flintstone&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;fred&lt;span class=&quot;token variable&quot;&gt;@flinstone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; created the following &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt; info&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
 • name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Tricky&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Spinner&lt;/span&gt;
 • description&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
 • notes&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Recommended&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; ages &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; an up
 • created by&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Fred&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Flintstone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;123&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
 • pattern&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;386&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
 • price&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12.34&lt;/span&gt;
 • status&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inactive
 •&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;123&lt;/span&gt;

&lt;span class=&quot;token constant&quot;&gt;On&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Wednesday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Dec&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2017&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;53&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Barney&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Rubble&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;barney&lt;span class=&quot;token variable&quot;&gt;@rubble&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; updated the following &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt; info&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
 • name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Recommended&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; ages &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; an up &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Recommended&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; ages &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;and&lt;/span&gt; up
 • description&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;A&lt;/span&gt; fun spinning widget to keep your active fingers busy&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;
 • price&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12.34&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12.99&lt;/span&gt;

&lt;span class=&quot;token constant&quot;&gt;On&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Thursday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Dec&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2017&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;34&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Wilma&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Flintstone&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;wilma&lt;span class=&quot;token variable&quot;&gt;@flinstone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; updated the following &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt; info&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
 • price&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12.99&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11.99&lt;/span&gt;

&lt;span class=&quot;token constant&quot;&gt;On&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Wednesday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;03&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Jan&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;AM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Betty&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Rubble&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;betty&lt;span class=&quot;token variable&quot;&gt;@rubble&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; updated the following &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt; info&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
 • name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Tricky&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Spinner&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Spinning&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Trick&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt;
 • price&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11.99&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9.99&lt;/span&gt;
 • status&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inactive &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; active

&lt;span class=&quot;token constant&quot;&gt;On&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Wednesday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;05&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Jan&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Fred&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Flintstone&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;fred&lt;span class=&quot;token variable&quot;&gt;@flinstone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; updated the following &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt; info&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
 • name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Spinning&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Trick&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Spinning&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Brontosaurus&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt;
 • price&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11.99&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9.99&lt;/span&gt;
 • status&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inactive &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; active&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4&gt;UserJournal&lt;/h4&gt;&lt;p&gt;The &lt;code&gt;UserJournal&lt;/code&gt; module takes a &lt;code&gt;whodunnit&lt;/code&gt; instance as its primary argument and generates a summary of changes made by that person over time. It also provides options to scope the summary to a specific class and/or date range. This can be really useful as your app ages since the number of changes made by a person could grow quite large over time.&lt;/p&gt;&lt;p&gt;For example, searching by a specific &lt;code&gt;whodunnit&lt;/code&gt;:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;fred &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;find&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

puts &lt;span class=&quot;token constant&quot;&gt;PaperTrailScrapbook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;UserJournal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fred&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;story&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Could output the following history:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;Between&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Friday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;08&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Dec&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2017&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;01&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;AM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Wednesday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;05&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Jan&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Fred&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Flintstone&lt;/span&gt; made the following changes&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;

&lt;span class=&quot;token constant&quot;&gt;On&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Friday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;08&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Dec&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2017&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;01&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;AM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; created &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;123&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
 • name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Tricky&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Spinner&lt;/span&gt;
 • description&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
 • notes&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Recommended&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; ages &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; an up
 • created by&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Fred&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Flintstone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;123&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
 • pattern&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;386&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
 • price&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12.34&lt;/span&gt;
 • status&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inactive
 •&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;123&lt;/span&gt;

&lt;span class=&quot;token constant&quot;&gt;On&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Wednesday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Dec&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2017&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;31&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updated &lt;span class=&quot;token constant&quot;&gt;Wobble&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;538&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
 • on_hand&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;

&lt;span class=&quot;token constant&quot;&gt;On&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Thursday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Dec&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2017&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;34&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updated &lt;span class=&quot;token constant&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
 • favorite saying&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Yabba&lt;/span&gt; dabba &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Yabba&lt;/span&gt; dabba doo&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;

&lt;span class=&quot;token constant&quot;&gt;On&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Wednesday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;05&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Jan&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updated the following &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;123&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
 • name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Spinning&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Trick&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Spinning&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Brontosaurus&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt;
 • price&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11.99&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9.99&lt;/span&gt;
 • status&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inactive &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; active&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You can also scope changes to a specific class to hone in on the changes you&amp;#x27;re after. Consider the following where we look for changes Fred has made to instances of the &lt;code&gt;Widget&lt;/code&gt; class:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;fred &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;find&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

puts &lt;span class=&quot;token constant&quot;&gt;PaperTrailScrapbook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;UserJournal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fred&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; klass&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;story&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Which would output the following:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;Between&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Friday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;08&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Dec&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2017&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;01&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;AM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Wednesday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;05&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Jan&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Fred&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Flintstone&lt;/span&gt; made the following changes&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;

&lt;span class=&quot;token constant&quot;&gt;On&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Friday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;08&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Dec&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2017&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;01&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;AM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; created &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;123&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
 • name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Tricky&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Spinner&lt;/span&gt;
 • description&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
 • notes&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Recommended&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; ages &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; an up
 • created by&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Fred&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Flintstone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;123&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
 • pattern&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;386&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
 • price&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12.34&lt;/span&gt;
 • status&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inactive
 •&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;123&lt;/span&gt;

&lt;span class=&quot;token constant&quot;&gt;On&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Wednesday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;05&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Jan&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updated the following &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;123&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
 • name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Spinning&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Trick&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Spinning&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Brontosaurus&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt;
 • price&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11.99&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9.99&lt;/span&gt;
 • status&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inactive &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; active&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;History can also be constrained to a specific period of time, using the &lt;code&gt;start&lt;/code&gt; and &lt;code&gt;end&lt;/code&gt; parameters:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;fred &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;find&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

puts &lt;span class=&quot;token constant&quot;&gt;PaperTrailScrapbook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;UserJournal&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fred&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; klass&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
                                                start&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;parse&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&amp;#x27;2018-01-01&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
                                                &lt;span class=&quot;token keyword&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;   &lt;span class=&quot;token builtin&quot;&gt;Time&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;zone&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;now&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;story&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Which would ouput this:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;Between&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Monday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;01&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Jan&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;AM&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;00&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;00&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Friday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;23&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Feb&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;05&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;AM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Fred&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Flintstone&lt;/span&gt; made the following changes&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;

&lt;span class=&quot;token constant&quot;&gt;On&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Wednesday&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;05&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Jan&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2018&lt;/span&gt; at &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PM&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; updated the following &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;123&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
 • name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Spinning&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Trick&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Spinning&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Brontosaurus&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;Widget&lt;/span&gt;
 • price&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11.99&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9.99&lt;/span&gt;
 • status&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; inactive &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; active&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3&gt;Customization&lt;/h3&gt;&lt;p&gt;If your system allows for instances of your whodunnit class to be deleted, you may run across a situation where the whodunnit for a version no longer exists in your database. You can customize the behavior of PaperTrailScrapbook for that scenario by providing a proc for invalid whodunnits in your configuration file, as follows:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt; config&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;invalid_whodunnit &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; proc &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;id&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;** DELETED: &lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token delimiter tag&quot;&gt;#{&lt;/span&gt;id&lt;span class=&quot;token delimiter tag&quot;&gt;}&lt;/span&gt;&lt;/span&gt;**&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3&gt;Caveats&lt;/h3&gt;&lt;p&gt;This project is still in its infancy, so you may hit occasional quirks or behavior that isn&amp;#x27;t ideal for your application. If you do, I&amp;#x27;d consider submitting an issue or even a pull request. Any contributions are definitely welcomed and appreciated.&lt;/p&gt;&lt;p&gt;That said, there are a few known behaviors that I&amp;#x27;d like to mention.&lt;/p&gt;&lt;p&gt;Querying for changes made by a person can take a &lt;em&gt;very&lt;/em&gt; long time if your project has several large tables and the person has been active. If you can, scoping by class or time period will improve performance drastically.&lt;/p&gt;&lt;p&gt;Another area that could use improvement is in the presentation of serialized fields. &lt;/p&gt;&lt;p&gt;Imagine you have a &lt;code&gt;Container&lt;/code&gt; class with a serialized Hash field, called &lt;code&gt;capacity&lt;/code&gt;. If you were to populate the &lt;code&gt;capacity&lt;/code&gt; field with the following hash:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&amp;quot;weight&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&amp;quot;min&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;25&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&amp;quot;max&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;50&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;and ran history on your object instance, you would see something like this for the change on &lt;code&gt;capacity&lt;/code&gt;:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;• capacity&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;ruby&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;hash&lt;span class=&quot;token symbol&quot;&gt;:ActiveSupport&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;HashWithIndifferentAccess&lt;/span&gt;
weight&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;ruby&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;hash&lt;span class=&quot;token symbol&quot;&gt;:ActiveSupport&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;HashWithIndifferentAccess&lt;/span&gt;
min&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;25&amp;#x27;&lt;/span&gt;
max&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;50&amp;#x27;&lt;/span&gt;
added&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;and then if you updated the value to include &lt;code&gt;height&lt;/code&gt; limits so the hash was:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&amp;quot;weight&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&amp;quot;min&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;20&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&amp;quot;max&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;40&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&amp;quot;height&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&amp;quot;min&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;55&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&amp;quot;max&amp;quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;quot;65&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;and re-ran history, you&amp;#x27;d see this for the change:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ruby&quot;&gt;&lt;pre class=&quot;language-ruby&quot;&gt;&lt;code class=&quot;language-ruby&quot;&gt;• capacity&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;ruby&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;hash&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;with&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;ivars&lt;span class=&quot;token symbol&quot;&gt;:ActionController&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Parameters&lt;/span&gt;
elements&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
weight&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;ruby&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;hash&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;with&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;ivars&lt;span class=&quot;token symbol&quot;&gt;:ActionController&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;Parameters&lt;/span&gt;
elements&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
min&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;25&amp;#x27;&lt;/span&gt;
max&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;50&amp;#x27;&lt;/span&gt;
ivars&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;@permitted&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
ivars&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;@permitted&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;ruby&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;hash&lt;span class=&quot;token symbol&quot;&gt;:ActiveSupport&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;HashWithIndifferentAccess&lt;/span&gt;
weight&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;ruby&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;hash&lt;span class=&quot;token symbol&quot;&gt;:ActiveSupport&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;HashWithIndifferentAccess&lt;/span&gt;
min&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;20&amp;#x27;&lt;/span&gt;
max&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;40&amp;#x27;&lt;/span&gt;
height&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;ruby&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;hash&lt;span class=&quot;token symbol&quot;&gt;:ActiveSupport&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;HashWithIndifferentAccess&lt;/span&gt;
min&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;55&amp;#x27;&lt;/span&gt;
max&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;#x27;65&amp;#x27;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;All of the information is there, but as you can see, it can get a little unwieldy to wrap your head around as the hash grows in size. Serialized arrays face similar challenges, but the amount of data displayed for a change is nowhere near as verbose.&lt;/p&gt;&lt;h2&gt;Summary&lt;/h2&gt;&lt;p&gt;These two gems provide a great way to track changes made to your application&amp;#x27;s data.&lt;/p&gt;&lt;p&gt;&lt;code&gt;PaperTrail&lt;/code&gt; is a well established gem and is used by many applications in their production environment. &lt;/p&gt;&lt;p&gt;&lt;code&gt;PaperTrailScrapbook&lt;/code&gt; is hugely helpful for following changes made over time. It provides useful tools for observing how people are using your application and the sorts of changes they are making to data. I am excited to see how the project continues to evolve and grow as time goes on.&lt;/p&gt;&lt;h2&gt;Next Time&lt;/h2&gt;&lt;p&gt;In the next post in this series, we&amp;#x27;ll take a look at the handy-dandy &lt;a href=&quot;https://github.com/snusnu/procto&quot;&gt;Procto gem&lt;/a&gt;, which provides an excellent way to turn &amp;quot;your ruby object into a method object&amp;quot;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Upgrading CodePen]]></title><description><![CDATA[TLDR: Our cofounder Joshua Wood was  recently on the weekly CodePen.io podcast  to discuss how we helped them upgrade their Rails app: 09…]]></description><link>https://hint.io/blog/upgrading-codepen</link><guid isPermaLink="false">https://hint.io/blog/upgrading-codepen</guid><dc:creator><![CDATA[kyleBoe]]></dc:creator><pubDate>Tue, 05 Jul 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;TLDR: Our cofounder Joshua Wood was &lt;a href=&quot;https://blog.codepen.io/2016/06/28/096-upgrading-rails/&quot;&gt;recently on the weekly CodePen.io podcast&lt;/a&gt; to discuss how we helped them upgrade their Rails app:&lt;/em&gt;&lt;/p&gt;&lt;audio controls=&quot;&quot; preload=&quot;none&quot;&gt;&lt;source type=&quot;audio/mpeg&quot; src=&quot;https://media.blubrry.com/codepen_radio/p/codepen-podcast.s3.amazonaws.com/096.mp3?_=1&quot;/&gt;&lt;/audio&gt;&lt;br/&gt;&lt;p&gt;&lt;a href=&quot;https://blog.codepen.io/2016/06/28/096-upgrading-rails/&quot;&gt;096:Upgrading Rails&lt;/a&gt;&lt;/p&gt;&lt;p&gt;You may have seen our ad in Ruby Weekly advertising our site &lt;a href=&quot;https://www.upgraderails.com/&quot;&gt;UpgradeRails.com&lt;/a&gt;. In response to our ad, the fine folks over at &lt;a href=&quot;http://codepen.io/&quot;&gt;CodePen.io&lt;/a&gt; got in touch with us and threw down the gauntlet: upgrade CodePen from Rails 3.2 to Rails 4.2.&lt;/p&gt;&lt;p&gt;After analyzing CodePen&amp;#x27;s codebase and determining that the upgrade was within their budget, we got to work. The end result: we crushed it!&lt;/p&gt;&lt;img src=&quot;https://media.giphy.com/media/fGkCHF0bzRWPm/giphy.gif&quot; alt=&quot;Crushing it gif&quot; title=&quot;Crushing it&quot;/&gt;&lt;p&gt;They were so happy with our work that they invited our very own cofounder and creator of Upgrade Rails, &lt;a href=&quot;https://twitter.com/joshuap&quot;&gt;Joshua Wood&lt;/a&gt;, onto their weekly podcast to talk about the upgrade. During the podcast CodePen cofounder Tim Sabat summarized it best:&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;“This is the perfect thing for us to consult on… we can be building user facing features while [Hint] can be working hard in the background.”&lt;/p&gt;&lt;byline&gt;- Tim Sabat&lt;/byline&gt;&lt;/blockquote&gt;&lt;p&gt;To hear all about the upgrade process, &lt;a href=&quot;https://blog.codepen.io/2016/06/28/096-upgrading-rails/&quot;&gt;check out the podcast&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Case Study: CodePen Rails Upgrade]]></title><description><![CDATA[Hint recently worked with the awesome  CodePen  team to
 upgrade their rails app ,
which we also  discussed on their podcast . Check out the…]]></description><link>https://hint.io/blog/codepen-case-study</link><guid isPermaLink="false">https://hint.io/blog/codepen-case-study</guid><dc:creator><![CDATA[joshWood]]></dc:creator><pubDate>Wed, 29 Jun 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Hint recently worked with the awesome &lt;a href=&quot;https://codepen.io/&quot;&gt;CodePen&lt;/a&gt; team to
&lt;a href=&quot;https://www.upgraderails.com/?utm_source=hint&amp;amp;utm_medium=link&amp;amp;utm_campaign=CodePenCaseStudy&quot;&gt;upgrade their rails app&lt;/a&gt;,
which we also &lt;a href=&quot;https://hint.io/blog/upgrading-codepen&quot;&gt;discussed on their podcast&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;Check out the following case study for the full story of the upgrade and how
we helped CodePen modernize their Rails app without impacting feature
development!&lt;/p&gt;&lt;p&gt;&lt;a href=&quot;/blog/freebies/UpgradeRails_CaseStudy_CodePen.pdf&quot;&gt;Download the case study as a PDF&lt;/a&gt;&lt;/p&gt;&lt;blockquote&gt;&lt;p&gt;“This is the perfect thing to bring a consultant on for because we can be
building user facing features and &lt;a href=&quot;https://upgraderails.com&quot;&gt;UpgradeRails&lt;/a&gt;
can be working super hard in the background. And they specialize in this; this
is what their firm does at this point, so to me this is a perfect use of our
hard earned dollars to put back into the company.”&lt;/p&gt;&lt;byline&gt;- Tim Sabat, Cofounder CodePen&lt;/byline&gt;&lt;/blockquote&gt;&lt;h2&gt;Executive Summary&lt;/h2&gt;&lt;p&gt;In 2016 CodePen selected UpgradeRails to upgrade the primary component of
their platform – a Rails application – from Rails 3.2 to 4.2; a critical
upgrade because Rails 3.2 has reached end-of-life and is open to security
vulnerabilities. The CodePen development team is hyper-focused on product
development, lacking the necessary time to complete the upgrade in-house.&lt;/p&gt;&lt;p&gt;CodePen chose UpgradeRails over several other options because we specialize
exclusively in Rails upgrade projects. Our process makes us the most
affordable as well as the most experienced option on the market.&lt;/p&gt;&lt;p&gt;Initially estimated at 1-2 weeks, the project was completed in exactly 1 week
(32 hours) of development time. The upgrade progressed in tandem with the
in-house product development, whose team were involved during a short
integration phase only.&lt;/p&gt;&lt;p&gt;The end result is that UpgradeRails completed the upgrade with minimal
disruption and in  significantly less time than it would have taken a less
experienced team to do the same work, saving CodePen tens of thousands of
dollars. CodePen’s Rails application is now up-to-date and secure, and the
CodePen development team continues to meet product deadlines which would be
otherwise impossible.&lt;/p&gt;&lt;h2&gt;Background&lt;/h2&gt;&lt;p&gt;CodePen was founded by Alex Vazquez, Tim Sabat and Chris Coyier in 2012, and
since has grown to a team of 8. The web-based service, which provides
front-end developers with shared code sandboxes and collaboration tools, has
over half a million users and is ranked 1,249 out of all sites on the Internet
by Alexa, with 2.3 million unique visitors per month.&lt;/p&gt;&lt;p&gt;The core of CodePen’s technology is a web application built on Ruby on Rails;
the application leverages the full Rails stack and also makes heavy use of
JavaScript on the front-end.&lt;/p&gt;&lt;p&gt;As a small team serving a relatively large user base, one of the key
challenges faced by CodePen is keeping their software stack up-to-date while
under pressure to continually deliver new features to their customers.&lt;/p&gt;&lt;p&gt;When they contacted UpgradeRails they were on Rails 3.2, while the latest
version of Rails – version 5 – was just completing beta testing. It became
critical that they update to a newer version of Rails for several reasons:&lt;/p&gt;&lt;p&gt;Rails 3.2 is no longer maintained. As a result security patches are not
released, exposing CodePen to vulnerabilities and hacking attempts.
It is much easier for developers to work with the latest version of Rails; the
documentation and discussions on the web often reference the newest version of
Rails, making it difficult for the development team to find answers for older
versions.
They would be able to use new features and methods, increasing the pace of
development.&lt;/p&gt;&lt;h2&gt;Alternatives&lt;/h2&gt;&lt;p&gt;CodePen had several alternatives to consider when planning their Rails upgrade
project, which we’ll discuss in turn. In each case, they came to the
conclusion it was more efficient to hire UpgradeRails.&lt;/p&gt;&lt;h3&gt;Perform the upgrade in-house&lt;/h3&gt;&lt;p&gt;CodePen potentially could have had their in-house development team perform the
upgrade. Rails maintains adequate documentation for upgrading Rails itself to
newer versions, and there are a number of resources online. Companies perform
their own upgrades in-house all the time, and typically spend substantial time
and money in the process.&lt;/p&gt;&lt;p&gt;The main reason an in-house project was not feasible for CodePen is the
disruptive impact on their development team that already had a heavy workload.
Stopping to work on maintenance projects (which if done correctly have no
immediate user-facing impact, beyond better performance) was a distraction
they couldn’t afford to manage themselves.&lt;/p&gt;&lt;p&gt;Additionally, UpgradeRails specializes in upgrading Rails applications. Our
process allows us to do the work far faster than a team which must multi-task,
translating to lower costs and shorter duration. CodePen did the math and
realized it was also cheaper to have us upgrade their Rails app vs. upgrading
in-house.&lt;/p&gt;&lt;h3&gt;Hire an agency&lt;/h3&gt;&lt;p&gt;Another option was to outsource the upgrade to a more standard Rails agency.
This solved the problem of distracting the in-house development team, but did
not win on cost. Agency rates may vary, but confidence in the outcome of the
project would necessitate hiring a top agency; the process we’ve developed at
UpgradeRails allows us to upgrade Rails applications faster than other top
agencies while bringing more experience to the table in our area of expertise.
That translates to a higher quality and lower cost service.&lt;/p&gt;&lt;h2&gt;Solution&lt;/h2&gt;&lt;p&gt;When CodePen engaged UpgradeRails, we began by discussing their goal for the
project - to modernize their Rails application with minimal impact to their
development team.&lt;/p&gt;&lt;p&gt;We agreed that because Rails 5 was not released yet, the target version should
be the latest stable version of Rails: version 4.2. With that in mind, we knew
there were 3 steps to perform:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Upgrade from Rails 3.2 to 4.0&lt;/li&gt;&lt;li&gt;Upgrade from Rails 4.0 to 4.1&lt;/li&gt;&lt;li&gt;Upgrade from Rails 4.1 to 4.2&lt;/li&gt;&lt;/ul&gt;&lt;p&gt;It’s important to perform each upgrade incrementally - it’s easy to miss
required steps when jumping versions. Additionally, there are several phases
which upgrade steps must go through:&lt;/p&gt;&lt;p&gt;Development - Our teams upgrade the Rails application; all changes are applied
to a dedicated code branch.
Integration - As CodePen teams make changes to their master code branch, we
integrate their changes into the upgrade. When the upgrade is complete, we
integrate our branch back into the master branch.
Quality Assurance (QA) - CodePen is responsible to test deployment of the
upgrade to staging environments to verify that the production deployment will
go smoothly and that application features work correctly.
Deployment - After completing QA, CodePen deploys the upgrade to production
environments.&lt;/p&gt;&lt;p&gt;With these targets in mind, our team swung into action and began the upgrade
from Rails 3.2 to 4.0. The upgrade was performed while CodePen’s product
development team continued their work on application features; periodically we
integrated new work from their team into our upgrade branch of development. Our
process is engineered in a manner which strategically avoid conflicts with
other teams, resulting in minimal merge conflicts during integration.&lt;/p&gt;&lt;p&gt;After completing this initial 4.0 upgrade, we submitted our branch to CodePen
for review and QA testing. We advised that they move to Rails 4.0 in
production environments after testing was completed in order to avoid
unnecessary integration cycles during the subsequent Rails 4.1 and 4.2
upgrades.&lt;/p&gt;&lt;p&gt;Next the upgrades to Rails 4.1 and 4.2 were performed. While each upgrade was
performed sequentially, we opted to deploy 4.2 to production after both
upgrades were completed saving time during QA testing (essentially cutting QA
and deployment time in half). During the 4.1 and 4.2 upgrades we also offered
several recommendations for necessary code changes which we back-ported to
Rails 4.0 to minimize conflicts during integration.&lt;/p&gt;&lt;p&gt;When the 4.2 upgrade was ready for QA, we review with CodePen the important
changes to the application and provided checklists for their developers to
review. The final production deployment was performed successfully and in a
timely manner.&lt;/p&gt;&lt;h2&gt;Recommendations&lt;/h2&gt;&lt;p&gt;We continue to refine our process as we complete further Rails upgrades. Our
goal is to continually lower the cost and risk of upgrading as we acquire new
methods, tools and knowledge to speed our pace of development. A few lessons
from the CodePen upgrade follow.&lt;/p&gt;&lt;h3&gt;Coordinating QA testing and deployment&lt;/h3&gt;&lt;p&gt;It’s extremely important that QA testing is performed in the proper
environments and that all teams plan for the time required to respond to
potential bugs and issues before deployment is completed. During the deployment
of the Rails 4.0 upgrade there was a bug which caused user sessions to be
reset, meaning that users had to re-login to the site. This was the result of a
setting which was not configured properly during development. Normally this is
something that would have been caught during QA, but QA was not performed, and
the deployment happened without additional review. We used this experience to
improve our process in several ways:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;The misconfigured setting has been added as an issue to our internal pre-QA checklist so that our teams do not miss it during future projects.&lt;/li&gt;&lt;li&gt;We now provide customers with a more detailed process for QA and deployment phases, which are largely their responsibility. This includes checklists and other materials which our customers should use to test the deployment scenario for their applications.&lt;/li&gt;&lt;/ul&gt;&lt;h3&gt;Code improvement opportunities&lt;/h3&gt;&lt;p&gt;New versions of Rails often include changes which attempt to curb bad
development practices and plug gaps in prior versions. As a result, sometimes
a workaround that was necessary on an older version of Rails may conflict with
the newer version. These types of issues are sometimes missed by the test
suite and need to be fleshed out during the review and QA phase; occasionally
there will be an issue which makes it through QA and into production, where
more of the application is exercised in unique ways. While this can be
irritating, the end result is that the quality of the code improves during the
process of working through these issues. The upgrade process is a valuable
opportunity to ensure that the application is using the current best practices
in the Rails community.&lt;/p&gt;&lt;h2&gt;Conclusion&lt;/h2&gt;&lt;p&gt;When first contacted CodePen’s current version of Rails – version 3.2 – had
reached end-of-life, resulting in security vulnerabilities. It was imperative
to upgrade, however their in-house development team didn’t have the necessary
capacity available in a near-term time frame. While the upgrade work was
essential, it was not customer-facing, making it the perfect project for
CodePen to outsource.&lt;/p&gt;&lt;p&gt;CodePen chose UpgradeRails because we specialize in upgrading Rails
applications and have developed a process which allows us to perform Rails
upgrades in dramatically less time than it would take an internal team or an
external agency to complete the same effort.&lt;/p&gt;&lt;p&gt;Working with UpgradeRails allowed CodePen to continue to meet product deadlines
for THEIR clients without missing a step while we performed the upgrade
concurrently in the background.&lt;/p&gt;&lt;p&gt;The end result is that CodePen saved tens of thousands of dollars by engaging
UpgradeRails while meeting their business and product goals. Their Rails
application is now modern and secure, and their development team continues to
meet product deadlines which would have not been possible otherwise.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[How to Upgrade to Rails 5]]></title><description><![CDATA[Ruby on Rails version 5 is just around the corner, with 5.0.0.beta3 released in
late February. Is your app ready? Follow these steps/best…]]></description><link>https://hint.io/blog/upgrade-ruby-on-rails</link><guid isPermaLink="false">https://hint.io/blog/upgrade-ruby-on-rails</guid><dc:creator><![CDATA[joshWood]]></dc:creator><pubDate>Mon, 07 Mar 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Ruby on Rails version 5 is just around the corner, with 5.0.0.beta3 released in
late February. Is your app ready? Follow these steps/best practices to update
your app to the latest version of Rails as smoothly as possible.&lt;/p&gt;&lt;h2&gt;Check your Ruby version&lt;/h2&gt;&lt;p&gt;The first thing you&amp;#x27;ll need to know is the Ruby version your app currently
supports. If you&amp;#x27;re on an old version, then you may need to upgrade Ruby before
you upgrade Rails. Rails 5 requires Ruby 2.2.2 or newer. We recommend upgrading
to 2.3.0, which is the latest version of Ruby.&lt;/p&gt;&lt;h2&gt;Check your Rails version&lt;/h2&gt;&lt;p&gt;The &lt;a href=&quot;https://rubygems.org/gems/rails/versions&quot;&gt;current stable version&lt;/a&gt; of Ruby
on Rails is Rails 4.2.5. If you&amp;#x27;re on an earlier version, you should upgrade to
4.2.5 &lt;strong&gt;before&lt;/strong&gt; attempting to upgrade to version 5.0.0. To avoid some serious
headaches, it&amp;#x27;s best to upgrade in increments; for example, from 4.1.5 to
4.1.15, 4.1.15 to 4.2.5 and finally from 4.2.5 to 5.0.0. Otherwise you
will lose valuable deprecation warnings and be stumped when things just stop
working for no apparent reason.&lt;/p&gt;&lt;h2&gt;Use your test suite&lt;/h2&gt;&lt;p&gt;A solid automated test suite is invaluable when performing an upgrade; tests
ensure that your app executes the same way after the upgrade as it did before.
If the test coverage (the amount of code that gets executed when your tests run)
for your app is high, then many bugs and inconsistencies created by the upgrade
process will be discovered up front rather than waiting for your users to
encounter them (if you don&amp;#x27;t write tests, make sure you use
&lt;a href=&quot;https://www.honeybadger.io/&quot;&gt;Honeybadger&lt;/a&gt; :)).&lt;/p&gt;&lt;p&gt;&lt;strong&gt;PROTIP: Write some tests before an upgrade if you don&amp;#x27;t have a test suite, or
if your test coverage is low.&lt;/strong&gt;&lt;/p&gt;&lt;h2&gt;Review your dependencies&lt;/h2&gt;&lt;p&gt;Many surprises may be lurking in your Gemfile. When you go to update the &lt;code&gt;rails&lt;/code&gt;
gem, for instance, you may realize that the &lt;code&gt;rspec-rails&lt;/code&gt; gem must also be
updated. But wait, the latest version of RSpec has new syntax, and before long
you find yourself rewriting your test suite. That&amp;#x27;s what we call &lt;a href=&quot;http://sethgodin.typepad.com/seths_blog/2005/03/dont_shave_that.html&quot;&gt;shaving a
yak&lt;/a&gt;, and
we prefer not to do it; or at least we like to know about it ahead of time. Take
a look at your gems before starting the upgrade and see if you can identify some
yaks; your future (less surprised) self will thank you.&lt;/p&gt;&lt;h2&gt;Pick your battles&lt;/h2&gt;&lt;p&gt;Speaking of yak shaving, it&amp;#x27;s easy to get tangled up in making changes to your
application code when Rails changes a core feature. Avoid changing your code as
much as possible until after you&amp;#x27;re successfully running the new version of
Rails. This will reduce the number of bugs you have to deal with immediately. In
some cases Rails makes this easy by providing backwards-compatibility for a
deprecated feature via adding a gem.&lt;/p&gt;&lt;p&gt;A great example of this is &lt;a href=&quot;http://edgeguides.rubyonrails.org/action_controller_overview.html#strong-parameters&quot;&gt;strong
parameters&lt;/a&gt;.
Prior to version 4, Rails had a feature called &amp;quot;protected attributes&amp;quot; which
protected model attributes from mass assignment exploits. In version 4 this
feature was replaced by a new approach called &amp;quot;strong parameters&amp;quot;. Upgrading
from protected attributes to strong parameters is a project in itself; one which
can involve changing a lot of model, controller and test code, and in turn makes
it easier to introduce new bugs.&lt;/p&gt;&lt;p&gt;The good news is that the Rails team &lt;a href=&quot;https://github.com/rails/protected_attributes&quot;&gt;released a
gem&lt;/a&gt; which allows you to continue
to use protected attributes on Rails 4, without migrating to strong parameters
immediately. Using this gem means changing a single line of code vs.
potentially hundreds. After you&amp;#x27;ve completed the upgrade, plan a followup
project to migrate to new features provided by your new Rails version.&lt;/p&gt;&lt;h2&gt;Preserve history&lt;/h2&gt;&lt;p&gt;You&amp;#x27;ll still be making a lot of random changes to your app during the upgrade
process as you update syntax and refactor deprecated code; it&amp;#x27;s super easy to
get in the zone, get things working/tests passing/whatever and then save the
changes in a massive commit. &lt;em&gt;Avoid doing this&lt;/em&gt;.&lt;/p&gt;&lt;p&gt;Instead, try to make small, isolated changes and commit them as you work;
clearly explain your thinking in your commit messages so that you&amp;#x27;ll remember
your reasoning when you (and/or your team members) look back on the upgrade 6
months or a year from now.&lt;/p&gt;&lt;h2&gt;Follow the instructions&lt;/h2&gt;&lt;p&gt;The Rails team has provided an excellent &lt;a href=&quot;http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html&quot;&gt;Guide for Upgrading Ruby on
Rails&lt;/a&gt; that we
would be hard-pressed to beat. Follow the official instructions, and be sure to
read the General Advice section for even more great tips.&lt;/p&gt;&lt;p&gt;Now it&amp;#x27;s time to get to work. If you would like some help upgrading your Rails
app (or if you would rather ship features instead), be sure to check out
&lt;a href=&quot;http://www.upgraderails.com/?utm_source=hint&amp;amp;utm_medium=link&amp;amp;utm_campaign=HowToUpgradeRails&quot;&gt;UpgradeRails.com&lt;/a&gt;,
our concierge Rails upgrade
service. We&amp;#x27;ll manage the process of upgrading to the latest version of Rails
from start to finish and also schedule regular upgrades as they are released.&lt;/p&gt;&lt;p&gt;In any case, let us know how it goes! Feel free to email us your advice,
questions, or feedback.&lt;/p&gt;&lt;h2&gt;Further reading&lt;/h2&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=&quot;http://edgeguides.rubyonrails.org/upgrading_ruby_on_rails.html&quot;&gt;The official Rails upgrade
guide&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;http://guides.rubyonrails.org/maintenance_policy.html&quot;&gt;The official Rails maintenance
policy&lt;/a&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=&quot;https://www.ruby-lang.org/en/news/2016/02/24/support-plan&quot;&gt;Support plans for Ruby 2.0 and Ruby
2.1&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;</content:encoded></item></channel></rss>