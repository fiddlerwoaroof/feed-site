{
  "title":"A more secure bundler: We fixed our source priorities.",
  "date":"2022-11-14T08:17:03.000000Z",
  "author":"David Rodríguez",
  "id":"https://bundler.io/blog/2021/02/15/a-more-secure-bundler-we-fixed-our-source-priorities.html",
  "link":"https://bundler.io/blog/2021/02/15/a-more-secure-bundler-we-fixed-our-source-priorities.html",
  "content":"<blockquote>\n  <p><strong>NOTE</strong>: Whereas the issue was initially fixed in bundler 2.2.10, it had to\nbe reverted due to several problems caused by the initial approach. A proper\nfix was finally released with bundler 2.2.18.</p>\n</blockquote>\n\n<h2 id=\"what-happened\">What happened?</h2>\n\n<p>Last week <a href=\"https://medium.com/@alex.birsan/dependency-confusion-4a5d60fec610\">an article about “Dependency\nConfusion”</a>\nhit the news, where a developer was able to make thousands of dollars on bug\nbounty programs from big tech companies, by pushing libraries to public\nrepositories that ended up unintentionally being installed into these companies\nservers.</p>\n\n<p>The developer was able to expose (in a non-malicious way) a vulnerability\npresent in well-known dependency managers, where given a library name they will\nend up preferring installing it from a public source rather than from a private\nsource. This is not secure because the name in the public source is controlled\nby the first person claiming it, whereas the name in the private source is controlled\nby the private source owner.</p>\n\n<p>Unfortunately, Bundler had this vulnerability.</p>\n\n<p>There’s good news though:</p>\n\n<h2 id=\"things-were-safe-on-the-rubygemsorg-side\">Things were safe on the rubygems.org side</h2>\n\n<p>The rubygems.org organization, in collaboration with\n<a href=\"https://diffend.io\">diffend.io</a>, have a pretty good malicious code detection\nsystem. In fact, the only reason this developer was able to make all this money\nby getting these gems installed in companies private servers is because our\nsystem detected them, flagged them for us, and we determined them to be\nnon-malicious, and only for research purposes. If those gems had been malicious,\nwe wouldn’t have allowed them.</p>\n\n<p>Check out the <a href=\"https://mensfeld.pl/2021/02/rubygems-dependency-confusion-side-of-things/\">more detailed blog\npost</a>\nfrom our diffend.io friends about what happened in the rubygems.org side of\nthings, and how things were secure.</p>\n\n<h2 id=\"the-issue-has-been-fixed-in-bundler-2210\">The issue has been fixed in bundler 2.2.10</h2>\n\n<p>We have shipped bundler 2.2.10 with a fix, and now whenever you specify a block\nsource in your <code>Gemfile</code>, bundler will prioritize it when resolving direct\ndependencies specified inside, and also transitive dependencies of those. So in\nthe following situation both <code>my-private-gem</code> and <code>my-another-private-gem</code> will\nbe picked up from <code>https://my-private-server</code>, even if someone pushes a higher\nversion with the same name to <code>rubygems.org</code>:</p>\n\n<div class=\"highlight\"><pre class=\"highlight ruby\"><code><span class=\"c1\"># my-private-gem.gemspec</span>\n<span class=\"c1\"># ...</span>\n<span class=\"n\">gem</span><span class=\"p\">.</span><span class=\"nf\">dependency</span><span class=\"p\">(</span><span class=\"s2\">&quot;my-another-private-gem&quot;</span><span class=\"p\">)</span>\n</code></pre></div>\n<div class=\"highlight\"><pre class=\"highlight ruby\"><code><span class=\"c1\"># Gemfile</span>\n\n<span class=\"n\">source</span> <span class=\"s2\">&quot;https://rubygems.org&quot;</span>\n\n<span class=\"n\">source</span> <span class=\"s2\">&quot;https://my-private-server&quot;</span> <span class=\"k\">do</span>\n  <span class=\"n\">gem</span> <span class=\"s2\">&quot;my-private-gem&quot;</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>Make sure you upgrade your bundler version either by running <code>gem install\nbundler</code>, or by upgrading rubygems through <code>gem update --system</code> (which will\ninstall bundler 2.2.10 as a default gem).</p>\n\n<h2 id=\"final-notes\">Final notes</h2>\n\n<p>The bundler team had actually been aware of this issue for a while, but\nunfortunately lacks resources to take care of everything we need to take care,\nso the fix was postponed for too long. Maintaining the rubygems.org\ninfrastructure and its client libraries requires a big amount of work and we\nbarely manage to keep up with it. So, if your company really needs us to stay on\ntop of these issues, please consider funding\n<a href=\"https://rubytogether.org/\">RubyTogether</a> ❤️.</p>\n\n<p>That’s all for today,</p>\n\n<p>Happy bundling!</p>\n\n<hr>\n\n<p>Deivid, André and the RubyGems team</p>\n"
}